[{"id":"80eab637.b91808","type":"tab","label":"MBP3222","disabled":false,"info":""},{"id":"b6837abd.323fd8","type":"tab","label":"IBU F","disabled":false,"info":""},{"id":"fd486f91.7596e","type":"tab","label":"Tambat","disabled":false,"info":""},{"id":"ce7006a0.688478","type":"tab","label":"MBP3206","disabled":false,"info":""},{"id":"323faf53d384df59","type":"tab","label":"Tulus","disabled":false,"info":""},{"id":"47ec9b6e.206e24","type":"tab","label":"Olahdata","disabled":false,"info":""},{"id":"ea265a0.2300aa8","type":"tab","label":"VMS Reporting ","disabled":false,"info":""},{"id":"0cc168986be28252","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"eb274b9b.a25048","type":"tab","label":"dev","disabled":false,"info":""},{"id":"7399def9.9066","type":"tab","label":"Tuhup1","disabled":false,"info":""},{"id":"51c3eae1.47d714","type":"tab","label":"Website","disabled":true,"info":""},{"id":"31a1ac1c.c57c44","type":"tab","label":"Kelanis","disabled":false,"info":""},{"id":"fdac93f7.bec1b","type":"tab","label":"Inject","disabled":false,"info":""},{"id":"4ac8b097.5249b","type":"tab","label":"Inject2","disabled":false,"info":""},{"id":"e2749508.bbf528","type":"tab","label":"KELANIS APEX","disabled":false,"info":""},{"id":"720653e6.744a9c","type":"tab","label":"HydroPonik","disabled":false,"info":""},{"id":"0b6b53eb180f1e72","type":"tab","label":"Test3206","disabled":false,"info":""},{"id":"ebaf9ff27fa33555","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"e9b71a55.b25c68","type":"subflow","name":"Loops","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"9f7aa00f.d31ab"}]}],"out":[{"x":640,"y":40,"wires":[{"id":"f2a7b456.1521f8","port":0}]},{"x":540,"y":260,"wires":[{"id":"71533a81.973c84","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7a8c1823.dfa1d8","type":"group","z":"31a1ac1c.c57c44","name":"IMOVEID DUMMY","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["2bd48929.07ead6","1fef08d2.29cf97","2d42621e.33f07e","82c6af33.cfc04","65a775dc.49cdbc","1390e59c.fec25a","9a4d3da9.578b7","4643019f.f6f7c","eec00471.aa04c8","3aa39cb2.83e234","ceafde35.c9a9b","6cfe0132.7775","7ff3e4c4.72505c","304d3052.e9aa1","a9a6d6a1.f7e3c8","e9691310.1ffd6","dac780da.8bf44","c1992428.8ba2b8","803cb194.c1073","89f0118d.20836","fd32f2c6.63671"],"x":1074,"y":2339,"w":922,"h":262},{"id":"c0a41fe1.51ff1","type":"group","z":"31a1ac1c.c57c44","name":"Cycle","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["fea0fcea.05f15","9d6fdf25.0b455","e57e8a78.dd31b8","32fa3a6a.423bf6","f49178fd.599a18"],"x":34,"y":2379,"w":452,"h":162},{"id":"cf3284e7.37ba88","type":"group","z":"31a1ac1c.c57c44","name":"Process","style":{"fill":"#ffbfbf","label":true,"color":"#000000"},"nodes":["f3201188.1fcc5","10f27db.4c8f582","f9b61dc7.6c8fd","c47284b0.41acf8","ce25a5ca.4281f8","15dcadce.77aea2","ad333df4.70efd","3f47b80a.eda868","60b79821.a39c48","9f6f19c9.112118","c97d2897.6de388","609aa5c8.c8958c"],"x":36,"y":2559,"w":842,"h":202},{"id":"85b897f2.9dd298","type":"group","z":"31a1ac1c.c57c44","name":"VMS DATA DUMMY","style":{"fill":"#dbcbe7","label":true,"color":"#000000"},"nodes":["18798a17.c35876","2dbf37df.28f668","857a3e4c.a9109","a5197857.de7af8","32caa4a2.d4c68c","1aa9c51b.d9fa4b","a10b445.dd72db8","31157c44.26f504","5d81dccd.aa90a4","67365fe.b62e4a","c2d8eec3.4bc51","14bbfda1.0b6df2","2c1c49f5.d246f6","8c0c4769.cbd278","3e75653d.8c01aa","f2c99a81.6efa28","2f6907b1.d22008","b2d406e1.cd7b68","fb8f2c93.f8dd3","fe6fe555.2341e8","e8be98ae.0d54e8","90f0a782.dddb78","3ec6b1f2.efd6de","b60e66ef.8998d8","554ef1d3.6dc99","a818978f.141f58"],"x":34,"y":2779,"w":1282,"h":642},{"id":"16e14cdc.ac2753","type":"group","z":"31a1ac1c.c57c44","name":"Update Flag","style":{"fill":"#7fb7df","label":true,"color":"#000000"},"nodes":["8c3a1cbe.e74b2","3992738a.708fac","ad7f0b55.aaca98","3369c47.6fb7f3c","7210e7a7.7a9ea8","4a43974d.de4c68","42ca0217.53504c"],"x":514,"y":2379,"w":502,"h":162},{"id":"93c266f2.b8a218","type":"group","z":"31a1ac1c.c57c44","name":"Update Flag","style":{"fill":"#7fb7df","label":true,"color":"#000000"},"nodes":["1ea8e023.ce126","2bf2b20.a917c4e","98371b08.a98558","8a077621.940f28","b11e1b46.abe088","1bb87642.26548a","53fb5bf3.66cbe4"],"x":1094,"y":3839,"w":502,"h":162},{"id":"7726a67f.543948","type":"group","z":"31a1ac1c.c57c44","name":"IMOVEID DUMMY","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["796088bc.016df8","38188e6d.853692","47322e0d.4cdea","6714cf3.b134d3","dd13a738.c4b718","348557e0.9b1dc8","dff9d26c.feb2c","6d10830d.6bd5dc","c0c43ee4.99a99","6cd82582.acc53c","a5dad4d.7962c28","e8bc431c.8b34e","4a828951.7baa08","d0bfb4e5.319f88","86f8983a.04d8a8","6d4c2476.a8fb2c","39f6a5a5.4ae1aa","383710d9.e33fa","15a7a429.b67bcc","9d0d7361.9e954","2fc7f34f.aaf8ec","f095228c.f5c91","507fa06f.ac5b","e9ea6d95.0aed8","b2aa682d.913248"],"x":54,"y":3579,"w":742,"h":242},{"id":"1c949b03.b3b8e5","type":"group","z":"31a1ac1c.c57c44","name":"CycleA1","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["d67beda1.0b541","8608589a.488e98","daeafd15.57d56","ae8d0de5.307f4","e6463724.5db558"],"x":54,"y":3839,"w":452,"h":162},{"id":"159284bb.9da1bb","type":"group","z":"31a1ac1c.c57c44","name":"Process","style":{"fill":"#ffbfbf","label":true,"color":"#000000"},"nodes":["934c739b.aca5e","9b2d1086.a52f8","57be10c0.67315","bca9e4e0.b85b18","a41af69e.76d3c8","5a9df685.033318","2d51cda8.801402","b9bf3b77.bc0f98","57bf5783.50aed8","5a351969.0fcff8","e9d47aa6.aa67b8"],"x":54,"y":4019,"w":872,"h":202},{"id":"9d67465f.bdd6e8","type":"group","z":"31a1ac1c.c57c44","name":"VMS DATA DUMMY","style":{"fill":"#dbcbe7","label":true,"color":"#000000"},"nodes":["8441a26e.3e5a7","eff6aa8a.5fc038","473f1d80.0004c4","a6a154a4.718208","a85e2c93.d7cd2","3fe9e662.ed481a","869bb822.d1d648","4e8fe3f0.ad327c","87636e9f.673f2","1a9f9da7.cc4862","237db2d9.4d4e6e"],"x":54,"y":4239,"w":1032,"h":142},{"id":"bbe9b9b5.691c98","type":"group","z":"31a1ac1c.c57c44","name":"IMOVEID DUMMY","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["66f779ee.1734a8","6ddae762.1ab868","ac3d804.d1c228","4b930659.c88258","857faf88.d9232","55ae4137.2f712","a014a0e1.ea37a","eb7bae3d.96ee8","b6e459fb.6000f8","12a75c9f.5e6413","49575bda.dec1d4","e212e373.e380d","d58bf8fd.c69f98","7d1d3e95.8b608","5a9391e4.af742","ebba1b98.7d9458","5d0901d8.e49d1","e5e68ca9.5e202","c5bb2798.5b37a8","eb0ae5e.cb7a318","eee1d1a5.4dcf9","87435471.893458"],"x":814,"y":3579,"w":742,"h":242},{"id":"a9aa65e3.d865a8","type":"group","z":"31a1ac1c.c57c44","name":"CycleA2","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["3424c367.7d1eac","be484a47.cefbc8","f17f08f6.360a88","e090275f.6df468","4f513cbe.2ce674","2908694a.2680e6"],"x":534,"y":3839,"w":522,"h":162},{"id":"22521.7f738adf8","type":"group","z":"31a1ac1c.c57c44","name":"VMS DATA DUMMY","style":{"fill":"#dbcbe7","label":true,"color":"#000000"},"nodes":["4b88c0d0.1499c","8712fd99.a9684","2f58b20c.cc9f9e","2bfc2f52.faf99","3bd09c7f.ac3654","e559a479.2d5508","6de490b9.267b4","1102fb34.6e1465"],"x":214,"y":4419,"w":892,"h":142},{"id":"744515a6.e4a4bc","type":"group","z":"51c3eae1.47d714","name":"Update Popup Apex","style":{"fill":"#addb7b","fill-opacity":"0.2","label":true,"label-position":"n","color":"#000000"},"nodes":["8843baa1.9c1d68","345ce2e4.0b7dee","78cb3a38.c73784","6a680e6f.fd20c","cf454677.345528","4b3058c7.5482c8","a8036a48.d79338","b7a391bb.21337","b8738ceb.63375","b615c9f6.11e028","182a49ec.a59a66","177aead2.ca7535","fc64cf29.d3f6c","34baa418.eb214c"],"x":54,"y":2619},{"id":"50aa5b6f.f7a464","type":"group","z":"80eab637.b91808","name":"UPDATE OLD TO NEW","style":{"label":true},"nodes":["40d241e0.8e712","bfa17b5f.f33208","3ced6787.ff57b8","d99d66b5.c8da18","62c5a910.08efb8","514a05d4.d3e5ac","46a2baeb.137d04","b9718d5d.79017","325f139b.e658bc","90f94c38.1e358","3d34dd3f.e872e2","ed4e2081.1a80a","41548b23.1ae8a4","f224babc.8a6948","8a7ea072.93123","97718dde.bfe4a","3c90f244.03119e"],"x":4,"y":3979,"w":1022,"h":382},{"id":"b3621802.efa748","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["6b7abe3c.230f7","d5d93666.976e58","889c4dd1.c0d73","68f46b7e.a57be4","370cad5f.8f0f42"],"x":34,"y":4239},{"id":"7b7edc02.424ab4","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["c326f269.cede2","db5aa5fa.19ff38","1873862.945c87a","19136a66.c484e6","5bbc959.078506c","f660835.cb98d8","6ceba51d.c9bc7c","9daceeb4.14475","df2d3c57.1b156","53c14aea.824a34","e348418c.bca25","8fbe45e4.641ad8","7bcd6e86.4a753","32705e2c.dba942","ca10c5b6.f19578","6964a39f.cd2b1c","d69742e3.df8b4","276c502e.3eb7f","8dc7e991.44ce58","78d7f4c8.c7416c","f5d6770f.637f18","cd3f7edc.596f5"],"x":34,"y":3899},{"id":"f906b9e0.9c7f48","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["5b2cb626.14bec8","523cd224.28ff1c","2ca8744c.43812c","5136bf02.72c61","18add830.2ae5f8"],"x":34,"y":3759},{"id":"45e9425d.ac897c","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["86861139.b53f9","c50d460.cfa84b8","8d00bc49.49288"],"x":554,"y":3799},{"id":"52a9d974.a74ad8","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["f4140b7d.7001d8","4214f163.1fd0f"],"x":41,"y":3659},{"id":"d7262ac7.319a88","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["6ff9b902.540c08","aedc507e.777a8","f447fa56.0ad1e8"],"x":117,"y":3499},{"id":"10f315b3.5886da","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["21213d0d.b055d2","cf66798f.37b908","610460d9.05eb8","f63ef6a8.4b2b48","ce1462f8.d95e3","a84438c5.73e388","8669e377.46444","9a895434.5e9738","3640f32a.c7462c","9f5b4d0f.5bc33","583e352a.0905ec","1cfe6ca7.764963","82ffacda.c2dac","ba174895.685028","ee68bd8b.dbdd"],"x":557,"y":3399},{"id":"eaea4331.3c878","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["384f5b4f.f40404","62665e20.df829","a1bd5094.71be9","78fe7aae.973f34"],"x":57,"y":3319},{"id":"a784c1.5adc1b4","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["69b31542.5fa73c","bcfd55da.6724d8","f15cc82d.168958","a1c2d5eb.5f5778","6b08606e.9de6f"],"x":74,"y":3159},{"id":"fc215eb0.952fb","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["1cd060ce.b6af6f","ecd041d8.fa4aa"],"x":561,"y":3299},{"id":"f8df85a6.93ccb8","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["f41a9bfe.99a708","9f7452e9.62cd","74bf0fb5.33ef5","1850ee2c.0d41b2","5611b68e.cb77c8","75dfa694.0c1a58","3ae09f3e.bf089","784043ae.4043dc","d0623be9.aa2c48","1a728756.7213c9","21612c43.3d9b54","4debb4bf.697d8c","607df3b1.e0725c","d1c8768b.f234e8","81433c40.45508","94ac6bb.ee84498","861763a8.b993c","7a233714.b4afb8","4aefae92.5f5c4","4f37c500.a7524c","852abc1a.dda91","7ea713f3.ad178c","ce2078c9.9f3728"],"x":64,"y":2839},{"id":"156f4df9.675f62","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["edac956b.ea48a8","1e2eb23b.70671e","e63c5cf4.142c5","c119a7db.47bf98","50ff4507.a7dcac"],"x":54,"y":2419},{"id":"fb689e78.5fa04","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["a670e3c9.220e3","63e70434.dbd2bc","76f8ac0f.43a064","609cf598.a7e2cc","619b7f79.44c41"],"x":54,"y":2299},{"id":"51dc6ef1.ebc47","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["a87d2e6a.dd55c","aa67bba7.e73778","13f32796.c12ed8","77d8b80c.ac5978","d60e9b1a.b7c208"],"x":54,"y":2119},{"id":"f2b8c5da.e09968","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["9564eaf8.9ee2b8","c1478481.726d98","87f076bc.088d58","1cb6ea29.0cb476"],"x":54,"y":1959},{"id":"7eda24b0.a1b09c","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["d4cff2c7.2b0eb","e15c73df.2ced2","1f2c3010.ddc82","8a6f3a2a.dfecf8","f8bc9e6b.16c2f","46516ad3.107444","8d93b87.6c60348"],"x":58,"y":1719},{"id":"124aada0.a21b82","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["a7550326.a19bb","7de6ad69.fbf724","f1878612.168358","4dec17a8.40afb8","9efd370.e010fc8","e3b269da.692428","bab1265b.843048","4e9ec2f.262343c","d2e0467a.56d088","1403c3ef.df21ac","9dc3f2.169adc1","e0914b2.d5d33b8","3fe811f1.842aae","2606a881.7f7578","aab3f3a7.8471","ee69f384.41225","a2bbe96c.85cf08","32fffcab.da57c4","1fe66073.c87a4","14dbbef1.cd0751","45a20f5f.7ff86","6d9e73bf.9a979c","515ba5de.a7270c","a8c63575.a963b8","742733bb.8f7dfc","22919141.00474e","ce41e76e.08f338","d55c0278.105a","e98f187a.f12448","593c29a3.617b88"],"x":54,"y":1239},{"id":"c2b70546.5e9668","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["431e8bda.866854","645ccfa1.3c1ab","e0ebb693.5831a8","58380dc7.a4f314","18dda32e.59022d","955a2c31.1ef36","a9e76c30.6d3d8","6456719c.917d4","c3c9ba83.550f98","13fa6858.f3bd78","dea9be95.a7368","57c4423e.7080ec","45623995.b46e98","72b0fff8.2326f","9f6cfd94.01455","6f015999.81b7d8","902be83b.5259b8","3191ab6f.4426b4","1cc161f2.221c8e","261043d8.59f4ac","cb307363.41651","4605ef30.38be3","774c24f7.9954ac","830f2597.363238","c7f483df.9e36b","9efb717b.623a3","55b1f904.1f80a8","8d604155.2fefb"],"x":54,"y":899},{"id":"27d3216d.4b2e7e","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["cd0fc071.a4b97","88fcbce6.b5363","228cd1c4.1e993e","ee337a70.2904c8","4d3ba2db.58118c"],"x":54,"y":759},{"id":"5d7b596d.3c2708","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["b4a2080f.2257f8","1cf1d1b7.d18cbe","b8bac9cf.4880d8","5f6b77ff.e6d9a8","1eb2e88d.0ca4f7","4ebb0a8c.b9ef04","a5ed1c08.e19dd","c15ed462.a26c08","808f7dd0.7666c"],"x":54,"y":559},{"id":"3dd003d9.b94eec","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["ebadf9a4.f2c388","be2e836a.4d0c2","a6bdede6.d6bd9","758ac4da.bdc19c","138aec54.4e2aa4","6a212d72.c2ba64","29c7f357.51551c","e8db11ee.f914"],"x":54,"y":419},{"id":"42b4dc71.c3d2e4","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["b1233f05.68963","ff2e5a37.a747d8","de3f36e9.bfec78","55de2c47.b1f284","d9443f8a.810bd","a09168ac.bdb028","e088ebf3.535998","e086e237.dca46","73c96c80.edd5c4","3e752c3f.8a2b84","221c3585.8aa2ba"],"x":54,"y":199},{"id":"4fa578fa.bfc088","type":"group","z":"51c3eae1.47d714","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["d2c16170.d056c","9e2e18eb.840718","a9f503e2.ffea4","17a816d6.9617a9","367a9cea.813f04"],"x":54,"y":59},{"id":"ac1a35ff.d8c228","type":"group","z":"fdac93f7.bec1b","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["be21cda8.ee2a5","167f8dd7.1b4dc2","967e01a4.72765","ce5bc7c5.9f5798","a1e7bd1c.82cd4","65ec51f5.fc126","b098e98.7594318","bd53d0ac.e0802","86e11661.ef4598","32eb0e13.80bf32","fe949a2d.10fe88","d9a130b2.b06ed","4c24fb7c.fdb824","12d08b25.7f5995","8449b7b7.569a48","34264e4e.a6a7f2","fc08e0fe.be313","a876d3c7.104a6","349f0798.bf8d68","17dccdbf.856182","eecdad4b.3e2a9","d33c572b.f58b98","66f2cbe.9c4a934","b4c00a91.094ca8","98075c0a.8321c","4099a982.c4b4a8","4b39e7ad.cddd48"],"x":14,"y":4219},{"id":"641d28f8.063e48","type":"group","z":"80eab637.b91808","name":"Grafana","style":{"label":true},"nodes":["1e02a385.8fbd7c","4c72669b.2d69c8","470eb8e5.9d9b38","1b02ae95.b42691","628443f4.2705cc","318a2111.591cee","171ce6f3.5a8709","88dced45.acad7","a322a1da.9143b","4148feea.d1098","a25df07f.a7c3b","2fcf5a96.a39236","4d6a4adc.c91d14","50958c64.b59744","3484aab0.a4d046","e57872dc.b6c7","79f8f273.59bd5c","5b490f12.25f5","4bd6b915.57c348","bd5a3962.5cbf18","ba26ac95.5bba4","a6a942a7.f8f04","3b549111.c7c6be","d4136a68.4cb7f8","8108fca0.13de8","b8b01df4.b5c33","3a7bacc8.1f8ca4","f70af5d5.a6c088","4bce727c.720a4c","8323177b.3ff9f8","1979c263.63619e","95310c7.cd2e3f","b3139a1c.215238","9b7fdf9d.d61be","71bd699b.81a318","453806ff.50c868","d4f568c6.5f6188","5027eb68.949d24","cf90f83e.e418d8","54453824.ea6158","1a350f1b.b77931","63da789c.3f7658","4ae3a182.654af","ad381645.878fe8","b9e2fcf7.e13ce","87116130.c063d","bb9dfabc.89f958","ea8e654.d942b98","a4d0b3a5.edc42","9efee38c.29403","340183ae.eb1d8c","ee5a63ea.cd352","11e0e60c.efc5ea","71ed0a81.ac2604","6d5e59c6.5744d8","b93a0473.17b758","7a4af1b7.0a26f","c88507a3.1af4f8","7c77b55.1f8ed4c","4c32e106.e5785","1738828b.5d70fd"],"x":14,"y":1179,"w":1292,"h":542},{"id":"54e9d374.2101fc","type":"group","z":"31a1ac1c.c57c44","name":"FMS Data ","style":{"label":true},"nodes":["31109d72.e2d522","f0c02b4.f25b5d8","fb7a9dbd.53871","121080b0.0116df","569cf2a8.36268c","8a1d1ea1.f6c3b","12fbfb74.9f0de5","6db99611.02bef8","f12f1a29.601ce8","5c6e63eb.85285c","bfad3d9.dae4dc","549a70b0.eeaa5","17496799.255968","606cfc6d.8e2144","faac9a72.4c3368","e4a83995.f59fe8","92413e6.49197c","d128570f.fe69f8","a3459018.7f6ce","19e1f5d5.5f4c6a","50dcd254.4188cc","4e1c1cc.dc382e4","1ee0d8a8.591977","6dc24344.fa1bfc","a3227de9.60b6e","8a6f430.4ef7ec","a52ed9a4.b94668","63ceb196.a4008","56c7fc65.9c2574","742a7f47.4b8d7","f70a08e.ef781f8","b047cdbb.cac52","a592759a.d3d038","45e7e819.855888","8dd3c5d9.ef8be8","9365861a.8e4398","8e7cab51.64f268","edeb8d83.210da","7bd54c86.fe99a4","10095b0c.c3ab65","cec0c607.212c98","fb1478c1.97cf68","83b11e14.df53","da716c93.8b8fd","5cdbfddb9a4ef822"],"x":-6,"y":-21,"w":1602,"h":462},{"id":"aeafb94d.da92e8","type":"group","z":"ce7006a0.688478","name":"Send","style":{"label":true},"nodes":["1c54c915.b916a7","bd922c1f.14784","7ebf14d.529d1ec","b49a241e.12aeb8","633d59a1.366d68","3ebad1d2.fcd46e","a450c1f4.0a7dd","fa56bac1.7f78b8","6063007d.6a45e","4fe44bac.5393d4","42d2bcdb.68eef4","1d0441a.cb9b7be","732c1460.ea6e2c","b434158d.dcc508","f3201f75.e4b88","80b2811d.5a041","205360a8.633ae","df8715b.2588be8","1b35846e.21d0fc","73f2d8cb.0a5a58","648e6019.2d832","301ccc4f.90e1a4","6c8eca5.ae0c734","17ed2da1.96f4d2","807ae8ae.4a8068","eeb166f2.5f1eb8","619ec01f.49537","d4afb0b7.2bf3f","5b4a75dd.9b753c","aee380a2.afc85","6aacc4a9.e9f40c","2d41f3ab.8cb90c","f396f498.da45d8","f50bfc57.c41c6","a4e1a145.54745","2f31ccfe.884094","ded0d4aa.232908","477dbec.28ff14","d85f9a06.199088","53377478.d9b2ac","398755bc.6476ea","d9201167.46ebd","ec686219.b244e","7f158e95.3cb95","84b73ddc.edfe9","540dd4f095f7eaf6","60013134c14ddc96","4086a028.3f476","851e2eb1.1a258","23b018c6.9b1338","b005afe.4b1db5","fbff0317.50656","582d18ec.57c198","245701dc.eb691e","3b79e53a.6c708a","1b4220f3.583c2f","19b707e1.9c4148","2a611480.ff107c","21147a6b.5531a6"],"x":14,"y":19,"w":1312,"h":482},{"id":"46649669.bdf2d8","type":"group","z":"e2749508.bbf528","name":"SEND DATA TO APEX (ORACLE CLOUD)","style":{"label":true,"stroke":"none","fill":"#3f3f3f","color":"#ffffff"},"nodes":["84d01d72.dc269","5037e125.b5dea","3f56d3f9.9fd2ec","72cf7665.6250f8"],"x":44,"y":179,"w":882,"h":182},{"id":"c7961627.1b6a08","type":"group","z":"e2749508.bbf528","name":"GET DATA LITER KELANIS","style":{"stroke":"none","fill":"#6f2fa0","label":true,"color":"#ffffff"},"nodes":["76cccdc3.641574","c55e7ee8.449cf","241c37c9.1cf978","65ceffc1.6da3a","b3aaa32d.0c7e4"],"x":54,"y":19,"w":872,"h":142},{"id":"f1faa51d.03ad28","type":"group","z":"b6837abd.323fd8","name":"Send","style":{"label":true},"nodes":["2b43ae5b.946962","3df69b02.e0fa64","fab4033.2d513","c5556bee.4bfe78","90e4d0b4.a4577","bd8015d0.a588c8","8f5ab544.ed72b8","bcadfb1d.31d788","fbc2ef90.6fad4","ec461156.66069","50eea68f.83b8b8","f00dae99.5a805","7a406fb5.cc2f6","8792bc1c.36dd5","b647ec97.743bf","5612ded0.391a2","75cf972b.bfdaf8","523c6ce4.702d74","96998d63.3e30f","fe689e75.9bd26","4d3d584c.4bc0d8","487d77f7.095368","b0ddd76b.8b16e8","d78b476a.80cf18","14c6e023.598cc","b9bde4f6.268648","ae48f406.b90388","bbde4958.9ac6a8","3219644f.ed8e7c","f959bae1.444c78","8e9b408c.295c3","f3b92b09.041c18","7e26af6.789d45","2c0ed7b1.7fc9e8","de0f0feb.e93f9","a45f50ad.19843","d1a24f58.12b7d","44b9fc63.44f8a4","914d9809.1b75a8","f873285b.15daa8","6d419a09.90fc54","6c6247f3.351bf8","3fcfa87e.991a68","25682cee.666d44","b3ea6152.e7e6d","8d0bbda5.99ab8","8295f305.725bc","de9293d.98e787","bbf3ccdd.6e3ff","d9688dfb.e381f","fa4859d1.ac5d18","8df9b58f.e85bf8"],"x":34,"y":39,"w":1272,"h":482},{"id":"50524935.d705d8","type":"group","z":"80eab637.b91808","name":"Send","style":{"label":true},"nodes":["15a023ee.85233c","3b44262f.f175da","4fdc829d.12e1dc","15f9f051.aa948","443db3a7.2ec3cc","eec0ba33.1881a8","997a78e6.37a018","aeb18c6f.97af5","a4682c51.a0d48","93d58b23.f57ed8","638cbce7.d872e4","a3d07ee2.4118d","e7be72f7.fd01e","7435f427.19a48c","df39e395.25891","a97fa98d.e57c68","7b49a365.7a587c","e8aedf53.b5953","3a33b787.0a8488","c5f6187c.1da7f8","7aa78bc7.d4c694","f96f3314.a30c2","b9d7d9da.6e7948","f9526034.6f7ee","c95a3295.6363","22f77df0.031702","5b081930.657f38","b8a39583.00f7b8","d7efcb43.6f1368","654fba48.cf00e4","43456f8c.5dd4c","b2b6259e.2cfe68","201eaa40.3a0456","59fbdf3a.7d32c","7980386e.195e38","8982ca28.b605c8","6682ab79.3d1d94","f99b719e.4324a","8a37d2ca.58b59","46573742.c4fed8","e7432d6c.e9c39","bcefa163.5774b","ef898af6.f02028","3254795a.fdfa06","b8e48adf.d29ab8","d5156c20.db42f","999ba0fe.ae798","a069b332.f057","5bb156f5.c3eaf8","bbc628d6.76b8d8","c78de680.770678","f9553beb.817e88","57304d57.a1f3a4","b0299d27.caa54","d894231a.bc71c","3ff6c654.0a649a","529bedf6.6b8134","1539036d.d1b99d","17cc519e.bda25e","ddc785a8.ceaf68","173c1707.fde679","3353775.f824488","f58f94f1.027418","4d4b37fe.7d6608","54657a7f.c1cbd4","b62a3f2911f9016f","c630955530ddf6da","ce282d92.7623","7760eab5.396054","532b9665.20cea8"],"x":34,"y":19,"w":1272,"h":582},{"id":"85055426.1b98b8","type":"group","z":"fd486f91.7596e","name":" ","style":{"label":true},"nodes":["e333ef2a.fc30e","acf50395.da227","c6f98f12.b78f3","ae456b88.e55f08","6bc49007.84bd4","8ca28c92.b988f","aed9aa93.d0b178","caa997d1.da97e8","1b030aff.cb0855","a706ceed.b16f5","b4b336f.92076c8","47142fbd.ed386","567d8308.02e2ec","711284c1.852f2c","a39d4f0a.41197","6ab4d971.0c42c8","84e7b49c.17a518","609d291e.3bcac8","74917c7.60a7a84","4bb62859.7894a8","81537343.6dcbb","52093913.f8d898","d6081bd.67e41e8","8142d3bc.d5467","f82b24e8.1a3688","330c2c95.98c264","f353b3c7.cf77b"],"x":14,"y":459,"w":1112,"h":282},{"id":"7dbe7912.2bbcf8","type":"group","z":"fd486f91.7596e","name":"Apex","style":{"label":true},"nodes":["7a0225d3.58771c","2c269a58.096406","d2649908.adb688","69f3b52f.f99f0c","68382160.57db1","2df0a7d8.9846b8","f852bb7b.3beb78","6e16b577.fb6fac","f0ca42cd.2b45b","5624481e.63d668","d374510d.02228","facb04ff.3bf3d8","be46f130.35198","1a8ec8bc.ebaf37","6786e187.358e","fd3c82f6.d3f23","f4687dd1.18242","9d8b092a.225a28","45e81e58.d0d4c","cf3ac02e.e43c3","1e2a2d2a.d341d3","6b852f75.bfd0c","82f225ef.3748c8","64d74d1b.db8ee4","3299e3aa.4756bc","3de754d8.15bb3c","dce69f73.80a0b","80b904a3.fe0298","3cb97cc2.90d8b4","92aac65d.c31598","bcc33025.e4f7f","2976220f.1610ae","d9af7c98.5a994","46651d6e.321224","90dbd21e.931c6","2b999bfb.22e644","25d6b73e.037028","a34eb0fe.ea157","4e3f4e2a.0fd16","85c384d1.de55c8","6d59ccdc.330bc4","5bf0dd0c.098834","d976bbdf.e5ebd8","3ce3157d.8d829a","f0247fd7.b5a4e","21b936af.45c75a","fd4a4c59.b1917","b7d7dcd6.91b8e","287150c6.b159","8c143627.d9d798","6b2a44bd.cac25c","5fd6111b.516f7","37102c7f.57bfd4","c285415d.9aea5","643982e4.5910dc","10d7f6eb.44fee9","c3ad2924.a28218","cb284eb2.1482e","bda525b2.b10548","8372cf6d.7af2b","f4a0c7b8.9a98f8","367a161.4de00ea","1829c885.1fb727","e151e3e2.a3183","e1d2b739.d36e78","87745895.2463c8","2cb143d3.94012c","28478031.4a2eb","647acaa2.80e564","5086c9eb.e6d908","1ccfe0c2.d3d9ef","9bf857e3d218ae89","8ff67750.e3cf68"],"x":14,"y":759,"w":1632,"h":562},{"id":"5248f06a.76272","type":"group","z":"80eab637.b91808","name":"Apex","style":{"label":true},"nodes":["dde3d436.b45a08","ab7fdf93.dca08","5e2bd994.e2e6d8","75ed68e0.099798","c3109275.665f4","5fd029a1.b44818","25da03b9.3763ac","913d9025.f4f76","5995455f.2229cc","250d90c0.58685","df1bb320.69b74","6167db7.423bc24","c2c16d84.90f6b","8afe2eb6.99a23","b3b3c717.d35168","9c13f98d.5d8308","2277318a.6b0d4e","3b9a9f1d.60079","a193e1f6.4514a","cb555a8e.d789d8","2698458e.b38c6a","6710947e.4376cc","eb681426.6669a8","885f5406.b99b98","94d892b.4554f7","57b3a7b7.a66a18","c6389731.c6f4e8","a12e2e61.a97df","638b1d65.ea70d4","7acc2b7a.3be684","9753092b.78f868","f62412ad.2deb6","cd7c8b58.49c428","ecb286c.188cd78","d2fe5fa.1e87da","72aea59.c4a235c","6318aa3a.caf1f4","fa5f2c90.b5758","d11035c6.e1a4f8","8e429c4b.b7fc7","a840537d.19d7a","3bde898e.4534e6","509e6195.182e5","3581f557.a7092a","2c9cd878.3e58b8","c7aceb2f.2a6138","b1b90fcb.9d1e1","75a06ca8.5a8ec4","41e15b3e.e35bd4","bfdad16d.077a4","f88bd21e.1a2d4","987815be.b9f298","f58de549.cea3e8","11e0d0e3.85c00f","e920bf4e.5a398","6c22d906.4af448","2948b09c.3da6b","96f309d9.8c0bc8","1f259929.06cdf7","fe4478d0.f11298","fde67b46.c55d68","1b48ebe4.d959a4","f475e59c.d2f8b8","bea9228d.dd1ca","d2c6e533.334478","e0154272.3ff04","8c9bfc9d.aafd5","98372a16.569fe8","e35fc8e7.70f108","94ddbe14.889a3","8fc17cc8.c08dd","b306b774.880498","d8575dc9.48b91","db54f22c.f760d","b6d2b684.1d52b8","3b113cad.f38c94","17c886ba.6b65b9","614434bb.0e79dc","2476c2e0.6067ee","8a4c819f.725e5","3103e8b6.56ed88","40a565e8.9dd9dc","598e93e9.e362bc","4e44fabf.a5fa44","33a3a30.97dbe5e","813678d4b5e17a9a","71c44d41e40f17dc"],"x":14,"y":619,"w":1852,"h":542},{"id":"2f8b3dd0.0d2cb2","type":"group","z":"b6837abd.323fd8","name":"Grafana","style":{"label":true},"nodes":["a5f554f6.284c58","d3a9b6b3.db8b78","d61c2f7.6cd58d","aa262aea.323d68","ba8bb479.9ecd78","5a5e5f9a.4f44d","c3c00a46.6763a8","818d5030.a504d","86219589.53bc58","6e03c0d3.f0097","5d4d656b.813b0c","35f1061.1ff9bfa","1042909d.91529f","1022a007.6e304","79406cf2.c77844","7fc7962d.cb1548","d05319ad.d96d38","f5046ab5.2c6128","f49cdda3.a2db7","f2423db4.80f74","f0dbd8b0.62ecc8","645b7ace.20e1f4","6a9a35b7.ea5f3c","fef6fa5e.3020c8","e1fc1b82.447788"],"x":54,"y":559,"w":952,"h":302},{"id":"5f95045c.cd76fc","type":"group","z":"b6837abd.323fd8","name":"Apex","style":{"label":true},"nodes":["ec8ad53d.6eff68","abaea431.b6ab18","202e42ce.f3f2ae","96771a3c.58faf8","dc33570c.7a7a98","4a66d8b5.2afbc8","82e51829.ded438","45f1151b.9f72ac","7cf50b78.45d6a4","e9cc4ba1.a6c658","44bf73a3.c8342c","c3cd1add.b91bc8","71c279ed.eee3b8","f1de1887.b06738","6bdf45d8.1ae9cc","b883ac45.4cf46","229a9a3.e829b66","ef28d4ab.15ef58","fe575826.ae4fc8","ec87b3fc.03e83","9ae49310.cdfea","188c30de.c5ca0f","5354c1a3.24f1f","cf28e50a.113a28","3a8acd4e.b2c502","2edc3bb7.cdf614","dab2839d.ee4c","b2488e8c.9a50b","d1358b73.ce2ed8","4c266d0.79e3094","9ca1ba93.0fd9e8","c5e0dabb.40b508","321e8ed7.8d6642","5fd15150.ff2c4","4fd66244.e33ffc","c8aa43b1.92472","6d5f47d4.d8ec08","8af1825e.7eb83","b36328a9.e7da78","fe445d8f.af92d","3e48693.f1fe896","8813107e.d371f","38e14f66.f4575","71482b84.0311a4","d8fbe89.406d818","74949411.31ea5c","dbe04746.1ac248","91c7d47d.d4d968","19ad0ea7.fbc441","3a1d2d65.b549e2","c10d99c5.ba4a08","f3362410.5aa3e8","e0f49ba5.bd8a08","2553ac6d.fce054","6a01015f.e2a79","94c848d.32cf8b8","808efc12.e87d9","f06ca5a2.a9cd98","d841d151.6f1f8","fcbe03a9.2a08f","bc97fd31.13e31","fcaa5779.0a6958","2d0a2edb.423f32","30ec27c3.678148","74cefc9a.7cec64","2c8499cd.96f2a6","5e7ad5ea.923ffc","1f514f1c.c6d471","bbea1ca5.26dd6","b9b8f74935bbf75a"],"x":74,"y":899,"w":1412,"h":562},{"id":"840bdfee.a61db","type":"group","z":"ce7006a0.688478","name":"Grafana","style":{"label":true},"nodes":["f5b4ab05.ce7028","b0505d84.2dd2b","4dadca11.448ec4","d8e1c04a.5f70a","1cf77d14.598433","6ab3f15d.dfa82","e950873e.3f1008","11b4d325.9e143d","1747df4.1f36b21","edf8f5fa.82ad98","6a35fb0e.07d4f4","cdcd6694.3289c8","5a4b19fc.0d6438","11bfc50d.62239b","b299e5f3.27a008","dcd0f100.10328","1e3c66e1.cc4d89","65ae254f.1ff61c","b813b387.4b884","3a0c1fd0.29c3c","ff4f56fa.a22808","2d68b7d1.29d038","1f2a359a.fc511a","ad39e73f.49beb8","332f9703.450968","73da23dc.245f9c","79f88877.791218","c89db517.60d7f8","ed0d3a73.051578"],"x":34,"y":519,"w":1112,"h":302},{"id":"eb56ff57.5b80d","type":"group","z":"ce7006a0.688478","name":"Apex","style":{"label":true},"nodes":["99900402.9f99d8","b8f6f994.a78008","e4d51f8b.830fe","c790af37.9f3d5","c1dae8ce.a4a138","90cd3061.4c776","54f40a0c.730004","245599c1.b52da6","aa6a87b5.ebedb8","98ecf42e.0e6dd8","c608a7e.c160758","6264edee.6f4f04","1c0b96e5.038139","ea44e728.6d0138","7832c71d.8368c8","2bd325cc.4a2d3a","862b1113.8d9d9","357b6531.d092fa","7aa60394.71b61c","13c9bcb9.163213","8fe909cd.7d1b98","a858b469.484598","10e5206f.98375","8b6aba68.2379b8","4c6587b0.883af8","36715be3.c59a14","c73b0d7a.989d5","68c5e533.b6d08c","28fb0f0e.e2663","63bdda47.a262f4","a38417d1.e24a28","9cd7f0ba.3fe24","89a2856e.595888","30fa5c4b.ed4ba4","28f6b124.33728e","e8cd79e1.9a6388","9b9952b7.aa5b5","1bf3ecd2.340823","fa0c12f4.d3cd3","710b2722.784858","78c26879.151a68","1362f2bd.4b1b0d","76f9243b.3c1d2c","ccbce152.814d2","a72d143b.29eb68","f9f48924.d09ec8","8a63f5a9.ea2bc8","2f92acb8.dc4104","c01c08cc.19ea48","4c2b9947.fe69e8","a1558c5b.23622","3e57a1a7.152cae","304d339.0a5dbcc","433d88fd.9a8c08","ff056d7e.7927f","a2f94c3d.e0f5e","69fe2268.9a5dcc","b4fca700.425db8","bf61f0c5.06d4","44946c9e.cdea14","1733e5da.74d4ea","e0c94366.fcfea","f2dc8c0a.59c65","e4f1b3ed.e3f9b","2b0e947b.1c32cc","ff8ed24a.a8b9a","5525bab6.202aa4","c1771354.0ea98","5483ff.17800c","644e954b.767c4c","785ce802.b88d98","2111e402.2b5d1c","783c7fa7.2bacb","b2345672.49c578","301f903c.ce8f4","c9126f18.879e8","d6869cfd122385d0"],"x":74,"y":859,"w":1432,"h":662},{"id":"e90ee691.a45788","type":"group","z":"47ec9b6e.206e24","name":"Trigger EveryMinute","style":{"label":true},"nodes":["1536058.0c270fb","ed0721c8.514e3","38f4418a.b6859e","81088aae.aa4a48","933a74ba.0ef758","d590d8d1.8969f8","cd380dba.34eb5","6a443c41.591964","7f7c68f1.a3d9c8","c6a8b4b7.bf7478","90ae8a76.48c5f8","c6127353.b122c","7a2fa434.b8b47c","70972d3d.f8fc04","e1d85b19.a86398","873cb1fe.af7e6","de69feca.f9fb2","f026fd32.1e5f4","3bfe79d2.cb9696","a1be4bb2.003ff8","5aa04069.7927d","545df55f.32a83c","4dc2bc87.305af4","956b0ece.03cac","bf64fa3.38b1908","550bf9ea.0b5368","62db012.c0c4d","1f8089f8.6a0936","93a7acd6.0eb78","760a2a06.195604","69cdba50.362694","35e6a301.80057c","a7bcbdca.02588","19e70f08.fe9631","d7af74dd.717a38","6f1db37d.bfdb2c","69b37ca4.99df64","3d4a5116.5614ee","7cf49193.bead3","3dec1f12.c78eb","adda36b3.dd6078"],"x":24,"y":319,"w":1112,"h":582},{"id":"53d851bc.74e43","type":"group","z":"47ec9b6e.206e24","name":"FuelDashboard to Apex","style":{"label":true},"nodes":["870f79f9.10ced8","1ecb831b.92780d","22754978.418996","afaa2d26.7a48","854c8411.a20078","7dc39e33.8fe6c","380bed0b.9239d2","eaebaf5e.5d116","5a6e4511.c26dcc","ce652cfd.f2d89","98e6001a.41618","70029a4d.9338f4","26dcdd6.0fda022","f8482fc.c8541d","713a60bb.a5ee3","ed1ca77e.3a0058","dc2ebc80.343c1","a1bb7b21.713568","f8536997.83ae08","8bbe972a.221c88","cf4161b3.bb1f2","ef00fb17.ca28c8","f704dd48.b0f09","5f7ab9a3.a2f218","f0d2afe6.6954b","16436be6.833614","51baad12.0d4994","d7977316.81b67"],"x":14,"y":1619,"w":1182,"h":282},{"id":"3e5f8b9c.6d2c74","type":"group","z":"47ec9b6e.206e24","name":"","style":{"label":true},"nodes":["947ea49e.0ad598","b90d109c.3003f","318c2d13.6f4342","cd61effa.ac573","a7058a1c.31e018","cd645d6a.0b229","3b7c4985.6a6fd6","3b4601ba.ab60fe","523cc76c.157dc8","f0349909.6e7eb8","78e72c6e.eb5e54","ea7e9c5.b765f6","1e21bb78.888cc5","14c8631d.31c65d","1c0d9a93.3363e5","6d0d8444.93628c","8facbc86.7cf02","e524840f.2676e8","1d1065a.437889a","a82513fa.0f88c","8e5f48cc.f26358","598ab60e.4b98d8"],"x":34,"y":99,"w":1042,"h":202},{"id":"f41a6b42.27a6f8","type":"group","z":"47ec9b6e.206e24","name":"VMSDATA Apex","style":{"label":true},"nodes":["1e9cebd7.8bc364","ffcf0c2a.9424e","3d1fe5b9.5bc5ba","7a266f24.10d47","dc91eb23.56e988","d8eada66.d1cc58","d0455da8.ac986","1a1f7626.47cb9a","9bf512a3.c2c2f","fdf27af8.32cad8","d9bf0f7f.96e92","b160692a.a8bd08","78e74020.f73d2","934c4cb6.02b67","a9c27a85.284548","f9c97186.94ec4","7e281a5c.c84aa4","5dbe05b5.609cfc","82cb1743.3767c8","e7f8b071.33a18","ecddb313.ef6f5","ff77a9e8.a5e698","e1972be4.98dab8","76512ed1.ecf5f","da62429b.6db66","f071c4b8.958be8","6f309c8a.d6ee94","35dd739.362388c","c9d1294b.aed868","d13e6c2a.6a5b8","372e1f38.b21a7","d6fc8228.81193","862169e1.4b27e8","4f1b087c.6c9218","9443017a.a4a18","d8d3d9ec.3ddd48","880d0912.6538e8","bfd54fde.57998","d828724c.7fcf","6e102191.b6dd6","ac1e26a6fb544816","d5f5e2d66dea1bd7"],"x":34,"y":999,"w":1432,"h":362},{"id":"a12e1f8a.e83e8","type":"group","z":"80eab637.b91808","name":"FromPast","style":{"label":true},"nodes":["16b4740c.8d6f3c","24b88b27.20be44","9f4f155a.e897d8","2bc40121.3bc0fe","f6cf7284.91a9f","f9ab8a49.478318","c2cab59b.99caf8","cb85bde1.fdb9a","ea4755c6.266af8","c837abd4.226ea8","e39e1783.fa5318","d4d66fff.2ab61","d525abc5.066aa8","221b4248.aef21e","d5831f5.bfef8e","af514300.74fce","68ead9cd.458ba8","fbd60615.2ff648","1f0c1d00.a81293","626f0b52.567974","1714e4bc.d9db8b","db0c2e6.af7c3d","99a9414c.e267e","b81de4d5.b5b1d8","72f61c2c.a9a564","72a1b9a1.de9338"],"x":1314,"y":39,"w":1472,"h":542},{"id":"b2a8424.21928c","type":"group","z":"b6837abd.323fd8","name":"FromPast","style":{"label":true},"nodes":["9e8bff91.843c1","15972b43.34c0c5","da9ee776.38f9f8","643d752.b46bb8c","41102d3c.59d6b4","51348c2d.7d7764","35d75a4c.b20f56","eaae2f1c.b0e7d","4380133a.ae93bc","eb9b4085.7eb5","fda66cab.7d2fd","2584aa68.4d9626","b7f5ecdf.f6962","8c3a523d.0a80d","f5e4943a.44af58","ba423b03.60ee08"],"x":2114,"y":-1,"w":852,"h":542},{"id":"3b614174.164cfe","type":"group","z":"b6837abd.323fd8","name":"FromPast","style":{"label":true},"nodes":["839bf7bd.fde878","6e73a5ad.a42acc","ab7fe28d.840d","1392f3ae.2a194c","48efd7e0.bc4588","ac8147f0.4c1ac8","b8cc1ab9.8d2538","37088e00.dea9c2","76560afb.774d64","863e3f8f.3af94","b4ad5889.d57e78","e77383ab.da881","9ed4179a.76f6b8","870403fd.c0527","89b63d21.4294d","538a8ca4.7bc8a4","e04d4470.592e78","492aeff6.91d3","c2a268d7.c88d78","39ad5365.11760c","b1c02495.ed0528","dd8b7eab.ef0f","f7d52737.44c108","f7f90dbb.56895","d1b563d.6cffca","6c1f28d8.f9e5c8"],"x":2114,"y":559,"w":1472,"h":542},{"id":"fcbdbec6.319c5","type":"group","z":"fd486f91.7596e","name":"TakeDataFromPast","style":{"label":true},"nodes":["49d4dbbb.7569e4","9bb6205e.2288e","c87fea34.727198","63cf1660.aa1c98","d8d1b240.ea435","74f5a27e.7bbcdc","344e2d31.a087d2","83659f88.38fb9","4a8a01fb.f947f","3fc071d5.867c6e","59b64bf3.652794","7c9af236.5d5b7c","84d2f344.77dd2","89981ce4.172b","a20ad130.8bad","62d920d6.e8547","2078cfaab63051a2","19d5cb57531dd627"],"x":14,"y":1579,"w":1132,"h":162},{"id":"e1041fc7.f509f","type":"group","z":"ce7006a0.688478","name":"FromPast","style":{"label":true},"nodes":["6b6e8074.fc3a4","51d98d07.d6d304","77d72c9b.48a214","aebec9d7.8e2bd8","9cbf4837.840548","d244d938.d2d008","875c6652.69a588","f0762b5.30e77d8","754429fa.c98e38","a14731b6.67485","3ce1e3d2.88417c","b03dd22f.ca7f9","da19b58b.fe4278","a5a55a2e.f4b9e8","2d5fed2.e082912","8825845f.22c0d8","7de06874.051548"],"x":1694,"y":179,"w":852,"h":542},{"id":"6f19b97d.5656b8","type":"group","z":"ce7006a0.688478","name":"FromPast","style":{"label":true},"nodes":["b636e70f.ebddf8","c51cee38.a29cf","eb0cdf30.62d26","3641c031.6d8a5","a7b5aaf6.4a0108","4a082fb8.ae131","6007c31c.14595c","36025038.e550c","4adde03a.65d24","eee6b762.356228","6078ed38.0e7dc4","152df20.983150e","d9da8f72.0741","4b586528.555a0c","81247a27.cc8dc8","b8fbb2e5.56964","88133364.11bb9","38bda411.71bddc","7bcd6b97.4b7c04","49231215.5ed54c","c751a3eb.b8347","b9878070.3165b","edf5a926.597618","a647e7e4.c58168","59ab4a24.d896d4"],"x":2574,"y":179,"w":1472,"h":542},{"id":"382e1e18.723212","type":"group","z":"fd486f91.7596e","name":"Bunker","style":{"label":true},"nodes":["9c8feb2a.1c2b88","40beb8f.3bfdb48","d111b315.ab0fc","8d5358b1.0581c8","eb323d6e.f6bf5","cc979ea4.ee9d8","8d547c68.ea3c5","32659ce8.1a5834","d059dcdf.006da","42047341.2e802c","2755a16a.e939ee","9266f3ee.dbbfd","ecf18cb3.98178","fa196d09.2240d","644492e5.f4ab8c","75f87627.bc4968","df804088.82ad7"],"x":14,"y":1919,"w":1032,"h":222},{"id":"d943fe42.7259e","type":"group","z":"ce7006a0.688478","name":"Bunker","style":{"label":true},"nodes":["feb5ad37.79ebd","1a4ae8cb.3daf57","acf9d66f.22ee68","79a1e39e.ab6aac","2cfcc1f4.1c409e","48047a3b.6ae164","c28ec34d.2a071","c3665c94.15dac","cf9381b.1654c8","8cceb287.1694d","119fe324.3eb31d","2af03970.175c86","8c2ff36e.f4394","ead0a698.33aef8","80f595cc.94f158","864ca1d9.4d02d"],"x":34,"y":1879,"w":1022,"h":222},{"id":"e29f94d3.283128","type":"group","z":"47ec9b6e.206e24","name":"VMS Send Email Report","style":{"label":true},"nodes":["4d8985c187ed494e","4a1b1df5116616ac","ae92eecf31a0b75b","fd0a9dc6.22fe2","aa30b7cb.d93218","51e0ef56.917be","76cca9ca.d048d8","360f3b01.bae684","846a8c01.2342a","c893e887.526d78","6decb252.0228bc","76c2a638.494e78","175428c2.f8bd17","c2fbaa40.e58d78","1fc57748.e1f849","3ec5f4c3.7a618c","3638dafb.bd5206"],"x":54,"y":2579,"w":1032,"h":382},{"id":"cf2ae4eb.728d18","type":"group","z":"eb274b9b.a25048","name":"FromPast","style":{"label":true},"nodes":["2219e3f8.0511cc","533be77c.bdf1f8","48f7c074.63013","5576869e.1fe238","f3063b.e3a8f9c8","9803719b.75b48","7fe0ffce.a1a76","441f1348.b5bedc","3e74e00b.d7adf","ff666134.99219","51e3e7ec.646588","8350e85c.2722b8","aaacd4f0.94b798","498126c1.b09c48","9ac736f4.3aa348","4f56c938.d20a48","37994dc4.da1852","3ee1cf7.3f5aa3","453f661.4526d98","7c871cf6.f96454","c3a14577.2785d8","8242807b.46ca3","e6f3174e.3af208","6f2ea617.ced7d8","53867bb5.6395b4","65c46949.216c28","994fef44.13237","d3a5fe5e.88666","964d050b.a95628","76e37580.524d0c","7a1c1d56.35c654","a279519b.3054d","e9a70803.ef8ed8","e21d3066.e17d4","6537b4f5.2ee04c","2bd867a3.545478","6f1bc7ec.9bfba8","65a1eee2.29e91","6f4511ef.4d335","1d2495eb.d5dd4a"],"x":34,"y":39},{"id":"f91a5010.a62fe","type":"group","z":"31a1ac1c.c57c44","name":"Trigger EveryMinute","style":{"label":true},"nodes":["852a4e29.4e1be","bfc86f88.30d69","cd34e1ef.e0855","1b9070d3.bdff6f","a62474e1.5af898","23b8ed3c.f5b702","12acf92f.4d9767","93dc6145.fcff5","f5bc26e9.a44008","53aa886c.d80498","106acba8.7668f4","24658ed0.277432","2773b227.d266ce","2aed5054.cbed2","740162f3.cb0b1c","516ee81f.b47cb8","bd7be530.6b7f08","361ecdb4.e14ea2","f665ec0f.f2441","aefa40c9.5eecf","19824683.2209f9","d532dcc4.bfcf8","ec14aa41.5c9828","99eaa341.ffa83","18218edc.a75871","d486f6aa.c6b0a8","3413a3f2.35681c","c7c4b04e.db65f","2e21cdbc.bf2de2","7a7a8127.c495d","14ad3282.d7fb1d","27314c94.a65f64","916de746.519338","4851b3fc.d2348c","9a2e0086.8a436","49583937.066e68","9d4fca9c.d5e538","82c1b8ae.298098","c249d6c7.c5aca8","7d03c947.2b6808"],"x":24,"y":899,"w":1112,"h":582},{"id":"ca2a1220.a872d","type":"group","z":"31a1ac1c.c57c44","name":"","style":{"label":true},"nodes":["89dc0128.7afc5","35e064ec.f6cc0c","fafcf88d.8689b8","3170c5fd.a70b8a","175a13ba.953bec","98d1a77e.5df2a8","c33e708.63f459","f55842c3.7f395","914c5ed0.bdc2d","93d8a5f0.053ef8","786b36f6.872e08","e0ec3016.dec16","f98430c2.0d708","a91c3161.3f5e4","811359a3.95cd68","ec752389.0849b","fa80ef2f.d2c62","a801e39.e13392","ae2f5f6.ba16ca","e1c52fc3.6dc34","12ee95f4.7f863a","65a9072d.9fe008"],"x":34,"y":659,"w":1042,"h":202},{"id":"fe9bcf91.65e0c","type":"group","z":"720653e6.744a9c","name":"Trigger EveryMinute","style":{"label":true},"nodes":["4a360149.0dc9f","9819f259.d0b39","66c0356a.789e5c","f745e613.4176b8","2c4b727.7f9488e","b42d7283.a4857","89d5ba7e.ee7348","16009458.da844c","95a36415.566838","3fe7b779.4825d8","484263c4.c5889c","dcf39f56.cfecb","6020efe9.c2913","783d698a.645118","97c56520.1a1968","68b0c80e.073b38","a8faf473.6736e8","eb2df056.e42a5","475d9209.ce125c","981e0069.444a3","1d74c785.50fff8","b980447a.1c01f8","a345480f.bfedf8","d87b3f85.a4023","79cc4206.6a43fc","c34182c6.2a1d8","5c0e27cd.ab66c8","41ce15bd.c22fec","b40a9b53.e14508","6bbf7e7.f74b88","bb6f1414.00d4d8","409671fb.45032","cec13a6a.a18398","26ba6752.b41d48","33c3efb8.3dc98","a6ee8767.871bd8","feedaad7.8223c8","2407daf8.e5af06","3d732d84.ae4c52"],"x":24,"y":159,"w":1112,"h":582},{"id":"c6c5f291.8b695","type":"group","z":"720653e6.744a9c","name":"RESET FLAG","style":{"label":true},"nodes":["5a41244d.a7717c","7be74a60.f19c24","611ebe25.a6781","407de22.c53121c","ebd86a79.f8a8d8","3968ac47.e94214","f1d9f512.719fa8","538ce6d1.08b2e8","aeb0c5dd.cb2b58","87f7837f.322e6","33f58d13.a4ecc2"],"x":1714,"y":239,"w":1012,"h":262},{"id":"efacc863.a3f888","type":"group","z":"31a1ac1c.c57c44","name":"FMS Send Email Report","style":{"label":true},"nodes":["78e79218.170cfc","2fd56e81.38a5d2","de89a4c3.7b81a8","ff361356.16168","7bb0b3dd.66b21c"],"x":54,"y":4574,"w":700,"h":127},{"id":"25e7d0fc.3faee","type":"group","z":"31a1ac1c.c57c44","name":"Get Data From Server Local Kelanis","style":{"label":true,"color":"#000000"},"nodes":["b8d03b72.00ed18","ab056952.93a6a8","6c57d2b6.f0df5c","4195668.aee4298","f9095625.39ce08","c708fa1c.595738","de2fcc67.1127c","16bc65.b224a39b","1628851b.04bf3b"],"x":24,"y":479,"w":1052,"h":162},{"id":"cc6a03f2.0bc1e","type":"group","z":"31a1ac1c.c57c44","name":"Send Data to Apex","style":{"label":true,"color":"#000000"},"nodes":["61a4cc21.bbfda4","e2445ede.10c75","2460cfe0.80692","e543ed1e.83322","88c20d89.4b4f6","93ccc5b.609f138","8147d8ab.a37a88","a0b2a7dc.bb6378","fb07a1fc.166cd","acbf180c.b7f4c8","9e520115.c37fc","bafada45.3619c8","16197d11.881323","ddc44bdc.7cae48","5febb4b5.106e6c","73c8b37d.48021c","fb06a5bb.0a9e28","6fc07de9.769894","476c917.b35497","50241f9f.34fba","f3706505.4cf838","92eac366.afb23","3d68afce.bc3da","665db025.77e5a","29fdb04.00ef75","615a75ef.5a2b9c","bc5e95b1.7d3b48","5fb40f18.92729","8237ec92.84c9"],"x":34,"y":1499,"w":1912,"h":222},{"id":"df4bcd58.fbdb4","type":"group","z":"31a1ac1c.c57c44","name":"Get Data Flowmeter From Server Local","style":{"label":true,"color":"#000000"},"nodes":["5be3e6cb.f51278","92a551da.cd603","f151297d.27cdc8","552bca54.381214","f470c14e.b0d86","70006388.0f487c","eefba998.643828","27cb6362.f0adac","63a6d877.38c708","36894d1a.2287e2","f11e279.c8cd7d8","4f5788c3.69a108","a4a3bc2b.0b91a","eaf735c9.70b438","73dfe935.543408","d351af57.42f43","60db1bcd.8a2e14","d303228a.4aaa6","485f479e.6f6e28","a7f76186.0dcab","e614b4e4.343fd8","cbb51b40.72fa38","ba744d22.51da8","52a37321.dda2cc","9b8fa7b1.36e8e8","327c4f78.bf109","e0748802.9b95b8"],"x":34,"y":1739,"w":1432,"h":262},{"id":"f9733f01.9767d","type":"group","z":"31a1ac1c.c57c44","name":"Send Flowmeter Data to Apex","style":{"label":true,"color":"#000000"},"nodes":["ff81a9f5.623d88","330aff73.a4d26","45f4e092.38546","bef1050.72452f8","162364ee.add1ab","a2bd3365.2a727","cfeb0f30.84705","a26428dd.29e328","8665b312.3fef7","9023f1c1.783ec","14662b5e.b10325","67330b22.978554","9070b6b6.9c94f8","df0eb504.630f48","cccb15ed.c15418","e4e740b4.7f422"],"x":34,"y":2039,"w":1812,"h":122},{"id":"4305afdb.9f512","type":"group","z":"80eab637.b91808","name":"Bunker","style":{"label":true},"nodes":["6874bb21.74f804","7a67df2b.18d1d","9c481dc1.4eec4","af663a3c.235d48","4a145c7a.b81ea4","c0940631.e18df8","7c6900d9.1aa0d","e7f36995.016728","122544ec.4242cb","99b227d8.6705c8","99a89200.df3e5","73a9ff1f.bb8ad","2b6f265a.c97fea","c16b7d4d.598d7","355e6a3d.a00e46","7ddc72c6.62a1cc"],"x":154,"y":2279,"w":982,"h":222},{"id":"77ad3b83d2a689b5","type":"group","z":"323faf53d384df59","name":"Test Inject Data to Broker","style":{"label":true,"fill":"#ffff00","color":"#000000"},"nodes":["5b15b21639bc6261","81081cf231112f82"],"x":214,"y":99,"w":442,"h":122},{"id":"a5952fbf264b6317","type":"group","z":"323faf53d384df59","name":"Main Table InfluxDB","style":{"label":true,"color":"#ffffff","fill":"#ffC000"},"nodes":["14ec19f9eef3d57a","2e59aebea5f323ca","ba06f15e9cc19587"],"x":434,"y":279,"w":672,"h":182},{"id":"f8c1175ae8ef7af1","type":"group","z":"fd486f91.7596e","name":"per 30min","style":{"label":true},"nodes":["a64ad2620c1e6d9d","b7bd465c6008ce05","12950f8fee82695d","90e710faf616f687","9ff1dabfee1b0d16","54c1b98fad5353b8","aea4898cf999525b","407ef8ff8c204532"],"x":14,"y":1759,"w":672,"h":142},{"id":"d7541a4.d356fe8","type":"group","z":"fd486f91.7596e","name":"Send","style":{"label":true},"nodes":["704a8141.f82cf","bb96ab8d.971528","41ddf714.c19238","31f81998.347856","83772f1.1d115d","a211a538.1b93b8","60823f95.e8f89","4948af18.6d611","997ba561.c8c678","7dd5715c.4e50b","9a6b26fd.f095e8","908344ee.ea3e18","86f3bf18.b0bcf","143a4405.812f8c","1af04911.590687","8c991105.199dd","9548c64f.7dd838","bdeddbfb.ccda18","e113b393.8c61","5397a21f.8030bc","a49d942c.8f1c48","c58d6065.48ce9","9e97a5ff.702a68","7cc15c50.3aa794","4556d74e.bb68b8","1f07104e.02081","e447db7c.481ac8","73409110.8d0ee","641839e6.da57e8","933f2b09.3bd168","f55c6a05.00aa48","1d7ccbb9.e31694","ea0be969.25f6b8","ace0340a.7c2aa8","b60933e2.0f928","77f288da.bf1248","7a0f38d.aeafac8","398fb8b8.303028","ecd733b7.272f2","c057387a.08a2e8","663d0c7a.eb4ca4","87a0452.da9b7b8","f687e42a.847d08","87964e94.b2df2","591a9f46.021d7","a217eec014a2a788","14f59fe.3ceaf6","dc1766bb.d187e8","23c75db2.924ed2","a206b44b.935098"],"x":14,"y":19,"w":1272,"h":422},{"id":"9cdee6d271f686a5","type":"group","z":"323faf53d384df59","name":"Apex","style":{"label":true},"nodes":["667eb3e926e602aa","518e3ef2ff0662b7","df237815f146eafd","e9d17504cdc266fc","b7c1b9d03a4f08b0","4019ea38ee6fd93f","21794c522ea251b7","19c13536957caddf","32ba978b7220f80f","87cc70206d015671","130d15266a26b7b6","9ad12c8bb43ba1fa","ba06892a53e0557f","cd4d4fc062dba6be","bf1cfa526047af37","7b613f2769e031dd","6cd0830333fdc74a","59d6c96b521474f6","131ce50ffc32c2f6","884ab70982d8c52f","36002db1fb7e54de","b224de5a911b1a13","9f088a99d6ea494b","8bd81a37ce146d75","623f4065a5179ef3","c04a92c8465565ea","6f43c47144392d2c","2c547a63ea734cb3","418423e13de673e7","73dc6f068cf0709f","39936c7f103dbe8f","79c67d017cf2a3fd","dab8fb8563771c2d","fc519290ab646f17","b6dae04d96413171","b3babaaf34e2276a","f8f4fa3c47ac7615","7e568acdc7614f94","3df37d353c58e5aa","101f99c61f6abb8e","054ca2d130345187","9ded4b1df3bd8142","c14f50878b420f95","8cf2927c2c04b028","e13d75f063fd7967","65cd7badba3b8e14","8f5d98d97c897391","263385f6a8b265ae","332d5932c1cdc9df","c4ceba969a728ef2","d23cd2f7547da22a","930196acb8f0b037","d261488056749650","c8f33989e6fcc5b1","1786bcf2046fb859","e00953cc91b59ce9","95cdb6500f6d586f","8e9dbce068ead96e","511ed55cf299090e","ebe9360d0cd1a93d","873afc755c864a1d","178e542f2bf15939","270eaa62b1b16110","ecdcbaf43473e447","0a191d2043f369fd","4ac24b2c88477a10","f809acdf500add27","d59fdc9b01f65bbb","3c779c3ec41c46a6","886906b945f82154","3f9f9a46d2325276","5ccaca3281be99f6"],"x":74,"y":1099,"w":1632,"h":642},{"id":"c6157749cd57c3a9","type":"group","z":"323faf53d384df59","name":" Grafana","style":{"label":true},"nodes":["d6d3622355de9dd1","c8a86fbfcd859d42","572c66bbe49e89f0","36e8ffd561d03a57","2f15cb6faca3414d","edd02c8aa9a8c267","ed5a089213647a59","0fdc05585074589a","d11afd4c3c08a414","dec94fd168715d6b","581d848c94dc5516","74a62164c8b1c8c5","36490f137680ac35","5d4228b6b433bcee","d735bbd1202a34a0","733accd290919ef4","5802c609cdcf27de","3d62f4ede8c3f936","b2a61155964adfca","b31ab7ee0cf4bb5b","c55a967f19013096","724923f2e6e7053e"],"x":94,"y":599,"w":952,"h":302},{"id":"42acac8bf0d92f0c","type":"group","z":"323faf53d384df59","name":"per 30min","style":{"label":true},"nodes":["7afd8aeb41d1e37c","1057749a68808eec","29fdb639fbf9f66e","c32fcf5a924e76f9","889d2db58bebcded","5fa0bf934287639a","4bb71a6d1ddde0f7","835889b25625563e"],"x":1174,"y":599,"w":672,"h":142},{"id":"93166cf09fa2d088","type":"group","z":"323faf53d384df59","name":"TakeDataFromPast","style":{"label":true},"nodes":["ffb72ba719abe892","c49a8cc6045b560d","314ee4f73eba8a7d","79135ffd89104d8a","0c1220727504a8a9","8b7e769c330553fb","a36234e129c831fb","44c977294b3e6de8","ef0f9d471b94acba","de6b3c096af97543","50b46af16a65c3de","283a765f5e8b2ad4","49d758607b9b88dd","7038dfd64bfb48af","e9d875ea71181e5c","6a53e7e8748fab07","89561f3d80785403","f13fe18a8ac2d5bc"],"x":94,"y":919,"w":1132,"h":162},{"id":"4803b37b.b88cfc","type":"mqtt-broker","name":"local","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"protocolVersion":4,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"76f4cea2.88ada","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"fuelSensor","name":"","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"be353e7e.73b9d","type":"MySQLdatabase","name":"","host":"127.0.0.1","port":"3306","db":"vms","tz":"","charset":"UTF8"},{"id":"6b860e6d.a3ab8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3df154b8.35094c","type":"mqtt-broker","name":"","broker":"51.15.243.241","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c5ceb024.c8f2e","type":"mqtt-broker","name":"","broker":"test.mosquitto.org","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c2c49373.a19cb","type":"ui_tab","name":"Hidroponik","icon":"dashboard","disabled":false,"hidden":false},{"id":"2be7d32a.bb264c","type":"ui_group","name":"S2","tab":"c2c49373.a19cb","order":2,"disp":true,"width":"6","collapse":false,"className":""},{"id":"e40597f8.c624a8","type":"ui_group","name":"Intensitas1","tab":"c2c49373.a19cb","order":3,"disp":true,"width":"6","collapse":false,"className":""},{"id":"94f22afa.255ee8","type":"ui_group","name":"Intensitas2","tab":"c2c49373.a19cb","order":4,"disp":true,"width":"6","collapse":false,"className":""},{"id":"6140daab.469a94","type":"ui_group","name":"Turbidity","tab":"c2c49373.a19cb","order":5,"disp":true,"width":"6","collapse":false,"className":""},{"id":"6f63c9e9.8be8a8","type":"ui_group","name":"Moisture","tab":"c2c49373.a19cb","order":6,"disp":true,"width":"6","collapse":false,"className":""},{"id":"747b8a8a.26cb74","type":"ui_group","name":"S1","tab":"c2c49373.a19cb","order":6,"disp":true,"width":"6","collapse":false,"className":""},{"id":"66dfbc48.411c84","type":"ui_group","name":"Pump","tab":"c2c49373.a19cb","order":7,"disp":true,"width":"6","collapse":false,"className":""},{"id":"5069a677.3406e8","type":"mqtt-broker","name":"","broker":"51.15.242.36","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"63c9411b.ed21d","type":"ui_group","name":"Export Data","tab":"c80e202d.b58a","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"c80e202d.b58a","type":"ui_tab","name":"ExportData","icon":"dashboard","disabled":false,"hidden":false},{"id":"b21187dd.19c978","type":"MySQLdatabase","name":"","host":"127.0.0.1","port":"3306","db":"fms","tz":"","charset":"UTF8"},{"id":"c7c6f8eb.0cadd8","type":"MySQLdatabase","name":"","host":"10.105.1.1","port":"6978","db":"Database_ops","tz":"","charset":"UTF8"},{"id":"7db681aad1f6f90a","type":"MSSQL-CN","tdsVersion":"7_4","name":"","server":"10.105.1.11","port":"6978","encyption":false,"database":"Dashboard_ops","useUTC":true,"connectTimeout":"15000","requestTimeout":"15000","cancelTimeout":"5000","pool":"5"},{"id":"a8f1e10afb77ed46","type":"mqtt-broker","name":"AdaroMQTT","broker":"ptmbp.co.id","port":"1883","clientid":"","usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"5c0b81429c4852e3","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"fuelSensor","name":"fredxLaptop_v1","usetls":false,"tls":"55e339f2ea01dbd7","influxdbVersion":"1.x","url":"http://localhost:8086","timeout":"10","rejectUnauthorized":true},{"id":"55e339f2ea01dbd7","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"mosquitto.org.crt","servername":"","verifyservercert":true,"alpnprotocol":""},{"id":"d1895f30.a012e","type":"http in","z":"47ec9b6e.206e24","name":"","url":"/gsm","method":"get","upload":false,"swaggerDoc":"","x":2140,"y":200,"wires":[["8b47411e.22ef1","c6b7701f.25a79"]]},{"id":"8b47411e.22ef1","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2390,"y":160,"wires":[]},{"id":"c6b7701f.25a79","type":"http response","z":"47ec9b6e.206e24","name":"","statusCode":"200","headers":{},"x":2450,"y":240,"wires":[]},{"id":"ebbfbe73.1872","type":"http request","z":"47ec9b6e.206e24","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://36.92.113.244:1880/gsm","tls":"","persist":false,"proxy":"","authType":"","x":2420,"y":280,"wires":[["525ecd27.411484"]]},{"id":"35f556b5.dc636a","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2210,"y":260,"wires":[["ebbfbe73.1872"]]},{"id":"525ecd27.411484","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2620,"y":280,"wires":[]},{"id":"b1233f05.68963","type":"http in","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","url":"/getcoor","method":"get","upload":false,"swaggerDoc":"","x":150,"y":320,"wires":[["ff2e5a37.a747d8"]]},{"id":"ff2e5a37.a747d8","type":"function","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","func":"msg.query = \"select * from combine where lat != '0' and lon != '0' and time > 1621575534;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":320,"wires":[["de3f36e9.bfec78"]]},{"id":"de3f36e9.bfec78","type":"influxdb in","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":490,"y":320,"wires":[["d9443f8a.810bd","a09168ac.bdb028"]]},{"id":"3e752c3f.8a2b84","type":"debug","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":990,"y":280,"wires":[]},{"id":"221c3585.8aa2ba","type":"http response","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","statusCode":"","headers":{},"x":970,"y":320,"wires":[]},{"id":"d9443f8a.810bd","type":"function","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","func":"var data = msg.payload;\nvar latlon = [];\nvar nilai = data.results[0].series[0].values;\nfor(i=0;i<data.results[0].series[0].values.length;i++){\n    latlon.push({\"ID\":nilai[i][1],\"lat\":nilai[i][8],\"lon\":nilai[i][9],\"time\":nilai[i][7],\"wind\":nilai[i][14]});\n}\nmsg.payload = latlon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":320,"wires":[["e086e237.dca46","73c96c80.edd5c4"]]},{"id":"e086e237.dca46","type":"function","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"Stretch","func":"var data = msg.payload;\nvar limit = 250;\nvar array = [];\nvar step = 1;\nif(data.length%2==0){\n    step = Math.round(data.length/limit);\n}else{\n    step = Math.round((data.length-1)/limit);\n}\nfor(i=0;i<data.length;i+=step){\n    array.push(data[i]);\n}\nif(array[array.length-1] != data[data.length-1]){\n    array.push(data[data.length-1]);\n}\nmsg.payload = array;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":320,"wires":[["3e752c3f.8a2b84","221c3585.8aa2ba"]]},{"id":"ebadf9a4.f2c388","type":"http in","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"limitdata","url":"/limitdata","method":"get","upload":false,"swaggerDoc":"","x":140,"y":500,"wires":[["be2e836a.4d0c2"]]},{"id":"be2e836a.4d0c2","type":"function","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"TakeLimitData","func":"var data = msg.payload;\nflow.set(\"limitt\",data);\nmsg.query = \"select * from sortgps where lat != '0' and lon != '0' and ID= '\"+data.shipId+\"' and time > \"+data.start+\" and time < \"+data.end+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":500,"wires":[["a6bdede6.d6bd9"]]},{"id":"a6bdede6.d6bd9","type":"influxdb in","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":500,"wires":[["758ac4da.bdc19c"]]},{"id":"758ac4da.bdc19c","type":"function","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"TakeLatLonId","func":"var data = msg.payload;\nvar latlon = [];\nvar nilai = data.results[0].series[0].values;\nfor(i=0;i<data.results[0].series[0].values.length;i++){\n    latlon.push({\"ID\":nilai[i][1],\"lat\":nilai[i][2],\"lon\":nilai[i][3],\"time\":nilai[i][0]});\n}\nmsg.payload = latlon;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":500,"wires":[["138aec54.4e2aa4"]]},{"id":"6a212d72.c2ba64","type":"function","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"Stretch","func":"var data = msg.payload;\nvar limitdata = flow.get(\"limitt\");\nvar limit = parseFloat(limitdata.maxdata);\nvar array = [];\nvar step = 1;\nif(data.length<=limit){\n    return msg;\n}else{\n    if(data.length%2==0){\n        step = Math.round(data.length/limit);\n    }else{\n        step = Math.round((data.length-1)/limit);\n    }\n    for(i=0;i<data.length;i+=step){\n        array.push(data[i]);\n    }\n    if(array[array.length-1] != data[data.length-1]){\n        array.push(data[data.length-1]);\n    }\n    msg.payload = array;\n    return msg;    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":500,"wires":[["29c7f357.51551c","e8db11ee.f914"]]},{"id":"e8db11ee.f914","type":"debug","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":460,"wires":[]},{"id":"29c7f357.51551c","type":"http response","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"","statusCode":"","headers":{},"x":1130,"y":500,"wires":[]},{"id":"138aec54.4e2aa4","type":"function","z":"51c3eae1.47d714","g":"3dd003d9.b94eec","name":"Distance","func":"var data = msg.payload;\nvar mindis = ((flow.get(\"limitt\")).mindis)/1000;\nvar pass = [];\nvar current = 0\n\nfor(i=0;i<data.length;i++){\n    var dis = distance(parseFloat(data[current].lat),parseFloat(data[current].lon),parseFloat(data[i].lat),parseFloat(data[i].lon),\"K\")\n    if(dis<mindis){\n        continue\n    }else{\n        pass.push({\"ID\":data[i].ID,\"lat\":data[i].lat,\"lon\":data[i].lon,\"time\":data[i].time,\"difdis\":current});\n        current = i;\n    }\n}\nmsg.payload = pass;\nreturn msg;\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":500,"wires":[["6a212d72.c2ba64"]]},{"id":"a09168ac.bdb028","type":"debug","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":280,"wires":[]},{"id":"55de2c47.b1f284","type":"inject","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":280,"wires":[["ff2e5a37.a747d8"]]},{"id":"b4a2080f.2257f8","type":"http in","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","url":"/DispAllVehicle","method":"get","upload":false,"swaggerDoc":"","x":170,"y":700,"wires":[["1cf1d1b7.d18cbe"]]},{"id":"a5ed1c08.e19dd","type":"comment","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"Display posisi terakhir semua kapal : http://36.92.113.244:1880/DispAllVehicle.","info":"Display posisi terakhir semua kapal untuk ditampilkan di google map\nReturn : JSON posisi semua kapal","x":360,"y":600,"wires":[]},{"id":"1cf1d1b7.d18cbe","type":"function","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","func":"msg.query = \"SELECT lat,lon FROM A1GPS GROUP BY * ORDER BY desc LIMIT 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":700,"wires":[["b8bac9cf.4880d8"]]},{"id":"1eb2e88d.0ca4f7","type":"debug","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":640,"wires":[]},{"id":"5f6b77ff.e6d9a8","type":"http response","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","statusCode":"","headers":{},"x":950,"y":700,"wires":[]},{"id":"b8bac9cf.4880d8","type":"influxdb in","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":690,"y":700,"wires":[["5f6b77ff.e6d9a8","1eb2e88d.0ca4f7"]]},{"id":"55b1f904.1f80a8","type":"comment","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"Display data history untuk suatu kapal : http://36.92.113.244:1880/History?vid=A1&from=xxxxx&to=xxxxx&sep=500&num=25","info":"Display data history untuk suatu kapal \nReturn :\narray JSON dari ","x":500,"y":940,"wires":[]},{"id":"cd0fc071.a4b97","type":"http in","z":"51c3eae1.47d714","g":"27d3216d.4b2e7e","name":"","url":"/History","method":"get","upload":false,"swaggerDoc":"","x":170,"y":800,"wires":[["228cd1c4.1e993e"]]},{"id":"3191ab6f.4426b4","type":"http response","z":"51c3eae1.47d714","d":true,"g":"c2b70546.5e9668","name":"","statusCode":"","headers":{},"x":1150,"y":1020,"wires":[]},{"id":"228cd1c4.1e993e","type":"debug","z":"51c3eae1.47d714","g":"27d3216d.4b2e7e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":330,"y":820,"wires":[]},{"id":"57c4423e.7080ec","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"Query","func":"var data = msg.payload;\nvar VID = data.vid;\nvar fromDate = parseInt(data.from); //epoch time\nvar toDate = parseInt(data.to);\nvar distance = parseInt(data.sep);\nmsg.distance = distance;\nvar num = parseInt(data.num);\nflow.set(\"num\", num);\n//msg.query = \"SELECT Time,F1,F2,F3,F4,F5,F6,rpm1,rpm2,prop1,prop2,ws,lat,lon FROM combine WHERE Time >= \" + String(fromDate) + \" AND Time <= \" + String(toDate) + \";\";\nmsg.query = \"SELECT * FROM fuelLevel WHERE Time >= \" + String(fromDate) + \" AND Time <= \"+String(toDate)+\";\";\nmsg.payload = msg.query;\n//msg.query = \"SELECT Time,F1,F2,F3,F4,F5,F6,rpm1,rpm2,prop1,prop2,ws,lat,lon FROM combine WHERE Time != NULL;\";\n//msg.query = \"SELECT Time,lat FROM combine WHERE Time >= 1619;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1020,"wires":[["45623995.b46e98","72b0fff8.2326f"]]},{"id":"45623995.b46e98","type":"influxdb in","z":"51c3eae1.47d714","g":"c2b70546.5e9668","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":650,"y":1020,"wires":[["9f6cfd94.01455","6f015999.81b7d8"]]},{"id":"9f6cfd94.01455","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":980,"wires":[]},{"id":"7de6ad69.fbf724","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":230,"y":1400,"wires":[]},{"id":"ee337a70.2904c8","type":"function","z":"51c3eae1.47d714","g":"27d3216d.4b2e7e","name":"","func":"var data = msg.payload;\nvar distance = parseInt(msg.distance);\nvar len = data.length;\nvar lat1, lon1, lat2, lon2;\n\nfunction getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\n  var R = 6371; // Radius of the earth in km\n  var dLat = deg2rad(lat2-lat1);  // deg2rad below\n  var dLon = deg2rad(lon2-lon1); \n  var a = \n    Math.sin(dLat/2) * Math.sin(dLat/2) +\n    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * \n    Math.sin(dLon/2) * Math.sin(dLon/2)\n    ; \n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n  var d = R * c; // Distance in km\n  var e = d * 1000; // distance in m\n  return e;\n}\n\nfunction deg2rad(deg) {\n  return deg * (Math.PI/180)\n}\n\nvar j = 1;\nvar i = 0;\nvar buffDist = [];\nvar sta = true;\nvar index = [];\nindex.push[0];\nwhile (sta) {\n  // code block to be executed\n  lat1 = data[i].lat;\n  lon1 = data[i].lon;\n  lat2 = data[i+j].lat;\n  lon2 = data[i+j].lon;\n  var dist = getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2);\n  var distInt = parseInt(dist);\n  if (distInt >= distance) {\n      index.push(i+j);\n      i = i+j;\n      j = 1;\n  } else {\n      j++;\n  }\n  if ((i >= len-1) || (j >= len)) {\n      sta = false;\n  }\n}\n\nvar lenIndex = index.length;\n\nfor (i=0;i<lenIndex;i++) {\n    buffDist.push(data[index[i]]);\n}\n\nmsg.payload = buffDist;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":840,"wires":[[]]},{"id":"902be83b.5259b8","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1190,"y":960,"wires":[]},{"id":"4393ff0d.3600e","type":"inject","z":"47ec9b6e.206e24","name":"prev","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-2.352752,\"lon\":114.888211,\"Time\":1650528171397}","payloadType":"str","x":2100,"y":460,"wires":[["b8c51cca.43e39"]]},{"id":"9fa8d9a4.2497e8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3000,"y":400,"wires":[]},{"id":"b8c51cca.43e39","type":"json","z":"47ec9b6e.206e24","name":"","property":"payload","action":"","pretty":false,"x":2260,"y":480,"wires":[["6fe85687.513c88","507868ef.31ca38"]]},{"id":"d0d83def.9afdf","type":"function","z":"47ec9b6e.206e24","name":"Take Geofence","func":"var data = msg.payload;\nflow.set(\"latlon\",data);\nmsg.topic = \"SELECT * FROM `Geofence`\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2470,"y":500,"wires":[["1d42aaeb.a23d35"]]},{"id":"1d42aaeb.a23d35","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":2640,"y":500,"wires":[["edd0387.81078c8"]]},{"id":"edd0387.81078c8","type":"function","z":"47ec9b6e.206e24","name":"Proses","func":"var data = msg.payload;\nvar latlon = flow.get(\"latlon\");\nvar array4 = [];\nvar array2 = [];\nvar lat = latlon.Lat;\nvar long = latlon.Lon;\nvar time = msg.dat.Time;\nfor(i=0;i<data.length;i++){\n    if(data[i].lat3==null){\n        array2.push(data[i]);\n    }else{\n        array4.push(data[i]);\n    }\n}\n// msg.payload = [array2,array4];\nfor(i=0;i<array2.length;i++){\n    var maxlat2 = Math.max(array2[i].lat1,array2[i].lat2)+(0.050);\n    var minlat2 = Math.min(array2[i].lat1,array2[i].lat2)-(0.050);\n    var maxlong2 = Math.max(array2[i].long1,array2[i].long2);\n    var minlong2 = Math.min(array2[i].long1,array2[i].long2);\n    if(lat<maxlat2 && lat>minlat2 && long<maxlong2 && long>minlong2){\n        //msg.payload = array4[i].geofenceName;\n        // time = Date.now();\n        msg.payload = {Time:time, geoID:array2[i].geofenceID, \"Gname\": array4[i].geofenceName, \"lat\":lat, \"long\":long};\n        return msg;\n        \n    }\n}\n\nfor(i=0;i<array4.length;i++){\n    var maxlat = Math.max(array4[i].lat1,array4[i].lat2,array4[i].lat3,array4[i].lat4);\n    var minlat = Math.min(array4[i].lat1,array4[i].lat2,array4[i].lat3,array4[i].lat4);\n    var maxlong = Math.max(array4[i].long1,array4[i].long2,array4[i].long3,array4[i].long4);\n    var minlong = Math.min(array4[i].long1,array4[i].long2,array4[i].long3,array4[i].long4);\n    if(lat<maxlat && lat>minlat && long<maxlong && long>minlong){\n        //msg.payload = array4[i].geofenceName;\n        // time = Date.now();\n        msg.payload = {\"Time\":time, \"geoID\":array4[i].geofenceID, \"Gname\": array4[i].geofenceName, \"lat\":lat, \"long\":long};\n        return msg;\n        \n    }\n}\n\n\nmsg.payload = null;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2790,"y":480,"wires":[["9fa8d9a4.2497e8","d3987b9b.5480a8","375e687.5fa5998"]]},{"id":"a97416d1.ecabe8","type":"link in","z":"47ec9b6e.206e24","name":"","links":["9f90ebdf.8e5368"],"x":2225,"y":580,"wires":[["6fe85687.513c88"]]},{"id":"6fe85687.513c88","type":"function","z":"47ec9b6e.206e24","name":"","func":"msg.payload = msg.INCOMINGDATA;\nvar data = msg.payload;\nmsg.dat = data;\n// msg.time = data.time;\nmsg.payload = {Lat:parseFloat(data.Lat), Lon:parseFloat(data.Lon)};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":540,"wires":[["d0d83def.9afdf","507868ef.31ca38"]]},{"id":"6a2dd775.4c4cc8","type":"comment","z":"47ec9b6e.206e24","name":"Geofence","info":"","x":2090,"y":380,"wires":[]},{"id":"2fdcbff6.24e53","type":"influxdb out","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":"","measurement":"A1Geo","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":3350,"y":480,"wires":[]},{"id":"d3987b9b.5480a8","type":"switch","z":"47ec9b6e.206e24","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2960,"y":480,"wires":[["59c48dcd.271034"]]},{"id":"593c29a3.617b88","type":"comment","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"Detail kalau di click posisi di map : http://36.92.113.244:1880/clickVid?vid=A1","info":"Departure, Arrival, Current Posistion, Next Position, lat, lon, speed, rob, rpm, ws, prop, last-receive date","x":350,"y":1280,"wires":[]},{"id":"a7550326.a19bb","type":"http in","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","url":"/clickVid","method":"get","upload":false,"swaggerDoc":"","x":150,"y":1340,"wires":[["7de6ad69.fbf724","f1878612.168358"]]},{"id":"515ba5de.a7270c","type":"http response","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","statusCode":"","headers":{},"x":1590,"y":1380,"wires":[]},{"id":"f1878612.168358","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar vid = data.vid;\nmsg.payload = vid;\nvar msg1 = {payload:vid};\nmsg.vid = vid\nreturn [msg, msg1];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":340,"y":1340,"wires":[["4dec17a8.40afb8"],["9efd370.e010fc8"]]},{"id":"4dec17a8.40afb8","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"msg.query = \"SELECT * FROM combine ORDER BY time DESC LIMIT 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1340,"wires":[["e3b269da.692428"]]},{"id":"e3b269da.692428","type":"influxdb in","z":"51c3eae1.47d714","g":"124aada0.a21b82","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":770,"y":1340,"wires":[["4e9ec2f.262343c","d2e0467a.56d088"]]},{"id":"4e9ec2f.262343c","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":1300,"wires":[]},{"id":"d2e0467a.56d088","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"//Departure, Arrival, Current Posistion, Next Position, lat, lon, speed, rob, rpm, ws, prop, last-receive date\nvar data = msg.payload;\nvar Lat = data[0].lat;\nvar Lon = data[0].lon;\nvar speed = 10;\nvar Rob = (data[0].F1+data[0].F6)/2 + (data[0].F2+data[0].F3)/2 + data[0].F4 + data[0].F5;\nvar Ws = data[0].ws;\nvar rpm = 0;\nif (data[0].rpm1 > data[0].rpm2) {\n    rpm = data[0].rpm1;\n} else {\n    rpm = data[0].rpm2;\n}\nvar prop = 0;\nif (data[0].prop1 > data[0].prop2) {\n    prop = data[0].prop1;\n} else {\n    prop = data[0].prop2;\n}\nvar last = data[0].Time;\nmsg.payload = {lat:Lat,lon:Lon,Speed:speed,rob:Rob,ws:Ws,RPM:rpm,PROP:prop,Last:last};\nmsg.topic = \"clickVid\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":1340,"wires":[["9dc3f2.169adc1","e0914b2.d5d33b8"]]},{"id":"9dc3f2.169adc1","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1210,"y":1340,"wires":[]},{"id":"bab1265b.843048","type":"influxdb in","z":"51c3eae1.47d714","g":"124aada0.a21b82","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":670,"y":1400,"wires":[["1403c3ef.df21ac"]]},{"id":"1fe66073.c87a4","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1390,"y":1400,"wires":[]},{"id":"9efd370.e010fc8","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"msg.query = \"SELECT * FROM A1Geo ORDER BY time DESC LIMIT 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1400,"wires":[["bab1265b.843048"]]},{"id":"1403c3ef.df21ac","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar geoID = data[0].geoID;\nmsg.topic = \"SELECT geofenceName FROM Geofence WHERE geofenceID = \\' \" + String(geoID) + \"\\';\";\nvar msg1 = {payload:geoID};\nreturn [msg, msg1];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":880,"y":1400,"wires":[["3fe811f1.842aae"],["2606a881.7f7578"]]},{"id":"3fe811f1.842aae","type":"mysql","z":"51c3eae1.47d714","g":"124aada0.a21b82","mydb":"be353e7e.73b9d","name":"","x":1030,"y":1400,"wires":[["aab3f3a7.8471"]]},{"id":"aab3f3a7.8471","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nmsg.payload = {geofenceName:data[0].geofenceName};\nmsg.topic = \"geoName\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":1400,"wires":[["e0914b2.d5d33b8","1fe66073.c87a4"]]},{"id":"2606a881.7f7578","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var geoID = msg.payload;\nvar vid = msg.vid;\nflow.set(\"geoID\",geoID);\nmsg.topic = \"SELECT * FROM TaskID WHERE VID = \"+String(vid)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1480,"wires":[["32fffcab.da57c4"]]},{"id":"32fffcab.da57c4","type":"mysql","z":"51c3eae1.47d714","g":"124aada0.a21b82","mydb":"be353e7e.73b9d","name":"","x":1030,"y":1480,"wires":[["a8c63575.a963b8","742733bb.8f7dfc"]]},{"id":"6d9e73bf.9a979c","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1610,"y":1500,"wires":[]},{"id":"a8c63575.a963b8","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar PathID = data[0].PathID;\nvar PathNum = parseInt(data[0].PathNum) + 1;\nmsg.topic = \"SELECT geofenceID FROM PathName WHERE PathID = \\'\"+String(PathID)+\"\\' AND PathNum = \\'\"+String(PathNum)+\"\\';\";\nmsg.topic += \"SELECT geofenceID FROM PathName WHERE PathID = \\'\"+String(PathID)+\"\\' AND PathNum = \\'\"+String(1)+\"\\';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1540,"wires":[["d55c0278.105a"]]},{"id":"d55c0278.105a","type":"mysql","z":"51c3eae1.47d714","g":"124aada0.a21b82","mydb":"be353e7e.73b9d","name":"","x":1033,"y":1538,"wires":[["22919141.00474e","e98f187a.f12448"]]},{"id":"22919141.00474e","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar geoID = 0;\ntry{\n    geoID = data[0][0].geofenceID;\n}catch(x){\n    geoID = data[1][0].geofenceID;\n}\nmsg.payload = geoID;\nmsg.topic = \"SELECT geofenceName FROM Geofence WHERE geofenceID = \\' \" + String(geoID) + \"\\';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1600,"wires":[["14dbbef1.cd0751","ce41e76e.08f338"]]},{"id":"14dbbef1.cd0751","type":"mysql","z":"51c3eae1.47d714","g":"124aada0.a21b82","mydb":"be353e7e.73b9d","name":"","x":1030,"y":1600,"wires":[["ee69f384.41225","ce41e76e.08f338"]]},{"id":"ee69f384.41225","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar geoName = data[0].geofenceName;\nmsg.payload = {next:geoName};\nmsg.topic = \"nextGeoName\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":1600,"wires":[["e0914b2.d5d33b8","45a20f5f.7ff86"]]},{"id":"e0914b2.d5d33b8","type":"join","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1260,"y":1500,"wires":[["a2bbe96c.85cf08"]]},{"id":"45a20f5f.7ff86","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1350,"y":1600,"wires":[]},{"id":"a2bbe96c.85cf08","type":"function","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","func":"var data = msg.payload;\nvar Lat = data.clickVid.lat;\nvar Lon = data.clickVid.lon;\nvar Speed = data.clickVid.Speed;\nvar Rob = data.clickVid.rob;\nvar Ws = data.clickVid.ws;\nvar Rpm = data.clickVid.RPM;\nvar PROP = data.clickVid.PROP;\nvar Last = data.clickVid.Last;\nvar Next = data.nextGeoName.next;\nvar CurrGeo = data.geoName.geofenceName;\nmsg.payload = [{lat:Lat,lon:Lon,speed:Speed,rob:Rob,ws:Ws,rpm:Rpm,prop:PROP,last:Last,next:Next,current:CurrGeo}];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1420,"y":1500,"wires":[["6d9e73bf.9a979c","515ba5de.a7270c"]]},{"id":"6f015999.81b7d8","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","func":"var data = msg.payload.results[0].series[0].values;\nvar len = data.length;\nvar buff = [];\nvar num = parseInt(flow.get(\"num\"));\nif (len > num) {\n    var step = parseInt(len/num);\n    for (i=0;i<num;i++) {\n        buff.push(data[i*step]);\n    }\n    msg.payload = buff;\n} else {\n    msg.payload = data;\n}\nvar payld = msg.payload;\nvar arra = [];\nfor(i=0;i<payld.length;i++){\n    var jsonn = {\n        \"idd\":String(i+1),\n        \"time\": payld[i][0],\n        \"F1\":payld[i][1],\n        \"F2\":payld[i][2],\n        \"F3\":payld[i][3],\n        \"F4\":payld[i][4],\n        \"F5\":payld[i][5],\n        \"F6\":payld[i][6],\n        \"RP1\":payld[i][7],\n        \"RP2\":payld[i][8],\n        \"RP5\":payld[i][9],\n        \"RP8\":payld[i][10],\n        \"lat\":payld[i][11],\n        \"lon\":payld[i][12],\n        \"sat\":payld[i][13],\n        \"ws\":payld[i][14]\n    }\n    var waktu = dateepo(jsonn.time);\n    var apex = {\n        \"IDD\":jsonn.idd,\n        \"ROB\":jsonn.F1, //ROB ---------------------------------------------------------------\n        \"RPMENGINE\":String((parseInt(jsonn.RP1)+parseInt(jsonn.RP2))/2),\n        \"RPMPROP\":String((parseInt(jsonn.RP5)+parseInt(jsonn.RP8))/2),\n        \"WINDSPEED\":jsonn.ws,\n        \"SPEED\":\"0\", //SPEEEEEEEEEEED\n        \"RECORDDATE\":String(waktu),\n        \"STATS\":\"1\",\n        \"LAT\":parseFloat(jsonn.lat),\n        \"LON\":parseFloat(jsonn.lon),\n        \"EPO\":jsonn.time\n    }\n    arra.push(apex);\n}\nmsg.mymy= arra;\nreturn msg;\n\nfunction dateepo(datee){\n    var strdate = String(new Date(datee));\n    var s = strdate.split(\" \");\n    var mydate = s[0]+\" \"+s[2]+\" \"+s[1]+\" \"+s[3]+\" \"+s[4].substring(0,5);\n    return mydate;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":1080,"wires":[["902be83b.5259b8","3191ab6f.4426b4","1cc161f2.221c8e"]]},{"id":"9564eaf8.9ee2b8","type":"inject","z":"51c3eae1.47d714","g":"f2b8c5da.e09968","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":2040,"wires":[["c1478481.726d98"]]},{"id":"c1478481.726d98","type":"function","z":"51c3eae1.47d714","g":"f2b8c5da.e09968","name":"","func":"msg.query = \"SELECT Time FROM combine\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":2020,"wires":[["87f076bc.088d58"]]},{"id":"1cb6ea29.0cb476","type":"debug","z":"51c3eae1.47d714","g":"f2b8c5da.e09968","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":680,"y":2060,"wires":[]},{"id":"87f076bc.088d58","type":"influxdb in","z":"51c3eae1.47d714","g":"f2b8c5da.e09968","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":610,"y":2000,"wires":[["1cb6ea29.0cb476"]]},{"id":"fa39dd60.3b52b","type":"function","z":"47ec9b6e.206e24","name":"Select","func":"var IDkapal = flow.get(\"IDKAPAL\");\nflow.set(\"PositionNow\",msg.payload);\nmsg.payload = IDkapal;\nmsg.topic = \"SELECT * FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"';\";\n//msg.topic += \"SELECT `geofenceID`,`Main_Activity` FROM `PathName` WHERE `PathName`.`PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"') AND `PathName`.`PathNum` = (SELECT `PathNum` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"');\";\nmsg.topic += \"SELECT * FROM `PathName`;\";\nmsg.topic += \"SELECT * FROM `PathID` WHERE `PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"');\";\n//msg.topoc += \"SELECT * FROM `PathName` WHERE `PathName`.`PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"') AND `PathName`.`PathNum` = (SELECT `PathNum` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"');\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":540,"wires":[["2285ac4c.c97134","ba0f4276.69bda"]]},{"id":"962ca60a.9e51b8","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1000","payloadType":"num","x":4170,"y":480,"wires":[["1ff0f441.f3209c"]]},{"id":"1ff0f441.f3209c","type":"function","z":"47ec9b6e.206e24","name":"Replace","func":"//msg.payload = {'time':1619856125,'test':1,'test2':2};\nmsg.payload = {'time':1619861879,'value':Math.floor(Math.random() * 1000) + 1};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4360,"y":480,"wires":[["39079762.7dfbe8","441349b8.116868","1169e4e2.19d7bb"]]},{"id":"39079762.7dfbe8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4580,"y":480,"wires":[]},{"id":"2285ac4c.c97134","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":3120,"y":540,"wires":[["7d260696.2df258","1c16a587.8f2dba"]]},{"id":"a2702b64.fc7cf8","type":"function","z":"47ec9b6e.206e24","name":"Update Task ID","func":"var PositionNow = flow.get(\"PositionNow\");\nvar IDkapal = flow.get(\"IDKAPAL\");\nvar geoIDNow = PositionNow.geoID;\nvar TaskID = flow.get(\"TaskIDNow\");\nvar PathName = msg.payload;\nvar PathNumNow = TaskID.PathNum;\nfor(i=0;i<PathName.length;i++){\n    if(PathName[i].geofenceID == geoIDNow){\n        var NewPathNum = PathName[i].PathNum;\n        msg.topic = \"UPDATE `TaskID` SET `PathNum` = \"+String(NewPathNum)+\" WHERE `VID` = '\"+String(IDkapal)+\"';\";\n        return msg;\n    }\n}\nif(PathName.length<1){\n    msg.topic = \"UPDATE `TaskID` SET `PathNum` = 1, `Cycle` = 1+`Cycle` WHERE `VID` = '\"+String(IDkapal)+\"';\";\n    return msg;\n}\nmsg.topic = \"SELECT `PathNum` FROM `TaskID`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3590,"y":540,"wires":[["feae11cf.2dc66","26bba83b.916c08"]]},{"id":"1c16a587.8f2dba","type":"function","z":"47ec9b6e.206e24","name":"Select PathName","func":"var TaskID = msg.payload[0][0];\nvar PathNum = TaskID.PathNum;\nflow.set(\"TaskIDNow\",TaskID)\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = \"+String(TaskID.PathID)+\" AND `PathNum` > \"+String(PathNum)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3340,"y":580,"wires":[["20e37ec0.cb8172"]]},{"id":"20e37ec0.cb8172","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":3380,"y":540,"wires":[["a2702b64.fc7cf8","fea11825.7906c8"]]},{"id":"634a2ff6.e87e6","type":"function","z":"47ec9b6e.206e24","name":"Simpan ID Kapal","func":"flow.set(\"IDKAPAL\",String(msg.topic));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":100,"wires":[[]]},{"id":"89aba1e6.61f2e","type":"link in","z":"47ec9b6e.206e24","name":"","links":["9f90ebdf.8e5368"],"x":2115,"y":100,"wires":[["634a2ff6.e87e6"]]},{"id":"feae11cf.2dc66","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"Update Mysql","x":3610,"y":600,"wires":[["94c9449d.abf6f8"]]},{"id":"441349b8.116868","type":"influxdb out","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":"","measurement":"Test","precision":"s","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":4620,"y":540,"wires":[]},{"id":"dab3d45a.3d5928","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1000","payloadType":"num","x":4180,"y":540,"wires":[["441349b8.116868"]]},{"id":"86da09d8.948068","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"4000","payloadType":"num","x":4180,"y":580,"wires":[["441349b8.116868"]]},{"id":"3f1dfcc7.a900a4","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2000","payloadType":"num","x":4180,"y":620,"wires":[["441349b8.116868"]]},{"id":"e46288bb.65e008","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3000","payloadType":"num","x":4180,"y":660,"wires":[["441349b8.116868"]]},{"id":"1169e4e2.19d7bb","type":"delay","z":"47ec9b6e.206e24","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4370,"y":400,"wires":[[]]},{"id":"72b0fff8.2326f","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":980,"wires":[]},{"id":"a87d2e6a.dd55c","type":"http in","z":"51c3eae1.47d714","g":"51dc6ef1.ebc47","name":"changepathid","url":"changepathid","method":"get","upload":false,"swaggerDoc":"","x":150,"y":2240,"wires":[["aa67bba7.e73778","13f32796.c12ed8"]]},{"id":"aa67bba7.e73778","type":"function","z":"51c3eae1.47d714","g":"51dc6ef1.ebc47","name":"Update PathID","func":"var data = msg.payload;\nvar VID = data.VID;\nvar pathID = data.pathID;\nmsg.topic = \"UPDATE `TaskID` SET `PathID` = \"+String(pathID)+\", `PathNum` = 1 WHERE `VID` = '\"+String(VID)+\"';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2240,"wires":[["13f32796.c12ed8","77d8b80c.ac5978"]]},{"id":"13f32796.c12ed8","type":"debug","z":"51c3eae1.47d714","g":"51dc6ef1.ebc47","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":530,"y":2160,"wires":[]},{"id":"77d8b80c.ac5978","type":"mysql","z":"51c3eae1.47d714","g":"51dc6ef1.ebc47","mydb":"be353e7e.73b9d","name":"","x":630,"y":2240,"wires":[["d60e9b1a.b7c208"]]},{"id":"d60e9b1a.b7c208","type":"http response","z":"51c3eae1.47d714","g":"51dc6ef1.ebc47","name":"","statusCode":"","headers":{},"x":850,"y":2240,"wires":[]},{"id":"a670e3c9.220e3","type":"inject","z":"51c3eae1.47d714","g":"fb689e78.5fa04","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":2340,"wires":[["63e70434.dbd2bc"]]},{"id":"63e70434.dbd2bc","type":"function","z":"51c3eae1.47d714","g":"fb689e78.5fa04","name":"","func":"msg.query = \"SELECT * from sortgps;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":2360,"wires":[["76f8ac0f.43a064"]]},{"id":"76f8ac0f.43a064","type":"influxdb in","z":"51c3eae1.47d714","g":"fb689e78.5fa04","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":610,"y":2340,"wires":[["609cf598.a7e2cc"]]},{"id":"619b7f79.44c41","type":"debug","z":"51c3eae1.47d714","g":"fb689e78.5fa04","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1060,"y":2340,"wires":[]},{"id":"609cf598.a7e2cc","type":"function","z":"51c3eae1.47d714","g":"fb689e78.5fa04","name":"","func":"var data = msg.payload;\nvar angka = [];\nfor(i=0;i<data.length;i++){\n    if(parseFloat(data[i].lat)>0){\n        angka.push(parseFloat(data[i].lat));\n    }\n}\nmsg.payload = angka;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":2340,"wires":[["619b7f79.44c41"]]},{"id":"e088ebf3.535998","type":"function","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"backup","func":"msg.query = \"select ID,lat,lon,wind from sortgps where lat != '0' and lon != '0' and time > 1614560461;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":360,"wires":[["de3f36e9.bfec78"]]},{"id":"73c96c80.edd5c4","type":"debug","z":"51c3eae1.47d714","g":"42b4dc71.c3d2e4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":240,"wires":[]},{"id":"7f26f664.013538","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":320,"y":140,"wires":[["44ec7f6c.c91de"]]},{"id":"44ec7f6c.c91de","type":"function","z":"fdac93f7.bec1b","name":"F5","func":"msg.query = \"SELECT * FROM F5Liter;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":140,"wires":[["585f4ec7.d3552"]]},{"id":"585f4ec7.d3552","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":630,"y":140,"wires":[["98be7b8e.b75178","e4df8b8b.60c258"]]},{"id":"12c9f01d.e2d6","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":380,"wires":[]},{"id":"e4df8b8b.60c258","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar arr = [];\nfor(i=0;i<data.length;i++){\n    if(data[i].Time > 1000000000){\n        arr.push(data[i]);\n    }\n}\nmsg.payload = arr;\nflow.set(\"DataF5\",arr);\nmsg.topic = \"\";\nfor(i=0;i<arr.length;i++){\n    msg.topic +=  \"SELECT Value FROM FS004cek WHERE Liter = \"+String(arr[i].F5)+\";\";\n}\nvar arrtop = msg.topic.split(';');\nflow.set(\"SiTopicc\",arrtop);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":180,"wires":[["1ebf5e05.19c5a2","1a03453f.ded40b"]]},{"id":"1a03453f.ded40b","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":410,"y":240,"wires":[["41d5557e.d1f3ec"]]},{"id":"41d5557e.d1f3ec","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar arr = [];\nvar digit = \"\";\nvar newdigit = \"\";\nvar str = \"\";\nvar matches = [];\nmsg.topic = \"\";\nvar topic = flow.get(\"SiTopicc\");\nfor(i=0;i<data.length;i++){\n    if(data[i].length<1){\n        arr.push(i);\n    }\n}\nfor(i=0;i<arr.length;i++){\n    var j = arr[i]\n    str = topic[j].substring(40,topic[j].length)\n    matches.push(str.match(/(\\d+)/));\n    var m = str.match(/(\\d+)/);\n    var angka = parseFloat(m)+1;\n    var split = topic[i].split(\"=\");\n    var query = split[0]+\"=\";\n    topic[j] = query+String(angka);\n}\nfor(i=0;i<topic.length;i++){\n    msg.topic += String(topic[i])+\";\";\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":300,"wires":[["277c36fa.2c9a4a","3703de8a.cb1fb2"]]},{"id":"277c36fa.2c9a4a","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":490,"y":300,"wires":[["59a23a1d.c5ff94","d2e28f68.c4dcd"]]},{"id":"d2e28f68.c4dcd","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.topic = \"\";\nvar data = msg.payload;\nfor(i=0;i<data.length;i++){\n    var value = data[i][0].Value;\n    msg.topic += \"SELECT `Liter` FROM `FS005_New` WHERE `Value` =     \"+ String(value) + \";\";    \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":360,"wires":[["8d74dcf2.46ca5"]]},{"id":"8d74dcf2.46ca5","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":430,"y":400,"wires":[["dea01596.f6d038"]]},{"id":"98be7b8e.b75178","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":120,"wires":[]},{"id":"dea01596.f6d038","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nmsg.topic = \"\";\nvar dataF5 = flow.get(\"DataF5\");\nfor(i=0;i<dataF5.length;i++){\n    dataF5[i].F5 = data[i][0].Liter;\n}\nmsg.payload = dataF5;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":440,"wires":[["64a7f846.0ec2c8","12c9f01d.e2d6"]]},{"id":"64a7f846.0ec2c8","type":"function","z":"fdac93f7.bec1b","name":"Initiate Loop","func":"var data = msg.payload;\nmsg.topic = \"0\";\nflow.set(\"LimitLoopF3\",data.length);\nflow.set(\"DataF3Loop\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":540,"wires":[["d7a330db.715cf"]]},{"id":"d7a330db.715cf","type":"function","z":"fdac93f7.bec1b","name":"Loop","func":"var count = parseFloat(msg.topic);\nvar data = flow.get(\"DataF3Loop\");\nmsg.payload = data[count];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":540,"wires":[["a2884823.7729c8","f38dc30d.5974d","5db7eeb2.9f1c3"]]},{"id":"a2884823.7729c8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":900,"y":540,"wires":[]},{"id":"f38dc30d.5974d","type":"link out","z":"fdac93f7.bec1b","name":"","links":["de74bb53.4ad388"],"x":545,"y":580,"wires":[]},{"id":"846de7ab.4c1a88","type":"link in","z":"fdac93f7.bec1b","name":"","links":["5a4f7601.51c008"],"x":365,"y":580,"wires":[["d7a330db.715cf"]]},{"id":"de74bb53.4ad388","type":"link in","z":"fdac93f7.bec1b","name":"","links":["f38dc30d.5974d"],"x":285,"y":620,"wires":[["a197144b.b79f08"]]},{"id":"5a4f7601.51c008","type":"link out","z":"fdac93f7.bec1b","name":"","links":["846de7ab.4c1a88"],"x":765,"y":620,"wires":[]},{"id":"a197144b.b79f08","type":"function","z":"fdac93f7.bec1b","name":"Increment","func":"var count = parseFloat(msg.topic);\nvar limit  = flow.get(\"LimitLoopF3\");\ncount++;\nif(count<limit){\n    var a = 1;\n    // msg.payload = null;\n}else{\n    msg.payload = null;\n}\nmsg.topic = String(count);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":620,"wires":[["e3b94230.df023","14a14cae.09d6a3"]]},{"id":"e3b94230.df023","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":620,"wires":[["5a473e87.bebb3"]]},{"id":"14a14cae.09d6a3","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":660,"wires":[["d6afff5.d7aac"]]},{"id":"d6afff5.d7aac","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":680,"y":660,"wires":[]},{"id":"5a473e87.bebb3","type":"delay","z":"fdac93f7.bec1b","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"milliseconds","drop":false,"x":650,"y":620,"wires":[["5a4f7601.51c008"]]},{"id":"59a23a1d.c5ff94","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":280,"wires":[]},{"id":"3703de8a.cb1fb2","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":240,"wires":[]},{"id":"1ebf5e05.19c5a2","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":920,"y":160,"wires":[]},{"id":"5db7eeb2.9f1c3","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"F5Liter3","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":720,"y":500,"wires":[]},{"id":"36e8cc76.0c8dd4","type":"inject","z":"fdac93f7.bec1b","name":"Reset Relay 1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Relay\":\"1\"}","payloadType":"json","x":210,"y":740,"wires":[["2a3a91db.d902ce"]]},{"id":"2a3a91db.d902ce","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"Relayy","qos":"","retain":"","broker":"4803b37b.b88cfc","x":470,"y":800,"wires":[]},{"id":"fac1bbac.5e1e18","type":"inject","z":"fdac93f7.bec1b","name":"Reset Relay 5","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Relay\":\"5\"}","payloadType":"json","x":210,"y":780,"wires":[["2a3a91db.d902ce"]]},{"id":"5b853105.ba7db","type":"inject","z":"fdac93f7.bec1b","name":"Reset Relay 3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Relay\":\"3\"}","payloadType":"json","x":210,"y":820,"wires":[["2a3a91db.d902ce"]]},{"id":"489d95d4.6a01fc","type":"inject","z":"fdac93f7.bec1b","name":"Reset Relay 4","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Relay\":\"4\"}","payloadType":"json","x":210,"y":860,"wires":[["2a3a91db.d902ce"]]},{"id":"53cd2a8c.8b8bd4","type":"inject","z":"fdac93f7.bec1b","name":"Cek","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Relay\":\"Check\"}","payloadType":"json","x":200,"y":940,"wires":[["2a3a91db.d902ce","4373177.467f2e8"]]},{"id":"40d65d17.0ceff4","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"CheckStatFuel","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":380,"y":940,"wires":[["ec0885bb.68d028"]]},{"id":"ec0885bb.68d028","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":940,"wires":[]},{"id":"377b7f3f.85f89","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"NilaiFuell","qos":"","retain":"","broker":"4803b37b.b88cfc","x":320,"y":1000,"wires":[]},{"id":"36f4edd8.510f42","type":"inject","z":"fdac93f7.bec1b","name":"On","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"FuelView\":\"1\"}","payloadType":"json","x":170,"y":1000,"wires":[["377b7f3f.85f89"]]},{"id":"642fc776.99e598","type":"inject","z":"fdac93f7.bec1b","name":"Off","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"FuelView\":\"0\"}","payloadType":"json","x":170,"y":1040,"wires":[["377b7f3f.85f89"]]},{"id":"9875ecc2.340d1","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"NilaiFuel","qos":"2","datatype":"utf8","broker":"4803b37b.b88cfc","x":320,"y":1040,"wires":[["eee48948.92c258"]]},{"id":"4373177.467f2e8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":860,"wires":[]},{"id":"4b98d7d6.0fc448","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR001/cmd","payload":"FS001,1","payloadType":"str","x":230,"y":1280,"wires":[["cdd4d954.949878"]]},{"id":"cdd4d954.949878","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"InjectToRaspi","qos":"","retain":"","broker":"4803b37b.b88cfc","x":540,"y":1340,"wires":[]},{"id":"503c7567.4fa5cc","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR002/cmd","payload":"FS002,5,1","payloadType":"str","x":220,"y":1200,"wires":[["cdd4d954.949878"]]},{"id":"8dbaf2d1.4b132","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR002/cmd","payload":"FS004,4,7","payloadType":"str","x":220,"y":1240,"wires":[["cdd4d954.949878"]]},{"id":"c9f404b1.0c8da8","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR001/cmd","payload":"FS002,1","payloadType":"str","x":230,"y":1320,"wires":[["cdd4d954.949878"]]},{"id":"9c2639bd.569598","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR001/cmd","payload":"FS003,1","payloadType":"str","x":230,"y":1360,"wires":[["cdd4d954.949878"]]},{"id":"3ea02453.1c0f9c","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR001/cmd","payload":"FS004,1","payloadType":"str","x":230,"y":1400,"wires":[["cdd4d954.949878"]]},{"id":"f54b2aaf.a580e8","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR001/cmd","payload":"FS005,1","payloadType":"str","x":230,"y":1440,"wires":[["cdd4d954.949878"]]},{"id":"2ad836ea.75ab1a","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LR002/cmd","payload":"FS006,1","payloadType":"str","x":230,"y":1480,"wires":[["cdd4d954.949878"]]},{"id":"f454f951.9abbe8","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"SendReport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":470,"y":1080,"wires":[]},{"id":"bf030d0.11eadf","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SendReport","payload":"SendReport","payloadType":"str","x":190,"y":1080,"wires":[["f454f951.9abbe8"]]},{"id":"35731383.99624c","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"query","v":" select * from fuelkelanisliters","vt":"str"},{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":1520,"wires":[["990bac91.9c55a"]]},{"id":"990bac91.9c55a","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":300,"y":1560,"wires":[["1aef81f4.07f64e","53dfb3ff.dfd0dc","35eed6ee.95fb3a"]]},{"id":"d99fe3fb.6d08c","type":"debug","z":"fdac93f7.bec1b","name":"excel","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":710,"y":1480,"wires":[]},{"id":"f8b8e610.06a308","type":"excel","z":"fdac93f7.bec1b","name":"All1718","file":"/var/www/html/All.xlsx","x":700,"y":1580,"wires":[["75e1d86a.398da8"]]},{"id":"1aef81f4.07f64e","type":"function","z":"fdac93f7.bec1b","d":true,"name":"","func":"var data = msg.payload;\nvar json = [];\nvar values = data.results[0].series[0].values;\nfor(i=0;i<values.length;i++){\n    json.push({\"time\":values[i][0],\"F1\":values[i][1],\"F2\":values[i][2],\"F3\":values[i][3],\"F4\":values[i][4],\"F5\":values[i][5],\"F6\":values[i][6],\"RP1\":values[i][7],\"RP2\":values[i][8],\"RP5\":values[i][9],\"RP8\":values[i][10],\"lat\":values[i][11],\"lon\":values[i][12],\"sat\":values[i][13],\"ws\":values[i][14]});\n}\nflow.set(\"dataFuelLev\",json);\nmsg.payload = json\nmsg.topic = \"SELECT * FROM FS001Jan;\";\nmsg.topic += \"SELECT * FROM FS002Jan;\";\nmsg.topic += \"SELECT * FROM FS003Jan;\";\nmsg.topic += \"SELECT * FROM FS4Nov;\";\nmsg.topic += \"SELECT * FROM FS5Nov;\";\nmsg.topic += \"SELECT * FROM FS006Jan;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":1620,"wires":[["53dfb3ff.dfd0dc"]]},{"id":"1d6b5849.5b2c68","type":"excel","z":"fdac93f7.bec1b","name":"","file":"/var/www/html/KelanisLiter.xlsx","x":690,"y":1540,"wires":[["d99fe3fb.6d08c"]]},{"id":"75e1d86a.398da8","type":"debug","z":"fdac93f7.bec1b","name":"excel","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":1620,"wires":[]},{"id":"eee48948.92c258","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":560,"y":1020,"wires":[]},{"id":"94223318.9938a","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":1740,"wires":[["4120e5df.15a9fc"]]},{"id":"4120e5df.15a9fc","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.query = \"SELECT F1,time FROM fuelLevel;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1740,"wires":[["67cc1507.7eff3c"]]},{"id":"67cc1507.7eff3c","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":620,"y":1740,"wires":[["3d0c51b8.cfa47e"]]},{"id":"3d0c51b8.cfa47e","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = (msg.payload).results[0].series[0].values;\nvar arr = [];\nfor(i=0;i<data.length;i++){\n    if(data[i][1] != '-1' && data[i][0]>1636246800000 && parseInt(data[i][1]) > 399){ //7 nov\n        arr.push({\"time\":data[i][0],\"F1\":data[i][1]});\n    }\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1740,"wires":[["dccb804f.a4eef","1b88b156.f0cbff"]]},{"id":"1b88b156.f0cbff","type":"function","z":"fdac93f7.bec1b","name":"Initiate Loop","func":"var data = msg.payload;\nmsg.topic = \"0\";\nflow.set(\"LimitLoop\",data.length);\nflow.set(\"DataLoop\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":1840,"wires":[["98264248.6ffc9"]]},{"id":"98264248.6ffc9","type":"function","z":"fdac93f7.bec1b","name":"Loop","func":"var count = parseFloat(msg.topic);\nvar data = flow.get(\"DataLoop\");\nmsg.payload = data[count];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1840,"wires":[["e1150c3b.ad069","a0307a47.9d60d8"]]},{"id":"a0307a47.9d60d8","type":"link out","z":"fdac93f7.bec1b","name":"","links":["e4c6df50.70af"],"x":425,"y":1880,"wires":[]},{"id":"ecdc39a9.a75ec8","type":"link in","z":"fdac93f7.bec1b","name":"","links":["90cfed32.195"],"x":245,"y":1880,"wires":[["98264248.6ffc9"]]},{"id":"e4c6df50.70af","type":"link in","z":"fdac93f7.bec1b","name":"","links":["a0307a47.9d60d8"],"x":165,"y":1920,"wires":[["294890bb.59e96"]]},{"id":"90cfed32.195","type":"link out","z":"fdac93f7.bec1b","name":"","links":["ecdc39a9.a75ec8"],"x":645,"y":1920,"wires":[]},{"id":"294890bb.59e96","type":"function","z":"fdac93f7.bec1b","name":"Increment","func":"var count = parseFloat(msg.topic);\nvar limit  = flow.get(\"LimitLoop\");\ncount++;\nif(count<limit){\n    var a = 1;\n    // msg.payload = null;\n}else{\n    msg.payload = null;\n}\nmsg.topic = String(count);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1920,"wires":[["cddfb4e8.e34b98","4a7fe75e.86e2f8"]]},{"id":"cddfb4e8.e34b98","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":400,"y":1920,"wires":[["c18ba7a4.a12d68"]]},{"id":"4a7fe75e.86e2f8","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":400,"y":1960,"wires":[["59c515bd.70467c"]]},{"id":"59c515bd.70467c","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":560,"y":1960,"wires":[]},{"id":"c18ba7a4.a12d68","type":"delay","z":"fdac93f7.bec1b","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"milliseconds","drop":false,"x":540,"y":1920,"wires":[["90cfed32.195"]]},{"id":"718b076.63360f8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":1900,"wires":[]},{"id":"e1150c3b.ad069","type":"function","z":"fdac93f7.bec1b","name":"TabelBaruNov","func":"var data = msg.payload;\nflow.set(\"isidata\",data);\nmsg.topic = \"SELECT `Liter` FROM `FS001Jan` WHERE `Value` = \"+String(data.F1)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1840,"wires":[["2d0861f7.33bb9e"]]},{"id":"2d0861f7.33bb9e","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":670,"y":1840,"wires":[["37a7b450.58c3ac"]]},{"id":"37a7b450.58c3ac","type":"function","z":"fdac93f7.bec1b","name":"Injecttoinflux","func":"var Liter = (msg.payload)[0].Liter;\nvar data = flow.get(\"isidata\");\nvar time = data.time*1000000;\nvar json = {Time: time, F1:Liter, time: time};\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":1840,"wires":[["718b076.63360f8","36bb830f.6f819c"]]},{"id":"36bb830f.6f819c","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"F1LiterJan2022","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1110,"y":1840,"wires":[]},{"id":"dccb804f.a4eef","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":1680,"wires":[]},{"id":"ee7957b0.ca3118","type":"comment","z":"fdac93f7.bec1b","name":"Untuk Modif Liter ke Tabel sQL","info":"","x":280,"y":1700,"wires":[]},{"id":"667bafd7.fc611","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":2060,"wires":[["7e8b1c36.fbecf4"]]},{"id":"3cdbd38.7e8852c","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":550,"y":2060,"wires":[["8971420c.37fcc","3907edc1.83bf92"]]},{"id":"7e8b1c36.fbecf4","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.query = \"SELECT sat FROM fuelLevel;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":2060,"wires":[["3cdbd38.7e8852c"]]},{"id":"aeed3725.adf578","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":2120,"wires":[]},{"id":"8971420c.37fcc","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = (msg.payload).results[0].series[0].values;\nvar arr = [];\nfor(i=0;i<data.length;i++){\n    if(data[i][0]>1 && data[i][1]>=0){\n        arr.push({time:data[i][0],Sat:parseInt(data[i][1])});\n    }\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":2060,"wires":[["18959a35.677f06","e78dcf57.5797a"]]},{"id":"75fa8369.080f2c","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"SatNov","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":800,"y":2160,"wires":[]},{"id":"f2837882.a70da8","type":"link out","z":"fdac93f7.bec1b","name":"","links":["4e9f6530.45583c"],"x":435,"y":2160,"wires":[]},{"id":"2bd58adb.a0a336","type":"link in","z":"fdac93f7.bec1b","name":"","links":["3d5ee6b0.eb18fa"],"x":255,"y":2160,"wires":[["34507664.9bfcda"]]},{"id":"4e9f6530.45583c","type":"link in","z":"fdac93f7.bec1b","name":"","links":["f2837882.a70da8"],"x":175,"y":2200,"wires":[["341afa90.8266f6"]]},{"id":"3d5ee6b0.eb18fa","type":"link out","z":"fdac93f7.bec1b","name":"","links":["2bd58adb.a0a336"],"x":655,"y":2200,"wires":[]},{"id":"341afa90.8266f6","type":"function","z":"fdac93f7.bec1b","name":"Increment","func":"var count = parseFloat(msg.topic);\nvar limit  = flow.get(\"LimitLoop\");\ncount++;\nif(count<limit){\n    var a = 1;\n    // msg.payload = null;\n}else{\n    msg.payload = null;\n}\nmsg.topic = String(count);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":2200,"wires":[["7d69d8e8.de1718","c24a4d16.b04d5"]]},{"id":"7d69d8e8.de1718","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":2200,"wires":[["78420d90.6c3fa4"]]},{"id":"c24a4d16.b04d5","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":2240,"wires":[["7dfa5f86.35315"]]},{"id":"7dfa5f86.35315","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":2240,"wires":[]},{"id":"78420d90.6c3fa4","type":"delay","z":"fdac93f7.bec1b","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"milliseconds","drop":false,"x":540,"y":2200,"wires":[["3d5ee6b0.eb18fa"]]},{"id":"34507664.9bfcda","type":"function","z":"fdac93f7.bec1b","name":"Loop","func":"var count = parseFloat(msg.topic);\nvar data = flow.get(\"DataLoop\");\nmsg.payload = data[count];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":2120,"wires":[["f2837882.a70da8","b31c3361.fe65b"]]},{"id":"e78dcf57.5797a","type":"function","z":"fdac93f7.bec1b","name":"Initiate Loop","func":"var data = msg.payload;\nmsg.topic = \"0\";\nflow.set(\"LimitLoop\",data.length);\nflow.set(\"DataLoop\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":140,"y":2120,"wires":[["34507664.9bfcda"]]},{"id":"b31c3361.fe65b","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar time = data.time*1000000;\nvar json = {Time: time, Sat:data.Sat, time: time};\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2120,"wires":[["aeed3725.adf578","75fa8369.080f2c"]]},{"id":"18959a35.677f06","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":2060,"wires":[]},{"id":"7f3502b1.a0a89c","type":"comment","z":"fdac93f7.bec1b","name":"Inject ke grafana Nov","info":"","x":260,"y":2020,"wires":[]},{"id":"3907edc1.83bf92","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":740,"y":2000,"wires":[]},{"id":"113540b6.5fd7ff","type":"http in","z":"fdac93f7.bec1b","name":"","url":"/feedback","method":"get","upload":false,"swaggerDoc":"","x":180,"y":2340,"wires":[["2f47d2b5.a6112e","77cbba8f.470a44"]]},{"id":"2f47d2b5.a6112e","type":"http response","z":"fdac93f7.bec1b","name":"","statusCode":"","headers":{},"x":550,"y":2340,"wires":[]},{"id":"77cbba8f.470a44","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":2300,"wires":[]},{"id":"31109d72.e2d522","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":60,"wires":[]},{"id":"f0c02b4.f25b5d8","type":"mqtt in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","topic":"fuelkelanis","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":80,"y":40,"wires":[["4e1c1cc.dc382e4"]]},{"id":"fb7a9dbd.53871","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Parse","func":"msg.Data = msg.payload;\n// msg.payload = JSON.parse(msg.payload);\nmsg.objj = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":100,"wires":[["31109d72.e2d522","121080b0.0116df","569cf2a8.36268c","cec0c607.212c98","da716c93.8b8fd"]]},{"id":"e9d5beb6.d929d","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":2420,"wires":[["680411f8.f514f"]]},{"id":"680411f8.f514f","type":"function","z":"fdac93f7.bec1b","name":"SelectfuelLevelData","func":"msg.query = \"select * from fuelLevel;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2420,"wires":[["22255782.7939e8"]]},{"id":"22255782.7939e8","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":590,"y":2420,"wires":[["aaea581d.828ba8"]]},{"id":"e74d19d.20f6ce8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":950,"y":2420,"wires":[]},{"id":"aaea581d.828ba8","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar values = data.results[0].series[0].values;\nvar arr = [];\nfor(i=0;i<values.length;i++){\n    var gps = values[i][11];\n    var timee = values[i][0]*1000000;\n    if(gps == \"-1\"){\n        arr.push({time:timee,value:0});\n    }else{\n        arr.push({time:timee,value:1});\n    }\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":2420,"wires":[["e74d19d.20f6ce8","e2abdffd.00029"]]},{"id":"447b44b1.4bae8c","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"GPSSta","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":820,"y":2560,"wires":[]},{"id":"9ebdd70c.bcf238","type":"function","z":"fdac93f7.bec1b","name":"Loop","func":"var count = parseFloat(msg.topic);\nvar data = flow.get(\"DataLoop\");\nmsg.payload = data[count];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2560,"wires":[["447b44b1.4bae8c","d2e8d76e.49f8b8","691cf52b.5f4c1c"]]},{"id":"e8bc9748.618b78","type":"function","z":"fdac93f7.bec1b","name":"Increment","func":"var count = parseFloat(msg.topic);\nvar limit  = flow.get(\"LimitLoop\");\ncount++;\nif(count<limit){\n    var a = 1;\n    // msg.payload = null;\n}else{\n    msg.payload = null;\n}\nmsg.topic = String(count);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":2640,"wires":[["6dd84a38.448a44","b41db663.3e35a8"]]},{"id":"6dd84a38.448a44","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":2640,"wires":[["845d21ee.0bdcf"]]},{"id":"b41db663.3e35a8","type":"switch","z":"fdac93f7.bec1b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":2680,"wires":[["af5b5d8d.61b31"]]},{"id":"af5b5d8d.61b31","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":2680,"wires":[]},{"id":"845d21ee.0bdcf","type":"link out","z":"fdac93f7.bec1b","name":"","links":["ee756c7d.38926"],"x":755,"y":2640,"wires":[]},{"id":"9887a767.6b1598","type":"link in","z":"fdac93f7.bec1b","name":"","links":["691cf52b.5f4c1c"],"x":275,"y":2640,"wires":[["e8bc9748.618b78"]]},{"id":"e2abdffd.00029","type":"function","z":"fdac93f7.bec1b","name":"Initiate Loop","func":"var data = msg.payload;\nmsg.topic = \"0\";\nflow.set(\"LimitLoop\",data.length);\nflow.set(\"DataLoop\",data);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":2560,"wires":[["9ebdd70c.bcf238"]]},{"id":"ee756c7d.38926","type":"link in","z":"fdac93f7.bec1b","name":"","links":["845d21ee.0bdcf"],"x":375,"y":2600,"wires":[["9ebdd70c.bcf238"]]},{"id":"691cf52b.5f4c1c","type":"link out","z":"fdac93f7.bec1b","name":"","links":["9887a767.6b1598"],"x":555,"y":2600,"wires":[]},{"id":"d2e8d76e.49f8b8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":770,"y":2520,"wires":[]},{"id":"f357bda7.c915b","type":"inject","z":"fdac93f7.bec1b","name":"CheckGateway","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"Check","payloadType":"str","x":160,"y":1120,"wires":[["93526ac9.2d7378"]]},{"id":"93526ac9.2d7378","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"CheckGateway","qos":"","retain":"","broker":"4803b37b.b88cfc","x":360,"y":1120,"wires":[]},{"id":"fccddc67.f935b","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":1160,"wires":[]},{"id":"72bcf38b.1ab31c","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"CheckGateway","qos":"2","datatype":"utf8","broker":"4803b37b.b88cfc","x":360,"y":1160,"wires":[["fccddc67.f935b"]]},{"id":"cc006f45.0923e","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":2840,"wires":[["c3d7ea8e.aa7e18","6a9e01de.15c6f"]]},{"id":"44e194e3.50e93c","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":330,"y":3000,"wires":[["d8e3ab8e.4dffe8"]]},{"id":"a08e4e71.ef80a","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"Test","precision":"n","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":640,"y":2940,"wires":[]},{"id":"c3d7ea8e.aa7e18","type":"delay","z":"fdac93f7.bec1b","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":2920,"wires":[["b3bf8d63.33e42"]]},{"id":"b3bf8d63.33e42","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.query = \"SELECT * FROM Test;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":3000,"wires":[["44e194e3.50e93c"]]},{"id":"d8e3ab8e.4dffe8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":560,"y":3020,"wires":[]},{"id":"9f7aa00f.d31ab","type":"function","z":"e9b71a55.b25c68","name":"InitiateLoop","func":"var data = msg.payload;\nvar limit = data.length;\nflow.set(\"data\",data);\nflow.set(\"limit\",limit);\nmsg.topic = \"0\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":40,"wires":[["f2a7b456.1521f8"]]},{"id":"f2a7b456.1521f8","type":"function","z":"e9b71a55.b25c68","name":"Loop","func":"var data = flow.get(\"data\");\nvar count = parseInt(msg.topic);\nmsg.payload = data[count];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":40,"wires":[["31bc9e4a.f0c962"]]},{"id":"26ad85dd.1a426a","type":"link in","z":"e9b71a55.b25c68","name":"","links":["6e495066.b7de"],"x":215,"y":80,"wires":[["f2a7b456.1521f8"]]},{"id":"31bc9e4a.f0c962","type":"link out","z":"e9b71a55.b25c68","name":"","links":["4642e834.27d108"],"x":395,"y":80,"wires":[]},{"id":"6e495066.b7de","type":"link out","z":"e9b71a55.b25c68","name":"","links":["26ad85dd.1a426a"],"x":655,"y":180,"wires":[]},{"id":"4642e834.27d108","type":"link in","z":"e9b71a55.b25c68","name":"","links":["31bc9e4a.f0c962"],"x":95,"y":180,"wires":[["db2b7400.81c1e8"]]},{"id":"db2b7400.81c1e8","type":"function","z":"e9b71a55.b25c68","name":"Increment","func":"var limit = flow.get(\"limit\");\nvar count = parseInt(msg.topic);//0\ncount++;//1\nif(count>=limit){\n    msg.payload = null;\n}\nmsg.topic = String(count);//1\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":180,"wires":[["6b0c2d4d.1d2934"]]},{"id":"6b0c2d4d.1d2934","type":"switch","z":"e9b71a55.b25c68","name":"Continue?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":180,"wires":[["f20c27b7.bee1c8"],["71533a81.973c84"]]},{"id":"f20c27b7.bee1c8","type":"delay","z":"e9b71a55.b25c68","name":"","pauseType":"delayv","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":540,"y":180,"wires":[["6e495066.b7de"]]},{"id":"e402df37.4c17f","type":"subflow:e9b71a55.b25c68","z":"fdac93f7.bec1b","name":"","env":[],"x":630,"y":3120,"wires":[["a7b31c6f.ca40c"],[]]},{"id":"5bc40019.6829d","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"query","v":"SELECT * FROM Test;","vt":"str"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":130,"y":3120,"wires":[["d6747ed5.24aa1"]]},{"id":"d6747ed5.24aa1","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":290,"y":3120,"wires":[["aa82c1c9.7351"]]},{"id":"aa82c1c9.7351","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar values = data.results[0].series[0].values;\nmsg.payload = values;\nmsg.delay = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":3120,"wires":[["fdb4c2b4.1a4e5","e402df37.4c17f"]]},{"id":"fdb4c2b4.1a4e5","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":3180,"wires":[]},{"id":"a7b31c6f.ca40c","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":780,"y":3080,"wires":[]},{"id":"6a6fd31d.0ac9ac","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"Fixing","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":3240,"wires":[[]]},{"id":"1bb60f17.77a381","type":"function","z":"fdac93f7.bec1b","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":3240,"wires":[["9ce72098.9fa41"]]},{"id":"9ce72098.9fa41","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"Test","precision":"n","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":510,"y":3240,"wires":[]},{"id":"6a9e01de.15c6f","type":"function","z":"fdac93f7.bec1b","name":"Select","func":"msg.query = \"select * from fuelLevel where time > 1641042061000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2840,"wires":[["d413df9a.13a7f"]]},{"id":"d413df9a.13a7f","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":430,"y":2840,"wires":[["ddf8a6ae.05b608","fdfec945.738578"]]},{"id":"fdfec945.738578","type":"function","z":"fdac93f7.bec1b","name":"Insert","func":"var data = msg.payload;\nvar values = data.results[0].series[0].values;\nvar arr = [];\n\nfor(i=0;i<values.length;i++){\n    var json = {\n                Time:parseInt(values[i][0]),\n                Lat:values[i][11],\n                Lon:values[i][12],\n                WS:values[i][14],\n                Sat:values[i][13],\n                Fuel:{\n                    F1:values[i][1],\n                    F2:values[i][2],\n                    F3:values[i][3],\n                    F4:values[i][4],\n                    F5:values[i][5],\n                    F6:values[i][6]\n                    },\n                RPM:{\n                    R1:values[i][7],\n                    R2:values[i][8]\n                    },\n                Propeller:{\n                    R5:values[i][9],\n                    R8:values[i][10]\n                    }\n                }\n    arr.push(JSON.stringify(json))\n}\nmsg.payload = arr;\nmsg.delay = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":2840,"wires":[["fc537f15.f499"]]},{"id":"fc537f15.f499","type":"subflow:e9b71a55.b25c68","z":"fdac93f7.bec1b","name":"","env":[],"x":710,"y":2840,"wires":[["215a6c80.fd78f4"],[]]},{"id":"215a6c80.fd78f4","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":760,"y":2900,"wires":[]},{"id":"ddf8a6ae.05b608","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":2780,"wires":[]},{"id":"b562183.10863e8","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":\"1641879101211\",\"data\":2}","payloadType":"json","x":430,"y":2900,"wires":[["a08e4e71.ef80a"]]},{"id":"53dfb3ff.dfd0dc","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":620,"y":1420,"wires":[]},{"id":"3c9b098.72b58f6","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":130,"y":1620,"wires":[["2757d34e.73b7ec"]]},{"id":"2757d34e.73b7ec","type":"function","z":"fdac93f7.bec1b","d":true,"name":"ToLiter","func":"var data = msg.payload;\nvar raw = flow.get(\"dataFuelLev\");\nfor(i=0;i<raw.length;i++){\n    for(j=0;j<data[0].length;j++){\n        if(parseInt(String(raw[i].F1)) == parseInt(String(data[j].Value))){\n            raw[i].F1 = String(data[j].Liter);\n        }\n    }\n    for(j=0;j<data[1].length;j++){\n        if(parseInt(String(raw[i].F2)) == parseInt(String(data[j].Value))){\n            raw[i].F2 = String(data[j].Liter);\n        }\n    }\n    for(j=0;j<data[2].length;j++){\n        if(parseInt(String(raw[i].F3)) == parseInt(String(data[j].Value))){\n            raw[i].F3 = String(data[j].Liter);\n        }\n    }\n    for(j=0;j<data[3].length;j++){\n        if(parseInt(String(raw[i].F4)) == parseInt(String(data[j].Value))){\n            raw[i].F4 = String(data[j].Liter);\n        }\n    }\n    for(j=0;j<data[4].length;j++){\n        if(parseInt(String(raw[i].F5)) == parseInt(String(data[j].Value))){\n            raw[i].F5 = String(data[j].Liter);\n        }\n    }\n    for(j=0;j<data[5].length;j++){\n        if(parseInt(String(raw[i].F6)) == parseInt(String(data[j].Value))){\n            raw[i].F6 = String(data[j].Liter);\n        }\n    }\n}\nmsg.payload = raw;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1620,"wires":[["53dfb3ff.dfd0dc"]]},{"id":"568c5f9f.706df","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from DATA2022;","payload":"","payloadType":"date","x":130,"y":3340,"wires":[["a8e8dd9.493332"]]},{"id":"e25bac6f.d4411","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"ToApex","qos":"","retain":"","broker":"4803b37b.b88cfc","x":580,"y":3340,"wires":[]},{"id":"a8e8dd9.493332","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":330,"y":3340,"wires":[["e25bac6f.d4411"]]},{"id":"6c0bcc1e.bce944","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nvar values = data.results[0].series[0].values;\nvar arr = []\nfor(i=0;i<values.length;i++){\n    var json = {\n        time:values[i][0],\n        F1:values[i][1],\n        F2:values[i][2],\n        F3:values[i][3],\n        F4:values[i][4],\n        F5:values[i][5],\n        F6:values[i][6],\n        RP1:values[i][7],\n        RP2:values[i][8],\n        RP5:values[i][9],\n        RP8:values[i][10],\n        lat:values[i][11],\n        lon:values[i][12],\n        sat:values[i][13],\n        ws:values[i][14]\n    }\n    arr.push(json)\n}\nflow.set(\"rawdata\",arr);\nmsg.payload = arr;\nmsg.topic = \"SELECT * FROM FS001Jan;\";\nmsg.topic += \"SELECT * FROM FS002Jan;\";\nmsg.topic += \"SELECT * FROM FS003Jan;\";\nmsg.topic += \"SELECT * FROM FS4Nov;\";\nmsg.topic += \"SELECT * FROM FS5Nov;\";\nmsg.topic += \"SELECT * FROM FS006Jan;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":3500,"wires":[["9bde6583.814ee8","8fca654c.b69ac8","cf2b9ab4.d000a8"]]},{"id":"9bde6583.814ee8","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":430,"y":3500,"wires":[["b237268c.13b288","2ac3620e.959cee"]]},{"id":"b237268c.13b288","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":620,"y":3440,"wires":[]},{"id":"8fca654c.b69ac8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":3440,"wires":[]},{"id":"db457b90.2846b8","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":" ","query":"select * from fuelLevel where time > 1640590503042;","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":150,"y":3500,"wires":[["6c0bcc1e.bce944"]]},{"id":"2c28c4c2.fc41ac","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":3460,"wires":[["db457b90.2846b8"]]},{"id":"2f8bdfa9.e316a","type":"function","z":"fdac93f7.bec1b","name":"ToLiter","func":"var data = msg.payload;\nvar raw = flow.get(\"rawdata\");\nfor(i=0;i<raw.length;i++){\n    var prevF1 = flow.get(\"prevF1\")\n    if(prevF1==0 || prevF1 == \"0\" || !prevF1){\n        flow.set(\"prevF1\",parseInt(raw[i].F1));\n        prevF1 = parseInt(raw[i].F1);\n    }\n    if(parseInt(raw[i]).F1>prevF1+200 || parseInt(raw[i]).F1<prevF1-200){\n        raw[i].F1 = raw[i-1].F1;\n    }\n    \n    var prevF2 = flow.get(\"prevF2\")\n    if(prevF2==0 || prevF2 == \"0\" || !prevF2){\n        flow.set(\"prevF2\",parseInt(raw[i].F2));\n        prevF1 = parseInt(raw[i].F2);\n    }\n    if(parseInt(raw[i]).F2>prevF2+200 || parseInt(raw[i]).F2<prevF2-200){\n        raw[i].F2 = raw[i-1].F2;\n    }\n    \n    var prevF3 = flow.get(\"prevF3\")\n    if(prevF3==0 || prevF3 == \"0\" || !prevF3){\n        flow.set(\"prevF3\",parseInt(raw[i].F3));\n        prevF3 = parseInt(raw[i].F3);\n    }\n    if(parseInt(raw[i]).F3>prevF3+200 || parseInt(raw[i]).F3<prevF3-200){\n        raw[i].F3 = raw[i-1].F3;\n    }\n    \n    var prevF4 = flow.get(\"prevF4\")\n    if(prevF4==0 || prevF4 == \"0\" || !prevF4){\n        flow.set(\"prevF4\",parseInt(raw[i].F4));\n        prevF4 = parseInt(raw[i].F4);\n    }\n    if(parseInt(raw[i]).F4>prevF4+200 || parseInt(raw[i]).F4<prevF4-200){\n        raw[i].F4 = raw[i-1].F4;\n    }\n    \n    var prevF5 = flow.get(\"prevF5\")\n    if(prevF5==0 || prevF5 == \"0\" || !prevF5){\n        flow.set(\"prevF5\",parseInt(raw[i].F5));\n        prevF5 = parseInt(raw[i].F5);\n    }\n    if(parseInt(raw[i]).F5>prevF5+200 || parseInt(raw[i]).F5<prevF5-200){\n        raw[i].F5 = raw[i-1].F5;\n    }\n    \n    var prevF6 = flow.get(\"prevF6\")\n    if(prevF6==0 || prevF6 == \"0\" || !prevF6){\n        flow.set(\"prevF6\",parseInt(raw[i].F6));\n        prevF6 = parseInt(raw[i].F6);\n    }\n    if(parseInt(raw[i]).F6>prevF6+200 || parseInt(raw[i]).F6<prevF6-200){\n        raw[i].F6 = raw[i-1].F6;\n    }\n    \n    if(parseInt(String(raw[i].RP1)) == -1){\n        raw[i].RP1 = raw[i-1].RP1;\n    }\n    if(parseInt(String(raw[i].RP2)) == -1){\n        raw[i].RP2 = raw[i-1].RP2;\n    }\n    if(parseInt(String(raw[i].RP5)) == -1){\n        raw[i].RP5 = raw[i-1].RP5;\n    }\n    if(parseInt(String(raw[i].RP8)) == -1){\n        raw[i].RP8 = raw[i-1].RP8;\n    }\n    if(parseInt(String(raw[i].lat)) == -1){\n        raw[i].lat = raw[i-1].lat;\n    }\n    if(parseInt(String(raw[i].lon)) == -1){\n        raw[i].lon = raw[i-1].lon;\n    }\n    if(parseInt(String(raw[i].sat)) == -1){\n        raw[i].sat = raw[i-1].sat;\n    }\n    if(parseInt(String(raw[i].ws)) == -1){\n        raw[i].ws = raw[i-1].ws;\n    }\n    for(j=0;j<data[0].length;j++){\n        if(parseInt(String(raw[i].F1)) == parseInt(String(data[0][j].Value))){\n            raw[i].F1 = data[0][j].Liter;\n        }\n    }\n    for(j=0;j<data[1].length;j++){\n        if(parseInt(String(raw[i].F2)) == parseInt(String(data[1][j].Value))){\n            raw[i].F2 = data[1][j].Liter;\n        }\n    }\n    for(j=0;j<data[2].length;j++){\n        if(parseInt(String(raw[i].F3)) == parseInt(String(data[2][j].Value))){\n            raw[i].F3 = data[2][j].Liter;\n        }\n    }\n    for(j=0;j<data[3].length;j++){\n        if(parseInt(String(raw[i].F4)) == parseInt(String(data[3][j].Value))){\n            raw[i].F4 = data[3][j].Liter;\n        }\n    }\n    for(j=0;j<data[4].length;j++){\n        if(parseInt(String(raw[i].F5)) == parseInt(String(data[4][j].Value))){\n            raw[i].F5 = data[4][j].Liter;\n        }\n    }\n    for(j=0;j<data[5].length;j++){\n        if(parseInt(String(raw[i].F6)) == parseInt(String(data[5][j].Value))){\n            raw[i].F6 = data[5][j].Liter;\n        }\n    }\n}\nmsg.payload = raw;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":3580,"wires":[[]]},{"id":"2ac3620e.959cee","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"ToLaptop","qos":"","retain":"","broker":"4803b37b.b88cfc","x":480,"y":3560,"wires":[]},{"id":"fc4a96f9.c699a8","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"ToLaptop2","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":80,"y":3600,"wires":[["a5203301.67693","e9b269be.927c68"]]},{"id":"e7444eb6.3d92d","type":"subflow:e9b71a55.b25c68","z":"fdac93f7.bec1b","name":"","env":[],"x":330,"y":3740,"wires":[["58309a47.2daae4"],["6309cad.d598334"]]},{"id":"a5203301.67693","type":"json","z":"fdac93f7.bec1b","name":"","property":"payload","action":"","pretty":false,"x":170,"y":3660,"wires":[["6309cad.d598334","74e73d77.9316f4"]]},{"id":"58309a47.2daae4","type":"influxdb out","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":"","measurement":"TryFilter","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":620,"y":3700,"wires":[]},{"id":"9f280701.cd6418","type":"delay","z":"fdac93f7.bec1b","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":160,"y":3760,"wires":[["e7444eb6.3d92d"]]},{"id":"6309cad.d598334","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":420,"y":3660,"wires":[]},{"id":"74e73d77.9316f4","type":"function","z":"fdac93f7.bec1b","name":"","func":"var data = msg.payload;\nfor(i=0;i<data.length;i++){\n    data[i].time = parseInt(String(data[i].time))*1000000\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":3720,"wires":[["9f280701.cd6418","6309cad.d598334"]]},{"id":"e9b269be.927c68","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":330,"y":3600,"wires":[]},{"id":"cf2b9ab4.d000a8","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"ToLaptoprawdata","qos":"","retain":"","broker":"4803b37b.b88cfc","x":350,"y":3420,"wires":[]},{"id":"c119a7db.47bf98","type":"debug","z":"51c3eae1.47d714","g":"156f4df9.675f62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":680,"y":2540,"wires":[]},{"id":"1e2eb23b.70671e","type":"function","z":"51c3eae1.47d714","g":"156f4df9.675f62","name":"","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/fahmi/fuelSensor\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"id\" : 36,\n    \"vid\": \"A1\",\n    \"time1\": 1636506343501290000,\n    \"f1\": 9757,\n    \"f2\": 9757,\n    \"f3\": 9757,\n    \"f4\": 9757,\n    \"f5\": 9757,\n    \"f6\": 9757,\n    \"time2\": 1636506343500,\n    \"lat\": -3.759011,\n    \"lon\": 114.465814,\n    \"prop1\": 0,\n    \"prop2\": 0,\n    \"rpm1\": 0,\n    \"rpm2\": 0,\n    \"ws\": 120,\n    \"sat\": 5\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2540,"wires":[["e63c5cf4.142c5"]]},{"id":"e63c5cf4.142c5","type":"http request","z":"51c3eae1.47d714","g":"156f4df9.675f62","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":500,"y":2560,"wires":[["c119a7db.47bf98"]]},{"id":"50ff4507.a7dcac","type":"http response","z":"51c3eae1.47d714","g":"156f4df9.675f62","name":"","statusCode":"","headers":{},"x":670,"y":2460,"wires":[]},{"id":"edac956b.ea48a8","type":"inject","z":"51c3eae1.47d714","g":"156f4df9.675f62","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":2520,"wires":[["1e2eb23b.70671e"]]},{"id":"58380dc7.a4f314","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":" ","func":"var data = msg.payload;\n// try{\n    var split = data.split('\"');\n    // var arr = [];\n    // for(i=0;i<split.length;i++){\n    //     arr.push(split[i]);\n    // }\n    // var year1 = split[3].split(\" \")[1];\n    // var year2 = split[6].split(\" \")[1];\n    // var month1 = split[2].split(\" \")[2];\n    // var month2 = split[5].split(\" \")[2];\n    // var day1 = split[2].split(\" \")[1];\n    // var day2 = split[5].split(\" \")[1];\n    // var hour1 = split[3].split(\" \")[2].substring(0,5);\n    // var hour2 = split[6].split(\" \")[2].substring(0,5);\n    var epo1 = epoch(split[1]);\n    var epo2 = epoch(split[3]);\n    var json = {\n        \"SHIP\":split[0].substring(0,split[0].length-1),\n        \"from\":epo1,\n        \"to\":epo2,\n        \"num\":split[4].split(',')[1],\n        \"stat\":split[4].split(',')[2],\n        \"id\":split[4].split(',')[3].substring(0,1)\n    }\n    if(json.stat == \"1\"){\n        msg.payload = null;\n        return msg;\n    }else{\n        if(flow.get(\"UPDATEHIS\")==0){\n            flow.set(\"UPDATEHIS\",1);\n        }else{\n            msg.payload = null;\n            return msg;\n        }\n    }\n    msg.MyJSON = json;\n    msg.payload = json;\n    msg.topic = \"SELECT `ID` FROM `SHIPLIST` WHERE `SHIPNAME` = '\"+String(json.SHIP)+\"';\";\n    return msg;\n// }catch(x){\n//     msg.payload = null;\n//     return msg;\n// }\nfunction epoch (date) {\n  return Date.parse(date)\n}\nfunction returnepo(hour,day,month,year){\n    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];\n    var hours = (parseInt(hour.split(\":\")[0])*3600) + (parseInt(hour.split(\":\")[1]*60));\n    var epotime = 0;\n    epotime += hours;\n    if(parseInt(day)>0){\n        epotime+= parseInt(day)*86400;\n    }\n    if(parseInt(year)>1970){\n        var intyear = parseInt(year)-1970;\n        epotime+= intyear*31556926;\n    }\n    for(i=0;i<months.length;i++){\n        if(month == months[i]){\n            var monindex = months.indexOf(month);\n            epotime += monindex*2629743;\n            break;\n        }\n    }\n    return epotime-31495;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":1100,"wires":[["18dda32e.59022d","955a2c31.1ef36"]]},{"id":"c3c9ba83.550f98","type":"mysql","z":"51c3eae1.47d714","g":"c2b70546.5e9668","mydb":"be353e7e.73b9d","name":"","x":650,"y":1100,"wires":[["13fa6858.f3bd78"]]},{"id":"dea9be95.a7368","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":1100,"wires":[]},{"id":"13fa6858.f3bd78","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":" ","func":"msg.MyJSON['vid'] = msg.payload[0].ID;\nmsg.payload = msg.MyJSON;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1100,"wires":[["dea9be95.a7368","57c4423e.7080ec"]]},{"id":"18dda32e.59022d","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":450,"y":1160,"wires":[]},{"id":"955a2c31.1ef36","type":"switch","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":1100,"wires":[["a9e76c30.6d3d8"]]},{"id":"261043d8.59f4ac","type":"subflow:e9b71a55.b25c68","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","x":1130,"y":1120,"wires":[["cb307363.41651"],["4605ef30.38be3"]]},{"id":"cb307363.41651","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/inserthistory/\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":1120,"wires":[["774c24f7.9954ac","830f2597.363238"]]},{"id":"774c24f7.9954ac","type":"http request","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1430,"y":1120,"wires":[[]]},{"id":"9efb717b.623a3","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1320,"y":1160,"wires":[]},{"id":"830f2597.363238","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1430,"y":1080,"wires":[]},{"id":"4ebb0a8c.b9ef04","type":"inject","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1120,"y":660,"wires":[[]]},{"id":"1cc161f2.221c8e","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","func":"msg.payload = msg.mymy;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":1080,"wires":[["261043d8.59f4ac"]]},{"id":"8d604155.2fefb","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1430,"y":960,"wires":[]},{"id":"4d3ba2db.58118c","type":"http request","z":"51c3eae1.47d714","g":"27d3216d.4b2e7e","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/delete/delete/","tls":"","persist":false,"proxy":"","authType":"basic","x":1410,"y":800,"wires":[[]]},{"id":"88fcbce6.b5363","type":"inject","z":"51c3eae1.47d714","g":"27d3216d.4b2e7e","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":840,"wires":[[]]},{"id":"c7f483df.9e36b","type":"delay","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1140,"y":1200,"wires":[["9efb717b.623a3"]]},{"id":"6456719c.917d4","type":"http request","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"Reset","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/delete/delete/","tls":"","persist":false,"proxy":"","authType":"basic","x":830,"y":1160,"wires":[["c3c9ba83.550f98"]]},{"id":"e0ebb693.5831a8","type":"trigger","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":" ","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":250,"y":1160,"wires":[["58380dc7.a4f314"]]},{"id":"d4cff2c7.2b0eb","type":"http request","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/SelectM/historycmd/","tls":"","persist":false,"proxy":"","authType":"","x":174,"y":1860,"wires":[["8d93b87.6c60348"]]},{"id":"1f2c3010.ddc82","type":"inject","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":164,"y":1780,"wires":[["8a6f3a2a.dfecf8"]]},{"id":"8d93b87.6c60348","type":"debug","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":483,"y":1880,"wires":[]},{"id":"e15c73df.2ced2","type":"inject","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"items\":[{\"ship\":\"MBP 3222\",\"fdate\":\"Tuesday, 18 January, 2022 00:00\",\"tdate\":\"Tuesday, 1 February, 2022 00:00\",\"count\":\"50\",\"stat\":\"1\",\"id\":1}],\"first\":{\"$ref\":\"https://apex.oracle.com/pls/apex/iot-elkafi/SelectM/historycmd/\"}}","payloadType":"json","x":204,"y":1900,"wires":[["8d93b87.6c60348"]]},{"id":"645ccfa1.3c1ab","type":"debug","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":360,"y":1060,"wires":[]},{"id":"e98f187a.f12448","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1240,"y":1540,"wires":[]},{"id":"742733bb.8f7dfc","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1210,"y":1440,"wires":[]},{"id":"ce41e76e.08f338","type":"debug","z":"51c3eae1.47d714","g":"124aada0.a21b82","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":1660,"wires":[]},{"id":"154a1751.5bb239","type":"exec","z":"47ec9b6e.206e24","command":"service grafana-server restart","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Restart Grafana","x":2510,"y":420,"wires":[["25ab17d8.1577b8"],[],[]]},{"id":"25ab17d8.1577b8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2800,"y":360,"wires":[]},{"id":"39447918.d7ea76","type":"function","z":"47ec9b6e.206e24","name":"","func":"var data = msg.payload;\nvar substring = data.substring(0,5);\nif(substring == \"Error\"){\n    msg.payload = null;\n}\nmsg.payload = substring;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2390,"y":360,"wires":[[]]},{"id":"ccd877a8.e29eb8","type":"switch","z":"47ec9b6e.206e24","name":"","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":2530,"y":360,"wires":[["154a1751.5bb239"]]},{"id":"be21cda8.ee2a5","type":"mqtt in","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","topic":"influxqueryy","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":150,"y":4440,"wires":[["967e01a4.72765","ce5bc7c5.9f5798"]]},{"id":"932bf1ce.fc63a","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"show measurements","payloadType":"str","x":350,"y":3800,"wires":[["431d44dc.ebbeec","461ca32.44dbf5c"]]},{"id":"431d44dc.ebbeec","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"influxquery","qos":"","retain":"","broker":"4803b37b.b88cfc","x":610,"y":3820,"wires":[]},{"id":"167f8dd7.1b4dc2","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":4540,"wires":[]},{"id":"967e01a4.72765","type":"json","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","property":"payload","action":"","pretty":false,"x":330,"y":4440,"wires":[["167f8dd7.1b4dc2","65ec51f5.fc126"]]},{"id":"2ba3da91.b1cbf6","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"SELECT * FROM Fuel WHERE time > 1650412800000000000 order by time asc;","payloadType":"str","x":310,"y":3840,"wires":[["431d44dc.ebbeec","461ca32.44dbf5c"]]},{"id":"121080b0.0116df","type":"influxdb out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","influxdb":"76f4cea2.88ada","name":"Timeseries","measurement":"fuelkelanis","precision":"n","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":490,"y":140,"wires":[]},{"id":"569cf2a8.36268c","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"GetTable","func":"msg.datatank = msg.payload;\nmsg.topic = \"SELECT * FROM `TableTangkiKelanis`;\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":100,"wires":[["12fbfb74.9f0de5","7bd54c86.fe99a4"]]},{"id":"8a1d1ea1.f6c3b","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Scalling","func":"var payload = msg.datatank;\nvar table = msg.payload;\nvar arr = [];\nvar cm = [];\nvar t1 = 1100,t2 = 1100, t3 = 600, t4 = 600;\ncm.push(convertRange(payload.FuelTangki1));\ncm.push(Tangki2(payload.FuelTangki2));\ncm.push(Tangki3(payload.FuelTangki3));//-400);\ncm.push(Tangki4(payload.FuelTangki4));//-400);\nfor(i=0;i<cm.length;i++){\n    if(cm[i]<1){\n        cm[i] = 0;\n    }\n}\nvar json = {};\nfor(i=1;i<=4;i++){\n    try{\n        if(cm[i-1]>0){\n            json[\"Tangki\"+String(i)] = table[cm[i-1]][\"Tangki\"+String(i)];\n            // json[\"Tangki\"+String(i)] = table[0];\n            // msg.payload = [table[0].Tangki1,\"Tangki\"+String(i),cm[i-1],table[cm[i-1]]];\n            \n        }else{\n            json[\"Tangki\"+String(i)] = table[0][\"Tangki\"+String(i)];\n            \n        }\n    }catch(x){\n      msg.payload= String(i) + \" Error\"; \n      return msg;\n    }\n}\nfor(i=0;i<cm.length;i++){\n    cm[i] = cm[i]/100;\n}\narr.push(json);\narr.push(cm);\nmsg.payload = arr;\nreturn msg;\n\nfunction convertRange(value) { \n    var r1 = [400,2000];\n    var r2 = [0,1000];\n    var res = Math.round(( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction Tangki2(x){\n    var res = (0.6747744901921760*x) - 174.0031896070680000;\n    if(res<1){\n        res = 0\n    }\n    if(res >= 1015){\n        res = 1015;\n    }\n    return Math.round(res);\n}\nfunction Tangki3(x){\n    var res = (0.5918586213225440*x) - 549.4977147105810000;\n    if(res<1){\n        res = 0\n    }\n    return Math.round(res);\n}\nfunction Tangki4(x){\n    var res = (0.5233689233187380*x) - 468.2680151940410000;\n    if(res<1){\n        res = 0\n    }\n    return Math.round(res);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":100,"wires":[["6db99611.02bef8","5c6e63eb.85285c","bfad3d9.dae4dc"]]},{"id":"12fbfb74.9f0de5","type":"mysql","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","mydb":"be353e7e.73b9d","name":"Database","x":620,"y":100,"wires":[["8a1d1ea1.f6c3b","10095b0c.c3ab65"]]},{"id":"6db99611.02bef8","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":60,"wires":[]},{"id":"f12f1a29.601ce8","type":"influxdb out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","influxdb":"76f4cea2.88ada","name":"Database Value","measurement":"fuelkelanisliter","precision":"n","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1120,"y":100,"wires":[]},{"id":"5c6e63eb.85285c","type":"mqtt out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Local","topic":"fuelkelanisliter","qos":"","retain":"","broker":"4803b37b.b88cfc","x":910,"y":140,"wires":[]},{"id":"bfad3d9.dae4dc","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Store","func":"msg.payload = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":100,"wires":[["f12f1a29.601ce8","606cfc6d.8e2144","1ee0d8a8.591977","a592759a.d3d038"]]},{"id":"549a70b0.eeaa5","type":"mqtt out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","topic":"triggerfuelkelanis","qos":"","retain":"","broker":"4803b37b.b88cfc","x":350,"y":400,"wires":[]},{"id":"17496799.255968","type":"inject","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Request","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":400,"wires":[["549a70b0.eeaa5"]]},{"id":"bceda56a.c47858","type":"debug","z":"31a1ac1c.c57c44","name":"submittform","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1470,"y":2300,"wires":[]},{"id":"89f0118d.20836","type":"mysql","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","mydb":"be353e7e.73b9d","name":"","x":1810,"y":2480,"wires":[["bceda56a.c47858","fd32f2c6.63671"]]},{"id":"c1992428.8ba2b8","type":"function","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"Insert","func":"var data = msg.payload;\nvar ID = data.ID;\nvar time = String(timeconvert(data.time));\nvar polpod = data.polpod;\nvar barge = data.barge;\nvar status = data.statuss;\nmsg.topic = \"INSERT INTO `submittform`(`time`,`ID`, `polpod`, `barge`, `Statuss`) VALUES (\"+time+\",\"+ID+\",'\"+polpod+\"','\"+barge+\"','\"+status+\"');\";\nreturn msg;\n\nfunction timeconvert(timee){\n    var t1 = Date.parse(timee)+3600000;\n    return t1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":2520,"wires":[["89f0118d.20836"]]},{"id":"2bd48929.07ead6","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"1\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T00:01\",\"barge\":\"Bungur\",\"statuss\":\"\"}","payloadType":"json","x":1170,"y":2380,"wires":[["65a775dc.49cdbc"]]},{"id":"1fef08d2.29cf97","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"2*","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"2\",\"polpod\":\"\",\"time\":\"2022-03-30T17:30\",\"barge\":\"\",\"statuss\":\"UNPAIR\"}","payloadType":"json","x":1170,"y":2440,"wires":[["1390e59c.fec25a"]]},{"id":"2d42621e.33f07e","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"3*","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"3\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T18:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE BARGE\"}","payloadType":"json","x":1170,"y":2500,"wires":[["9a4d3da9.578b7"]]},{"id":"f3201188.1fcc5","type":"function","z":"31a1ac1c.c57c44","d":true,"g":"cf3284e7.37ba88","name":"Proses","func":"var data = msg.payload[0];\nvar pathName = msg.payload[1];\nvar vms = msg.payload[2];\nvar PathID = msg.payload[3];\nvar TaskID = msg.payload[4];\nvar prevcycle = flow.get(\"cycleA1\");\nvar pI = [];\nfor(i=0;i<PathID.length;i++){\n    pI.push(PathID[i].PathName);\n}\nvar pN = {};\nvar num = 1;\npN[String(num)] = [];\nfor(i=0;i<pathName.length;i++){\n    if(num == pathName[i].PathID){\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }else{\n        num = num + 1;\n        pN[String(num)] = [];\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }\n}\nvar prevlen = flow.get(\"LengthForm\");\nvar last = data.length-1;\nmsg.topic = \"\";\nvar previmovelen = flow.get(\"imovelength\");\nvar imovelen = data.length;\nif(previmovelen != imovelen){\n    for(i=0;i<data.length;i++){\n        msg.topic += \"UPDATE `VMS` SET `IDIMOVE` = '\"+data[i].ID+\"',`POLPOD` = '\"+data[i].polpod+\"',`BARGE` = '\"+data[i].barge+\"',`Statuss` = '\"+data[i].Statuss+\"' WHERE Cycle = \"+String(prevcycle)+\";\";\n        // msg.topic = \"UPDATE `VMS` SET `IDIMOVE` = '\"+data[i].ID+\"',`POLPOD` = '\"+data[i].polpod+\"',`BARGE` = '\"+data[i].barge+\"',`Statuss` = '\"+data[i].Statuss+\"' WHERE time > \"+String(data[i].time)+\";\";\n        // msg.topic = \"UPDATE `VMS` SET `IDIMOVE` = '\"+data[i].ID+\"',`POLPOD` = '\"+data[i].polpod+\"',`BARGE` = '\"+data[i].barge+\"',`Statuss` = '\"+data[i].Statuss+\"' WHERE time > \"+String(data[i].time)+\" OR Cycle = \"+String(prevcycle)+\";\";\n        msg.topic += \"UPDATE `submittform` SET `x` = \"+String(TaskID.Cycle)+\" WHERE `ID` = \"+String(data[data.length-1].ID)+\";\";\n    }\n}\n\nmsg.payload = pN;\nflow.set(\"imovelength\",data.length);\nflow.set(\"LengthForm\",data.length);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":592,"y":2600,"wires":[["60b79821.a39c48"]]},{"id":"10f27db.4c8f582","type":"inject","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":"Check","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM `submittform` order by `ID` desc limit 1;SELECT * FROM `PathName`;SELECT * FROM `VMS`;SELECT * FROM `PathID`;SELECT * FROM `TaskID`;","payload":"","payloadType":"str","x":142,"y":2680,"wires":[["f9b61dc7.6c8fd"]]},{"id":"f9b61dc7.6c8fd","type":"mysql","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","mydb":"be353e7e.73b9d","name":"","x":282,"y":2640,"wires":[["c47284b0.41acf8","9f6f19c9.112118"]]},{"id":"18798a17.c35876","type":"function","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"Insert VMS","func":"var data = msg.num;\nvar prev = msg.payload;\nvar day = 30;\nvar numlokasi = data;\nif(data+11>23){\n    day+=1\n    data=data-24;\n}\nvar json = {\"Lokasi\":\"\",\"GPS\":\"xxx\",\"Time\":\"2022-03-30T00:00\",\"POLPOD\":\"\",\"Barge\":\"\",\"Statuss\":\"\",\"ID\":0};\nvar Lokasi = [];\nvar Lokasix = [\"Kelanis\",\"Kelanis\",\"Marabahan\",\"Marabahan\",\"Trisakti\",\"Taboneo\",\"Trisakti\",\"Marabahan\",\"Marabahan\",\"Marabahan\"];\nvar pathNum = [];\nvar pathNumx = [4,4,5,5,6,9,2,3,3,3];\nvar cycle = [];\nvar cyclex =   [1,1,1,1,1,1,1,1,1,1];\nfor(i=1;i<=3;i++){\n    for(j=0;j<10;j++){\n        Lokasi.push(Lokasix[j]);\n        pathNum.push(pathNumx[j]);\n        cycle.push(i);\n    }\n}\n// var pathid = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];\nvar tcc = \"2022-03-\"+String(day)+\"T\"+String(12+data-1)+\":00\"\nvar time = tc(tcc)[0];\nmsg.queryy = \"INSERT INTO `VMS`(`Date`,`Cycle`,`Lokasi`, `GPS`, `Time`, `IDIMOVE`, `POLPOD`, `BARGE`, `Statuss`) VALUES ('\"+String(tc(tcc)[1])+\"',\"+String(cycle[-1+numlokasi])+\",'\"+Lokasi[-1+numlokasi]+\"','\"+json.GPS+\"',\"+time+\",\"+json.ID+\",'\"+json.POLPOD+\"','\"+json.Barge+\"','\"+json.Statuss+\"');\";\nmsg.topic = msg.queryy;\n\nreturn msg;\n\nfunction tc(timee){\n    if(timee.split('T')[1].split(':')[0].length < 2){\n        timee = timee.split('T')[0]+\"T0\"+timee.split('T')[1].split(':')[0]+\":\"+timee.split('T')[1].split(':')[1]\n    }\n    var t1 = Date.parse(timee)+3600000;\n    return [t1,timee];\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":2820,"wires":[["a818978f.141f58","2dbf37df.28f668"]]},{"id":"2dbf37df.28f668","type":"mysql","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","mydb":"be353e7e.73b9d","name":"","x":1130,"y":2820,"wires":[["bceda56a.c47858"]]},{"id":"857a3e4c.a9109","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"1","props":[{"p":"num","v":"1","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":550,"y":2820,"wires":[["fe6fe555.2341e8"]]},{"id":"a5197857.de7af8","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"2","props":[{"p":"num","v":"2","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":2860,"wires":[["fe6fe555.2341e8"]]},{"id":"32caa4a2.d4c68c","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"3","props":[{"p":"num","v":"3","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":2900,"wires":[["fe6fe555.2341e8"]]},{"id":"1aa9c51b.d9fa4b","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"4","props":[{"p":"num","v":"4","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":2940,"wires":[["fe6fe555.2341e8"]]},{"id":"a10b445.dd72db8","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"5","props":[{"p":"num","v":"5","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":2980,"wires":[["fe6fe555.2341e8"]]},{"id":"31157c44.26f504","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"6","props":[{"p":"num","v":"6","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3020,"wires":[["fe6fe555.2341e8"]]},{"id":"5d81dccd.aa90a4","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"7","props":[{"p":"num","v":"7","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3060,"wires":[["fe6fe555.2341e8"]]},{"id":"67365fe.b62e4a","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"8","props":[{"p":"num","v":"8","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3100,"wires":[["fe6fe555.2341e8"]]},{"id":"c2d8eec3.4bc51","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"9","props":[{"p":"num","v":"9","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3140,"wires":[["fe6fe555.2341e8"]]},{"id":"14bbfda1.0b6df2","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"10","props":[{"p":"num","v":"10","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3180,"wires":[["fe6fe555.2341e8"]]},{"id":"2c1c49f5.d246f6","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"11","props":[{"p":"num","v":"11","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3220,"wires":[["fe6fe555.2341e8"]]},{"id":"8c0c4769.cbd278","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"12","props":[{"p":"num","v":"12","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3260,"wires":[["fe6fe555.2341e8"]]},{"id":"3e75653d.8c01aa","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"13","props":[{"p":"num","v":"13","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3300,"wires":[["fe6fe555.2341e8"]]},{"id":"f2c99a81.6efa28","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"14","props":[{"p":"num","v":"14","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3340,"wires":[["fe6fe555.2341e8"]]},{"id":"2f6907b1.d22008","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"15","props":[{"p":"num","v":"15","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3380,"wires":[["fe6fe555.2341e8"]]},{"id":"b2d406e1.cd7b68","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"16","props":[{"p":"num","v":"16","vt":"num"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":550,"y":3380,"wires":[["fe6fe555.2341e8"]]},{"id":"dac780da.8bf44","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"DELETE","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"DELETE FROM `submittform` WHERE 1;","payload":"","payloadType":"str","x":1660,"y":2440,"wires":[["89f0118d.20836"]]},{"id":"fb8f2c93.f8dd3","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"DELETE","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"DELETE FROM `VMS` WHERE 1;","payload":"","payloadType":"str","x":980,"y":2860,"wires":[["2dbf37df.28f668"]]},{"id":"60b79821.a39c48","type":"mysql","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","mydb":"be353e7e.73b9d","name":"","x":742,"y":2600,"wires":[[]]},{"id":"fe6fe555.2341e8","type":"function","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"Select","func":"msg.topic  = \"SELECT * FROM `VMS` order by Time desc;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":2820,"wires":[["e8be98ae.0d54e8"]]},{"id":"e8be98ae.0d54e8","type":"mysql","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","mydb":"be353e7e.73b9d","name":"","x":810,"y":2820,"wires":[["18798a17.c35876"]]},{"id":"c47284b0.41acf8","type":"function","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":" ","func":"try{\n    if(msg.payload[0].length<1){\n    msg.payload = null;\n}\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":322,"y":2600,"wires":[["ce25a5ca.4281f8"]]},{"id":"ce25a5ca.4281f8","type":"switch","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":442,"y":2600,"wires":[["f3201188.1fcc5","15dcadce.77aea2"]]},{"id":"82c6af33.cfc04","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"4","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"4\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T20:30\",\"barge\":\"Batok\",\"statuss\":\"\"}","payloadType":"json","x":1170,"y":2560,"wires":[["4643019f.f6f7c"]]},{"id":"90f0a782.dddb78","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"","env":[],"x":250,"y":2840,"wires":[["554ef1d3.6dc99"],[]]},{"id":"3ec6b1f2.efd6de","type":"inject","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2900,"wires":[["b60e66ef.8998d8"]]},{"id":"b60e66ef.8998d8","type":"function","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":" ","func":"var data = [];\nfor(i=1;i<=30;i++){ //cycle 1\n    data.push(i);\n}\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":2840,"wires":[["90f0a782.dddb78"]]},{"id":"554ef1d3.6dc99","type":"function","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":" ","func":"msg.num = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2840,"wires":[["fe6fe555.2341e8"]]},{"id":"fea0fcea.05f15","type":"inject","z":"31a1ac1c.c57c44","g":"c0a41fe1.51ff1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":130,"y":2420,"wires":[["e57e8a78.dd31b8"]]},{"id":"9d6fdf25.0b455","type":"inject","z":"31a1ac1c.c57c44","g":"c0a41fe1.51ff1","name":"2","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"num","x":130,"y":2460,"wires":[["e57e8a78.dd31b8"]]},{"id":"e57e8a78.dd31b8","type":"function","z":"31a1ac1c.c57c44","g":"c0a41fe1.51ff1","name":"cycleA1","func":"flow.set(\"cycleA1\",msg.payload);\nmsg.topic = \"UPDATE `TaskID` SET `Cycle`=\"+String(msg.payload)+\" WHERE VID = 'A1'\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":2460,"wires":[["32fa3a6a.423bf6"]]},{"id":"32fa3a6a.423bf6","type":"mysql","z":"31a1ac1c.c57c44","g":"c0a41fe1.51ff1","mydb":"be353e7e.73b9d","name":"","x":410,"y":2460,"wires":[[]]},{"id":"f49178fd.599a18","type":"inject","z":"31a1ac1c.c57c44","g":"c0a41fe1.51ff1","name":"3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":130,"y":2500,"wires":[["e57e8a78.dd31b8"]]},{"id":"64fcf2f1.da003c","type":"inject","z":"31a1ac1c.c57c44","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING]","payloadType":"str","x":210,"y":3480,"wires":[[]]},{"id":"420ba297.58afbc","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":860,"y":3460,"wires":[]},{"id":"3046cb5a.41b6d4","type":"function","z":"31a1ac1c.c57c44","name":"Check Length","func":"var now = msg.payload.length; \nvar prev = flow.get(\"MBP3223\");\nif(now != prev){\n    msg.payload = \"New Data MBP3222 : \"+String(now)+\" || \"+String(prev);\n}else{\n    msg.payload = null;\n}\nflow.set(\"MBP3223\",now);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":3480,"wires":[["2baa1357.fd66cc"]]},{"id":"2baa1357.fd66cc","type":"switch","z":"31a1ac1c.c57c44","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":720,"y":3480,"wires":[["420ba297.58afbc","ad78071d.df3fd8","88180fb8.21a8"]]},{"id":"ad78071d.df3fd8","type":"mqtt out","z":"31a1ac1c.c57c44","name":"Send Notif","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":860,"y":3500,"wires":[]},{"id":"3e69b9c7.0208d6","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING];","payloadType":"str","x":240,"y":3560,"wires":[[]]},{"id":"d9af16a.785a0e8","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":3560,"wires":[]},{"id":"a818978f.141f58","type":"debug","z":"31a1ac1c.c57c44","g":"85b897f2.9dd298","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1200,"y":2900,"wires":[]},{"id":"15dcadce.77aea2","type":"function","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":"Proses","func":"var data = msg.payload[0][0];\nvar pathName = msg.payload[1];\nvar vms = msg.payload[2];\nvar pathID = msg.payload[4][0];\nvar pN = {};\nvar num = 1;\npN[String(num)] = [];\nfor(i=0;i<pathName.length;i++){\n    if(num == pathName[i].PathID){\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }else{\n        num = num + 1;\n        pN[String(num)] = [];\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }\n}\nmsg.pN = pN;\nvar target = [];\nmsg.topic = \"\";\n// if(data.Statuss != \"\"){\n//     // Special Status\n//     msg.topic += \"UPDATE `VMS` SET `IDIMOVE`=\"+String(data.ID)+\",`POLPOD`='\"+String(data.polpod)+\"',`BARGE`='\"+String(data.barge)+\"',`Statuss`='\"+String(data.Statuss)+\"'\";\n//     msg.topic += \" WHERE `Time` >= \"+String(data.time)+\" AND `Cycle` = \"+String(pathID.Cycle)//+\" AND `Statuss` = '';\";\n// }else{\n//     // Normal\n//     msg.topic += \"UPDATE `VMS` SET `IDIMOVE`=\"+String(data.ID)+\",`POLPOD`='\"+String(data.polpod)+\"',`BARGE`='\"+String(data.barge)+\"',`Statuss`='\"+String(data.Statuss)+\"'\";\n//     msg.topic += \" WHERE `Cycle` = \"+String(pathID.Cycle)+\" AND `Time` >= \"+String(data.time)+\";\";\n// }\nmsg.topic += \"UPDATE `VMS` SET `IDIMOVE`=\"+String(data.ID)+\",`POLPOD`='\"+String(data.polpod)+\"',`BARGE`='\"+String(data.barge)+\"',`Statuss`='\"+String(data.Statuss)+\"'\";\nmsg.topic += \" WHERE `Cycle` = \"+String(pathID.Cycle)+\" AND `Time` >= \"+String(data.time)+\" AND `Cycle` = \"+String(data.z)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":592,"y":2640,"wires":[["3f47b80a.eda868","9f6f19c9.112118"]]},{"id":"ad333df4.70efd","type":"mysql","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","mydb":"be353e7e.73b9d","name":"","x":802,"y":2680,"wires":[[]]},{"id":"65a775dc.49cdbc","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1255,"y":2380,"wires":[]},{"id":"803cb194.c1073","type":"link in","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["65a775dc.49cdbc","1390e59c.fec25a","9a4d3da9.578b7","4643019f.f6f7c","eec00471.aa04c8","3aa39cb2.83e234","ceafde35.c9a9b","6cfe0132.7775"],"x":1575,"y":2520,"wires":[["c1992428.8ba2b8"]]},{"id":"1390e59c.fec25a","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1255,"y":2440,"wires":[]},{"id":"9a4d3da9.578b7","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1255,"y":2500,"wires":[]},{"id":"4643019f.f6f7c","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1255,"y":2560,"wires":[]},{"id":"eec00471.aa04c8","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1435,"y":2380,"wires":[]},{"id":"3aa39cb2.83e234","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1435,"y":2440,"wires":[]},{"id":"ceafde35.c9a9b","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1435,"y":2500,"wires":[]},{"id":"6cfe0132.7775","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["803cb194.c1073"],"x":1615,"y":2380,"wires":[]},{"id":"7ff3e4c4.72505c","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"5","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"5\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T21:30\",\"barge\":\"Batok\",\"statuss\":\"\"}","payloadType":"json","x":1350,"y":2380,"wires":[["eec00471.aa04c8"]]},{"id":"304d3052.e9aa1","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"6*","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"6\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T22:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE ROUTE\"}","payloadType":"json","x":1350,"y":2440,"wires":[["3aa39cb2.83e234"]]},{"id":"a9a6d6a1.f7e3c8","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"7","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T23:30\",\"barge\":\"Batok\",\"statuss\":\"\"}","payloadType":"json","x":1350,"y":2500,"wires":[["ceafde35.c9a9b"]]},{"id":"e9691310.1ffd6","type":"inject","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"7","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-31T01:30\",\"barge\":\"Batok\",\"statuss\":\"\"}","payloadType":"json","x":1530,"y":2380,"wires":[["6cfe0132.7775"]]},{"id":"8c3a1cbe.e74b2","type":"function","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","name":"Select","func":"msg.topic = \"SELECT * FROM `submittform` order by ID asc;\";\nmsg.topic += \"SELECT `Cycle` FROM `TaskID` WHERE `VID` = 'A1';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":2460,"wires":[["3992738a.708fac"]]},{"id":"3992738a.708fac","type":"mysql","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","mydb":"be353e7e.73b9d","name":"","x":630,"y":2500,"wires":[["ad7f0b55.aaca98"]]},{"id":"ad7f0b55.aaca98","type":"function","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","name":"Update Flag","func":"var data =  msg.payload[0];\nvar cycle = msg.payload[1][0].Cycle;\nvar lastID = data[data.length-1].ID;\nmsg.topic = \"UPDATE `submittform` SET `z` = \"+String(cycle)+\" WHERE `ID` = \"+String(lastID)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":2500,"wires":[["3369c47.6fb7f3c"]]},{"id":"3369c47.6fb7f3c","type":"mysql","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","mydb":"be353e7e.73b9d","name":"","x":890,"y":2460,"wires":[["42ca0217.53504c"]]},{"id":"7210e7a7.7a9ea8","type":"inject","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":610,"y":2460,"wires":[["8c3a1cbe.e74b2"]]},{"id":"3f47b80a.eda868","type":"switch","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":742,"y":2640,"wires":[["ad333df4.70efd"]]},{"id":"ba0f4276.69bda","type":"debug","z":"47ec9b6e.206e24","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3020,"y":600,"wires":[]},{"id":"7d260696.2df258","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3220,"y":620,"wires":[]},{"id":"8fe005da.ffda28","type":"link in","z":"47ec9b6e.206e24","name":"","links":["2a561eb8.234af2","9ad82c70.74db8"],"x":2825,"y":720,"wires":[["5a48a200.a3883"]]},{"id":"5a48a200.a3883","type":"function","z":"47ec9b6e.206e24","name":" Create Data","func":"var data = msg.payload[0][0];\nvar data2 = msg.payload[1];\nvar data3 = msg.payload[2];\nif(data3.length ===0){\n    data3 = {\"PathName\":\"\"};\n}else{\n    data3 = msg.payload[2][0]\n}\nmsg.dat.Time = parseInt(String(msg.dat.Time));\nvar json = {\n    \"epoch\": msg.dat.Time,\n    \"date\": tcc(msg.dat.Time),\n    \"shipname\": String(data.Ship_Name),\n    \"GPS\": GPS(),\n    \"pathid\": data.PathID,\n    \"pathName\": String(data3.PathName),\n    \"pathNum\": data.PathNum,\n    \"geofenceID\":geofenceID(data2,data)[0],\n    \"curloc\": String(geofenceID(data2,data)[1]),\n    \"nexloc\": String(geofenceID(data2,data)[2]),\n    \"imoveid\": 0,\n    \"barge\":\"\",\n    \"cycle\":data.Cycle,\n    \"statuss\":\"\"\n}\n// msg.payload = json;\nmsg.payload = json;\nmsg.topic = \"INSERT INTO `VMS_Route`(`Time`, `Date`, `Ship_Name`, `PathID`, `Path_Name`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`)\"\nmsg.topic += \"VALUES (\";\nmsg.topic += json.epoch+\",\"; //epoch\nmsg.topic += \"'\"+json.date+\"'\"; //date\nmsg.topic += \")\";\nreturn msg;\n\nfunction GPS(){\n    var gps = flow.get(\"latlon\");\n    var str = String(gps.Lat)+\",\"+String(gps.Lon);\n    return str\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}\n\nfunction geofenceID(data2,data1){\n    var res = [];\n    try{\n        var pathName = data2;\n        var pN = {};\n        var num = 1;\n        pN[String(num)] = [];\n        for(i=0;i<pathName.length;i++){\n            if(num == pathName[i].PathID){\n                pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n            }else{\n                num = num + 1;\n                pN[String(num)] = [];\n                pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n            }\n        }\n        for(i=0;i<pN[data1.PathID].length;i++){\n            if(data1.PathNum == pN[data1.PathID][i].PathNum){\n                res.push(pN[data1.PathID][i].geofenceID);\n                res.push(pN[data1.PathID][i].Main_Activity);\n                if(data1.PathNum == pN[data1.PathID].length){\n                    res.push(pN[data1.PathID][0].Main_Activity);\n                }else{\n                    res.push(pN[data1.PathID][i+1].Main_Activity);\n                }\n                \n            }\n        }\n    }\n    catch(a){\n        var geonow = flow.get(\"PositionNow\").geoID;\n        res.push(geonow);\n        res.push(\"\");\n        res.push(\"\");\n    }\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2980,"y":720,"wires":[["8437a478.8d5ef8"]]},{"id":"507868ef.31ca38","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2420,"y":600,"wires":[]},{"id":"f0b85b9c.2ad168","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3300,"y":720,"wires":[]},{"id":"9f6f19c9.112118","type":"debug","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":482,"y":2720,"wires":[]},{"id":"c97d2897.6de388","type":"function","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":"Check","func":"msg.topic =  \"SELECT * FROM `submittform` order by `ID` desc limit 1;SELECT * FROM `PathName`;SELECT * FROM `VMS`;SELECT * FROM `PathID`;SELECT * FROM `TaskID`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":122,"y":2640,"wires":[["f9b61dc7.6c8fd"]]},{"id":"fd32f2c6.63671","type":"link out","z":"31a1ac1c.c57c44","g":"7a8c1823.dfa1d8","name":"","links":["4a43974d.de4c68"],"x":1955,"y":2500,"wires":[]},{"id":"4a43974d.de4c68","type":"link in","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","name":"","links":["fd32f2c6.63671"],"x":655,"y":2420,"wires":[["8c3a1cbe.e74b2"]]},{"id":"42ca0217.53504c","type":"link out","z":"31a1ac1c.c57c44","g":"16e14cdc.ac2753","name":"","links":["609aa5c8.c8958c"],"x":975,"y":2460,"wires":[]},{"id":"609aa5c8.c8958c","type":"link in","z":"31a1ac1c.c57c44","g":"cf3284e7.37ba88","name":"","links":["42ca0217.53504c"],"x":77,"y":2600,"wires":[["c97d2897.6de388"]]},{"id":"1ea8e023.ce126","type":"function","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","name":"Select","func":"msg.topic = \"SELECT * FROM `submittform` order by ID asc;\";\nmsg.topic += \"SELECT `Cycle` FROM `TaskID` WHERE `VID` = 'A1';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":3920,"wires":[["2bf2b20.a917c4e"]]},{"id":"2bf2b20.a917c4e","type":"mysql","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","mydb":"be353e7e.73b9d","name":"","x":1210,"y":3960,"wires":[["98371b08.a98558"]]},{"id":"98371b08.a98558","type":"function","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","name":"Update Flag","func":"var data =  msg.payload[0];\nvar cycle = msg.payload[1][0].Cycle;\nvar lastID = data[data.length-1].ID;\nmsg.topic = \"UPDATE `submittform` SET `z` = \"+String(cycle)+\" WHERE `ID` = \"+String(lastID)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":3960,"wires":[["8a077621.940f28"]]},{"id":"8a077621.940f28","type":"mysql","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","mydb":"be353e7e.73b9d","name":"","x":1470,"y":3920,"wires":[["53fb5bf3.66cbe4"]]},{"id":"b11e1b46.abe088","type":"inject","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1190,"y":3920,"wires":[["1ea8e023.ce126"]]},{"id":"1bb87642.26548a","type":"link in","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","name":"","links":["2fc7f34f.aaf8ec","eb0ae5e.cb7a318"],"x":1235,"y":3880,"wires":[[]]},{"id":"53fb5bf3.66cbe4","type":"link out","z":"31a1ac1c.c57c44","g":"93c266f2.b8a218","name":"","links":["5a351969.0fcff8"],"x":1555,"y":3920,"wires":[]},{"id":"796088bc.016df8","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"1","props":[{"p":"jsonn","v":"{\"ID\":\"1\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T00:01\",\"barge\":\"Bungur\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":150,"y":3660,"wires":[["dd13a738.c4b718"]]},{"id":"38188e6d.853692","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"2*","props":[{"p":"jsonn","v":"{\"ID\":\"2\",\"polpod\":\"\",\"time\":\"2022-03-30T17:30\",\"barge\":\"\",\"statuss\":\"UNPAIR\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":150,"y":3700,"wires":[["348557e0.9b1dc8"]]},{"id":"47322e0d.4cdea","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"3*","props":[{"p":"jsonn","v":"{\"ID\":\"3\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T18:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE BARGE\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":150,"y":3740,"wires":[["dff9d26c.feb2c"]]},{"id":"6714cf3.b134d3","type":"inject","z":"31a1ac1c.c57c44","d":true,"g":"7726a67f.543948","name":"4","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"4\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T20:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"}","payloadType":"json","x":150,"y":3780,"wires":[["6d10830d.6bd5dc"]]},{"id":"dd13a738.c4b718","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":235,"y":3660,"wires":[]},{"id":"348557e0.9b1dc8","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":235,"y":3700,"wires":[]},{"id":"dff9d26c.feb2c","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":235,"y":3740,"wires":[]},{"id":"6d10830d.6bd5dc","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":235,"y":3780,"wires":[]},{"id":"c0c43ee4.99a99","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":415,"y":3660,"wires":[]},{"id":"6cd82582.acc53c","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":415,"y":3700,"wires":[]},{"id":"a5dad4d.7962c28","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":415,"y":3740,"wires":[]},{"id":"e8bc431c.8b34e","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":595,"y":3660,"wires":[]},{"id":"4a828951.7baa08","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"5","props":[{"p":"jsonn","v":"{\"ID\":\"5\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T21:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":330,"y":3660,"wires":[["c0c43ee4.99a99"]]},{"id":"d0bfb4e5.319f88","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"6*","props":[{"p":"jsonn","v":"{\"ID\":\"6\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T22:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE ROUTE\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":330,"y":3700,"wires":[["6cd82582.acc53c"]]},{"id":"86f8983a.04d8a8","type":"inject","z":"31a1ac1c.c57c44","d":true,"g":"7726a67f.543948","name":"7","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T23:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"}","payloadType":"json","x":330,"y":3740,"wires":[["a5dad4d.7962c28"]]},{"id":"6d4c2476.a8fb2c","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"7","props":[{"p":"jsonn","v":"{\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-31T01:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":510,"y":3660,"wires":[["e8bc431c.8b34e"]]},{"id":"39f6a5a5.4ae1aa","type":"inject","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"DELETE","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"DELETE FROM `submittform` WHERE 1;","payload":"","payloadType":"str","x":520,"y":3700,"wires":[["9d0d7361.9e954"]]},{"id":"383710d9.e33fa","type":"function","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"Insert","func":"var data = msg.jsonn;\ntry{\n    var prevID = msg.payload[0].ID;\n    data.ID = prevID+1;\n}\ncatch(x){\n    \n}\nvar ID = data.ID;\nvar time = String(timeconvert(data.time));\nvar shipname = data.shipname;\nvar polpod = data.polpod;\nvar barge = data.barge;\nvar status = data.statuss;\n\nmsg.topic = \"INSERT INTO `submittform`(`time`,`Ship_name`,`ID`, `polpod`, `barge`, `Statuss`) VALUES (\"+time+\",'\"+String(shipname)+\"',\"+ID+\",'\"+polpod+\"','\"+barge+\"','\"+status+\"');\";    \n\nreturn msg;\n\nfunction timeconvert(timee){\n    var t1 = Date.parse(timee)+3600000;\n    return t1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":3780,"wires":[["9d0d7361.9e954"]]},{"id":"15a7a429.b67bcc","type":"link in","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["dd13a738.c4b718","348557e0.9b1dc8","dff9d26c.feb2c","6d10830d.6bd5dc","c0c43ee4.99a99","6cd82582.acc53c","a5dad4d.7962c28","e8bc431c.8b34e","b2aa682d.913248"],"x":455,"y":3740,"wires":[["f095228c.f5c91"]]},{"id":"9d0d7361.9e954","type":"mysql","z":"31a1ac1c.c57c44","g":"7726a67f.543948","mydb":"be353e7e.73b9d","name":"","x":670,"y":3740,"wires":[["2fc7f34f.aaf8ec"]]},{"id":"2fc7f34f.aaf8ec","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["1bb87642.26548a"],"x":755,"y":3740,"wires":[]},{"id":"d67beda1.0b541","type":"inject","z":"31a1ac1c.c57c44","g":"1c949b03.b3b8e5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":150,"y":3880,"wires":[["daeafd15.57d56"]]},{"id":"8608589a.488e98","type":"inject","z":"31a1ac1c.c57c44","g":"1c949b03.b3b8e5","name":"2","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"num","x":150,"y":3920,"wires":[["daeafd15.57d56"]]},{"id":"daeafd15.57d56","type":"function","z":"31a1ac1c.c57c44","g":"1c949b03.b3b8e5","name":"cycleA1","func":"flow.set(\"cycleA1\",msg.payload);\nmsg.topic = \"UPDATE `TaskID` SET `Cycle`=\"+String(msg.payload)+\" WHERE VID = 'A1';\";\nvar data = msg.payload;\nif(data === 0){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=0 WHERE `Ship_Name` = 'MBP 3222';\"\n}else if(data == 1){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648652400000 WHERE `Ship_Name` = 'MBP 3222';\";\n}else if(data == 2){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648688400000 WHERE `Ship_Name` = 'MBP 3222';\";\n}else if(data == 3){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648720800000 WHERE `Ship_Name` = 'MBP 3222';\";\n}\nmsg.topic += \"UPDATE `submittform` SET `z`=1 WHERE `Ship_Name` = 'MBP 3222';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":3920,"wires":[["ae8d0de5.307f4"]]},{"id":"ae8d0de5.307f4","type":"mysql","z":"31a1ac1c.c57c44","g":"1c949b03.b3b8e5","mydb":"be353e7e.73b9d","name":"","x":430,"y":3920,"wires":[[]]},{"id":"e6463724.5db558","type":"inject","z":"31a1ac1c.c57c44","g":"1c949b03.b3b8e5","name":"3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":150,"y":3960,"wires":[["daeafd15.57d56"]]},{"id":"934c739b.aca5e","type":"inject","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":"Check","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM `submittform`;SELECT * FROM `PathName`;SELECT * FROM `VMS`;SELECT * FROM `PathID`;SELECT * FROM `TaskID`;","payload":"","payloadType":"str","x":150,"y":4140,"wires":[["9b2d1086.a52f8"]]},{"id":"9b2d1086.a52f8","type":"mysql","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","mydb":"be353e7e.73b9d","name":"","x":310,"y":4100,"wires":[["57be10c0.67315","b9bf3b77.bc0f98"]]},{"id":"57be10c0.67315","type":"function","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":" ","func":"try{\n    if(msg.payload[0].length<1){\n    msg.payload = null;\n}\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":4060,"wires":[["bca9e4e0.b85b18"]]},{"id":"bca9e4e0.b85b18","type":"switch","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":4060,"wires":[["a41af69e.76d3c8","e9d47aa6.aa67b8"]]},{"id":"a41af69e.76d3c8","type":"function","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":"Proses","func":"var data = msg.payload[0];\nvar pathName = msg.payload[1];\nvar vms = msg.payload[2];\nvar pathID = msg.payload[4];\nvar ship = 0;\nvar pN = {};\nvar num = 1;\npN[String(num)] = [];\nfor(i=0;i<pathName.length;i++){\n    if(num == pathName[i].PathID){\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }else{\n        num = num + 1;\n        pN[String(num)] = [];\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }\n}\n\nmsg.pN = pN;\nmsg.payload = pN;\nmsg.topic = \"\";\nfor(i=0;i<data.length;i++){\n    var timecyc = 0;\n    for(j=0;j<pathID.length;j++){\n        if(data[i].Ship_Name == pathID[j].Ship_Name){\n            timecyc = pathID[j].timecycle;\n        }\n    }\n    if(data[i].z == null){\n        msg.topic += \"UPDATE `VMS` SET `IDIMOVE`=\"+String(data[i].ID)+\",`POLPOD`='\"+String(data[i].polpod)+\"',`BARGE`='\"+String(data[i].barge)+\"',`Statuss`='\"+String(data[i].Statuss)+\"'\";\n        msg.topic += \" WHERE `Time` >= \"+String(timecyc)+\" AND `Time` >= \"+String(data[i].time)+\" AND `Ship_Name` = '\"+String(data[i].Ship_Name)+\"';\";\n    }else{\n        msg.topic += \"SELECT * FROM `VMS`;\";\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":4100,"wires":[["2d51cda8.801402","b9bf3b77.bc0f98"]]},{"id":"5a9df685.033318","type":"mysql","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","mydb":"be353e7e.73b9d","name":"","x":850,"y":4140,"wires":[[]]},{"id":"2d51cda8.801402","type":"switch","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":4100,"wires":[["5a9df685.033318"]]},{"id":"b9bf3b77.bc0f98","type":"debug","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":4180,"wires":[]},{"id":"57bf5783.50aed8","type":"function","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":"Check","func":"msg.topic =  \"SELECT * FROM `submittform`;\";\nmsg.topic += \"SELECT * FROM `PathName`;\";\nmsg.topic += \"SELECT * FROM `VMS`;\";\nmsg.topic += \"SELECT * FROM `PathID`;\";\nmsg.topic += \"SELECT * FROM `TaskID`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":4100,"wires":[["9b2d1086.a52f8"]]},{"id":"5a351969.0fcff8","type":"link in","z":"31a1ac1c.c57c44","g":"159284bb.9da1bb","name":"","links":["53fb5bf3.66cbe4"],"x":105,"y":4060,"wires":[["57bf5783.50aed8"]]},{"id":"702c26a5.0a04f8","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SendReport","payload":"SendReport","payloadType":"str","x":2220,"y":700,"wires":[["fce8f87c.a611c8"]]},{"id":"fce8f87c.a611c8","type":"mqtt out","z":"47ec9b6e.206e24","name":"","topic":"SendReport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":2500,"y":660,"wires":[]},{"id":"8437a478.8d5ef8","type":"function","z":"47ec9b6e.206e24","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_Route`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3120,"y":720,"wires":[["1277b4bf.dca7db","928f2cae.118ae"]]},{"id":"928f2cae.118ae","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":3220,"y":780,"wires":[["f0b85b9c.2ad168","241c50a6.6711"]]},{"id":"1277b4bf.dca7db","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3260,"y":660,"wires":[]},{"id":"26bba83b.916c08","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3840,"y":500,"wires":[]},{"id":"a7994609.470858","type":"function","z":"47ec9b6e.206e24","name":"","func":"msg.payload = flow.get(\"PositionNow\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3140,"y":880,"wires":[["37e3ece4.329334"]]},{"id":"e1cfb268.8cb42","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":880,"wires":[["a7994609.470858"]]},{"id":"37e3ece4.329334","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3360,"y":860,"wires":[]},{"id":"8441a26e.3e5a7","type":"function","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"Insert VMS","func":"var data = msg.num;\nvar prev = msg.payload[0][0];\nvar taskc = msg.payload[1][0].Cycle;\nvar day = 30;\nvar numlokasi = data;\nif(data+11>23){\n    day+=1\n    data=data-24;\n}\nvar json = {\"Lokasi\":\"\",\"GPS\":\"xxx\",\"Time\":\"2022-03-30T00:00\",\"POLPOD\":\"\",\"Barge\":\"\",\"Statuss\":\"\",\"ID\":0};\nvar Lokasi = [];\nvar Lokasix = [\"Kelanis\",\"Kelanis\",\"Marabahan\",\"Marabahan\",\"Trisakti\",\"Taboneo\",\"Trisakti\",\"Marabahan\",\"Marabahan\",\"Marabahan\"];\nvar pathNum = [];\nvar pathNumx = [4,4,5,5,6,9,2,3,3,3];\nvar cycle = [];\nvar cyclex =   [1,1,1,1,1,1,1,1,1,1];\nfor(i=1;i<=3;i++){\n    for(j=0;j<10;j++){\n        Lokasi.push(Lokasix[j]);\n        pathNum.push(pathNumx[j]);\n        cycle.push(i);\n    }\n}\n// var pathid = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];\nvar tcc = \"2022-03-\"+String(day)+\"T\"+String(12+data-1)+\":00\"\nvar time = tc(tcc)[0];\nmsg.queryy = \"INSERT INTO `VMS`(`Ship_Name`,`Date`,`Cycle`,`Lokasi`, `GPS`, `Time`, `IDIMOVE`, `POLPOD`, `BARGE`, `Statuss`) VALUES ('MBP 3222','\"+String(tc(tcc)[1])+\"',\"+String(taskc)+\",'\"+Lokasi[-1+numlokasi]+\"','\"+json.GPS+\"',\"+time+\",\"+json.ID+\",'\"+json.POLPOD+\"','\"+json.Barge+\"','\"+json.Statuss+\"');\";\nmsg.topic = msg.queryy;\n\nreturn msg;\n\nfunction tc(timee){\n    if(timee.split('T')[1].split(':')[0].length < 2){\n        timee = timee.split('T')[0]+\"T0\"+timee.split('T')[1].split(':')[0]+\":\"+timee.split('T')[1].split(':')[1]\n    }\n    var t1 = Date.parse(timee)+3600000;\n    return [t1,timee];\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":4280,"wires":[["1a9f9da7.cc4862","eff6aa8a.5fc038"]]},{"id":"eff6aa8a.5fc038","type":"mysql","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","mydb":"be353e7e.73b9d","name":"","x":950,"y":4280,"wires":[[]]},{"id":"473f1d80.0004c4","type":"inject","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"DELETE","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"DELETE FROM `VMS` WHERE 1;","payload":"","payloadType":"str","x":800,"y":4320,"wires":[["eff6aa8a.5fc038"]]},{"id":"a6a154a4.718208","type":"function","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"Select","func":"msg.topic  = \"SELECT * FROM `VMS` order by Time desc;\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `Ship_Name` = 'MBP 3222';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4280,"wires":[["a85e2c93.d7cd2"]]},{"id":"a85e2c93.d7cd2","type":"mysql","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","mydb":"be353e7e.73b9d","name":"","x":630,"y":4280,"wires":[["8441a26e.3e5a7"]]},{"id":"3fe9e662.ed481a","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"","env":[],"x":270,"y":4280,"wires":[["87636e9f.673f2"],[]]},{"id":"869bb822.d1d648","type":"inject","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":4340,"wires":[["4e8fe3f0.ad327c"]]},{"id":"4e8fe3f0.ad327c","type":"function","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":" ","func":"var data = [];\nfor(i=1;i<=30;i++){ //cycle 1\n    data.push(i);\n}\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":4280,"wires":[["3fe9e662.ed481a","3bd09c7f.ac3654"]]},{"id":"87636e9f.673f2","type":"function","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":" ","func":"msg.num = msg.payload;\nmsg.payload = msg.num;\n// if(msg.num == 2 || msg.num == 4 || msg.num == 8 || msg.num == 9){\n//     msg.payload = null;\n// }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":4280,"wires":[["237db2d9.4d4e6e"]]},{"id":"1a9f9da7.cc4862","type":"debug","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":4320,"wires":[]},{"id":"66f779ee.1734a8","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"1","props":[{"p":"jsonn","v":"{\"ID\":\"1\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T00:02\",\"barge\":\"Bungur\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":910,"y":3660,"wires":[["857faf88.d9232"]]},{"id":"6ddae762.1ab868","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"2*","props":[{"p":"jsonn","v":"{\"ID\":\"2\",\"polpod\":\"\",\"time\":\"2022-03-30T17:45\",\"barge\":\"\",\"statuss\":\"UNPAIR\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":910,"y":3700,"wires":[["55ae4137.2f712"]]},{"id":"ac3d804.d1c228","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"3*","props":[{"p":"jsonn","v":"{\"ID\":\"3\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T18:45\",\"barge\":\"Batok\",\"statuss\":\"CHANGE BARGE\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":910,"y":3740,"wires":[["a014a0e1.ea37a"]]},{"id":"4b930659.c88258","type":"inject","z":"31a1ac1c.c57c44","d":true,"g":"bbe9b9b5.691c98","name":"4","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"4\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T20:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"}","payloadType":"json","x":910,"y":3780,"wires":[["eb7bae3d.96ee8"]]},{"id":"857faf88.d9232","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":995,"y":3660,"wires":[]},{"id":"55ae4137.2f712","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":995,"y":3700,"wires":[]},{"id":"a014a0e1.ea37a","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":995,"y":3740,"wires":[]},{"id":"eb7bae3d.96ee8","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":995,"y":3780,"wires":[]},{"id":"b6e459fb.6000f8","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":1175,"y":3660,"wires":[]},{"id":"12a75c9f.5e6413","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":1175,"y":3700,"wires":[]},{"id":"49575bda.dec1d4","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":1175,"y":3740,"wires":[]},{"id":"e212e373.e380d","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":1355,"y":3660,"wires":[]},{"id":"d58bf8fd.c69f98","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"5","props":[{"p":"jsonn","v":"{\"ID\":\"5\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T21:45\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1090,"y":3660,"wires":[["b6e459fb.6000f8"]]},{"id":"7d1d3e95.8b608","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"6*","props":[{"p":"jsonn","v":"{\"ID\":\"6\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T22:45\",\"barge\":\"Batok\",\"statuss\":\"CHANGE ROUTE\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1090,"y":3700,"wires":[["12a75c9f.5e6413"]]},{"id":"5a9391e4.af742","type":"inject","z":"31a1ac1c.c57c44","d":true,"g":"bbe9b9b5.691c98","name":"7","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T23:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"}","payloadType":"json","x":1090,"y":3740,"wires":[["49575bda.dec1d4"]]},{"id":"ebba1b98.7d9458","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"7","props":[{"p":"jsonn","v":"{\"ID\":\"7\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-31T01:45\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1270,"y":3660,"wires":[["e212e373.e380d"]]},{"id":"5d0901d8.e49d1","type":"inject","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"DELETE","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"DELETE FROM `submittform` WHERE 1;","payload":"","payloadType":"str","x":1280,"y":3700,"wires":[["c5bb2798.5b37a8"]]},{"id":"e5e68ca9.5e202","type":"link in","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["857faf88.d9232","55ae4137.2f712","a014a0e1.ea37a","eb7bae3d.96ee8","b6e459fb.6000f8","12a75c9f.5e6413","49575bda.dec1d4","e212e373.e380d","87435471.893458"],"x":1215,"y":3740,"wires":[["35ad6e79.b55292"]]},{"id":"c5bb2798.5b37a8","type":"mysql","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","mydb":"be353e7e.73b9d","name":"","x":1430,"y":3740,"wires":[["eb0ae5e.cb7a318"]]},{"id":"eb0ae5e.cb7a318","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["1bb87642.26548a"],"x":1515,"y":3740,"wires":[]},{"id":"3424c367.7d1eac","type":"inject","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":630,"y":3880,"wires":[["f17f08f6.360a88"]]},{"id":"be484a47.cefbc8","type":"inject","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","name":"2","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"num","x":630,"y":3920,"wires":[["f17f08f6.360a88"]]},{"id":"f17f08f6.360a88","type":"function","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","name":"cycleA2","func":"flow.set(\"cycleA2\",msg.payload);\nmsg.topic = \"UPDATE `TaskID` SET `Cycle`=\"+String(msg.payload)+\" WHERE VID = 'A2';\";\nvar data = msg.payload;\nif(data === 0){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=0 WHERE `Ship_Name` = 'MBP 3999';\"\n}else if(data == 1){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648654200000 WHERE `Ship_Name` = 'MBP 3999';\";\n}else if(data == 2){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648690200000 WHERE `Ship_Name` = 'MBP 3999';\";\n}else if(data == 3){\n    msg.topic += \"UPDATE `TaskID` SET `timecycle`=1648722600000 WHERE `Ship_Name` = 'MBP 3999';\";\n}\nmsg.topic += \"UPDATE `submittform` SET `z`=1 WHERE `Ship_Name` = 'MBP 3999';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":3920,"wires":[["e090275f.6df468","2908694a.2680e6"]]},{"id":"e090275f.6df468","type":"mysql","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","mydb":"be353e7e.73b9d","name":"","x":910,"y":3920,"wires":[[]]},{"id":"4f513cbe.2ce674","type":"inject","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","name":"3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":630,"y":3960,"wires":[["f17f08f6.360a88"]]},{"id":"e9d47aa6.aa67b8","type":"function","z":"31a1ac1c.c57c44","d":true,"g":"159284bb.9da1bb","name":"Proses","func":"var data = msg.payload[0][0];\nvar pathName = msg.payload[1];\nvar vms = msg.payload[2];\nvar pathID = msg.payload[4][0];\nvar pN = {};\nvar num = 1;\npN[String(num)] = [];\nfor(i=0;i<pathName.length;i++){\n    if(num == pathName[i].PathID){\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }else{\n        num = num + 1;\n        pN[String(num)] = [];\n        pN[String(num)].push({\"PathNum\":pathName[i].PathNum,\"geofenceID\":pathName[i].geofenceID,\"Main_Activity\":pathName[i].Main_Activity});\n    }\n}\nmsg.pN = pN;\nmsg.payload = pN;\nvar target = [];\nmsg.topic = \"\";\nmsg.topic += \"UPDATE `VMS` SET `IDIMOVE`=\"+String(data.ID)+\",`POLPOD`='\"+String(data.polpod)+\"',`BARGE`='\"+String(data.barge)+\"',`Statuss`='\"+String(data.Statuss)+\"'\";\nmsg.topic += \" WHERE `Cycle` = \"+String(pathID.Cycle)+\" AND `Time` >= \"+String(data.time)+\" AND `Cycle` = \"+String(data.z)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":4060,"wires":[["2d51cda8.801402"]]},{"id":"237db2d9.4d4e6e","type":"switch","z":"31a1ac1c.c57c44","g":"9d67465f.bdd6e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":4340,"wires":[["a6a154a4.718208"]]},{"id":"4b88c0d0.1499c","type":"function","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":"Insert VMS","func":"var data = msg.num;\nvar prev = msg.payload[0][0];\nvar taskc = msg.payload[1][0].Cycle;\nvar day = 30;\nvar numlokasi = data;\nif(data+11>23){\n    day+=1\n    data=data-24;\n}\nvar json = {\"Lokasi\":\"\",\"GPS\":\"xxx\",\"Time\":\"2022-03-30T00:00\",\"POLPOD\":\"\",\"Barge\":\"\",\"Statuss\":\"\",\"ID\":0};\nvar Lokasi = [];\nvar Lokasix = [\"Kelanis\",\"Kelanis\",\"Marabahan\",\"Marabahan\",\"Trisakti\",\"Taboneo\",\"Trisakti\",\"Marabahan\",\"Marabahan\",\"Marabahan\"];\nvar pathNum = [];\nvar pathNumx = [4,4,5,5,6,9,2,3,3,3];\nvar cycle = [];\nvar cyclex =   [1,1,1,1,1,1,1,1,1,1];\nfor(i=1;i<=3;i++){\n    for(j=0;j<10;j++){\n        Lokasi.push(Lokasix[j]);\n        pathNum.push(pathNumx[j]);\n        cycle.push(i);\n    }\n}\n// var pathid = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];\nvar tcc = \"2022-03-\"+String(day)+\"T\"+String(12+data-1)+\":30\"\nvar time = tc(tcc)[0];\nmsg.queryy = \"INSERT INTO `VMS`(`Ship_Name`,`Date`,`Cycle`,`Lokasi`, `GPS`, `Time`, `IDIMOVE`, `POLPOD`, `BARGE`, `Statuss`) VALUES ('MBP 3999','\"+String(tc(tcc)[1])+\"',\"+String(taskc)+\",'\"+Lokasi[-1+numlokasi]+\"','\"+json.GPS+\"',\"+time+\",\"+json.ID+\",'\"+json.POLPOD+\"','\"+json.Barge+\"','\"+json.Statuss+\"');\";\nmsg.topic = msg.queryy;\n\nreturn msg;\n\nfunction tc(timee){\n    if(timee.split('T')[1].split(':')[0].length < 2){\n        timee = timee.split('T')[0]+\"T0\"+timee.split('T')[1].split(':')[0]+\":\"+timee.split('T')[1].split(':')[1]\n    }\n    var t1 = Date.parse(timee)+3600000;\n    return [t1,timee];\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":4460,"wires":[["6de490b9.267b4","8712fd99.a9684"]]},{"id":"8712fd99.a9684","type":"mysql","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","mydb":"be353e7e.73b9d","name":"","x":970,"y":4460,"wires":[[]]},{"id":"2f58b20c.cc9f9e","type":"function","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":"Select","func":"msg.topic  = \"SELECT * FROM `VMS` order by Time desc;\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `Ship_Name` = 'MBP 3999';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4460,"wires":[["2bfc2f52.faf99"]]},{"id":"2bfc2f52.faf99","type":"mysql","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","mydb":"be353e7e.73b9d","name":"","x":650,"y":4460,"wires":[["4b88c0d0.1499c"]]},{"id":"3bd09c7f.ac3654","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":"","env":[],"x":290,"y":4460,"wires":[["e559a479.2d5508"],[]]},{"id":"e559a479.2d5508","type":"function","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":" ","func":"msg.num = msg.payload;\n// if(msg.num == 2 || msg.num == 4 || msg.num == 8 || msg.num == 9){\n//     msg.payload = null;\n// }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":4460,"wires":[["1102fb34.6e1465"]]},{"id":"6de490b9.267b4","type":"debug","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":990,"y":4500,"wires":[]},{"id":"1102fb34.6e1465","type":"switch","z":"31a1ac1c.c57c44","g":"22521.7f738adf8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":4520,"wires":[["2f58b20c.cc9f9e"]]},{"id":"f095228c.f5c91","type":"function","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":" ","func":"msg.topic = \"SELECT * FROM `submittform` ORDER BY `ID` DESC LIMIT 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":3780,"wires":[["507fa06f.ac5b"]]},{"id":"507fa06f.ac5b","type":"mysql","z":"31a1ac1c.c57c44","g":"7726a67f.543948","mydb":"be353e7e.73b9d","name":"","x":550,"y":3780,"wires":[["383710d9.e33fa"]]},{"id":"35ad6e79.b55292","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.topic = \"SELECT * FROM `submittform` ORDER BY `ID` DESC LIMIT 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1190,"y":3780,"wires":[["de18e440.d90298"]]},{"id":"de18e440.d90298","type":"mysql","z":"31a1ac1c.c57c44","mydb":"be353e7e.73b9d","name":"","x":1330,"y":3780,"wires":[["8a5bd7.7ebda428"]]},{"id":"8a5bd7.7ebda428","type":"function","z":"31a1ac1c.c57c44","name":"Insert","func":"var data = msg.jsonn;\ntry{\n    var prevID = msg.payload[0].ID;\n    data.ID = prevID+1;\n}\ncatch(x){\n    \n}\nvar ID = data.ID;\nvar time = String(timeconvert(data.time));\nvar shipname = data.shipname;\nvar polpod = data.polpod;\nvar barge = data.barge;\nvar status = data.statuss;\n\nmsg.topic = \"INSERT INTO `submittform`(`time`,`Ship_name`,`ID`, `polpod`, `barge`, `Statuss`) VALUES (\"+time+\",'\"+String(shipname)+\"',\"+ID+\",'\"+polpod+\"','\"+barge+\"','\"+status+\"');\";    \n\nreturn msg;\n\nfunction timeconvert(timee){\n    var t1 = Date.parse(timee)+3600000;\n    return t1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1450,"y":3780,"wires":[["c5bb2798.5b37a8"]]},{"id":"e9ea6d95.0aed8","type":"function","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":" ","func":"var res = msg.payload;\nvar arr=[];\narr.push({\"ID\":\"1\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T00:01\",\"barge\":\"Bungur\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"});\narr.push({\"ID\":\"2\",\"polpod\":\"\",\"time\":\"2022-03-30T17:30\",\"barge\":\"\",\"statuss\":\"UNPAIR\",\"shipname\":\"MBP 3222\"});\narr.push({\"ID\":\"3\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T18:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE BARGE\",\"shipname\":\"MBP 3222\"});\narr.push({\"ID\":\"5\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T21:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"});\narr.push({\"ID\":\"6\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T22:30\",\"barge\":\"Batok\",\"statuss\":\"CHANGE ROUTE\",\"shipname\":\"MBP 3222\"});\narr.push({\"ID\":\"7\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-31T01:30\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3222\"});\nmsg.jsonn = arr[res-1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":3620,"wires":[["b2aa682d.913248"]]},{"id":"b2aa682d.913248","type":"link out","z":"31a1ac1c.c57c44","g":"7726a67f.543948","name":"","links":["15a7a429.b67bcc"],"x":395,"y":3620,"wires":[]},{"id":"eee1d1a5.4dcf9","type":"function","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":" ","func":"var res = msg.payload;\nvar arr=[];\narr.push({\"ID\":\"1\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T00:02\",\"barge\":\"Bungur\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"});\narr.push({\"ID\":\"2\",\"polpod\":\"\",\"time\":\"2022-03-30T17:45\",\"barge\":\"\",\"statuss\":\"UNPAIR\",\"shipname\":\"MBP 3999\"});\narr.push({\"ID\":\"3\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T18:45\",\"barge\":\"Batok\",\"statuss\":\"CHANGE BARGE\",\"shipname\":\"MBP 3999\"});\narr.push({\"ID\":\"5\",\"polpod\":\"KLN - IBT\",\"time\":\"2022-03-30T21:45\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"});\narr.push({\"ID\":\"6\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-30T22:45\",\"barge\":\"Batok\",\"statuss\":\"CHANGE ROUTE\",\"shipname\":\"MBP 3999\"});\narr.push({\"ID\":\"7\",\"polpod\":\"KLN - TBN\",\"time\":\"2022-03-31T01:45\",\"barge\":\"Batok\",\"statuss\":\"\",\"shipname\":\"MBP 3999\"});\nmsg.jsonn = arr[res-1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":3620,"wires":[["87435471.893458"]]},{"id":"87435471.893458","type":"link out","z":"31a1ac1c.c57c44","g":"bbe9b9b5.691c98","name":"","links":["e5e68ca9.5e202"],"x":1115,"y":3620,"wires":[]},{"id":"2908694a.2680e6","type":"debug","z":"31a1ac1c.c57c44","g":"a9aa65e3.d865a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":940,"y":3880,"wires":[]},{"id":"a6d37745.3b7238","type":"function","z":"31a1ac1c.c57c44","name":"Select Table","func":"msg.datatank = msg.payload;\nmsg.topic = \"SELECT * FROM `TableTangkiKelanis`;\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2910,"y":920,"wires":[["78a63c20.108ff4"]]},{"id":"d7ac33c.02148d","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"query","v":"SELECT * FROM fuelkelanis;","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2300,"y":920,"wires":[["da386d.7849379"]]},{"id":"da386d.7849379","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":2470,"y":920,"wires":[["dd1be903.e02948"]]},{"id":"2b754eb1.69dc62","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3410,"y":920,"wires":[]},{"id":"78a63c20.108ff4","type":"mysql","z":"31a1ac1c.c57c44","mydb":"be353e7e.73b9d","name":"","x":3070,"y":920,"wires":[["8c6b788a.46f168"]]},{"id":"8c6b788a.46f168","type":"function","z":"31a1ac1c.c57c44","name":"Scalling","func":"var payload = msg.datatank;\nvar timee = epoch(payload.time);\nvar table = msg.payload;\nvar arr = [];\nvar cm = [];\nvar t1 = 1100,t2 = 1100, t3 = 300, t4 = 300;\ncm.push(convertRange(payload.FuelTangki1));\ncm.push(convertRange(payload.FuelTangki2));\ncm.push(convertRange(payload.FuelTangki3)-400);\ncm.push(convertRange(payload.FuelTangki4)-400);\nvar json = {};\njson[\"time\"] = payload.time;\nfor(i=1;i<=4;i++){\n    if(cm[i-1]>0){\n        json[\"Tangki\"+String(i)] = table[cm[i-1]][\"Tangki\"+String(i)];\n    }else{\n        json[\"Tangki\"+String(i)] = table[0][\"Tangki\"+String(i)];\n    }\n}\nfor(i=0;i<cm.length;i++){\n    cm[i] = cm[i]/100;\n}\n// arr.push(json);\n// arr.push(cm);\nmsg.payload = json;\nreturn msg;\n\nfunction convertRange(value) { \n    var r1 = [400,2000];\n    var r2 = [0,1000];\n    return Math.round(( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]);\n}\n\nfunction epoch (date) {\n//   return Date.parse(date)*1000000\n    return date;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3220,"y":920,"wires":[["2b754eb1.69dc62"]]},{"id":"95918c66.4d996","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","name":"","x":2750,"y":920,"wires":[["a6d37745.3b7238"],[]]},{"id":"dd1be903.e02948","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var data = msg.payload.results[0].series[0];\nvar v = data.values;\nvar arr = [];\nfor(i=0;i<data.values.length;i++){\n    var json = {\n        \"time\":v[i][0],\n        \"FuelTangki1\":v[i][1],\n        \"FuelTangki2\":v[i][2],\n        \"FuelTangki3\":v[i][3],\n        \"FuelTangki4\":v[i][4],\n        \"TempTangki1\":v[i][5],\n        \"TempTangki2\":v[i][6],\n        \"TempTangki3\":v[i][7],\n        \"TempTangki4\":v[i][8]\n    }\n    arr.push(json);\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2610,"y":920,"wires":[["95918c66.4d996"]]},{"id":"606cfc6d.8e2144","type":"influxdb out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","influxdb":"76f4cea2.88ada","name":"Database Raw","measurement":"fuelkelanisliters","precision":"n","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1120,"y":60,"wires":[]},{"id":"faac9a72.4c3368","type":"mqtt in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","topic":"fuelkelanisrequestliter","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":140,"y":340,"wires":[["e4a83995.f59fe8"]]},{"id":"e4a83995.f59fe8","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"SELECT Last Liter","func":"var data = msg.payload;\nmsg.num = data;\n// msg.query = \"SELECT Tangki1,Tangki2,Tangki3,Tangki4 FROM fuelkelanisliters order by time desc limit 1;\";\nmsg.query = \"SELECT Tangki1,Tangki2,Tangki3,Tangki4 FROM fuelkelanisliters order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":320,"wires":[["92413e6.49197c"]]},{"id":"92413e6.49197c","type":"influxdb in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"n","retentionPolicy":"","org":"organisation","x":510,"y":340,"wires":[["d128570f.fe69f8","83b11e14.df53"]]},{"id":"d128570f.fe69f8","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" feedback","func":"var num = msg.num;\nvar data = msg.payload;\n// data[0]['time'] = String(Date.parse(data[0].time));\ndata[0]['TempTangki1'] = msg.objj.TempTangki1;\ndata[0]['TempTangki2'] = msg.objj.TempTangki2;\ndata[0]['TempTangki3'] = msg.objj.TempTangki3;\ndata[0]['TempTangki4'] = msg.objj.TempTangki4;\ndata[0]['DSG1'] = msg.objj.DSG1;\ndata[0]['DSG2'] = msg.objj.DSG2;\ndata[0]['DSG3'] = msg.objj.DSG3;\ndata[0]['DSG4'] = msg.objj.DSG4;\nmsg.payload = data[0]//[\"Tangki\"+String(num)];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":320,"wires":[["a3459018.7f6ce","8a6f430.4ef7ec"]]},{"id":"a3459018.7f6ce","type":"mqtt out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","topic":"fuelkelanisfeedbackliter","qos":"","retain":"","broker":"4803b37b.b88cfc","x":850,"y":280,"wires":[]},{"id":"19e1f5d5.5f4c6a","type":"link out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","links":["50dcd254.4188cc"],"x":1255,"y":100,"wires":[]},{"id":"50dcd254.4188cc","type":"link in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","links":["19e1f5d5.5f4c6a"],"x":195,"y":300,"wires":[["e4a83995.f59fe8"]]},{"id":"4e1c1cc.dc382e4","type":"link out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","links":[],"x":195,"y":20,"wires":[]},{"id":"88180fb8.21a8","type":"link out","z":"31a1ac1c.c57c44","name":"NewIMOVE","links":["c966ccd0.4326a"],"x":815,"y":3540,"wires":[]},{"id":"c966ccd0.4326a","type":"link in","z":"47ec9b6e.206e24","name":"","links":["88180fb8.21a8"],"x":4005,"y":700,"wires":[["6eb6985c.9e5668"]]},{"id":"6eb6985c.9e5668","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.payload = \"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING]\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4120,"y":720,"wires":[[]]},{"id":"57c2e21b.3151cc","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4800,"y":720,"wires":[]},{"id":"62d07bdd.caa8d4","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3960,"y":780,"wires":[["6eb6985c.9e5668"]]},{"id":"2e6da980.7641a6","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var pl = msg.payload;\nvar len = pl.length;\nvar dat = pl[len-1];\nmsg.TARGET_FO = dat.TARGET_FO;\nmsg.topic = \"UPDATE `VMS_Route` SET `PathID`=\"+\"(SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(dat.POL)+\"-\"+String(dat.POD)+\"')\";\nmsg.topic += \",`POLPOD`='\"+String(dat.POL)+\"-\"+String(dat.POD)+\"'\";\n// msg.topic += \",`Path_Num`=(SELECT `PathNum` FROM `TaskID` WHERE `Ship_Name` = '\"+String(dat.SHIP)+\"')\";\n//msg.topic += \",`Current_Location`=(SELECT `Main_Activity` FROM `PathName` WHERE `PathID`=(SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(dat.POL)+\"-\"+String(dat.POD)+\"') AND `geofenceID`=())\"\n//msg.topic += \",`Next_Location`=\nmsg.topic += \",`IMOVEID`=\"+String(dat.ID)+\",`Barge`='\"+String(dat.BARGE)+\"',`Cycle`=(SELECT `Cycle` FROM `TaskID` WHERE `Ship_Name` = '\"+String(dat.SHIP)+\"'),`Statuss`='\"+String(dat.STATUS)+\"'\";\nmsg.topic += \" WHERE `Time` > \"+String(epoch(dat.DATE_TIME))+\" AND `Ship_Name` = '\"+String(dat.SHIP)+\"';\";\nmsg.payload = msg.topic;\nreturn msg;\n\nfunction epoch (date) {\n  return Date.parse(date)\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4380,"y":720,"wires":[["c998e86d.d18fc8"]]},{"id":"c998e86d.d18fc8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":4560,"y":720,"wires":[["57c2e21b.3151cc","b4aa1b51.6cdf98"]]},{"id":"b8e24616.dc55a8","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER];","payloadType":"str","x":230,"y":3520,"wires":[[]]},{"id":"fea11825.7906c8","type":"debug","z":"47ec9b6e.206e24","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3560,"y":460,"wires":[]},{"id":"8843baa1.9c1d68","type":"inject","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":2720,"wires":[[]]},{"id":"345ce2e4.0b7dee","type":"function","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":" ","func":"msg.topic = \"SELECT * FROM `VMS_Route` WHERE `Ship_Name`= 'MBP 3222' order by Time desc limit 1;\";\n\nvar d2 = msg.payload.results[0].series[0].values[0];\nvar d11 = msg.payload.results[1].series[0].values[0][1];\nvar d12 = msg.payload.results[2].series[0].values[0][1];\nvar d13 = msg.payload.results[3].series[0].values[0][1];\n// var d14 = msg.payload.results[4].series[0].values[0][1];\n// var d15 = msg.payload.results[5].series[0].values[0][1];\nvar d16 = msg.payload.results[4].series[0].values[0][1];\nvar d17 = msg.payload.results[5].series[0].values[0][1];\nvar d18 = msg.payload.results[6].series[0].values[0][1];\nvar rpmavr = Math.round((d17+d18)/2);\nvar res = d11+d12+d13+d16;\nmsg.influxx = {\n    \"ROB\" : res,\n    \"RPMENGINE\" : Math.abs(parseFloat(d2[7])+parseFloat(d2[8])/2),\n    \"RPMPROPELLER\" : Math.abs(parseFloat(d2[9])+parseFloat(d2[10])/2),\n    \"WINDSPEED\" : Math.abs(parseFloat(d2[14])),\n    \"rpmavr\":rpmavr\n}\nmsg.topic+=\"SELECT `Name` FROM `PathID` WHERE `PathName` = (SELECT `POLPOD` FROM `VMS_Route` WHERE `Ship_Name`= 'MBP 3222' order by Time desc limit 1);\";\nmsg.topic+=\"SELECT `DISTANCE_POL_POD` FROM `DistanceTask` WHERE `PROJECT` = (SELECT `POLPOD` FROM `VMS_Route` WHERE `Ship_Name`= 'MBP 3222' order by Time desc limit 1);\"\nmsg.payload = msg.influxx;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":2720,"wires":[["78cb3a38.c73784","b8738ceb.63375"]]},{"id":"78cb3a38.c73784","type":"mysql","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","mydb":"be353e7e.73b9d","name":"","x":810,"y":2720,"wires":[["6a680e6f.fd20c","177aead2.ca7535"]]},{"id":"6a680e6f.fd20c","type":"function","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":2720,"wires":[["b615c9f6.11e028","cf454677.345528"]]},{"id":"cf454677.345528","type":"http request","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1150,"y":2720,"wires":[["b615c9f6.11e028"]]},{"id":"4b3058c7.5482c8","type":"function","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":" ","func":"var indata = msg.INCOMINGDATA;\nmsg.query = \"\";\n// msg.query = \"SELECT * FROM fuelkelanisliters order by time desc limit 1;\";\nmsg.query += \"SELECT * FROM fuelLevel2 order by time desc limit 1;\"\nfor(i=1;i<=6;i++){\n    if(i==4 || i==5){\n        continue;\n    }\n    msg.query += \"SELECT * FROM F\"+String(i)+\"LiterJan2022 order by time desc limit 1;\";\n}\nmsg.query += \"SELECT mean(RP1) FROM RPM1F where time >= \"+String((parseInt(String(indata.Time))-3600000)*1000000)+\";\";\nmsg.query += \"SELECT mean(RP2) FROM RPM2F where time >= \"+String((parseInt(String(indata.Time))-3600000)*1000000)+\";\";\nmsg.payload = msg.query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2720,"wires":[["a8036a48.d79338","182a49ec.a59a66"]]},{"id":"a8036a48.d79338","type":"influxdb in","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":2720,"wires":[["345ce2e4.0b7dee","182a49ec.a59a66"]]},{"id":"c15ed462.a26c08","type":"ping","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","protocol":"Automatic","mode":"timed","name":"","host":"127.0.0.1","timer":"1","inputs":0,"x":200,"y":640,"wires":[["808f7dd0.7666c"]]},{"id":"808f7dd0.7666c","type":"debug","z":"51c3eae1.47d714","g":"5d7b596d.3c2708","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":640,"wires":[]},{"id":"f8bc9e6b.16c2f","type":"http request","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatehistory/","tls":"","persist":false,"proxy":"","authType":"basic","x":364,"y":1800,"wires":[["46516ad3.107444"]]},{"id":"b7a391bb.21337","type":"inject","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":2780,"wires":[["4b3058c7.5482c8"]]},{"id":"b8738ceb.63375","type":"debug","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":2780,"wires":[]},{"id":"b615c9f6.11e028","type":"debug","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1060,"y":2780,"wires":[]},{"id":"182a49ec.a59a66","type":"debug","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":640,"y":2780,"wires":[]},{"id":"4605ef30.38be3","type":"function","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"0","func":"flow.set(\"UPDATEHIS\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":1160,"wires":[["c7f483df.9e36b"]]},{"id":"d2c16170.d056c","type":"inject","z":"51c3eae1.47d714","g":"4fa578fa.bfc088","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":100,"wires":[["9e2e18eb.840718"]]},{"id":"9e2e18eb.840718","type":"function","z":"51c3eae1.47d714","g":"4fa578fa.bfc088","name":"show","func":"msg.payload = flow.get(\"UPDATEHIS\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":100,"wires":[["a9f503e2.ffea4"]]},{"id":"17a816d6.9617a9","type":"function","z":"51c3eae1.47d714","g":"4fa578fa.bfc088","name":"set","func":"flow.set(\"UPDATEHIS\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":140,"wires":[["a9f503e2.ffea4"]]},{"id":"a9f503e2.ffea4","type":"debug","z":"51c3eae1.47d714","g":"4fa578fa.bfc088","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":460,"y":100,"wires":[]},{"id":"367a9cea.813f04","type":"inject","z":"51c3eae1.47d714","g":"4fa578fa.bfc088","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":140,"wires":[["17a816d6.9617a9"]]},{"id":"46516ad3.107444","type":"debug","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":584,"y":1780,"wires":[]},{"id":"a9e76c30.6d3d8","type":"http request","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"UpdateStat","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatehistory/","tls":"","persist":false,"proxy":"","authType":"basic","x":650,"y":1160,"wires":[["6456719c.917d4"]]},{"id":"f41a9bfe.99a708","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"66","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER];","payloadType":"str","x":160,"y":2940,"wires":[[]]},{"id":"431e8bda.866854","type":"http request","z":"51c3eae1.47d714","g":"c2b70546.5e9668","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/SelectM/historycmd/","tls":"","persist":false,"proxy":"","authType":"","x":150,"y":1100,"wires":[["645ccfa1.3c1ab","e0ebb693.5831a8"]]},{"id":"8a6f3a2a.dfecf8","type":"http request","z":"51c3eae1.47d714","g":"7eda24b0.a1b09c","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/SelectM/historycmd/","tls":"","persist":false,"proxy":"","authType":"","x":364,"y":1760,"wires":[["46516ad3.107444"]]},{"id":"9f7452e9.62cd","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"Check Length","func":"var d = msg.payload;\nvar now = msg.payload.length; \nvar prev = flow.get(\"Bunker\");\nif(now == prev){\n    msg.payload = null;\n    return msg;\n}else{\n    var selisih = now-prev;\n    var arr = [];\n    for(i=1;i<=selisih;i++){\n        arr.push(d[d.length-i]);\n    }\n    flow.set(\"Bunker\",now);\n    arr.reverse();\n    msg.payload = arr;\n    // msg.payload = [arr[0]];\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":2940,"wires":[["74bf0fb5.33ef5"]]},{"id":"74bf0fb5.33ef5","type":"switch","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":680,"y":2940,"wires":[["75dfa694.0c1a58"]]},{"id":"1850ee2c.0d41b2","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","func":"flow.set(\"Bunker\",0);\nmsg.payload = flow.get(\"Bunker\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":3000,"wires":[["ce2078c9.9f3728"]]},{"id":"5611b68e.cb77c8","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":3000,"wires":[["1850ee2c.0d41b2"]]},{"id":"75dfa694.0c1a58","type":"subflow:e9b71a55.b25c68","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","env":[],"x":810,"y":2940,"wires":[["4debb4bf.697d8c","3ae09f3e.bf089"],[]]},{"id":"3ae09f3e.bf089","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","func":"// msg.method = \"POST\";\n// msg.payload[\"datee\"] = String(msg.payload.TIME_START).split(' ')[0]+\" \"+String(msg.payload.TIME_START).split(' ')[2]+\" \"+String(msg.payload.TIME_START).split(' ')[1]+\" \"+String(msg.payload.TIME_START).split(' ')[3];\nmsg.payload['datee'] = String(msg.payload.TIME_START);\nvar start = (Date.parse(msg.payload.TIME_START)*1000000)-28800000000000;\nmsg.recorddate = start/1000000000;\nvar stop = (Date.parse(msg.payload.TIME_COMPLETE)*1000000)-28800000000000;\nmsg.bunker = msg.payload;\ndelete msg.bunker['SHIP_ID'];\nmsg.query = \"\";\nfor(i=1;i<=6;i++){\n    msg.query += \"SELECT * FROM F\"+String(i)+\"LiterApr\"\n    msg.query += \" WHERE time >=\"+String(start)+\" order by time asc limit 1;\";\n}\nfor(i=1;i<=6;i++){\n    msg.query += \"SELECT * FROM F\"+String(i)+\"LiterApr\"\n    msg.query += \" WHERE time >=\"+String(stop)+\" order by time asc limit 1;\";\n}\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n// for(i=1;i<=6;i++){\n//     if(i==4 || i==5){\n//         msg.query += \"SELECT * FROM F\"+String(i)+\"LiterNov7\";\n//         msg.query += \" WHERE time >=\"+String(start)+\" order by time asc limit 1;\";\n//     }else{\n//         msg.query += \"SELECT * FROM F\"+String(i)+\"LiterJan2022\";\n//         msg.query += \" WHERE time >=\"+String(start)+\" order by time asc limit 1;\";\n//     }\n// }\n\n// for(i=1;i<=6;i++){\n//     if(i==4 || i==5){\n//         msg.query += \"SELECT * FROM F\"+String(i)+\"LiterNov7\";\n//         msg.query += \" WHERE time <=\"+String(stop)+\" order by time desc limit 1;\";\n//     }else{\n//         msg.query += \"SELECT * FROM F\"+String(i)+\"LiterJan2022\";\n//         msg.query += \" WHERE time <=\"+String(stop)+\" order by time desc limit 1;\";\n//     }\n// }\nmsg.payload = [start,stop];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":2960,"wires":[["607df3b1.e0725c","d0623be9.aa2c48"]]},{"id":"784043ae.4043dc","type":"http request","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertbunker","tls":"","persist":false,"proxy":"","authType":"basic","x":1100,"y":3100,"wires":[["1a728756.7213c9"]]},{"id":"d0623be9.aa2c48","type":"influxdb in","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":980,"y":3000,"wires":[["21612c43.3d9b54","d1c8768b.f234e8"]]},{"id":"1a728756.7213c9","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1200,"y":3040,"wires":[]},{"id":"21612c43.3d9b54","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","func":"msg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertbunker\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\n\nvar d = msg.payload;\nvar nstart = 0;\nvar nstop = 0;\nvar timeb = 0;\nvar timea = 0;\nfor(i=0;i<d.results.length/2;i++){\n    if(i==1 || i == 5){\n       nstart+=0;\n    }else{\n        if(d.results[i].series[0].values[0][1] == null){\n            nstart+=d.results[i].series[0].values[0][2]; \n        }else{\n            nstart+=d.results[i].series[0].values[0][1];      \n        }\n        if(timeb<d.results[i].series[0].values[0][0]){\n            timeb = Math.round(d.results[i].series[0].values[0][0]/1000000);\n        }\n    }\n}\n\nfor(i=d.results.length/2;i<d.results.length;i++){\n    if(i==7 || i == 11){\n        nstop+=0;\n    }else{\n        if(d.results[i].series[0].values[0][1] == null){\n            nstop+=d.results[i].series[0].values[0][2];\n        }else{\n            nstop+=d.results[i].series[0].values[0][1];\n        }\n        if(timea<d.results[i].series[0].values[0][0]){\n           timea = Math.round(d.results[i].series[0].values[0][0]/1000000);\n        }\n    }\n}\nvar vmsb = new Date(timeb); //+ 8 jam karena ke gmt 8\nvar vmsa = new Date(timea);\nmsg.bunker[\"vmsrob\"] = Math.round(nstop-nstart);\nmsg.bunker[\"dif\"] = Math.abs(msg.bunker[\"vmsrob\"] - msg.bunker[\"FO_RECEIVED\"]);\nmsg.bunker[\"recorddate\"] = msg.recorddate;\n\n// msg.bunker['SHIP_ID']=String(msg.bunker.SHIP_ID);\nmsg.bunker['SHIP']=String(msg.bunker.SHIP);\nmsg.bunker['TIME_START']=String(new Date(Date.parse(msg.bunker.TIME_START)-28800000));\nmsg.bunker['ROB_START']=String(msg.bunker.ROB_START);\nmsg.bunker['TIME_COMPLETE']=String(new Date(Date.parse(msg.bunker.TIME_COMPLETE)-28800000));\nmsg.bunker['ROB_FINISH']=String(msg.bunker.ROB_FINISH);\nmsg.bunker['BUNKER_QTY']=String(msg.bunker.BUNKER_QTY);\nmsg.bunker['FO_RECEIVED']=String(msg.bunker.FO_RECEIVED);\nmsg.bunker['FO_CONS']=String(msg.bunker.FO_CONS);\nmsg.bunker['datee']=String(Date.parse(msg.bunker.datee));\nmsg.bunker['vmsrob']=String(msg.bunker.vmsrob);\nmsg.bunker['dif']=String(msg.bunker.dif);\nmsg.bunker['ROB_BEFORE_VMS']=String(nstart);\nmsg.bunker['ROB_AFTER_VMS']=String(nstop);\nmsg.bunker['TIMEBFRVMS'] = String(vmsb);\nmsg.bunker['TIMEAFTVMS'] = String(vmsa);\n\n//simply\nmsg.bunker['TIME_START']= msg.bunker.TIME_START.substring(0,msg.bunker.TIME_START.length-34);\nmsg.bunker['TIME_COMPLETE']= msg.bunker.TIME_COMPLETE.substring(0,msg.bunker.TIME_COMPLETE.length-34);\nmsg.bunker['TIMEBFRVMS'] = msg.bunker.TIMEBFRVMS.substring(0,msg.bunker.TIMEBFRVMS.length-34);\nmsg.bunker['TIMEAFTVMS'] = msg.bunker.TIMEAFTVMS.substring(0,msg.bunker.TIMEAFTVMS.length-34);\n// msg.bunker['datee']=msg.bunker.datee.substring(0,msg.bunker.datee.length-34);\n\nmsg.payload = msg.bunker;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3040,"wires":[["1a728756.7213c9","784043ae.4043dc"]]},{"id":"4debb4bf.697d8c","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":2900,"wires":[]},{"id":"607df3b1.e0725c","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1130,"y":2940,"wires":[]},{"id":"d1c8768b.f234e8","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1140,"y":3000,"wires":[]},{"id":"81433c40.45508","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER];","payloadType":"str","x":200,"y":3100,"wires":[[]]},{"id":"94ac6bb.ee84498","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":3100,"wires":[]},{"id":"384f5b4f.f40404","type":"inject","z":"51c3eae1.47d714","g":"eaea4331.3c878","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":163,"y":3360,"wires":[["62665e20.df829"]]},{"id":"a1bd5094.71be9","type":"debug","z":"51c3eae1.47d714","g":"eaea4331.3c878","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":413,"y":3440,"wires":[]},{"id":"62665e20.df829","type":"function","z":"51c3eae1.47d714","g":"eaea4331.3c878","name":"","func":"msg.payload = new Date(\"2022-04-04T19:40:00.000Z\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":323,"y":3380,"wires":[["a1bd5094.71be9"]]},{"id":"1cd060ce.b6af6f","type":"inject","z":"51c3eae1.47d714","g":"fc215eb0.952fb","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"SHIP_ID\":\"100000167\",\"SHIP\":\"MBP 3222\",\"TIME_START\":\"Tue Apr 05 2022 03:40:00 GMT+0800 (Central Indonesia Time)\",\"ROB_START\":\"7048.354\",\"TIME_COMPLETE\":\"Tue Apr 05 2022 04:10:00 GMT+0800 (Central Indonesia Time)\",\"ROB_FINISH\":\"30040.354\",\"BUNKER_QTY\":\"23000\",\"FO_RECEIVED\":\"22992\",\"FO_CONS\":\"8\",\"datee\":\"Tue 05 Apr 2022\",\"vmsrob\":\"47022\",\"dif\":\"24022\",\"recorddate\":1649072400}","payloadType":"json","x":657,"y":3340,"wires":[["ecd041d8.fa4aa"]]},{"id":"ecd041d8.fa4aa","type":"debug","z":"51c3eae1.47d714","g":"fc215eb0.952fb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":847,"y":3340,"wires":[]},{"id":"6ff9b902.540c08","type":"link in","z":"51c3eae1.47d714","g":"d7262ac7.319a88","name":"","links":["241c50a6.6711"],"x":158,"y":3540,"wires":[["aedc507e.777a8","f447fa56.0ad1e8"]]},{"id":"1cfe6ca7.764963","type":"debug","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1523,"y":3520,"wires":[]},{"id":"21213d0d.b055d2","type":"function","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":" ","func":"msg.payload = msg.INCOMINGDATA;\nmsg.alldata = {\n    \"EPO\" : parseFloat(msg.payload.Time),\n    \"RECORDDATA\" : String(epotostr(parseFloat(msg.payload.Time))).split('.')[0],\n    \"LAT\":parseFloat(msg.payload.Lat),\n    \"LON\":parseFloat(msg.payload.Lon),\n    \"RPMENGINE\":ifunderten(Math.round(parseFloat(msg.payload.RPM.R1)+parseFloat(msg.payload.RPM.R2)/2)),\n    \"RPMPROP\":ifunderten(Math.round(parseFloat(msg.payload.Propeller.R5)+parseFloat(msg.payload.Propeller.R8)/2)),\n    \"WINDSPEED\":parseFloat(msg.payload.WS)\n}\nvar VID = \"A1\";\nmsg.topic=\"\";\nmsg.topic=\"SELECT `Ship_Name` FROM `TaskID` WHERE `VID` = '\"+String(VID)+\"' ;\";\n\nmsg.topic += \"SELECT `Liter` FROM `FS001Jan` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F1)/2),1))+\";\";\nmsg.topic += \"SELECT `Liter` FROM `FS002Jan` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F2)/2),2))+\";\";\nmsg.topic += \"SELECT `Liter` FROM `FS003Jan` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F3)/2),3))+\";\";\nmsg.topic += \"SELECT `Liter` FROM `FS4Nov` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F4)/2),4))+\";\";\nmsg.topic += \"SELECT `Liter` FROM `FS5Nov` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F5)/2),5))+\";\";\nmsg.topic += \"SELECT `Liter` FROM `FS006Jan` WHERE `Value` = \"+String(MA(Math.round(parseFloat(msg.payload.Fuel.F6)/2),6))+\";\";\nmsg.topic += \"SELECT `Current_Location`,`Next_Location`,`POLPOD`,`Barge` FROM `VMS_Route` order by Time desc limit 1;\";\nmsg.timebaru = parseInt(msg.payload.Time);\n\nmsg.payload = msg.alldata;\nreturn msg;\n\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nfunction ifunderten(x){\n    if(x<10){\n        return 0;\n    }else{\n        return x;\n    }\n}\n\nfunction MA(a,x){\n    var s = \"OLD\"+String(x);\n    var ar = flow.get(s);\n    if(ar.length>=30){\n        ar.shift();\n    }\n    ar.push(a);\n    var res = Math.round(ar.reduce(function (curr, prev) { return curr + prev; })/ar.length);\n    flow.set(s,ar);\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":763,"y":3520,"wires":[["cf66798f.37b908","ee68bd8b.dbdd"]]},{"id":"f4140b7d.7001d8","type":"inject","z":"51c3eae1.47d714","g":"52a9d974.a74ad8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SendReport","payload":"SendReport","payloadType":"str","x":197,"y":3700,"wires":[["4214f163.1fd0f"]]},{"id":"4214f163.1fd0f","type":"mqtt out","z":"51c3eae1.47d714","g":"52a9d974.a74ad8","name":"","topic":"SendReport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":437,"y":3700,"wires":[]},{"id":"aedc507e.777a8","type":"debug","z":"51c3eae1.47d714","g":"d7262ac7.319a88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":3540,"wires":[]},{"id":"cf66798f.37b908","type":"mysql","z":"51c3eae1.47d714","g":"10f315b3.5886da","mydb":"be353e7e.73b9d","name":"","x":903,"y":3560,"wires":[["f63ef6a8.4b2b48","ce1462f8.d95e3"]]},{"id":"f63ef6a8.4b2b48","type":"function","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":" insert alldata","func":"var d = msg.payload;\nvar shipname = d[0][0];\nvar rob = 0;\nfor(i=1;i<=6;i++){\n    if(i == 2 || i == 6){\n        rob+=0;\n    }else{\n        rob+=d[i][0].Liter\n    }\n}\nmsg.alldata[\"ROB\"] = rob;\nmsg.alldata[\"CURRENTT\"] = d[7][0].Current_Location;\nmsg.alldata[\"NEXTT\"] = d[7][0].Next_Location;\nmsg.alldata[\"DEPARTURE\"] = d[7][0].POLPOD.split('-')[0];\nmsg.alldata[\"ARRIVAL\"] = d[7][0].POLPOD.split('-')[1];\nmsg.alldata[\"SHIP_NAME\"] = d[0][0].Ship_Name;\n// msg.payload = msg.timebaru-1800000;\nmsg.databaru = {\"time\":msg.timebaru,\"lat\":msg.alldata.LAT,\"lon\":msg.alldata.LON};\nmsg.query = \"SELECT * FROM fuelLevel WHERE time >= \"+String(((msg.timebaru-3600000)))+\" limit 1;\";\nmsg.topic = msg.query;\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1063,"y":3520,"wires":[["a84438c5.73e388","8669e377.46444","9a895434.5e9738"]]},{"id":"c0539377.1c774","type":"ping","z":"31a1ac1c.c57c44","protocol":"Automatic","mode":"timed","name":"","host":"192.168.181.22","timer":"1","inputs":0,"x":240,"y":3440,"wires":[["d904365f.8d40a8"]]},{"id":"d904365f.8d40a8","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":450,"y":3440,"wires":[]},{"id":"a84438c5.73e388","type":"influxdb in","z":"51c3eae1.47d714","g":"10f315b3.5886da","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1223,"y":3520,"wires":[["3640f32a.c7462c"]]},{"id":"8669e377.46444","type":"debug","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1193,"y":3440,"wires":[]},{"id":"3640f32a.c7462c","type":"function","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":" ","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\n\nvar lat = msg.payload.results[0].series[0].values[0][11];\nvar lon = msg.payload.results[0].series[0].values[0][12];\nvar time = msg.payload.results[0].series[0].values[0][0];\nmsg.datalama = {\"time\":parseInt(time),\"lat\":parseFloat(lat),\"lon\":parseFloat(lon)}\nvar selisiht = Math.abs(msg.datalama.time - msg.databaru.time);\nvar spd = distance(msg.datalama.lat,msg.datalama.lon,msg.databaru.lat,msg.databaru.lon,\"K\")/(selisiht/(1000*3600));\nvar knot = (1.852*spd).toFixed(2); //--------------------------------------------------------------------------------------\n\nvar speed = String(knot)+\"Kn/\"+String(angle(msg.datalama.lat,msg.datalama.lon,msg.databaru.lat,msg.databaru.lon))+\"°\";\nflow.set(\"SPEEDMBP3222\",speed);\nflow.set(\"SPEEDMBP3222KM\",spd);\nmsg.alldata[\"SPEEDCOURSE\"] = speed;\nmsg.payload = {\n    \"EPO\":msg.alldata.EPO,\n    \"RECORDDATA\":msg.alldata.RECORDDATA,\n    \"SHIP_NAME\":msg.alldata.SHIP_NAME,\n    \"LAT\":msg.alldata.LAT,\n    \"LON\":msg.alldata.LON,\n    \"DEPARTURE\":msg.alldata.DEPARTURE,\n    \"ARRIVAL\":msg.alldata.ARRIVAL,\n    \"CURRENTT\":msg.alldata.CURRENTT,\n    \"NEXTT\":msg.alldata.NEXTT,\n    \"ROB\":msg.alldata.ROB,\n    \"RPMENGINE\":msg.alldata.RPMENGINE,\n    \"RPMPROP\":msg.alldata.RPMPROP,\n    \"WINDSPEED\":Math.round(parseFloat(String(msg.alldata.WINDSPEED))/100),\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE\n};\nreturn msg;\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\n\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1343,"y":3520,"wires":[["1cfe6ca7.764963","82ffacda.c2dac","ba174895.685028"]]},{"id":"86861139.b53f9","type":"inject","z":"51c3eae1.47d714","g":"45e9425d.ac897c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":660,"y":3840,"wires":[["c50d460.cfa84b8"]]},{"id":"c50d460.cfa84b8","type":"function","z":"51c3eae1.47d714","g":"45e9425d.ac897c","name":"","func":"\nmsg.payload = flow.get(\"SPEEDMBP3222\")\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":3840,"wires":[["8d00bc49.49288"]]},{"id":"8d00bc49.49288","type":"debug","z":"51c3eae1.47d714","g":"45e9425d.ac897c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":950,"y":3840,"wires":[]},{"id":"82ffacda.c2dac","type":"http request","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1423,"y":3600,"wires":[["1cfe6ca7.764963"]]},{"id":"679facf.eea1d54","type":"link in","z":"47ec9b6e.206e24","name":"UPDATEVMSROUTE","links":["f447fa56.0ad1e8"],"x":3995,"y":860,"wires":[["6eb6985c.9e5668"]]},{"id":"f447fa56.0ad1e8","type":"link out","z":"51c3eae1.47d714","g":"d7262ac7.319a88","name":"","links":["679facf.eea1d54"],"x":228,"y":3600,"wires":[]},{"id":"177aead2.ca7535","type":"debug","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":2680,"wires":[]},{"id":"78fe7aae.973f34","type":"inject","z":"51c3eae1.47d714","g":"eaea4331.3c878","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":203,"y":3440,"wires":[[]]},{"id":"fc64cf29.d3f6c","type":"link in","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","links":["ba174895.685028"],"x":215,"y":2660,"wires":[["4b3058c7.5482c8","34baa418.eb214c"]]},{"id":"9a895434.5e9738","type":"function","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":" insert fuel","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertfuel\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\n\nmsg.insertfuel = {\n    \"EPO\":msg.alldata.EPO,\n    \"DATEE\":msg.alldata.RECORDDATA,\n    \"F1\":msg.payload[1][0].Liter,\n    \"F2\":msg.payload[2][0].Liter,\n    \"F3\":msg.payload[3][0].Liter,\n    \"F4\":msg.payload[4][0].Liter,\n    \"F5\":msg.payload[5][0].Liter,\n    \"F6\":msg.payload[6][0].Liter,\n    \"MAX_FUEL\":50000\n}\nmsg.payload = msg.insertfuel;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1093,"y":3660,"wires":[["9f5b4d0f.5bc33","583e352a.0905ec"]]},{"id":"9f5b4d0f.5bc33","type":"debug","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1283,"y":3740,"wires":[]},{"id":"583e352a.0905ec","type":"http request","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1283,"y":3640,"wires":[["9f5b4d0f.5bc33"]]},{"id":"ce1462f8.d95e3","type":"debug","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1063,"y":3560,"wires":[]},{"id":"b4aa1b51.6cdf98","type":"link out","z":"47ec9b6e.206e24","name":"PROCESSDONE","links":["610460d9.05eb8"],"x":4655,"y":760,"wires":[]},{"id":"40d241e0.8e712","type":"function","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"Moving Average","func":"if(flow.get(\"NUM1\").split(',').length>=5){\n    var ar = flow.get(\"NUM\").split(',');\n    ar.shift();\n    ar.push(String(msg.payload));\n    var n = 0;\n    for(i=0;i<ar.length;i++){\n        n+=parseInt(ar[i]);\n    }\n    n = n/ar.length;\n    flow.set(\"NUM\",ar.toString());\n    msg.payload = n;\n    if(msg.payload.isNaN()){\n        msg.payload = null;\n    }\n}\nreturn msg;\n\n\nfunction MA(a){\n    if(flow.get(\"NUM1\").split(',').length>=5){\n        var ar = flow.get(\"NUM\").split(',');\n        ar.shift();\n        ar.push(String(msg.payload));\n        var n = 0;\n        for(i=0;i<ar.length;i++){\n            n+=parseInt(ar[i]);\n        }\n        n = n/ar.length;\n        flow.set(\"NUM\",ar.toString());\n        msg.payload = n;\n        if(msg.payload.isNaN()){\n            msg.payload = null;\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":4320,"wires":[["bfa17b5f.f33208","3ced6787.ff57b8"]]},{"id":"bfa17b5f.f33208","type":"switch","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"notnull","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":950,"y":4320,"wires":[[]]},{"id":"3ced6787.ff57b8","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":4260,"wires":[]},{"id":"d99d66b5.c8da18","type":"inject","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":4020,"wires":[["62c5a910.08efb8"]]},{"id":"62c5a910.08efb8","type":"function","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"select old data","func":"msg.query = \"SELECT F1 FROM F1LiterJan2022 WHERE time > 1648792861000000000;\";\nmsg.query += \"SELECT F2 FROM F2LiterJan2022 WHERE time > 1648792861000000000;\";\nmsg.query += \"SELECT F3 FROM F3LiterJan2022 WHERE time > 1648792861000000000;\";\nmsg.query += \"SELECT F4 FROM F4LiterNov7 WHERE time > 1648792861000000000;\";\nmsg.query += \"SELECT F5 FROM F5LiterNov7 WHERE time > 1648792861000000000;\";\nmsg.query += \"SELECT F6 FROM F6LiterJan2022 WHERE time > 1648792861000000000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":4080,"wires":[["514a05d4.d3e5ac"]]},{"id":"514a05d4.d3e5ac","type":"influxdb in","z":"80eab637.b91808","g":"50aa5b6f.f7a464","influxdb":"76f4cea2.88ada","name":"fuelSensor","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":310,"y":4080,"wires":[["97718dde.bfe4a","ed4e2081.1a80a"]]},{"id":"46a2baeb.137d04","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":4260,"wires":[]},{"id":"b9718d5d.79017","type":"function","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"GetLiter","func":"var d = msg.payload.results[0].series[0].values;\nmsg.topic = \"\";\nfor(i=0;i<d.length;i++){\n    msg.topic += \"SELECT `Liter` FROM `FS001Jan` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][1])/2))+\";\";\n    msg.topic += \"SELECT `Liter` FROM `FS002Jan` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][2])/2))+\";\";\n    msg.topic += \"SELECT `Liter` FROM `FS003Jan` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][3])/2))+\";\";\n    msg.topic += \"SELECT `Liter` FROM `FS4Nov` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][4])/2))+\";\";\n    msg.topic += \"SELECT `Liter` FROM `FS5Nov` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][5])/2))+\";\";\n    msg.topic += \"SELECT `Liter` FROM `FS006Jan` WHERE `Value` = \"+String(Math.round(parseFloat(msg.payload[i][6])/2))+\";\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":4320,"wires":[["325f139b.e658bc","3d34dd3f.e872e2"]]},{"id":"325f139b.e658bc","type":"mysql","z":"80eab637.b91808","g":"50aa5b6f.f7a464","mydb":"be353e7e.73b9d","name":"","x":610,"y":4320,"wires":[["46a2baeb.137d04"]]},{"id":"90f94c38.1e358","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":4020,"wires":[]},{"id":"3d34dd3f.e872e2","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":4260,"wires":[]},{"id":"ed4e2081.1a80a","type":"function","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":" ","func":"var d1 = msg.payload.results[0].series[0].values;\nvar dt1 = [];\nvar d2 = msg.payload.results[1].series[0].values;\nvar dt2 = [];\nvar d3 = msg.payload.results[2].series[0].values;\nvar dt3 = [];\nvar d4 = msg.payload.results[3].series[0].values;\nvar dt4 = [];\nvar d5 = msg.payload.results[4].series[0].values;\nvar dt5 = [];\nvar d6 = msg.payload.results[5].series[0].values;\nvar dt6 = [];\nmsg.topic = \"\";\nfor(i=0;i<d1.length;i++){\n    msg.topic += \"SELECT `Value` AS F1 FROM `FS001Jan` WHERE `Liter` = \"+String(d1[i][1])+\";\";\n    dt1.push(d1[i][0]);\n}\nfor(i=0;i<d2.length;i++){\n    msg.topic += \"SELECT `Value` AS F2 FROM `FS002Jan` WHERE `Liter` = \"+String(d2[i][1])+\";\";\n    dt2.push(d2[i][0]);\n}\nfor(i=0;i<d3.length;i++){\n    msg.topic += \"SELECT `Value` AS F3 FROM `FS003Jan` WHERE `Liter` = \"+String(d3[i][1])+\";\";\n    dt3.push(d3[i][0]);\n}\nfor(i=0;i<d4.length;i++){\n    msg.topic += \"SELECT `Value` AS F4 FROM `FS4Nov` WHERE `Liter` = \"+String(d4[i][1])+\";\";\n    dt4.push(d4[i][0]);\n}\nfor(i=0;i<d5.length;i++){\n    msg.topic += \"SELECT `Value` AS F5 FROM `FS5Nov` WHERE `Liter` = \"+String(d5[i][1])+\";\";\n    dt5.push(d5[i][0]);\n}\nfor(i=0;i<d6.length;i++){\n    msg.topic += \"SELECT `Value` AS F6 FROM `FS006Jan` WHERE `Liter` = \"+String(d6[i][1])+\";\";\n    dt6.push(d6[i][0]);\n}\nmsg.timedata = [dt1,dt2,dt3,dt4,dt5,dt6];\nmsg.payload= msg.timedata;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":4080,"wires":[["f224babc.8a6948","3c90f244.03119e"]]},{"id":"41548b23.1ae8a4","type":"influxdb out","z":"80eab637.b91808","g":"50aa5b6f.f7a464","influxdb":"76f4cea2.88ada","name":" ","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":910,"y":4120,"wires":[]},{"id":"f224babc.8a6948","type":"mysql","z":"80eab637.b91808","g":"50aa5b6f.f7a464","mydb":"be353e7e.73b9d","name":"","x":610,"y":4080,"wires":[["8a7ea072.93123"]]},{"id":"8a7ea072.93123","type":"function","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":" Create JSON","func":"var d = msg.payload;\nmsg.topic = \"\";\nvar F1 = [];\nvar F2 = [];\nvar F3 = [];\nvar F4 = [];\nvar F5 = [];\nvar F6 = [];\nfor(i=0;i<d.length;i++){\n    if(d[i][0].hasOwnProperty(\"F1\")){\n        F1.push(d[i][0].F1);\n    }else if(d[i][0].hasOwnProperty(\"F2\")){\n        F2.push(d[i][0].F2);\n    }else if(d[i][0].hasOwnProperty(\"F3\")){\n        F3.push(d[i][0].F3);\n    }else if(d[i][0].hasOwnProperty(\"F4\")){\n        F4.push(d[i][0].F4);\n    }else if(d[i][0].hasOwnProperty(\"F5\")){\n        F5.push(d[i][0].F5);\n    }else if(d[i][0].hasOwnProperty(\"F6\")){\n        F6.push(d[i][0].F6);\n    }\n}\nmsg.payload = [F1,F2,F3,F4,F5,F6]\nreturn msg;\n\nfunction MA(a,x){\n    if(flow.get(\"OLD\"+String(x)).split(',').length>=5){\n        var ar = flow.get(\"OLD\"+String(x)).split(',');\n        ar.shift();\n        ar.push(String(msg.payload));\n        var n = 0;\n        for(i=0;i<ar.length;i++){\n            n+=parseInt(ar[i]);\n        }\n        n = n/ar.length;\n        flow.set(\"OLD\"+String(x),ar.toString());\n        msg.payload = n;\n        if(msg.payload.isNaN()){\n            msg.payload = null;\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":4080,"wires":[["90f94c38.1e358"]]},{"id":"97718dde.bfe4a","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":4020,"wires":[]},{"id":"3c90f244.03119e","type":"debug","z":"80eab637.b91808","g":"50aa5b6f.f7a464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":610,"y":4020,"wires":[]},{"id":"ba9b3d0e.3a76d","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2280,"y":440,"wires":[["154a1751.5bb239"]]},{"id":"5136bf02.72c61","type":"function","z":"51c3eae1.47d714","g":"f906b9e0.9c7f48","name":"SET","func":"flow.set(\"OLD1\",[]);\nflow.set(\"OLD2\",[]);\nflow.set(\"OLD3\",[]);\nflow.set(\"OLD4\",[]);\nflow.set(\"OLD5\",[]);\nflow.set(\"OLD6\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":3840,"wires":[["2ca8744c.43812c"]]},{"id":"18add830.2ae5f8","type":"inject","z":"51c3eae1.47d714","g":"f906b9e0.9c7f48","name":"SET","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":3840,"wires":[["5136bf02.72c61"]]},{"id":"5b2cb626.14bec8","type":"inject","z":"51c3eae1.47d714","g":"f906b9e0.9c7f48","name":"GET","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":3800,"wires":[["523cd224.28ff1c"]]},{"id":"523cd224.28ff1c","type":"function","z":"51c3eae1.47d714","g":"f906b9e0.9c7f48","name":"GET","func":"// msg.payload = flow.get(\"NUM\");\nvar arr = [];\narr.push(flow.get(\"OLD1\"));\narr.push(flow.get(\"OLD2\"));\narr.push(flow.get(\"OLD3\"));\narr.push(flow.get(\"OLD4\"));\narr.push(flow.get(\"OLD5\"));\narr.push(flow.get(\"OLD6\"));\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":3800,"wires":[["2ca8744c.43812c"]]},{"id":"2ca8744c.43812c","type":"debug","z":"51c3eae1.47d714","g":"f906b9e0.9c7f48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":420,"y":3840,"wires":[]},{"id":"861763a8.b993c","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER];","payloadType":"str","x":160,"y":2880,"wires":[[]]},{"id":"a62fd448.4913f8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":3240,"y":260,"wires":[["db3d03bf.472f4"]]},{"id":"d6823c7b.31bae","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM `PathName` WHERE `PathID` = 3 AND `PathNum` > 40","payload":"","payloadType":"date","x":3080,"y":260,"wires":[["a62fd448.4913f8"]]},{"id":"db3d03bf.472f4","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3430,"y":260,"wires":[]},{"id":"94c9449d.abf6f8","type":"function","z":"47ec9b6e.206e24","name":"SELECT UPDATED DATA","func":"var IDkapal = flow.get(\"IDKAPAL\");\nmsg.IDkapal = IDkapal;\nmsg.topic = \"SELECT * FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"';\";\n//msg.topic += \"SELECT `geofenceID`,`Main_Activity` FROM `PathName` WHERE `PathName`.`PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"') AND `PathName`.`PathNum` = (SELECT `PathNum` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"');\";\nmsg.topic += \"SELECT * FROM `PathName`;\";\nmsg.topic += \"SELECT * FROM `PathID` WHERE `PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"');\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3600,"y":660,"wires":[["1d95b10c.fcc79f"]]},{"id":"9ad82c70.74db8","type":"link out","z":"47ec9b6e.206e24","name":"","links":["8fe005da.ffda28"],"x":3845,"y":680,"wires":[]},{"id":"1d95b10c.fcc79f","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":3780,"y":640,"wires":[["9ad82c70.74db8","f8cb576.51dbca8"]]},{"id":"78f5213e.37545","type":"function","z":"47ec9b6e.206e24","name":"","func":"msg.payload = flow.get(\"PositionNow\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3150,"y":220,"wires":[["db3d03bf.472f4"]]},{"id":"ee9c9b42.199da8","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2980,"y":220,"wires":[["78f5213e.37545"]]},{"id":"75313db7.fab174","type":"inject","z":"47ec9b6e.206e24","name":"A1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"A1","payload":"","payloadType":"date","x":2090,"y":140,"wires":[["634a2ff6.e87e6"]]},{"id":"eca7fb68.eb1c88","type":"function","z":"47ec9b6e.206e24","name":"lastgeoid","func":"flow.set(\"lastgeoid\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2850,"y":100,"wires":[[]]},{"id":"993ceb73.34a1a8","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2690,"y":100,"wires":[["eca7fb68.eb1c88"]]},{"id":"267840c8.b3c05","type":"function","z":"47ec9b6e.206e24","name":"lastgeoid","func":"msg.payload = flow.get(\"lastgeoid\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2830,"y":140,"wires":[["cbc3852f.1d4818"]]},{"id":"8d192400.6f0fb","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2670,"y":140,"wires":[["267840c8.b3c05"]]},{"id":"cbc3852f.1d4818","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3060,"y":140,"wires":[]},{"id":"375e687.5fa5998","type":"function","z":"47ec9b6e.206e24","name":"","func":"var d = msg.payload;\n// d[\"geoID\"] = 20;\n// msg.payload = d;\n// if(d.geoID == flow.get(\"lastgeoid\")){\n//     msg.payload = null;\n// }else{\n//     flow.set(\"lastgeoid\",d.geoID);\n// }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2710,"y":560,"wires":[["31bf3b0.f7785c6"]]},{"id":"31bf3b0.f7785c6","type":"switch","z":"47ec9b6e.206e24","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2840,"y":580,"wires":[["fa39dd60.3b52b"]]},{"id":"aa2ed6b6.fa9db8","type":"inject","z":"47ec9b6e.206e24","name":"2","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-2.441458,\"lon\":114.912831,\"Time\":1650528171398}","payloadType":"str","x":2100,"y":500,"wires":[["b8c51cca.43e39"]]},{"id":"c326f269.cede2","type":"inject","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"IDkapal","v":"A1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":4020,"wires":[["db5aa5fa.19ff38"]]},{"id":"db5aa5fa.19ff38","type":"function","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","func":"flow.set(\"IDkapal\",msg.IDkapal);\nvar IDkapal = flow.get(\"IDkapal\");\nmsg.topic = \"SELECT `PathNum` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"';\";\nmsg.topic += \"SELECT `PathNum` FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `TaskID` WHERE `VID` = '\"+String(IDkapal)+\"') order by `PathNum` desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":4060,"wires":[["1873862.945c87a","19136a66.c484e6"]]},{"id":"1873862.945c87a","type":"mysql","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","mydb":"be353e7e.73b9d","name":"","x":390,"y":4040,"wires":[["f660835.cb98d8","6ceba51d.c9bc7c"]]},{"id":"241c50a6.6711","type":"link out","z":"47ec9b6e.206e24","name":"Donevmsroute","links":["5bbc959.078506c","6ff9b902.540c08"],"x":3315,"y":780,"wires":[]},{"id":"5bbc959.078506c","type":"link in","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","links":["241c50a6.6711"],"x":175,"y":3980,"wires":[["db5aa5fa.19ff38","9daceeb4.14475"]]},{"id":"9daceeb4.14475","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":340,"y":3980,"wires":[]},{"id":"78d7f4c8.c7416c","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":4040,"wires":[]},{"id":"f660835.cb98d8","type":"function","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","func":"var pn = msg.payload[0][0].PathNum;\nvar pn2 = (msg.payload[1][0].PathNum/2)+1;\nvar pn3 = msg.payload[1][0].PathNum;\nvar epoch = msg.newvmsroute.epoch*1000000;\nmsg.epoch = epoch;\nif(pn==1){\n    flow.set(\"pathnum\"+msg.IDkapal,pn);\n    msg.payload = null;\n}\nif(pn>1){\n    if(flow.get(\"datprev\"+String(msg.IDkapal)).ROBprev>3){\n        if(flow.get(\"datmid\"+String(msg.IDkapal)).ROBmid>3){\n            if(flow.get(\"dataft\"+String(msg.IDkapal)).ROBaft>3){\n                msg.payload = null;\n            }else{\n                if(pn == pn3){\n                    msg.query = \"\";\n                    msg.query += \"SELECT Liter FROM F1LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                    msg.query += \"SELECT Liter FROM F3LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                    msg.query += \"SELECT Liter FROM F4LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                    msg.query += \"SELECT Liter FROM F5LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                    msg.payload = \"aft\";\n                }else{\n                    msg.payload = null;\n                }\n            }\n        }else{\n            if(pn == pn2){\n                msg.query = \"\";\n                msg.query += \"SELECT Liter FROM F1LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                msg.query += \"SELECT Liter FROM F3LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                msg.query += \"SELECT Liter FROM F4LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                msg.query += \"SELECT Liter FROM F5LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n                msg.payload = \"mid\";\n            }else{\n                msg.payload = null; \n            }\n        }\n    }else{\n        msg.query = \"\";\n        msg.query += \"SELECT Liter FROM F1LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n        msg.query += \"SELECT Liter FROM F3LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n        msg.query += \"SELECT Liter FROM F4LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n        msg.query += \"SELECT Liter FROM F5LiterApr where time <= \"+String(epoch)+\" limit 1;\";\n        msg.payload = \"prev\";\n    }\n}else{\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4060,"wires":[["df2d3c57.1b156","53c14aea.824a34","e348418c.bca25","8fbe45e4.641ad8"]]},{"id":"7bcd6e86.4a753","type":"influxdb in","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":750,"y":4060,"wires":[["6964a39f.cd2b1c","d69742e3.df8b4"]]},{"id":"6964a39f.cd2b1c","type":"function","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","func":"var d = msg.payload;\nvar prev = flow.get(\"datprev\"+String(msg.IDkapal));\nvar n = 0;\nfor(i=0;i<d.results.length;i++){\n    n+=d.results[i].series[0].values[0][1];\n}\nprev[\"ROBprev\"] = n;\nprev[\"epochprev\"] = msg.epoch;\nflow.set(\"datprev\"+String(msg.IDkapal),prev);\nmsg.payload = prev;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":4040,"wires":[["78d7f4c8.c7416c"]]},{"id":"df2d3c57.1b156","type":"switch","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"prev","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"prev","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":4040,"wires":[["7bcd6e86.4a753"]]},{"id":"53c14aea.824a34","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":600,"y":3980,"wires":[]},{"id":"6ceba51d.c9bc7c","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":3940,"wires":[]},{"id":"d5d93666.976e58","type":"function","z":"51c3eae1.47d714","g":"b3621802.efa748","name":"set","func":"flow.set(\"dataftA1\",{\"ROBaft\":0});\nflow.set(\"datmidA1\",{\"ROBmid\":0});\nflow.set(\"datprevA1\",{\"ROBprev\":0});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":4280,"wires":[["889c4dd1.c0d73"]]},{"id":"6b7abe3c.230f7","type":"inject","z":"51c3eae1.47d714","g":"b3621802.efa748","name":"SETFLOW","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":4280,"wires":[["d5d93666.976e58"]]},{"id":"948b645f.17baf8","type":"inject","z":"47ec9b6e.206e24","name":"0","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-2.304253,\"lon\":114.870225,\"Time\":1650528171394}","payloadType":"str","x":2100,"y":420,"wires":[["b8c51cca.43e39"]]},{"id":"889c4dd1.c0d73","type":"debug","z":"51c3eae1.47d714","g":"b3621802.efa748","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":4300,"wires":[]},{"id":"d69742e3.df8b4","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":870,"y":3960,"wires":[]},{"id":"68f46b7e.a57be4","type":"function","z":"51c3eae1.47d714","g":"b3621802.efa748","name":"get","func":"msg.payload = [flow.get(\"datprevA1\"),flow.get(\"datmidA1\"),flow.get(\"dataftA1\")];\n// var arr = [];\n// arr.push(Math.round(msg.payload[0].epochprev/1000000));\n// arr.push(Math.round(msg.payload[1].epochmid/1000000));\n// arr.push(Math.round(msg.payload[2].epochaft/1000000));\n// msg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":4320,"wires":[["889c4dd1.c0d73"]]},{"id":"370cad5f.8f0f42","type":"inject","z":"51c3eae1.47d714","g":"b3621802.efa748","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":151,"y":4334,"wires":[["68f46b7e.a57be4"]]},{"id":"19136a66.c484e6","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":400,"y":4120,"wires":[]},{"id":"e348418c.bca25","type":"switch","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"mid","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"mid","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":4100,"wires":[["32705e2c.dba942"]]},{"id":"32705e2c.dba942","type":"influxdb in","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":750,"y":4120,"wires":[["276c502e.3eb7f"]]},{"id":"276c502e.3eb7f","type":"function","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","func":"var d = msg.payload;\nvar mid = flow.get(\"datmid\"+String(msg.IDkapal));\nvar n = 1;\nfor(i=0;i<d.results.length;i++){\n    n+=d.results[i].series[0].values[0][1];\n}\nmid[\"ROBmid\"] = n;\nmid[\"epochmid\"] = msg.epoch;\nflow.set(\"datmid\"+String(msg.IDkapal),mid);\nmsg.payload = mid;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":4100,"wires":[["f5d6770f.637f18"]]},{"id":"f5d6770f.637f18","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":4100,"wires":[]},{"id":"8fbe45e4.641ad8","type":"switch","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"aft","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"aft","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":4160,"wires":[["ca10c5b6.f19578"]]},{"id":"ca10c5b6.f19578","type":"influxdb in","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":750,"y":4180,"wires":[["8dc7e991.44ce58"]]},{"id":"8dc7e991.44ce58","type":"function","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":" ","func":"var d = msg.payload;\nvar aft = flow.get(\"dataft\"+String(msg.IDkapal));\nvar n = 2;\nfor(i=0;i<d.results.length;i++){\n    n+=d.results[i].series[0].values[0][1];\n}\naft[\"ROBaft\"] = n;\naft[\"epochaft\"] = msg.epoch;\nflow.set(\"dataft\"+String(msg.IDkapal),aft);\nmsg.payload = aft;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":4160,"wires":[["cd3f7edc.596f5"]]},{"id":"cd3f7edc.596f5","type":"debug","z":"51c3eae1.47d714","g":"7b7edc02.424ab4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":4160,"wires":[]},{"id":"8d430b75.2071e8","type":"inject","z":"47ec9b6e.206e24","name":"mid","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-3.751394,\"lon\":114.506351,\"Time\":1650528171399}","payloadType":"str","x":2100,"y":540,"wires":[["b8c51cca.43e39"]]},{"id":"c9b0cbb8.1e3d58","type":"inject","z":"47ec9b6e.206e24","name":"3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-2.441458,\"lon\":114.912831,\"Time\":1650528171400}","payloadType":"str","x":2040,"y":580,"wires":[["b8c51cca.43e39"]]},{"id":"990d283c.5bfa48","type":"inject","z":"47ec9b6e.206e24","name":"aft","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-2.352643,\"lon\":114.888279,\"Time\":1650528171401}","payloadType":"str","x":2100,"y":620,"wires":[["b8c51cca.43e39"]]},{"id":"ff93b76c.77e998","type":"inject","z":"fdac93f7.bec1b","name":"AMBILROB","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":4060,"wires":[["a093c077.06fd7"]]},{"id":"a093c077.06fd7","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.query = \"\";\n\nvar bfr = 1653198851345000000;\nvar aft = 1653228240000000000;\nmsg.query += \"SELECT * FROM F1LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time asc limit 1;\";\nmsg.query += \"SELECT * FROM F3LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time asc limit 1;\";\nmsg.query += \"SELECT * FROM F4LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time asc limit 1;\";\nmsg.query += \"SELECT * FROM F5LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time asc limit 1;\";\n\nmsg.query += \"SELECT * FROM F1LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time desc limit 1;\";\nmsg.query += \"SELECT * FROM F3LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time desc limit 1;\";\nmsg.query += \"SELECT * FROM F4LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time desc limit 1;\";\nmsg.query += \"SELECT * FROM F5LiterApr where time >= \"+String(bfr)+\" AND time <= \"+String(aft)+\" order by time desc limit 1;\";\n\n// msg.query += \"SELECT MEAN(RP1) FROM RPM1F where time >= 1649663867033000000 AND time <= 1650114177882402000;\";\n// msg.query += \"SELECT MEAN(RP2) FROM RPM2F where time >= 1649663867033000000 AND time <= 1650114177882402000;\";\n\n// msg.query += \"SELECT RP1 FROM RPM1F where time >= 1649663867033000000 AND time <= 1650114177882402000 order by time desc limit 1;\";\n// msg.query += \"SELECT RP2 FROM RPM2F where time >= 1649663867033000000 AND time <= 1650114177882402000 order by time desc limit 1;\";\nmsg.payload = msg.query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":4060,"wires":[["2c63f418.3d64fc","dc0ec22a.32082"]]},{"id":"6ebaf2d8.89180c","type":"excel","z":"fdac93f7.bec1b","name":"","file":"/var/www/html/vmsroute.xlsx","x":1150,"y":1380,"wires":[["7378e2b2.1a086c"]]},{"id":"c53913ff.3426","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM VMS_Route","payload":"","payloadType":"date","x":920,"y":1320,"wires":[["804667a0.a9da08"]]},{"id":"804667a0.a9da08","type":"mysql","z":"fdac93f7.bec1b","mydb":"be353e7e.73b9d","name":"","x":950,"y":1380,"wires":[["6ebaf2d8.89180c"]]},{"id":"7378e2b2.1a086c","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1220,"y":1300,"wires":[]},{"id":"dc0ec22a.32082","type":"influxdb in","z":"fdac93f7.bec1b","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":500,"y":4060,"wires":[["3ccab73e.293cb8","a960512a.d2b92"]]},{"id":"ed75fe94.61ebc","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":850,"y":4040,"wires":[]},{"id":"a960512a.d2b92","type":"function","z":"fdac93f7.bec1b","name":" ","func":"var d = msg.payload.results;\nvar bfr = 0;\nvar aft = 0;\nfor(i=0;i<4;i++){\n    bfr+=d[i].series[0].values[0][1];\n}\nfor(i=4;i<8;i++){\n    aft+=d[i].series[0].values[0][1];\n}\n// for(i=8;i<10;i++){\n//     rpmavr += d[i].series[0].values[0][1];\n// }\n// for(i=10;i<12;i++){\n//     rpmnow += d[i].series[0].values[0][1];\n// }\n// rpmavr = rpmavr/2;\nmsg.payload = [bfr,aft,Math.abs(aft-bfr),d];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":4060,"wires":[["ed75fe94.61ebc"]]},{"id":"faf32380.b6844","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER];","payloadType":"str","x":250,"y":4160,"wires":[[]]},{"id":"e9756182.e90af","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":560,"y":4160,"wires":[]},{"id":"7a233714.b4afb8","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":500,"y":3040,"wires":[["4aefae92.5f5c4"]]},{"id":"4aefae92.5f5c4","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","func":"// msg.payload = flow.get(\"datprevA1\");\nmsg.payload = flow.get(\"SPEEDMBP3222KM\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":3040,"wires":[["4f37c500.a7524c"]]},{"id":"4f37c500.a7524c","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":740,"y":3080,"wires":[]},{"id":"ce5bc7c5.9f5798","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":150,"y":4540,"wires":[]},{"id":"3b7aaded.5f8172","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SendReport","payload":"SendReport","payloadType":"str","x":250,"y":4000,"wires":[["21d5b624.6c8e4a"]]},{"id":"21d5b624.6c8e4a","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"SendReport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":530,"y":4000,"wires":[]},{"id":"461ca32.44dbf5c","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":3860,"wires":[]},{"id":"34baa418.eb214c","type":"debug","z":"51c3eae1.47d714","g":"744515a6.e4a4bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":500,"y":2680,"wires":[]},{"id":"610460d9.05eb8","type":"link in","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","links":["b4aa1b51.6cdf98"],"x":598,"y":3520,"wires":[["21213d0d.b055d2"]]},{"id":"ba174895.685028","type":"link out","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","links":["fc64cf29.d3f6c"],"x":1458,"y":3460,"wires":[]},{"id":"96d26277.7654f","type":"inject","z":"47ec9b6e.206e24","name":"aft dummy","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"lat\":-3.631743,\"lon\":114.479874,\"Time\":1652753399485}","payloadType":"str","x":2110,"y":660,"wires":[["b8c51cca.43e39"]]},{"id":"f8cb576.51dbca8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3930,"y":600,"wires":[]},{"id":"852abc1a.dda91","type":"inject","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":3060,"wires":[["7ea713f3.ad178c"]]},{"id":"7ea713f3.ad178c","type":"function","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":" ","func":"msg.payload = flow.get(\"Bunker\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":3060,"wires":[["94ac6bb.ee84498"]]},{"id":"4707b4fa.c4e5ac","type":"function","z":"47ec9b6e.206e24","name":"Take Geofence","func":"var data = msg.payload;\nflow.set(\"latlon\",data);\nmsg.topic = \"SELECT * FROM `Geofence`\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3960,"y":960,"wires":[["f534e665.90e888"]]},{"id":"f534e665.90e888","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":4130,"y":960,"wires":[["fb852cd7.bd012"]]},{"id":"fb852cd7.bd012","type":"function","z":"47ec9b6e.206e24","name":"Proses","func":"var data = msg.payload;\nvar latlon = flow.get(\"latlon\");\nvar array4 = [];\nvar array2 = [];\nvar lat = latlon.Lat;\nvar long = latlon.Lon;\nvar time = Date.now()\nfor(i=0;i<data.length;i++){\n    if(data[i].lat3==null){\n        array2.push(data[i]);\n    }else{\n        array4.push(data[i]);\n    }\n}\n// msg.payload = [array2,array4];\nfor(i=0;i<array2.length;i++){\n    var maxlat2 = Math.max(array2[i].lat1,array2[i].lat2)+(0.050);\n    var minlat2 = Math.min(array2[i].lat1,array2[i].lat2)-(0.050);\n    var maxlong2 = Math.max(array2[i].long1,array2[i].long2);\n    var minlong2 = Math.min(array2[i].long1,array2[i].long2);\n    if(lat<maxlat2 && lat>minlat2 && long<maxlong2 && long>minlong2){\n        //msg.payload = array4[i].geofenceName;\n        time = Date.now();\n        msg.payload = {Time:time, geoID:array2[i].geofenceID, \"Gname\": array4[i].geofenceName, \"lat\":lat, \"long\":long};\n        return msg;\n        \n    }\n}\n\nfor(i=0;i<array4.length;i++){\n    var maxlat = Math.max(array4[i].lat1,array4[i].lat2,array4[i].lat3,array4[i].lat4);\n    var minlat = Math.min(array4[i].lat1,array4[i].lat2,array4[i].lat3,array4[i].lat4);\n    var maxlong = Math.max(array4[i].long1,array4[i].long2,array4[i].long3,array4[i].long4);\n    var minlong = Math.min(array4[i].long1,array4[i].long2,array4[i].long3,array4[i].long4);\n    if(lat<maxlat && lat>minlat && long<maxlong && long>minlong){\n        //msg.payload = array4[i].geofenceName;\n        time = Date.now();\n        msg.payload = {\"Time\":time, \"geoID\":array4[i].geofenceID, \"Gname\": array4[i].geofenceName, \"lat\":lat, \"logn\":long};\n        return msg;\n        \n    }\n}\n\n\nmsg.payload = null;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4260,"y":960,"wires":[["3f5d87aa.7f20c8"]]},{"id":"1af5c4aa.1ce3db","type":"inject","z":"47ec9b6e.206e24","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"-2.289894,114.868709","payload":"{\"Lat\":-2.289894, \"Lon\":114.868709}","payloadType":"str","x":3760,"y":940,"wires":[["2165fee6.19c902","ba31949f.5c8348"]]},{"id":"2165fee6.19c902","type":"json","z":"47ec9b6e.206e24","name":"","property":"payload","action":"","pretty":false,"x":3810,"y":980,"wires":[["4707b4fa.c4e5ac"]]},{"id":"3f5d87aa.7f20c8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4440,"y":960,"wires":[]},{"id":"ba31949f.5c8348","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3900,"y":900,"wires":[]},{"id":"a1c2d5eb.5f5778","type":"subflow:e9b71a55.b25c68","z":"51c3eae1.47d714","g":"a784c1.5adc1b4","name":"","x":150,"y":3220,"wires":[["f15cc82d.168958"],[]]},{"id":"6b08606e.9de6f","type":"influxdb out","z":"51c3eae1.47d714","g":"a784c1.5adc1b4","influxdb":"76f4cea2.88ada","name":"imovee","measurement":"imovee","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":460,"y":3200,"wires":[]},{"id":"bcfd55da.6724d8","type":"debug","z":"51c3eae1.47d714","g":"a784c1.5adc1b4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":380,"y":3240,"wires":[]},{"id":"69b31542.5fa73c","type":"inject","z":"51c3eae1.47d714","g":"a784c1.5adc1b4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"abc\":1}","payloadType":"json","x":220,"y":3260,"wires":[["bcfd55da.6724d8"]]},{"id":"f15cc82d.168958","type":"function","z":"51c3eae1.47d714","g":"a784c1.5adc1b4","name":"","func":"var d = msg.payload;\nd[\"TIME_START\"] = Date.parse(d[\"TIME_START\"]);\nd[\"TIME_COMPLETE\"] = Date.parse(d[\"TIME_COMPLETE\"]);\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":3200,"wires":[["bcfd55da.6724d8","6b08606e.9de6f"]]},{"id":"ce2078c9.9f3728","type":"debug","z":"51c3eae1.47d714","g":"f8df85a6.93ccb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":470,"y":3000,"wires":[]},{"id":"59c48dcd.271034","type":"function","z":"47ec9b6e.206e24","name":"","func":"delete msg.payload['Gname'];\ndelete msg.payload['lat'];\ndelete msg.payload['long'];\nmsg.payload['Time'] = parseInt(msg.payload.Time);\nmsg.payload['time'] = parseInt(msg.payload.Time);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":480,"wires":[["2fdcbff6.24e53","4e23ea60.7f25a4"]]},{"id":"4e23ea60.7f25a4","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3290,"y":420,"wires":[]},{"id":"3ccab73e.293cb8","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":4100,"wires":[]},{"id":"2c63f418.3d64fc","type":"debug","z":"fdac93f7.bec1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":4100,"wires":[]},{"id":"a1e7bd1c.82cd4","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":4500,"wires":[]},{"id":"65ec51f5.fc126","type":"mqtt out","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","topic":"ToLaptop","qos":"","retain":"","broker":"4803b37b.b88cfc","x":500,"y":4440,"wires":[]},{"id":"33c599f8.0e77b6","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"SELECT * FROM Fuel order by time desc limit 1;","payloadType":"str","x":310,"y":3880,"wires":[["431d44dc.ebbeec","461ca32.44dbf5c"]]},{"id":"b098e98.7594318","type":"inject","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"select data lebih dari 20 april","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"SELECT * FROM Fuel WHERE time > 1650412800000000000 order by time asc;","payloadType":"str","x":180,"y":4300,"wires":[["d33c572b.f58b98"]]},{"id":"bd53d0ac.e0802","type":"inject","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"cek 20 data fuel","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"SELECT * FROM Fuel order by time desc limit 20;","payloadType":"str","x":200,"y":4340,"wires":[["86e11661.ef4598"]]},{"id":"86e11661.ef4598","type":"mqtt out","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","topic":"influxquery","qos":"","retain":"","broker":"4803b37b.b88cfc","x":630,"y":4300,"wires":[]},{"id":"32eb0e13.80bf32","type":"inject","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"show measurements","payloadType":"str","x":190,"y":4260,"wires":[["86e11661.ef4598"]]},{"id":"fe949a2d.10fe88","type":"mqtt in","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","topic":"ToLaptop22","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":150,"y":4620,"wires":[["d9a130b2.b06ed"]]},{"id":"d9a130b2.b06ed","type":"json","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","property":"payload","action":"","pretty":false,"x":310,"y":4620,"wires":[["12d08b25.7f5995","fc08e0fe.be313"]]},{"id":"4c24fb7c.fdb824","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":650,"y":4680,"wires":[]},{"id":"12d08b25.7f5995","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"var d = msg.payload[0];\nvar d2 = msg.payload[1];\nvar d3 = msg.payload[2];\nvar df = flow.get(\"DataFUEL\");\nvar arr = [];\nvar json = {};\nvar ti = parseInt(String(d[0].time)); //2 menit = 120000000000, 5 menit = 300000000000, 10 menit = 600000000000\nvar inc = 600000000000;\nfor(i=0;i<d.length;i++){\n    // if(Math.abs(d[i].time-d2[i].time))\n    if(d[i].time>=ti && d[i].time<=ti+inc){\n        json[String(d[i].deviceID)] = d[i].min;\n        // json[String(d3[i].deviceID)] = d3[i].rpm;\n        // json['LAT'] = d2[i].latitude;\n        // json['LON'] = d2[i].longitude;\n    }else{\n        json['time'] = ti;\n        arr.push(json);\n        json={};\n        ti+=inc;\n    }\n}\nmsg.payload = arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":4640,"wires":[["17dccdbf.856182","349f0798.bf8d68"]]},{"id":"8449b7b7.569a48","type":"inject","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":4720,"wires":[["34264e4e.a6a7f2"]]},{"id":"34264e4e.a6a7f2","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"flow.set(\"DataFUEL\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":4780,"wires":[[]]},{"id":"fc08e0fe.be313","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":480,"y":4580,"wires":[]},{"id":"a876d3c7.104a6","type":"inject","z":"fdac93f7.bec1b","d":true,"g":"ac1a35ff.d8c228","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"SELECT * FROM Fuel where time > 1653957906548420000;","payloadType":"str","x":170,"y":4380,"wires":[["86e11661.ef4598"]]},{"id":"e4ccb.f6cb6335","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"ToLaptopExcel","qos":"","retain":"","broker":"4803b37b.b88cfc","x":640,"y":4980,"wires":[]},{"id":"349f0798.bf8d68","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"var d = msg.payload;\nfor(i=0;i<d.length;i++){\n    if(d[i].FS001 == null){\n        d[i]['FS001'] = d[i-1].FS001;\n    }\n    if(d[i].FS002 == null){\n        d[i]['FS002'] = d[i-1].FS002;\n    }\n    if(d[i].FS003 == null){\n        d[i]['FS003'] = d[i-1].FS003;\n    }\n    if(d[i].FS004 == null){\n        d[i]['FS004'] = d[i-1].FS004;\n    }\n    if(d[i].FS005 == null){\n        d[i]['FS005'] = d[i-1].FS005;\n    }\n    if(d[i].FS006 == null){\n        d[i]['FS006'] = d[i-1].FS006;\n    }\n    // if(d[i].RP001 == null){\n    //     d[i]['RP001'] = d[i-1].RP001;\n    // }\n    // if(d[i].RP002 == null){\n    //     d[i]['RP002'] = d[i-1].RP002;\n    // }\n    // if(d[i].RP005 == null){\n    //     d[i]['RP005'] = d[i-1].RP005;\n    // }\n    // if(d[i].RP008 == null){\n    //     d[i]['RP008'] = d[i-1].RP008;\n    // }\n    // d[i]['RPMENGINE'] = Math.round((d[i].RP001 + d[i].RP002)/2);\n    // d[i]['RPMPROP'] = Math.round((d[i].RP005 + d[i].RP008)/2);\n    // delete d[i]['RP001'];\n    // delete d[i]['RP002'];\n    // delete d[i]['RP005'];\n    // delete d[i]['RP008'];\n}\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":4700,"wires":[["4c24fb7c.fdb824","eecdad4b.3e2a9"]]},{"id":"17dccdbf.856182","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":4620,"wires":[]},{"id":"eecdad4b.3e2a9","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"var d = msg.payload;\nmsg.RES = d;\nmsg.topic = \"\";\nfor(i=0;i<d.length;i++){\n    msg.topic += \"SELECT `Liter` FROM `FS001Jan` WHERE `Value` = \"+String(Math.round(d[i].FS001/2))+\";\"\n    // msg.topic += \"SELECT `Liter` FROM `FS002Jan` WHERE `Value` = \"+String(Math.round(d[i].FS002/2))+\";\"\n    msg.topic += \"SELECT `Liter` FROM `FS003Jan` WHERE `Value` = \"+String(Math.round(d[i].FS003/2))+\";\"\n    msg.topic += \"SELECT `Liter` FROM `FS4Nov` WHERE `Value` = \"+String(Math.round(d[i].FS004/2))+\";\"\n    msg.topic += \"SELECT `Liter` FROM `FS5Nov` WHERE `Value` = \"+String(Math.round(d[i].FS005/2))+\";\"\n    // msg.topic += \"SELECT `Liter` FROM `FS006Jan` WHERE `Value` = \"+String(Math.round(d[i].FS006/2))+\";\"\n}\n\nreturn msg;\n\n// msg.topic += \"SELECT `Liter` FROM `FS001Jan` WHERE `Value` = \n// msg.topic += \"SELECT `Liter` FROM `FS002Jan` WHERE `Value` = \n// msg.topic += \"SELECT `Liter` FROM `FS003Jan` WHERE `Value` = \n// msg.topic += \"SELECT `Liter` FROM `FS4Nov` WHERE `Value` = \n// msg.topic += \"SELECT `Liter` FROM `FS5Nov` WHERE `Value` = \n// msg.topic += \"SELECT `Liter` FROM `FS006Jan` WHERE `Value` = ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":4840,"wires":[["98075c0a.8321c","66f2cbe.9c4a934"]]},{"id":"d33c572b.f58b98","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"var d  = \"\";\nd+=\"SELECT * FROM Fuel WHERE time > 1650412800000000000 order by time asc;\";\nd+=\"SELECT * FROM GPS WHERE time > 1650412800000000000 order by time asc limit 1000;\";\nd+=\"SELECT * FROM RPM WHERE time > 1650412800000000000 order by time asc limit 1000;\";\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":4300,"wires":[["86e11661.ef4598"]]},{"id":"66f2cbe.9c4a934","type":"mysql","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","mydb":"be353e7e.73b9d","name":"","x":250,"y":4920,"wires":[["4b39e7ad.cddd48","4099a982.c4b4a8"]]},{"id":"b4c00a91.094ca8","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":4880,"wires":[]},{"id":"98075c0a.8321c","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":530,"y":4800,"wires":[]},{"id":"4099a982.c4b4a8","type":"function","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","func":"var d = msg.payload;\nvar RES = msg.RES;\nvar rob = 0;\nvar num = 0;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    if(i%4 || i==0){\n        var a = 0;\n    }else{\n        arr.push(rob);\n        rob=0;\n    }\n    try{\n        rob+=d[i][0].Liter;\n    }\n    catch(x){\n        var b = 0;\n    }\n}\nfor(i=0;i<arr.length;i++){\n    RES[i]['ROB'] = arr[i];\n    delete RES[i]['FS001'];\n    delete RES[i]['FS002'];\n    delete RES[i]['FS003'];\n    delete RES[i]['FS004'];\n    delete RES[i]['FS005'];\n    delete RES[i]['FS006'];\n}\nmsg.payload = RES;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":4920,"wires":[["b4c00a91.094ca8"]]},{"id":"4b39e7ad.cddd48","type":"debug","z":"fdac93f7.bec1b","g":"ac1a35ff.d8c228","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":4860,"wires":[]},{"id":"581da82d.38a018","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"deviceID\":\"FS001\",\"min\":1242},{\"deviceID\":\"FS002\",\"min\":124}]","payloadType":"str","x":850,"y":1080,"wires":[["9c1a5f75.3daba"]]},{"id":"6e98c1a1.71469","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1140,"y":1020,"wires":[]},{"id":"9c1a5f75.3daba","type":"json","z":"fdac93f7.bec1b","name":"","property":"payload","action":"","pretty":false,"x":1020,"y":1120,"wires":[["6e98c1a1.71469"]]},{"id":"ee68bd8b.dbdd","type":"debug","z":"51c3eae1.47d714","g":"10f315b3.5886da","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":3460,"wires":[]},{"id":"f0394e92.a5f14","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"WhatsAppNotif","qos":"","retain":"","broker":"3df154b8.35094c","x":4880,"y":200,"wires":[]},{"id":"b57baa33.2a62a8","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"3","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":100,"wires":[["aa5a012b.26c81","993358fc.9db608"]]},{"id":"aa5a012b.26c81","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":100,"wires":[["402ef1a7.a572b"]]},{"id":"16882065.ef763","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"6","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":140,"wires":[["21dafe16.db13c2"]]},{"id":"21a2d215.b80f0e","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"12","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":180,"wires":[["b717672e.86ff28"]]},{"id":"f91f4a0a.1719d8","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"24","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":220,"wires":[["d47b9e85.981e4"]]},{"id":"21dafe16.db13c2","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":140,"wires":[["ab210ed3.c23b9"]]},{"id":"b717672e.86ff28","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":180,"wires":[["9d22acdc.7063d"]]},{"id":"d47b9e85.981e4","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":220,"wires":[["c86b65.e4743498"]]},{"id":"402ef1a7.a572b","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 3 hour\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":100,"wires":[["f0394e92.a5f14"]]},{"id":"f03fad15.73007","type":"switch","z":"fdac93f7.bec1b","name":"A1?","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"A1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4270,"y":220,"wires":[["b57baa33.2a62a8","16882065.ef763","21a2d215.b80f0e","f91f4a0a.1719d8","ccacaad8.a25478","8c09e115.27e1d","71e01a93.265224","ffcb363f.efaf48"]]},{"id":"ab210ed3.c23b9","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 6 hour\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":140,"wires":[["f0394e92.a5f14"]]},{"id":"9d22acdc.7063d","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 12 hour\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":180,"wires":[["f0394e92.a5f14"]]},{"id":"c86b65.e4743498","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 1 day\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":220,"wires":[["f0394e92.a5f14"]]},{"id":"71533a81.973c84","type":"function","z":"e9b71a55.b25c68","name":"GiveLength","func":"msg.payload = flow.get(\"limit\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":240,"wires":[[]]},{"id":"ded9a71e.12cc58","type":"inject","z":"80eab637.b91808","name":"Contoh Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"Time\":\"1654700252572\",\"Lat\":\"-2.538289\",\"Lon\":\"114.847844\",\"WS\":\"2\",\"Sat\":\"-1\",\"Fuel\":{\"F1\":\"916\",\"F2\":\"918\",\"F3\":\"912\",\"F4\":\"2298\",\"F5\":\"2401\",\"F6\":\"855\"},\"RPM\":{\"R1\":\"300\",\"R2\":\"0\"},\"Propeller\":{\"R5\":\"740\",\"R8\":\"651\"}}","payloadType":"str","x":130,"y":3400,"wires":[["25ab0778.626588"]]},{"id":"edd8861b.196358","type":"inject","z":"80eab637.b91808","name":"Contoh Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1654700099747,\"lat\":\"-2.540209\",\"lon\":\"114.847253\",\"ws\":\"2\",\"sat\":\"-1\",\"F1\":\"863\",\"F2\":\"937\",\"F3\":\"914\",\"F4\":\"2309\",\"F5\":\"2588\",\"F6\":\"892\",\"RP1\":\"300\",\"RP2\":\"0\",\"RP5\":\"737\",\"RP8\":\"649\"}","payloadType":"json","x":130,"y":3440,"wires":[["955a99f1.5b7e48"]]},{"id":"913e633.6963fa","type":"trigger","z":"80eab637.b91808","name":"","op1":"1","op2":"","op1type":"str","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":380,"y":3480,"wires":[["29f7f210.77b7be"]]},{"id":"2734d4ff.c7512c","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":220,"y":3480,"wires":[["913e633.6963fa"]]},{"id":"29f7f210.77b7be","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":3500,"wires":[]},{"id":"5c113075.1eba6","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"str","x":230,"y":3520,"wires":[["913e633.6963fa"]]},{"id":"33ab4721.624238","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"python print.py","payloadType":"str","x":1150,"y":120,"wires":[["749a66d9.2aa608"]]},{"id":"749a66d9.2aa608","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"CommandTerminal","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1410,"y":120,"wires":[]},{"id":"e2e58225.f24a9","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"CommandTerminal2","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":1320,"y":200,"wires":[["5897a66c.cd01d8"]]},{"id":"5897a66c.cd01d8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1590,"y":220,"wires":[]},{"id":"2cc26124.e07dee","type":"mqtt in","z":"80eab637.b91808","name":"","topic":"fixingdataget","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":430,"y":3220,"wires":[["f5d3ea1c.5a7858"]]},{"id":"cee8a0e8.fc7ae","type":"mqtt out","z":"80eab637.b91808","name":"","topic":"fixingdatasend","qos":"","retain":"","broker":"4803b37b.b88cfc","x":420,"y":3180,"wires":[]},{"id":"3b886046.cacc4","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1654833600000","payloadType":"str","x":110,"y":3200,"wires":[["d8880d9d.d9e4b"]]},{"id":"d8880d9d.d9e4b","type":"function","z":"80eab637.b91808","name":"TakeData","func":"var time = 1654867982920;\nvar time2 = 1655026615776;\nmsg.topic = \"SELECT * FROM `reportdata` WHERE `Time` > \";\nmsg.topic += String(time);\n// msg.topic += \" AND `Time` < \"+String(time2);\nmsg.topic += \";\";\nmsg.payload = msg.topic;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":3200,"wires":[["cee8a0e8.fc7ae"]]},{"id":"cca05c0b.442e2","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":3200,"wires":[]},{"id":"f5d3ea1c.5a7858","type":"json","z":"80eab637.b91808","name":"","property":"payload","action":"","pretty":false,"x":570,"y":3200,"wires":[["c6abcb94.7b78a8"]]},{"id":"c6abcb94.7b78a8","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/fixingdata.xlsx","x":690,"y":3200,"wires":[["a96497b8.0764a8"]]},{"id":"7e36e61a.ff2bc8","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT lat AS Lat,lon AS Lon,time AS Time,F1,F2,F3,F4,F5,F6,RP1 AS R1,RP2 AS R2,RP5 AS R5,RP8 AS R8,sat AS Sat,ws AS WS FROM fromoffline WHERE time >= 1654775986287","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"1654775986287,1654722299968","payload":"","payloadType":"date","x":110,"y":3280,"wires":[["6faf8b13.a9a844"]]},{"id":"6faf8b13.a9a844","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":360,"y":3280,"wires":[["a1a957b6.abaac8"]]},{"id":"8c478b75.2c7438","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":870,"y":3280,"wires":[]},{"id":"a1a957b6.abaac8","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3280,"wires":[["56f1df03.67f7d"]]},{"id":"ab7e9d0c.3887f","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/fixingdatainflux.xlsx","x":710,"y":3280,"wires":[["8c478b75.2c7438"]]},{"id":"a96497b8.0764a8","type":"function","z":"80eab637.b91808","name":"","func":"//F1LiterMei\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3200,"wires":[["cca05c0b.442e2"]]},{"id":"ccacaad8.a25478","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"36","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":260,"wires":[["b9a03551.eca888"]]},{"id":"b9a03551.eca888","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":260,"wires":[["f76f0f04.cfe53"]]},{"id":"f76f0f04.cfe53","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 1 day 12 hours\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":260,"wires":[["f0394e92.a5f14"]]},{"id":"8c09e115.27e1d","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"48","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":300,"wires":[["ad60af25.0cf73"]]},{"id":"ad60af25.0cf73","type":"switch","z":"fdac93f7.bec1b","name":"0?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":300,"wires":[["6de3be99.a7dca"]]},{"id":"6de3be99.a7dca","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Off - 2 day\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":300,"wires":[["f0394e92.a5f14"]]},{"id":"25ab0778.626588","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":470,"y":3420,"wires":[]},{"id":"955a99f1.5b7e48","type":"function","z":"80eab637.b91808","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":3440,"wires":[["25ab0778.626588"]]},{"id":"e42a5396.e1313","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/MBP3206Data.xlsx","x":710,"y":3340,"wires":[["8c478b75.2c7438"]]},{"id":"26f03c9c.e8a834","type":"function","z":"80eab637.b91808","d":true,"name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3380,"wires":[["e42a5396.e1313"]]},{"id":"85e4fff5.45c5e","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":360,"y":3340,"wires":[["26f03c9c.e8a834","439aa3ab.80a5ac","442447bc.ec7058","bb3d7e27.127f6"]]},{"id":"e7ece48a.08ffa8","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM fromoffline","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":3300,"wires":[["85e4fff5.45c5e"]]},{"id":"18256ea4.dd3911","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1655182704000,\"data\":4}","payloadType":"json","x":240,"y":3580,"wires":[["438ecdac.7b7924"]]},{"id":"438ecdac.7b7924","type":"influxdb out","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","measurement":"testepo","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":560,"y":3580,"wires":[]},{"id":"993358fc.9db608","type":"switch","z":"fdac93f7.bec1b","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":60,"wires":[["53ba480f.500308"]]},{"id":"53ba480f.500308","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Back Online\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4710,"y":60,"wires":[["f0394e92.a5f14"]]},{"id":"1e02a385.8fbd7c","type":"link in","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","links":["8982ca28.b605c8"],"x":55,"y":1380,"wires":[["4c72669b.2d69c8","f70af5d5.a6c088","1979c263.63619e","79f8f273.59bd5c"]]},{"id":"4c72669b.2d69c8","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Rev5`\",\"`FS003Rev5`\",\"`FS004Rev5`\",\"`FS005Rev5`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":detectInt(d.ws),\n    \"Sat\":detectInt(d.sat),\n    \"F1\":MA(d.F1,1),\n    \"F2\":MA(d.F2,2),\n    \"F3\":MA(d.F3,3),\n    \"F4\":MA(d.F4,4),\n    \"F5\":MA(d.F5,5),\n    \"F6\":MA(d.F6,6),\n    \"R1\":parseFloat(d.RP1),\n    \"R2\":parseFloat(d.RP2),\n    \"R5\":parseFloat(d.RP5),\n    \"R8\":parseFloat(d.RP8)\n}\njson['CmKiri'] = Math.round(rumuskiri28double(json.F3,json.F6));\njson['CmKanan'] = Math.round(rumuskanan10double(json.F2,json.F1));\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    var val = Math.round(json['F'+String(i+1)]);\n    msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(val)+\";\";\n}\n\nmsg.topic += \"SELECT * FROM `TabelSondeKiri` WHERE `Cm` = \"+String(Math.round(json.CmKiri))+\";\";\nmsg.topic += \"SELECT * FROM `TabelSondeKanan` WHERE `Cm` = \"+String(Math.round(json.CmKanan))+\";\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        if(x==\"-1\"){\n            x=\"0\";\n        }\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(b==9 || b == 10){\n        if(a<10){\n            a = 0;\n        }\n    }\n    if(a < 100){\n        if(avr(n)<=400){\n            return 400;\n        }else{\n            return avr(n);\n        }\n    }\n    if(a != \"-1\"){\n        if(b<7){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=7){\n            a = parseInt(String(a));\n        }\n        var cekk = isNaN(a);\n        if(!cekk){\n            n.push(a);    \n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=400){\n            if(avr(n)>=200){\n                return 400;\n            }\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\n\nfunction rumuskiri28double(dpn,blg){\n    return (dpn * -0.0715895679807236)+(blg * 0.2189957537736704)+(54.37558133121867)\t\n}\nfunction rumuskanan10double(dpn,blg){\n    return (dpn * 0.06983610340529135)+(blg * 0.09880988417745153)+(2.072062588656962)\t\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":1380,"wires":[["4148feea.d1098","5b490f12.25f5","b9e2fcf7.e13ce","1738828b.5d70fd"]]},{"id":"470eb8e5.9d9b38","type":"comment","z":"80eab637.b91808","g":"641d28f8.063e48","name":"StoretoDatabase","info":"","x":120,"y":1340,"wires":[]},{"id":"1b02ae95.b42691","type":"inject","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":1340,"wires":[["628443f4.2705cc"]]},{"id":"628443f4.2705cc","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"SetAvr","func":"for(i=1;i<=10;i++){\n    // if(i==3){\n    //     flow.set(\"avr\"+String(i),[844]);\n    //     continue;\n    // }\n    flow.set(\"avr\"+String(i),[]);\n    \n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1340,"wires":[[]]},{"id":"318a2111.591cee","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=10;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1300,"wires":[["88dced45.acad7"]]},{"id":"171ce6f3.5a8709","type":"inject","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":1300,"wires":[["318a2111.591cee"]]},{"id":"88dced45.acad7","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":1300,"wires":[]},{"id":"a322a1da.9143b","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1460,"wires":[]},{"id":"4148feea.d1098","type":"mysql","z":"80eab637.b91808","g":"641d28f8.063e48","mydb":"be353e7e.73b9d","name":"","x":350,"y":1380,"wires":[["a25df07f.a7c3b","ad381645.878fe8"]]},{"id":"a25df07f.a7c3b","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"CreateJson","func":"var d = msg.payload;\nvar LiterKiri = msg.payload[6][0].Volume;\nvar LiterKanan = msg.payload[7][0].Volume;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":RPMKANAN(parseInt(String(msg.data.R1))),\n    \"R2\":RPMKIRI(parseInt(String(msg.data.R2))),\n    \"R5\":PropKiri(msg.data.R5),\n    \"R8\":PropKanan(msg.data.R8),\n    \"ROB\":ROB2(d),\n    \"ws\":convertws(msg.data.WS)\n}\nmsg.ROB = json.ROB;\nvar json2 = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"Kiri\":LiterKiri*1000,\n    \"Kanan\":LiterKanan*1000,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"ROB\":ROB2(d)\n}\nmsg.ROB2 = json2;\nmsg.Grafana2 = json;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    if(x[1][0].Liter>=2394){//FS002\n        // res+=(Math.round((x[1][0].Liter+x[0][0].Liter)/2));//FS002+FS001/2\n        res+=x[1][0].Liter;\n    }else{\n        res+=x[1][0].Liter;\n    }\n    if(x[2][0].Liter>=2347){//FS003\n        // res+=(Math.round((x[2][0].Liter+x[5][0].Liter)/2));//FS003+FS006/2\n        res+=x[2][0].Liter;\n    }else{\n        res+=x[2][0].Liter;\n    }\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\n\nfunction ROB2(x){\n    var res = 0;\n    res+=LiterKiri*1000;\n    res+=LiterKanan*1000;\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    \n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n\n\nfunction RPMKANAN(x){\n    var res = (0.4909 * x) - 7.1141;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return res;\n}\n\nfunction RPMKIRI(x){\n    var res = (0.4126 * x) - 14.878;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return res;\n}\n\nfunction PropKanan(x){\n    var res = (0.2376*x)+21.024;\n    if(res<40 || x<70){\n        res = 0;\n    }\n    return res;\n}\nfunction PropKiri(x){\n    var res = (0.2373*x)+0.0967;\n    if(res<40 || x<70){\n        res = 0;\n    }\n    return res;\n}\nfunction convertws(x) {\n    if(parseFloat(String(x))<=0){\n        return 0;\n    }\n    // var val = parseInt(String(x));\n    // var r1 = [0, 5000];\n    // var r2 = [0, 30];\n    // var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    // var res = parseFloat((sp * 1.94384).toFixed(2));\n    // return res;\n        var res = 0;\n    // res = (0.0230497910274685*x) - 4.0075862500195600; //pakai awal\n    res = (0.0265391880951463*x) - 6.4449747484478200; //tanpa awal\n    if(res<=0){\n        if(flow.get(\"LastWS\")==undefined){\n            res = 0;\n        }else{\n            res = flow.get(\"LastWS\");\n        }\n    }else{\n        flow.set(\"LastWS\",res);\n    }\n    return parseFloat(res.toFixed(2));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":1380,"wires":[["a322a1da.9143b","4d6a4adc.c91d14","2fcf5a96.a39236","50958c64.b59744","3b549111.c7c6be","8108fca0.13de8","b8b01df4.b5c33","bb9dfabc.89f958"]]},{"id":"2fcf5a96.a39236","type":"influxdb out","z":"80eab637.b91808","d":true,"g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"Grafana","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":680,"y":1400,"wires":[]},{"id":"56f1df03.67f7d","type":"link out","z":"80eab637.b91808","name":"","links":["792eef41.4085e"],"x":675,"y":3240,"wires":[]},{"id":"792eef41.4085e","type":"link in","z":"80eab637.b91808","name":"","links":["56f1df03.67f7d"],"x":475,"y":3080,"wires":[["23bbd1d294e7428f"]]},{"id":"23bbd1d294e7428f","type":"function","z":"80eab637.b91808","name":"combine","func":"var d = msg.payload;\nvar str = \"\";\nstr+=\"[\"\nfor(i=0;i<d.length;i++){\n    var z = JSON.stringify(d[i]);\n    str+=z;\n    if(i<d.length-1){\n        str+=\",\";    \n    }\n}\nstr+=\"]\";\nmsg.payload = str;\nflow.set(\"RPRT\",str);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3080,"wires":[["389faa52.dcdd86"]]},{"id":"49013ea3.93e13","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":760,"y":3460,"wires":[]},{"id":"4d6a4adc.c91d14","type":"link out","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","links":["dde3d436.b45a08"],"x":635,"y":1340,"wires":[]},{"id":"23f65c85.effc34","type":"inject","z":"80eab637.b91808","name":"ResendLatestData","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":3100,"wires":[["77a3b171.b98df"]]},{"id":"77a3b171.b98df","type":"function","z":"80eab637.b91808","name":"flowget","func":"msg.payload = flow.get(\"RSRT\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":3100,"wires":[["389faa52.dcdd86"]]},{"id":"f4b88311.0e217","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":3160,"wires":[]},{"id":"389faa52.dcdd86","type":"json","z":"80eab637.b91808","name":"","property":"payload","action":"","pretty":false,"x":530,"y":3140,"wires":[["f4b88311.0e217"]]},{"id":"439aa3ab.80a5ac","type":"function","z":"80eab637.b91808","d":true,"name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3340,"wires":[["e42a5396.e1313"]]},{"id":"50958c64.b59744","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"Grafana2","measurement":"Grafana2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":680,"y":1420,"wires":[]},{"id":"61717642.67dc18","type":"http in","z":"80eab637.b91808","name":"","url":"/TakeData","method":"get","upload":false,"swaggerDoc":"","x":120,"y":3660,"wires":[["1fd3fbd4.b71db4","d3373584.6dac98","27390371.51c39c"]]},{"id":"27390371.51c39c","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload;\nvar bfr = String(d.bfr);\nvar aft = String(d.aft);\nmsg.query = \"select lat AS Lat,lon AS Lon,time AS Time,F1,F2,F3,F4,F5,F6,RP1 AS R1,RP2 AS R2,RP5 AS R5,RP8 AS R8,sat AS Sat,ws AS WS from fromoffline where \"+bfr+\"<=time and time<=\"+aft+\";\";\n// msg.query = \"SELECT lat AS Lat,lon AS Lon,time AS Time,F1,F2,F3,F4,F5,F6,RP1 AS R1,RP2 AS R2,RP5 AS R5,RP8 AS R8,sat AS Sat,ws AS WS FROM fromoffline;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":3660,"wires":[["d7809630.897018"]]},{"id":"d7809630.897018","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":540,"y":3660,"wires":[["f49e01ba.f4401"]]},{"id":"ec287b25.8c2338","type":"http response","z":"80eab637.b91808","name":"","statusCode":"","headers":{},"x":850,"y":3660,"wires":[]},{"id":"f49e01ba.f4401","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json['date'] = epotostr(parseInt(d[i][0]));\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;\n\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":3700,"wires":[["2a837d00.634f44","ec287b25.8c2338"]]},{"id":"3484aab0.a4d046","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"GrafanaMA","measurement":"GrafanaMA","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":510,"y":1420,"wires":[]},{"id":"e57872dc.b6c7","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"GrafanaRaw","measurement":"GrafanaRaw","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":350,"y":1540,"wires":[]},{"id":"79f8f273.59bd5c","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Rev5`\",\"`FS003Rev5`\",\"`FS004Rev5`\",\"`FS005Rev5`\",\"`FS006Ags`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":d.ws,\n    \"Sat\":d.sat,\n    \"F1\":pars(d.F1,1),\n    \"F2\":pars(d.F2,2),\n    \"F3\":pars(d.F3,3),\n    \"F4\":pars(d.F4,4),\n    \"F5\":pars(d.F5,5),\n    \"F6\":pars(d.F6,6),\n    \"R1\":pars(d.RP1,7),\n    \"R2\":pars(d.RP2,8),\n    \"R5\":pars(d.RP5,9),\n    \"R8\":pars(d.RP8,10)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(Math.round(json['F'+String(i+1)]))+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":1460,"wires":[["e57872dc.b6c7","bd5a3962.5cbf18","4c32e106.e5785"]]},{"id":"5b490f12.25f5","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" Store MA","func":"var a = msg.payload;\nvar t = a.Time;\na['time'] = tonanosec(t);\nmsg.payload = a\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":1420,"wires":[["3484aab0.a4d046"]]},{"id":"1fd3fbd4.b71db4","type":"function","z":"80eab637.b91808","name":"","func":"msg.payload = new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":3720,"wires":[["9b2c347b.526548"]]},{"id":"9b2c347b.526548","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":440,"y":3720,"wires":[]},{"id":"9994fa00.d5f5a8","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[     {         \"id\": \"2e3d7174310326e2\",         \"type\": \"inject\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"props\": [             {                 \"p\": \"payload\"             },             {                 \"p\": \"topic\",                 \"vt\": \"str\"             }         ],         \"repeat\": \"1\",         \"crontab\": \"\",         \"once\": false,         \"onceDelay\": 0.1,         \"topic\": \"\",         \"payload\": \"[\\\"0x06\\\",\\\"0x03\\\",\\\"0x00\\\",\\\"0x00\\\",\\\"0x00\\\",\\\"0x04\\\",\\\"0x45\\\",\\\"0xBE\\\"]\",         \"payloadType\": \"bin\",         \"x\": 240,         \"y\": 1280,         \"wires\": [             [                 \"16e2689d5f6b7633\"             ]         ]     },     {         \"id\": \"16e2689d5f6b7633\",         \"type\": \"serial request\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"serial\": \"93714bddb22368b0\",         \"x\": 500,         \"y\": 1260,         \"wires\": [             [                 \"d93efc81.3b9c3\"             ]         ]     },     {         \"id\": \"4b4d4cf8fa7be3ac\",         \"type\": \"inject\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"props\": [             {                 \"p\": \"payload\"             },             {                 \"p\": \"topic\",                 \"vt\": \"str\"             }         ],         \"repeat\": \"\",         \"crontab\": \"\",         \"once\": false,         \"onceDelay\": 0.1,         \"topic\": \"\",         \"payload\": \"[\\\"0x06\\\",\\\"0x03\\\",\\\"0x00\\\",\\\"0x00\\\",\\\"0x00\\\",\\\"0x04\\\",\\\"0x45\\\",\\\"0xBE\\\"]\",         \"payloadType\": \"bin\",         \"x\": 250,         \"y\": 1320,         \"wires\": [             [                 \"16e2689d5f6b7633\"             ]         ]     },     {         \"id\": \"d93efc81.3b9c3\",         \"type\": \"function\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"func\": \"var a = msg.payload;\\nvar arr = a;\\nvar str = \\\"\\\";\\nfor(i=0;i<arr.length;i++){\\n    str+=a[i];\\n}\\nvar json = {};\\n// for(i=0;i<d.length;i+=2){\\n//     arr.push(parseInt(d.substring(i,i+2),16));\\n// }\\nif(arr[0] == 6 && arr[1] == 3){\\n    json = {\\n        \\\"rawTBD\\\" : arr[3] * 256 + arr[4],\\n        \\\"decTBD\\\" : arr[5] * 256 + arr[6],\\n        \\\"rawT\\\" : arr[7] * 256 + arr[8],\\n        \\\"decT\\\" : arr[9] * 256 + arr[10],\\n        \\\"str\\\" : str\\n    }\\n}\\nmsg.payload = json;\\nreturn msg;\\n\",         \"outputs\": 1,         \"noerr\": 0,         \"initialize\": \"\",         \"finalize\": \"\",         \"libs\": [],         \"x\": 780,         \"y\": 1440,         \"wires\": [             [                 \"6568e782.a521b8\",                 \"b29315b044d5622d\",                 \"2f2971fc8968ca30\",                 \"6648066f84e27f42\",                 \"389271ac1efd8503\"             ]         ]     },     {         \"id\": \"6568e782.a521b8\",         \"type\": \"debug\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"active\": false,         \"tosidebar\": true,         \"console\": true,         \"tostatus\": true,         \"complete\": \"payload.rawTBD\",         \"targetType\": \"msg\",         \"statusVal\": \"payload.rawTBD\",         \"statusType\": \"msg\",         \"x\": 1030,         \"y\": 1420,         \"wires\": []     },     {         \"id\": \"b29315b044d5622d\",         \"type\": \"debug\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"active\": false,         \"tosidebar\": true,         \"console\": true,         \"tostatus\": true,         \"complete\": \"payload.decTBD\",         \"targetType\": \"msg\",         \"statusVal\": \"payload.decTBD\",         \"statusType\": \"msg\",         \"x\": 1030,         \"y\": 1480,         \"wires\": []     },     {         \"id\": \"2f2971fc8968ca30\",         \"type\": \"debug\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"active\": false,         \"tosidebar\": true,         \"console\": true,         \"tostatus\": true,         \"complete\": \"payload.rawT\",         \"targetType\": \"msg\",         \"statusVal\": \"payload.rawT\",         \"statusType\": \"msg\",         \"x\": 1020,         \"y\": 1540,         \"wires\": []     },     {         \"id\": \"6648066f84e27f42\",         \"type\": \"debug\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"\",         \"active\": false,         \"tosidebar\": true,         \"console\": true,         \"tostatus\": true,         \"complete\": \"payload.decT\",         \"targetType\": \"msg\",         \"statusVal\": \"payload.decT\",         \"statusType\": \"msg\",         \"x\": 1020,         \"y\": 1600,         \"wires\": []     },     {         \"id\": \"389271ac1efd8503\",         \"type\": \"debug\",         \"z\": \"089c5ea37e6b62e9\",         \"name\": \"Buffer\",         \"active\": false,         \"tosidebar\": true,         \"console\": true,         \"tostatus\": true,         \"complete\": \"payload.str\",         \"targetType\": \"msg\",         \"statusVal\": \"payload.str\",         \"statusType\": \"msg\",         \"x\": 980,         \"y\": 1360,         \"wires\": []     },     {         \"id\": \"93714bddb22368b0\",         \"type\": \"serial-port\",         \"serialport\": \"COM27\",         \"serialbaud\": \"9600\",         \"databits\": \"8\",         \"parity\": \"none\",         \"stopbits\": \"1\",         \"waitfor\": \"\",         \"dtr\": \"none\",         \"rts\": \"none\",         \"cts\": \"none\",         \"dsr\": \"none\",         \"newline\": \"1000\",         \"bin\": \"bin\",         \"out\": \"interbyte\",         \"addchar\": \"\",         \"responsetimeout\": \"10000\"     } ]","payloadType":"str","x":200,"y":80,"wires":[[]]},{"id":"8283144f.24cb78","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":60,"wires":[]},{"id":"71e01a93.265224","type":"function","z":"fdac93f7.bec1b","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4310,"y":20,"wires":[["ebe5eb21.1fac88"]]},{"id":"ebe5eb21.1fac88","type":"debug","z":"fdac93f7.bec1b","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":4430,"y":20,"wires":[]},{"id":"c72f6593.53fba8","type":"http request","z":"80eab637.b91808","name":"alldata","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/SelectM/historycmd/","tls":"","persist":false,"proxy":"","authType":"basic","x":1770,"y":4160,"wires":[["671544ee.69345c"]]},{"id":"3f294d24.7a9af2","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1630,"y":4140,"wires":[["c72f6593.53fba8"]]},{"id":"671544ee.69345c","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1940,"y":4140,"wires":[]},{"id":"4bd6b915.57c348","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":msg.data.time,//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":msg.data.R1,\n    \"R2\":msg.data.R2,\n    \"R5\":msg.data.R5,\n    \"R8\":msg.data.R8,\n    \"ROB\":ROB(d)\n}\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        if(i==0||i==5){\n            continue;\n        }\n        res+=x[i][0].Liter;\n    }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1580,"wires":[["ba26ac95.5bba4"]]},{"id":"bd5a3962.5cbf18","type":"mysql","z":"80eab637.b91808","g":"641d28f8.063e48","mydb":"be353e7e.73b9d","name":"","x":330,"y":1580,"wires":[["4bd6b915.57c348"]]},{"id":"ba26ac95.5bba4","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"GrafanaRawLiter","measurement":"GrafanaRawLiter","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":710,"y":1580,"wires":[]},{"id":"55fc81b3.85f7c","type":"inject","z":"80eab637.b91808","name":" xxxxx","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT lat AS Lat,lon AS Lon,time AS Time,F1,F2,F3,F4,F5,F6,RP1 AS R1,RP2 AS R2,RP5 AS R5,RP8 AS R8,sat AS Sat,ws AS WS FROM fromoffline","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"1654775986287 ","payload":"","payloadType":"date","x":130,"y":3240,"wires":[["6faf8b13.a9a844"]]},{"id":"a10da936.a0dd98","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1620,"y":4220,"wires":[["c8497e56.3810f"]]},{"id":"c8497e56.3810f","type":"function","z":"80eab637.b91808","name":"","func":"msg.payload= gm(\"Jun\");\nreturn msg;\n\nfunction gm(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n       var res = \"\";\n       if(String(new Date(d).getMonth() + 1).length<2){\n           res = \"0\" + String(new Date(d).getMonth() + 1);\n       }else{\n           res = String(new Date(d).getMonth() + 1);\n       }\n      return res;\n   }\n   return -1;\n }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1790,"y":4240,"wires":[["820eadb9.b109f"]]},{"id":"820eadb9.b109f","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2020,"y":4240,"wires":[]},{"id":"7a825bd4.fec154","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER] ORDER BY TIME_START ASC;","payloadType":"str","x":1650,"y":3980,"wires":[[]]},{"id":"3b215860.ae17d8","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1980,"y":3980,"wires":[]},{"id":"b6edc829.79dc88","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":2240,"wires":[["355e6a3d.a00e46"]]},{"id":"1ee0d8a8.591977","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"SendToApex","func":"msg.payload = msg.Data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":140,"wires":[["19e1f5d5.5f4c6a","6dc24344.fa1bfc"]]},{"id":"bb3d7e27.127f6","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3320,"wires":[["e42a5396.e1313"]]},{"id":"a6a942a7.f8f04","type":"link in","z":"80eab637.b91808","g":"641d28f8.063e48","name":"RESETALL","links":["5bb156f5.c3eaf8"],"x":315,"y":1340,"wires":[["628443f4.2705cc"]]},{"id":"b76d1849.cde178","type":"mysql","z":"80eab637.b91808","mydb":"be353e7e.73b9d","name":"","x":1730,"y":4060,"wires":[["b944ed32.9e40f"]]},{"id":"b944ed32.9e40f","type":"function","z":"80eab637.b91808","name":"Proses","func":"var d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \nvar arr = [];\nfor(i=0;i<d.length;i++){\n    // try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0]){ //&& lon>mincor[1] && lon<maxcor[1]){\n            msg.Create = {};\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    // }catch(x){\n    //     msg.payload = null;\n    //     return msg;\n    // }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":4060,"wires":[["ba3d17b5.522a88"]]},{"id":"1d02cb51.05cb05","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"Valid","v":"{\"lat\":\"-3.479553\",\"lon\":\"114.502840\"}","vt":"json"},{"p":"cek","v":"-3.479553, 114.502840","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM `Geofence`","payload":"","payloadType":"date","x":1540,"y":4040,"wires":[["b76d1849.cde178"]]},{"id":"ba3d17b5.522a88","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2030,"y":4060,"wires":[]},{"id":"ff427a78.77c558","type":"mysql","z":"80eab637.b91808","mydb":"be353e7e.73b9d","name":"","x":1710,"y":4100,"wires":[["ba3d17b5.522a88"]]},{"id":"8877004c.89354","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SELECT * FROM `PathName` WHERE `PathID` = 3;","payload":"","payloadType":"date","x":1500,"y":4100,"wires":[["ff427a78.77c558"]]},{"id":"320a066a.d6d68a","type":"trigger","z":"fdac93f7.bec1b","name":"Online","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"3.2","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4430,"y":60,"wires":[["993358fc.9db608"]]},{"id":"bb8111a4.50fab","type":"link in","z":"fdac93f7.bec1b","name":"","links":["999ba0fe.ae798"],"x":4055,"y":220,"wires":[["3f206b21.cec0d4"]]},{"id":"3f206b21.cec0d4","type":"function","z":"fdac93f7.bec1b","name":"A1","func":"msg.topic = \"A1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4150,"y":220,"wires":[["f03fad15.73007"]]},{"id":"fd33b414.2f8128","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM GrafanaRawLiter where time >= 1660090137015000000 AND time <= 1660100026675000000;","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":3840,"wires":[["d0a55447.8bde08"]]},{"id":"d0a55447.8bde08","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":380,"y":3840,"wires":[["dffeb130.f4552"]]},{"id":"c05b6ee7.37a35","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":3840,"wires":[]},{"id":"80e7db0d.6cd6a8","type":"http in","z":"4ac8b097.5249b","name":"","url":"/cekcek","method":"post","upload":false,"swaggerDoc":"","x":120,"y":80,"wires":[["f88fe754.27ed88","58c66539.1f4d7c"]]},{"id":"51a52b9.f3cf2d4","type":"http request","z":"4ac8b097.5249b","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://jsonplaceholder.typicode.com/posts","tls":"","persist":false,"proxy":"","authType":"","x":220,"y":200,"wires":[["901b7128.131fd"]]},{"id":"3a28dbae.652c94","type":"inject","z":"4ac8b097.5249b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"test\",\"salary\":\"123\",\"age\":\"23\"}","payloadType":"json","x":150,"y":280,"wires":[["51a52b9.f3cf2d4"]]},{"id":"901b7128.131fd","type":"debug","z":"4ac8b097.5249b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":410,"y":200,"wires":[]},{"id":"f88fe754.27ed88","type":"http response","z":"4ac8b097.5249b","name":"","statusCode":"","headers":{},"x":560,"y":60,"wires":[]},{"id":"58c66539.1f4d7c","type":"debug","z":"4ac8b097.5249b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":350,"y":120,"wires":[]},{"id":"cda69c51.1da02","type":"http request","z":"4ac8b097.5249b","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://dummy.restapiexample.com/api/v1/create","tls":"","persist":false,"proxy":"","authType":"","x":290,"y":360,"wires":[["c013135e.70f2f"]]},{"id":"439eff5b.51bf","type":"inject","z":"4ac8b097.5249b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"name\":\"test\",\"salary\":\"123\",\"age\":\"23\"}","payloadType":"str","x":110,"y":340,"wires":[["cda69c51.1da02"]]},{"id":"c013135e.70f2f","type":"debug","z":"4ac8b097.5249b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":450,"y":360,"wires":[]},{"id":"1986d1b5.28bfee","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":3620,"wires":[["27390371.51c39c"]]},{"id":"2a837d00.634f44","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/alldatasended.xlsx","x":750,"y":3740,"wires":[["68cc749d.f19e6c"]]},{"id":"68cc749d.f19e6c","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":3740,"wires":[]},{"id":"1c54c915.b916a7","type":"mqtt in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1","topic":"PING3206","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":200,"wires":[["eeb166f2.5f1eb8","a4e1a145.54745"]]},{"id":"bd922c1f.14784","type":"delay","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"60","randomUnits":"seconds","drop":false,"x":650,"y":200,"wires":[["7ebf14d.529d1ec"]]},{"id":"7ebf14d.529d1ec","type":"mqtt out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1->2","topic":"PING3206nd","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":790,"y":200,"wires":[]},{"id":"b49a241e.12aeb8","type":"mqtt in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"3","topic":"PING3206rd","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":240,"wires":[["d85f9a06.199088"]]},{"id":"633d59a1.366d68","type":"mqtt out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"3->4","topic":"PING3206th","qos":"","retain":"","broker":"4803b37b.b88cfc","x":530,"y":240,"wires":[]},{"id":"3ebad1d2.fcd46e","type":"switch","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":200,"wires":[["bd922c1f.14784"]]},{"id":"a450c1f4.0a7dd","type":"mqtt in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"5","topic":"PING3206Data","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":280,"wires":[["fa56bac1.7f78b8"]]},{"id":"fa56bac1.7f78b8","type":"delay","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":230,"y":280,"wires":[["f50bfc57.c41c6","1d0441a.cb9b7be"]]},{"id":"6063007d.6a45e","type":"mqtt out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"5->6","topic":"PING3206FINAL","qos":"","retain":"","broker":"4803b37b.b88cfc","x":530,"y":280,"wires":[]},{"id":"4fe44bac.5393d4","type":"mqtt in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"7","topic":"PING3206Done","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":320,"wires":[["732c1460.ea6e2c"]]},{"id":"42d2bcdb.68eef4","type":"mqtt out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","topic":"UPDATE3206","qos":"","retain":"","broker":"4803b37b.b88cfc","x":560,"y":360,"wires":[]},{"id":"1d0441a.cb9b7be","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Save","func":"flow.set(\"RSRT\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":280,"wires":[["6063007d.6a45e"]]},{"id":"732c1460.ea6e2c","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"same?","func":"var rsrt = flow.get(\"RSRT\");\nvar d = msg.payload;\nif(rsrt!=d || d == \"[]\"){\n    msg.payload=null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":320,"wires":[["b434158d.dcc508"]]},{"id":"b434158d.dcc508","type":"switch","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"same","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":320,"wires":[["42d2bcdb.68eef4","f3201f75.e4b88"]]},{"id":"f3201f75.e4b88","type":"json","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","property":"payload","action":"","pretty":false,"x":530,"y":320,"wires":[["80b2811d.5a041"]]},{"id":"80b2811d.5a041","type":"subflow:e9b71a55.b25c68","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","env":[],"x":670,"y":320,"wires":[["73f2d8cb.0a5a58"],["648e6019.2d832","d9201167.46ebd","4086a028.3f476"]]},{"id":"205360a8.633ae","type":"mqtt out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1170,"y":400,"wires":[]},{"id":"df8715b.2588be8","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Send Report","func":"var a = String(new Date(Date.now()));\na = a.substring(0,a.length-25);\nvar len = String(msg.payload);\nmsg.payload = \"*\"+len+\"\";\nmsg.payload += \" Data Resended* - \"+a+\" - MBP3206 ReSendSystem Success ✓✓✓\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":400,"wires":[["205360a8.633ae"]]},{"id":"1b35846e.21d0fc","type":"influxdb out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","influxdb":"76f4cea2.88ada","name":"MBP3206","measurement":"MBP3206","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1080,"y":240,"wires":[]},{"id":"73f2d8cb.0a5a58","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Convert","func":"var data = msg.payload;\nvar data1 = {\n    \"time\":data.Time,\n    \"lat\":data.Lat, \n    \"lon\":data.Lon, \n    \"ws\":data.WS, \n    \"FS125\":data.FS125, \n    \"FS121\":data.FS121, \n    \"FS124\":data.FS124, \n    \"FS127\":data.FS127, \n    \"FS112\":data.FS112, \n    \"FS105\":data.FS105, \n    \"FS120\":data.FS120, \n    \"RPM106\":data.RPM113, \n    \"RPM104\":data.RPM104, \n    \"RPM209\":data.RPM209,\n    \"RPM205\":data.RPM205\n};\nmsg.payload = data1;\nmsg.countt = msg.topic;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":280,"wires":[["17ed2da1.96f4d2","1b35846e.21d0fc","540dd4f095f7eaf6","f396f498.da45d8","b3aecbd5.85d6a8"]]},{"id":"648e6019.2d832","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Reset","func":"msg.payload = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":360,"wires":[["301ccc4f.90e1a4"]]},{"id":"301ccc4f.90e1a4","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["6c8eca5.ae0c734","242e9e2d.9b74c2"],"x":925,"y":360,"wires":[]},{"id":"6c8eca5.ae0c734","type":"link in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["301ccc4f.90e1a4"],"x":295,"y":160,"wires":[["807ae8ae.4a8068"]]},{"id":"17ed2da1.96f4d2","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"MBP3206_SavingDataInflux","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1140,"y":280,"wires":[]},{"id":"807ae8ae.4a8068","type":"trigger","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"20","extend":true,"overrideDelay":true,"units":"s","reset":"RESET","bytopic":"all","topic":"topic","outputs":1,"x":390,"y":200,"wires":[["3ebad1d2.fcd46e"]]},{"id":"eeb166f2.5f1eb8","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["619ec01f.49537"],"x":195,"y":160,"wires":[]},{"id":"619ec01f.49537","type":"link in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["eeb166f2.5f1eb8"],"x":55,"y":80,"wires":[["d4afb0b7.2bf3f","aee380a2.afc85","6aacc4a9.e9f40c","1b4220f3.583c2f"]]},{"id":"d4afb0b7.2bf3f","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":170,"y":60,"wires":[]},{"id":"5b4a75dd.9b753c","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":310,"y":80,"wires":[]},{"id":"aee380a2.afc85","type":"trigger","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":170,"y":120,"wires":[[]]},{"id":"6aacc4a9.e9f40c","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"LastOnline\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":120,"wires":[["5b4a75dd.9b753c"]]},{"id":"2d41f3ab.8cb90c","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Query","func":"msg.payload = \"SELECT * FROM `reportdata` WHERE `sta` = '0' AND `Time` >= 1670831905360 limit 50 ;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":240,"wires":[["633d59a1.366d68"]]},{"id":"f396f498.da45d8","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["f5b4ab05.ce7028"],"x":1035,"y":200,"wires":[]},{"id":"f50bfc57.c41c6","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":240,"wires":[]},{"id":"a4e1a145.54745","type":"delay","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1 msg-only","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":250,"y":200,"wires":[["807ae8ae.4a8068"]]},{"id":"2f31ccfe.884094","type":"inject","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"TriggerSend","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":140,"wires":[["477dbec.28ff14"]]},{"id":"ded0d4aa.232908","type":"link in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["477dbec.28ff14"],"x":255,"y":240,"wires":[["2d41f3ab.8cb90c"]]},{"id":"477dbec.28ff14","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":["ded0d4aa.232908"],"x":535,"y":140,"wires":[]},{"id":"d85f9a06.199088","type":"delay","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":230,"y":240,"wires":[["2d41f3ab.8cb90c"]]},{"id":"53377478.d9b2ac","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":400,"wires":[["398755bc.6476ea"]]},{"id":"398755bc.6476ea","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":930,"y":440,"wires":[]},{"id":"d9201167.46ebd","type":"switch","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":">10","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"10","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":400,"wires":[["df8715b.2588be8"]]},{"id":"ec686219.b244e","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"BackOnline","links":[],"x":905,"y":320,"wires":[]},{"id":"7f158e95.3cb95","type":"inject","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"RESETALL","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":460,"wires":[["84b73ddc.edfe9"]]},{"id":"84b73ddc.edfe9","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","links":[],"x":235,"y":460,"wires":[]},{"id":"84d01d72.dc269","type":"function","z":"e2749508.bbf528","g":"46649669.bdf2d8","name":"Send Data To APEX","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db20220705apex.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota/insert/Kelanis\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":320,"wires":[[]]},{"id":"5037e125.b5dea","type":"function","z":"e2749508.bbf528","g":"46649669.bdf2d8","name":"Prepare Data","func":"var data = msg.payload;\n\nvar json ={\n\n    \"idd\": new Date(data[0].time),\n    \"datee\" : epotodate(data[0].time),\n    \"tank1\": parseInt(data[0].Tangki1),\n    \"tank2\": parseInt(data[0].Tangki2),\n    \"tank3\": parseInt(data[0].Tangki3),\n    \"tank4\": parseInt(data[0].Tangki4),\n};\n\n// var json = [];\n// for (i=0;i<data.length;i++){\n//     json.push({\n//         \"idd\": new Date(data[i].time),\n//         \"datee\" : epotodate(data[i].time),\n//         \"tank1\": parseInt(data[i].Tangki1),\n//         \"tank2\": parseInt(data[i].Tangki2),\n//         \"tank3\": parseInt(data[i].Tangki3),\n//         \"tank4\": parseInt(data[i].Tangki4),\n        \n//     });\n//     json['idd'] = Date.parse(json['idd']);\n//     function epotodate(x){\n//         var dt = String(new Date(Date.parse(data[i].time)+(7*3600000)));\n//         dt = dt.substring(0,dt.length-34);\n//         return dt;\n//     }\n// }\n\n\njson['idd'] = Date.parse(json['idd']);\n\nmsg.payload = json;\nreturn msg;\n\n// FUNCTION\nfunction epotodate(x){\n    var dt = String(new Date(Date.parse(data[0].time)+(7*3600000)));\n    dt = dt.substring(0,dt.length-34);\n    return dt;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":260,"wires":[["65ceffc1.6da3a","84d01d72.dc269"]]},{"id":"76cccdc3.641574","type":"inject","z":"e2749508.bbf528","g":"c7961627.1b6a08","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":120,"wires":[["c55e7ee8.449cf"]]},{"id":"c55e7ee8.449cf","type":"function","z":"e2749508.bbf528","g":"c7961627.1b6a08","name":"Select Liters","func":"msg.query = \"select * from fuelkelanisliters order by time desc limit 100\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":100,"wires":[["241c37c9.1cf978"]]},{"id":"241c37c9.1cf978","type":"influxdb in","z":"e2749508.bbf528","g":"c7961627.1b6a08","influxdb":"76f4cea2.88ada","name":" Kelanis DB","query":"","rawOutput":false,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":100,"wires":[["5037e125.b5dea"]]},{"id":"65ceffc1.6da3a","type":"debug","z":"e2749508.bbf528","g":"c7961627.1b6a08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":100,"wires":[]},{"id":"3f56d3f9.9fd2ec","type":"http request","z":"e2749508.bbf528","g":"46649669.bdf2d8","name":"Kelanis","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":600,"y":220,"wires":[["72cf7665.6250f8"]]},{"id":"72cf7665.6250f8","type":"debug","z":"e2749508.bbf528","g":"46649669.bdf2d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":320,"wires":[]},{"id":"6dc24344.fa1bfc","type":"mqtt out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Apex","topic":"triggerAPEX","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1290,"y":140,"wires":[]},{"id":"b3aaa32d.0c7e4","type":"mqtt in","z":"e2749508.bbf528","g":"c7961627.1b6a08","name":"","topic":"triggerAPEX","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":150,"y":60,"wires":[["c55e7ee8.449cf"]]},{"id":"35eed6ee.95fb3a","type":"function","z":"fdac93f7.bec1b","name":"","func":"var d = msg.payload.results[0].series[0].values;\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1560,"wires":[["1d6b5849.5b2c68"]]},{"id":"d122c681.fa71b8","type":"inject","z":"e2749508.bbf528","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":440,"wires":[["d4fa3b6.84fc6c8"]]},{"id":"d4fa3b6.84fc6c8","type":"function","z":"e2749508.bbf528","name":"Select Liters","func":"msg.query = \"select * from fuelkelanisliters\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":440,"wires":[["248a81dd.a8c54e"]]},{"id":"1deb22de.3e3efd","type":"debug","z":"e2749508.bbf528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":460,"wires":[]},{"id":"248a81dd.a8c54e","type":"influxdb in","z":"e2749508.bbf528","influxdb":"76f4cea2.88ada","name":" Kelanis DB","query":"","rawOutput":false,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":440,"wires":[["3c5b431.850cebc"]]},{"id":"18304a77.caf036","type":"function","z":"e2749508.bbf528","name":"Prepare Data","func":"var data = msg.payload;\n\nvar json ={\n\n    \"idd\": new Date(data.time),\n    \"datee\" : epotodate(data.time),\n    \"tank1\": parseInt(data.Tangki1),\n    \"tank2\": parseInt(data.Tangki2),\n    \"tank3\": parseInt(data.Tangki3),\n    \"tank4\": parseInt(data.Tangki4),\n};\n\n\njson['idd'] = Date.parse(json['idd']);\n\nmsg.payload = json;\nreturn msg;\n\n// FUNCTION\nfunction epotodate(x){\n    var dt = String(new Date(Date.parse(data.time)+(7*3600000)));\n    dt = dt.substring(0,dt.length-34);\n    return dt;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":460,"wires":[["1deb22de.3e3efd","84d01d72.dc269"]]},{"id":"3c5b431.850cebc","type":"subflow:e9b71a55.b25c68","z":"e2749508.bbf528","name":"","env":[],"x":620,"y":460,"wires":[["18304a77.caf036"],["bd3af702.74d968"]]},{"id":"bd3af702.74d968","type":"debug","z":"e2749508.bbf528","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":760,"y":540,"wires":[]},{"id":"7e48b024.2557","type":"mqtt in","z":"ce7006a0.688478","name":"1","topic":"CEKMBP3206","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":1430,"y":160,"wires":[["4ec4a4be.1925dc"]]},{"id":"4ec4a4be.1925dc","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1600,"y":160,"wires":[]},{"id":"4c700985.e8b678","type":"inject","z":"ce7006a0.688478","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"RSRT","payloadType":"flow","x":1650,"y":220,"wires":[["9de85536.f334b8","3049c807.f963f8"]]},{"id":"9de85536.f334b8","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1500,"y":140,"wires":[]},{"id":"3049c807.f963f8","type":"mqtt out","z":"ce7006a0.688478","name":"5->6","topic":"PING3206FINAL","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1470,"y":220,"wires":[]},{"id":"2b43ae5b.946962","type":"mqtt in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1","topic":"PINGIBUF","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":220,"wires":[["b9bde4f6.268648","de0f0feb.e93f9"]]},{"id":"3df69b02.e0fa64","type":"delay","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"60","randomUnits":"seconds","drop":false,"x":670,"y":220,"wires":[["fab4033.2d513"]]},{"id":"fab4033.2d513","type":"mqtt out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1->2","topic":"PINGIBUFnd","qos":"","retain":"","broker":"4803b37b.b88cfc","x":810,"y":220,"wires":[]},{"id":"c5556bee.4bfe78","type":"mqtt in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"3","topic":"PINGIBUFrd","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":260,"wires":[["914d9809.1b75a8"]]},{"id":"90e4d0b4.a4577","type":"mqtt out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"3->4","topic":"PINGIBUFth","qos":"","retain":"","broker":"4803b37b.b88cfc","x":550,"y":260,"wires":[]},{"id":"bd8015d0.a588c8","type":"switch","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":220,"wires":[["3df69b02.e0fa64"]]},{"id":"8f5ab544.ed72b8","type":"mqtt in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"5","topic":"PINGIBUFData","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":300,"wires":[["bcadfb1d.31d788","fa4859d1.ac5d18"]]},{"id":"bcadfb1d.31d788","type":"delay","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":250,"y":300,"wires":[["f00dae99.5a805"]]},{"id":"fbc2ef90.6fad4","type":"mqtt out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"5->6","topic":"PINGIBUFFINAL","qos":"","retain":"","broker":"4803b37b.b88cfc","x":550,"y":300,"wires":[]},{"id":"ec461156.66069","type":"mqtt in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"7","topic":"PINGIBUFDone","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":340,"wires":[["7a406fb5.cc2f6"]]},{"id":"50eea68f.83b8b8","type":"mqtt out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","topic":"UPDATEIBUF","qos":"","retain":"","broker":"4803b37b.b88cfc","x":600,"y":400,"wires":[]},{"id":"f00dae99.5a805","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Save","func":"flow.set(\"RSRT\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":300,"wires":[["fbc2ef90.6fad4","2c0ed7b1.7fc9e8"]]},{"id":"7a406fb5.cc2f6","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"same?","func":"var rsrt = flow.get(\"RSRT\");\nvar d = msg.payload;\nif(rsrt!=d || d == \"[]\"){\n    msg.payload=null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":340,"wires":[["8792bc1c.36dd5"]]},{"id":"8792bc1c.36dd5","type":"switch","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"same","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":340,"wires":[["50eea68f.83b8b8","b647ec97.743bf"]]},{"id":"b647ec97.743bf","type":"json","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","property":"payload","action":"","pretty":false,"x":550,"y":340,"wires":[["5612ded0.391a2"]]},{"id":"5612ded0.391a2","type":"subflow:e9b71a55.b25c68","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","env":[],"x":690,"y":340,"wires":[["fe689e75.9bd26"],["4d3d584c.4bc0d8","6c6247f3.351bf8","bbf3ccdd.6e3ff"]]},{"id":"75cf972b.bfdaf8","type":"mqtt out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1190,"y":420,"wires":[]},{"id":"523c6ce4.702d74","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Send Report","func":"var a = String(new Date(Date.now()));\na = a.substring(0,a.length-25);\nvar len = String(msg.payload);\nmsg.payload = \"*\"+len+\"\";\nmsg.payload += \" Data Resended* - \"+a+\" - IBU F ReSendSystem Success ✓✓✓\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":420,"wires":[["75cf972b.bfdaf8"]]},{"id":"96998d63.3e30f","type":"influxdb out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","influxdb":"76f4cea2.88ada","name":"IBUF","measurement":"IBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1090,"y":260,"wires":[]},{"id":"fe689e75.9bd26","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Convert","func":"var data = msg.payload;\nvar data1 = {\n    \"time\":data.time,\n    \"lat\":data.Lat, \n    \"lon\":data.Lon, \n    \"ws\":data.WS, \n    \"FS101\":data.FS101, \n    \"FS107\":data.FS107, \n    \"FS135\":data.FS135, \n    \"FS119\":data.FS119, \n    \"FS118\":data.FS118, \n    \"FS123\":data.FS123, \n    \"FS129\":data.FS129\n};\n// 'FS101', 'FS107', 'FS135', 'FS119', 'FS118', 'FS123','FS129'\nmsg.payload = data1;\nmsg.countt = msg.topic;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":300,"wires":[["d78b476a.80cf18","8d0bbda5.99ab8","7e26af6.789d45"]]},{"id":"4d3d584c.4bc0d8","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Reset","func":"msg.payload = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":380,"wires":[["487d77f7.095368"]]},{"id":"487d77f7.095368","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["b0ddd76b.8b16e8","242e9e2d.9b74c2"],"x":945,"y":380,"wires":[]},{"id":"b0ddd76b.8b16e8","type":"link in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["487d77f7.095368"],"x":315,"y":180,"wires":[["14c6e023.598cc"]]},{"id":"d78b476a.80cf18","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1090,"y":300,"wires":[]},{"id":"14c6e023.598cc","type":"trigger","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"50","extend":true,"overrideDelay":true,"units":"s","reset":"RESET","bytopic":"all","topic":"topic","outputs":1,"x":410,"y":220,"wires":[["bd8015d0.a588c8"]]},{"id":"b9bde4f6.268648","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["ae48f406.b90388"],"x":215,"y":180,"wires":[]},{"id":"ae48f406.b90388","type":"link in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["b9bde4f6.268648"],"x":75,"y":100,"wires":[["bbde4958.9ac6a8","f959bae1.444c78","8e9b408c.295c3","d9688dfb.e381f"]]},{"id":"bbde4958.9ac6a8","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":190,"y":80,"wires":[]},{"id":"3219644f.ed8e7c","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":330,"y":100,"wires":[]},{"id":"f959bae1.444c78","type":"trigger","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":190,"y":140,"wires":[[]]},{"id":"8e9b408c.295c3","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"LastOnline\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":190,"y":140,"wires":[["3219644f.ed8e7c"]]},{"id":"f3b92b09.041c18","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Query","func":"msg.payload = \"SELECT * FROM ReportData WHERE sta = '0' limit 50;\";\n// msg.payload = \"SELECT count(sta) FROM ReportData WHERE sta = '0';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":260,"wires":[["90e4d0b4.a4577"]]},{"id":"7e26af6.789d45","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["a5f554f6.284c58"],"x":1195,"y":180,"wires":[]},{"id":"2c0ed7b1.7fc9e8","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":690,"y":300,"wires":[]},{"id":"de0f0feb.e93f9","type":"delay","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1 msg-only","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":270,"y":220,"wires":[["14c6e023.598cc"]]},{"id":"a45f50ad.19843","type":"inject","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"TriggerSend","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":160,"wires":[["44b9fc63.44f8a4"]]},{"id":"d1a24f58.12b7d","type":"link in","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["44b9fc63.44f8a4"],"x":275,"y":260,"wires":[["f3b92b09.041c18"]]},{"id":"44b9fc63.44f8a4","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["d1a24f58.12b7d"],"x":555,"y":160,"wires":[]},{"id":"914d9809.1b75a8","type":"delay","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":250,"y":260,"wires":[["f3b92b09.041c18"]]},{"id":"f873285b.15daa8","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":420,"wires":[["6d419a09.90fc54"]]},{"id":"6d419a09.90fc54","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":950,"y":460,"wires":[]},{"id":"6c6247f3.351bf8","type":"switch","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":">10","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"10","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":830,"y":420,"wires":[["523c6ce4.702d74"]]},{"id":"3fcfa87e.991a68","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"BackOnline","links":[],"x":925,"y":340,"wires":[]},{"id":"25682cee.666d44","type":"inject","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"RESETALL","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":480,"wires":[["b3ea6152.e7e6d"]]},{"id":"b3ea6152.e7e6d","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","links":["91c7d47d.d4d968","19ad0ea7.fbc441","3a1d2d65.b549e2","c10d99c5.ba4a08","e1fc1b82.447788"],"x":255,"y":480,"wires":[]},{"id":"15a023ee.85233c","type":"mqtt in","z":"80eab637.b91808","g":"50524935.d705d8","name":"1","topic":"imonline","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":280,"wires":[["22f77df0.031702","f99b719e.4324a"]]},{"id":"3b44262f.f175da","type":"delay","z":"80eab637.b91808","g":"50524935.d705d8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"60","randomUnits":"seconds","drop":false,"x":670,"y":280,"wires":[["4fdc829d.12e1dc"]]},{"id":"4fdc829d.12e1dc","type":"mqtt out","z":"80eab637.b91808","g":"50524935.d705d8","name":"1->2","topic":"imonline2","qos":"","retain":"","broker":"4803b37b.b88cfc","x":810,"y":280,"wires":[]},{"id":"15f9f051.aa948","type":"mqtt in","z":"80eab637.b91808","g":"50524935.d705d8","name":"3","topic":"imonline3","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":320,"wires":[["bcefa163.5774b"]]},{"id":"443db3a7.2ec3cc","type":"mqtt out","z":"80eab637.b91808","g":"50524935.d705d8","name":"3->4","topic":"imonline4","qos":"","retain":"","broker":"4803b37b.b88cfc","x":550,"y":320,"wires":[]},{"id":"eec0ba33.1881a8","type":"switch","z":"80eab637.b91808","g":"50524935.d705d8","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":280,"wires":[["3b44262f.f175da"]]},{"id":"997a78e6.37a018","type":"mqtt in","z":"80eab637.b91808","g":"50524935.d705d8","name":"5","topic":"imonlinelast","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":360,"wires":[["aeb18c6f.97af5"]]},{"id":"aeb18c6f.97af5","type":"delay","z":"80eab637.b91808","g":"50524935.d705d8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":250,"y":360,"wires":[["a3d07ee2.4118d"]]},{"id":"a4682c51.a0d48","type":"mqtt out","z":"80eab637.b91808","g":"50524935.d705d8","name":"5->6","topic":"imonlinelast2","qos":"","retain":"","broker":"4803b37b.b88cfc","x":550,"y":360,"wires":[]},{"id":"93d58b23.f57ed8","type":"mqtt in","z":"80eab637.b91808","g":"50524935.d705d8","name":"7","topic":"imonlinelastlast","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":400,"wires":[["e7be72f7.fd01e"]]},{"id":"638cbce7.d872e4","type":"mqtt out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","topic":"imonlinelastlastdone","qos":"","retain":"","broker":"4803b37b.b88cfc","x":600,"y":440,"wires":[]},{"id":"a3d07ee2.4118d","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Save","func":"flow.set(\"RSRT\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":360,"wires":[["a4682c51.a0d48","6682ab79.3d1d94"]]},{"id":"e7be72f7.fd01e","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"same?","func":"var rsrt = flow.get(\"RSRT\");\nvar d = msg.payload;\nif(rsrt!=d || d == \"[]\"){\n    msg.payload=null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":400,"wires":[["7435f427.19a48c"]]},{"id":"7435f427.19a48c","type":"switch","z":"80eab637.b91808","g":"50524935.d705d8","name":"same","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":400,"wires":[["c630955530ddf6da"]]},{"id":"df39e395.25891","type":"link out","z":"80eab637.b91808","d":true,"g":"50524935.d705d8","name":"","links":["d447276f.0cf4d8"],"x":1055,"y":120,"wires":[]},{"id":"a97fa98d.e57c68","type":"json","z":"80eab637.b91808","g":"50524935.d705d8","name":"","property":"payload","action":"obj","pretty":false,"x":550,"y":400,"wires":[["532b9665.20cea8"]]},{"id":"7b49a365.7a587c","type":"mqtt out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1190,"y":480,"wires":[]},{"id":"e8aedf53.b5953","type":"function","z":"80eab637.b91808","d":true,"g":"50524935.d705d8","name":"Send Report","func":"var a = String(new Date(Date.now()));\na = a.substring(0,a.length-25);\nvar len = String(msg.payload);\nmsg.payload = \"*\"+len+\"\";\nmsg.payload += \" Data Resended* - \"+a+\" - *MBP3222* ReSendSystem Success ✓✓✓ \";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":520,"wires":[["7b49a365.7a587c"]]},{"id":"3a33b787.0a8488","type":"influxdb out","z":"80eab637.b91808","g":"50524935.d705d8","influxdb":"76f4cea2.88ada","name":"fromoffline","measurement":"fromoffline","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1110,"y":320,"wires":[]},{"id":"c5f6187c.1da7f8","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Convert","func":"var data = msg.payload;\n// data['F1'] = String(underfour(parseInt(data.F1))*2);\n// data['F2'] = String(underfour(parseInt(data.F2))*2);\n// data['F3'] = String(underfour(parseInt(data.F3))*2);\n// data['F4'] = String(underfour(parseInt(data.F4))*2);\n// data['F5'] = String(underfour(parseInt(data.F5))*2);\n// data['F6'] = String(underfour(parseInt(data.F6))*2);\n\n\nvar data1 = {time:data.Time, lat:data.Lat, lon:data.Lon, ws:data.WS, sat:data.Sat, F1:data.F1, F2:data.F2, F3:data.F3, F4:data.F4, F5:data.F5, F6:data.F6, RP1:data.R1, RP2:data.R2, RP5:data.R5, RP8:data.R8};\nmsg.payload = data1;\nmsg.countt = msg.topic;\n// d['lat'] = d.Lat;\n// delete d['Lat'];\n// d['lon'] = d.Lon;\n// delete d['Lon'];\n\n// d['RP1'] = d.R1;\n// delete d['R1'];\n// d['RP2'] = d.R2;\n// delete d['R2'];\n// d['RP5'] = d.R5;\n// delete d['R5'];\n// d['RP8'] = d.R8;\n// delete d['R8'];\n\n// d['ws'] = d.WS;\n// delete d['WS'];\n\n// d['sat'] = d.Sat;\n// delete d['Sat'];\n\n// d['time'] = d.Time;\n\nreturn msg;\n\nfunction underfour(x){\n    if(x<400){\n        return 400;\n    }else{\n        return x;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":360,"wires":[["df39e395.25891","3a33b787.0a8488","f9526034.6f7ee","43456f8c.5dd4c","654fba48.cf00e4","59fbdf3a.7d32c","8982ca28.b605c8"]]},{"id":"7aa78bc7.d4c694","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Reset","func":"msg.payload = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":440,"wires":[["f96f3314.a30c2"]]},{"id":"f96f3314.a30c2","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["b9d7d9da.6e7948","242e9e2d.9b74c2"],"x":915,"y":440,"wires":[]},{"id":"b9d7d9da.6e7948","type":"link in","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["f96f3314.a30c2"],"x":315,"y":240,"wires":[["c95a3295.6363"]]},{"id":"f9526034.6f7ee","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1090,"y":360,"wires":[]},{"id":"c95a3295.6363","type":"trigger","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":true,"overrideDelay":true,"units":"min","reset":"RESET","bytopic":"all","topic":"topic","outputs":1,"x":410,"y":280,"wires":[["eec0ba33.1881a8"]]},{"id":"22f77df0.031702","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["5b081930.657f38"],"x":215,"y":240,"wires":[]},{"id":"5b081930.657f38","type":"link in","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["22f77df0.031702"],"x":75,"y":160,"wires":[["b8a39583.00f7b8","b2b6259e.2cfe68","201eaa40.3a0456","17cc519e.bda25e"]]},{"id":"b8a39583.00f7b8","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":190,"y":120,"wires":[]},{"id":"d7efcb43.6f1368","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":330,"y":160,"wires":[]},{"id":"654fba48.cf00e4","type":"influxdb out","z":"80eab637.b91808","g":"50524935.d705d8","influxdb":"76f4cea2.88ada","name":"Store Data 2","measurement":"fuelLevel3","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1110,"y":240,"wires":[]},{"id":"43456f8c.5dd4c","type":"influxdb out","z":"80eab637.b91808","d":true,"g":"50524935.d705d8","influxdb":"76f4cea2.88ada","name":"Store Data 1","measurement":"fuelLevel2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1110,"y":200,"wires":[]},{"id":"b2b6259e.2cfe68","type":"trigger","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":190,"y":200,"wires":[[]]},{"id":"201eaa40.3a0456","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"LastOnline\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":190,"y":200,"wires":[["d7efcb43.6f1368"]]},{"id":"59fbdf3a.7d32c","type":"influxdb out","z":"80eab637.b91808","g":"50524935.d705d8","influxdb":"76f4cea2.88ada","name":"Store Data 3","measurement":"fuelLevel4","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1110,"y":280,"wires":[]},{"id":"7980386e.195e38","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Query","func":"msg.payload = \"SELECT * FROM `reportdata` WHERE `sta` = '0' limit 50;\";\n// msg.payload = \"SELECT count(`sta`) as count FROM `reportdata` WHERE `sta` = '0';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":320,"wires":[["443db3a7.2ec3cc"]]},{"id":"8982ca28.b605c8","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["1e02a385.8fbd7c"],"x":1055,"y":160,"wires":[]},{"id":"6682ab79.3d1d94","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":690,"y":360,"wires":[]},{"id":"f99b719e.4324a","type":"delay","z":"80eab637.b91808","g":"50524935.d705d8","name":"1 msg-only","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"x":270,"y":280,"wires":[["c95a3295.6363"]]},{"id":"8a37d2ca.58b59","type":"inject","z":"80eab637.b91808","g":"50524935.d705d8","name":"TriggerSend","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":220,"wires":[["e7432d6c.e9c39"]]},{"id":"46573742.c4fed8","type":"link in","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["e7432d6c.e9c39"],"x":275,"y":320,"wires":[["7980386e.195e38"]]},{"id":"e7432d6c.e9c39","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["46573742.c4fed8"],"x":555,"y":220,"wires":[]},{"id":"bcefa163.5774b","type":"delay","z":"80eab637.b91808","g":"50524935.d705d8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":250,"y":320,"wires":[["7980386e.195e38"]]},{"id":"ef898af6.f02028","type":"comment","z":"80eab637.b91808","g":"50524935.d705d8","name":"to Old System","info":"","x":1160,"y":120,"wires":[]},{"id":"3254795a.fdfa06","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":480,"wires":[["b8e48adf.d29ab8"]]},{"id":"b8e48adf.d29ab8","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":970,"y":560,"wires":[]},{"id":"d5156c20.db42f","type":"switch","z":"80eab637.b91808","g":"50524935.d705d8","name":">30","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"30","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":830,"y":480,"wires":[["e8aedf53.b5953","f9553beb.817e88"]]},{"id":"999ba0fe.ae798","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"BackOnline","links":["18c22a49.094eb6","bb8111a4.50fab"],"x":795,"y":400,"wires":[]},{"id":"a069b332.f057","type":"inject","z":"80eab637.b91808","g":"50524935.d705d8","name":"RESETALL","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":540,"wires":[["5bb156f5.c3eaf8"]]},{"id":"5bb156f5.c3eaf8","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"","links":["41e15b3e.e35bd4","987815be.b9f298","a6a942a7.f8f04","bfdad16d.077a4","f88bd21e.1a2d4"],"x":255,"y":540,"wires":[]},{"id":"99624f64.6aeec","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2.2","payloadType":"num","x":1160,"y":420,"wires":[["d5dbcc17.dd50d"]]},{"id":"d5dbcc17.dd50d","type":"range","z":"fdac93f7.bec1b","minin":"0","maxin":"3","minout":"0","maxout":"1500","action":"scale","round":false,"property":"payload","name":"","x":1210,"y":500,"wires":[["cc28e025.c04f"]]},{"id":"cc28e025.c04f","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1310,"y":560,"wires":[]},{"id":"35995f88.2f64e","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1600","payloadType":"num","x":810,"y":3400,"wires":[[]]},{"id":"d5a3017b.0c865","type":"inject","z":"fdac93f7.bec1b","name":"Reset","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4100,"y":360,"wires":[["ffcb363f.efaf48"]]},{"id":"ffcb363f.efaf48","type":"trigger","z":"fdac93f7.bec1b","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"3","extend":true,"overrideDelay":true,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4450,"y":400,"wires":[["c81edf11.d58a2"]]},{"id":"fda852fc.7e43f","type":"mqtt out","z":"fdac93f7.bec1b","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":4810,"y":400,"wires":[]},{"id":"c81edf11.d58a2","type":"switch","z":"fdac93f7.bec1b","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4590,"y":440,"wires":[["5f82baa3.616c64"]]},{"id":"5f82baa3.616c64","type":"function","z":"fdac93f7.bec1b","name":" ","func":"msg.payload = \"MBP3222 Back Online\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4690,"y":500,"wires":[["fda852fc.7e43f"]]},{"id":"3b549111.c7c6be","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"ROB Complete","func":"var d = msg.payload;\nvar res = 0;\nif(d.F2>=2394){//FS002\n    res+=(Math.round((d.F2+d.F1)/2));//FS002+FS001/2\n    // res+=x[1][0].Liter;\n}else{\n    res+=d.F2;\n}\nif(d.F3>=2347){//FS003\n    res+=(Math.round((d.F3+d.F6)/2));//FS003+FS006/2\n    // res+=x[2][0].Liter;\n}else{\n    res+=d.F3;\n}\nres+=d.F4;//FS004\nres+=d.F5;//FS005\nmsg.payload = {\"time\":d.time,\"val\":res};\nmsg.measurement = \"ROBFrontBack\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":1420,"wires":[["d4136a68.4cb7f8","63da789c.3f7658"]]},{"id":"d4136a68.4cb7f8","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"ROBComplete","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1020,"y":1420,"wires":[]},{"id":"8108fca0.13de8","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":780,"y":1340,"wires":[]},{"id":"63da789c.3f7658","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ROBFB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.val","targetType":"msg","statusVal":"payload.val","statusType":"auto","x":1140,"y":1460,"wires":[]},{"id":"b8b01df4.b5c33","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1380,"wires":[["3a7bacc8.1f8ca4"]]},{"id":"3a7bacc8.1f8ca4","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":890,"y":1380,"wires":[]},{"id":"e333ef2a.fc30e","type":"link in","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"","links":["1d7ccbb9.e31694"],"x":55,"y":580,"wires":[["6ab4d971.0c42c8","acf50395.da227"]]},{"id":"acf50395.da227","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(d.angle),\n    \"WS\":detectInt(d.ws),\n    \"F1\":MA(d.F1,1),\n    \"F2\":MA(d.F2,2),\n    \"F3\":MA(d.F3,3),\n    \"F4\":MA(d.F4,4),\n    \"F5\":MA(d.F5,5),\n    \"F6\":MA(d.F6,6),\n    \"R1\":parseFloat(d.RPM1),\n    \"R2\":parseFloat(d.RPM2),\n    \"Speed\":MA(d.speed,11)\n}\njson['StorageCenter'] = Center(json.F5,json.F6);\njson['StorageKanan'] = Kanan(json.F4);\njson['StorageKiri'] = Kiri(json.F3);\njson['DailyKanan'] = DailyKanan(json.F2);\njson['DailyKiri'] = DailyKiri(json.F1);\n\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nmsg.topic += \"SELECT `Center` FROM `LOOKUPTAMBAT` WHERE `Sonde` = \"+String(json.StorageCenter)+\";\";\nmsg.topic += \"SELECT `Kanan` FROM `LOOKUPTAMBAT` WHERE `Sonde` = \"+String(json.StorageKanan)+\";\";\nmsg.topic += \"SELECT `Kiri` FROM `LOOKUPTAMBAT` WHERE `Sonde` = \"+String(json.StorageKiri)+\";\";\nmsg.topic += \"SELECT `DailyKanan` FROM `LOOKUPTAMBAT` WHERE `Sonde` = \"+String(json.DailyKanan)+\";\";\nmsg.topic += \"SELECT `DailyKiri` FROM `LOOKUPTAMBAT` WHERE `Sonde` = \"+String(json.DailyKiri)+\";\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(a != \"-1\"){\n        if(b<7){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=7){\n            a = parseInt(String(a));\n        }\n        if(a % 1 === 0){\n            n.push(a);\n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=400){\n            return 400;\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\n\nfunction Center(x,y){\n    return Math.round((x * 0.07552776477236758)+(y * 0.11475764688716274)+(-63.50832099981113));\n}\nfunction Kanan(x){\n    var res = Math.round((0.1871*x) - 76.976);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction Kiri(x){\n    var res = Math.round((0.1913*x) - 70.627);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction DailyKiri(x){\n    var res = Math.round((0.0654*x) - 17.169);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction DailyKanan(x){\n    var res = Math.round((0.0625*x) - 14.85);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":580,"wires":[["a706ceed.b16f5","84e7b49c.17a518"]]},{"id":"c6f98f12.b78f3","type":"comment","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"StoretoDatabase","info":"","x":120,"y":540,"wires":[]},{"id":"ae456b88.e55f08","type":"inject","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":540,"wires":[["6bc49007.84bd4"]]},{"id":"6bc49007.84bd4","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"SetAvr","func":"for(i=1;i<=11;i++){\n    flow.set(\"avr\"+String(i),[]);\n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":540,"wires":[[]]},{"id":"8ca28c92.b988f","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=11;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":500,"wires":[["caa997d1.da97e8"]]},{"id":"aed9aa93.d0b178","type":"inject","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":500,"wires":[["8ca28c92.b988f"]]},{"id":"caa997d1.da97e8","type":"debug","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":500,"wires":[]},{"id":"1b030aff.cb0855","type":"debug","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":660,"wires":[]},{"id":"a706ceed.b16f5","type":"mysql","z":"fd486f91.7596e","g":"85055426.1b98b8","mydb":"be353e7e.73b9d","name":"","x":350,"y":580,"wires":[["b4b336f.92076c8"]]},{"id":"b4b336f.92076c8","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"Center\":d[0][0].Center,\n    \"Kanan\":d[1][0].Kanan,\n    \"Kiri\":d[2][0].Kiri,\n    \"DailyKanan\":d[3][0].DailyKanan,\n    \"DailyKiri\":d[4][0].DailyKiri,\n    \"R1\":RPMKANAN(parseInt(String(msg.data.R1))),\n    \"R2\":RPMKIRI(parseInt(String(msg.data.R2))),\n    \"ROB\":ROB(d),\n    \"ws\":convertws(msg.data.WS),\n    \"CmCenter\":msg.data.StorageCenter,\n    \"CmKanan\":msg.data.StorageKanan,\n    \"CmKiri\":msg.data.StorageKiri,\n    \"CmDailyKanan\":msg.data.DailyKanan,\n    \"CmDailyKiri\":msg.data.DailyKiri\n}\n\nmsg.GrafanaTambat = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    res += d[0][0].Center;\n    res += d[1][0].Kanan;\n    res += d[2][0].Kiri;\n    res += d[3][0].DailyKanan;\n    res += d[4][0].DailyKiri;\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\n// function convertrpm( value ) { \n//     var r1 = [0,3000];\n//     var r2 = [0,1500];\n//     return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n// }\n\n\nfunction RPMKANAN(x){\n    var res = (0.6*x) - 340.66;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction RPMKIRI(x){\n    var res = (0.6335*x) - 436.26;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":580,"wires":[["1b030aff.cb0855","567d8308.02e2ec","8142d3bc.d5467","f82b24e8.1a3688","47142fbd.ed386"]]},{"id":"47142fbd.ed386","type":"link out","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"","links":["7a0225d3.58771c"],"x":635,"y":540,"wires":[]},{"id":"567d8308.02e2ec","type":"influxdb out","z":"fd486f91.7596e","g":"85055426.1b98b8","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"GrafanaTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":680,"y":620,"wires":[]},{"id":"711284c1.852f2c","type":"influxdb out","z":"fd486f91.7596e","g":"85055426.1b98b8","influxdb":"76f4cea2.88ada","name":"GrafanaMA","measurement":"GrafanaMATAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":510,"y":620,"wires":[]},{"id":"a39d4f0a.41197","type":"influxdb out","z":"fd486f91.7596e","g":"85055426.1b98b8","influxdb":"76f4cea2.88ada","name":"GrafanaRaw","measurement":"GrafanaRawTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":350,"y":660,"wires":[]},{"id":"6ab4d971.0c42c8","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":parseFloat(d.ws),\n    \"Angle\":parseFloat(d.angle),\n    \"F1\":parseInt(String(d.F1)),\n    \"F2\":parseInt(String(d.F2)),\n    \"F3\":parseInt(String(d.F3)),\n    \"F4\":parseInt(String(d.F4)),\n    \"F5\":parseInt(String(d.F5)),\n    \"F6\":parseInt(String(d.F6)),\n    \"R1\":parseInt(String(d.RPM1)),\n    \"R2\":parseInt(String(d.RPM2)),\n    //--------------------\n    // \"F1\":pars(d.FS111,1),\n    // \"F2\":pars(d.FS113,2),\n    // \"F3\":pars(d.FS114,3),\n    // \"F4\":pars(d.FS115,4),\n    // \"F5\":pars(d.FS116,5),\n    // \"F6\":pars(d.FS117,6),\n    // \"R1\":pars(d.RPM113,7),\n    // \"R2\":pars(d.RPM114,8),\n    \"Speed\":parseFloat(d.speed)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(Math.round(json['F'+String(i+1)]))+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":660,"wires":[["a39d4f0a.41197","74917c7.60a7a84"]]},{"id":"84e7b49c.17a518","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" Store MA","func":"var a = msg.payload;\nvar t = a.Time;\na['time'] = tonanosec(t);\nmsg.payload = a\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":620,"wires":[["711284c1.852f2c"]]},{"id":"609d291e.3bcac8","type":"function","z":"fd486f91.7596e","d":true,"g":"85055426.1b98b8","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":msg.data.time,//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":msg.data.R1,\n    \"R2\":msg.data.R2,\n    \"R5\":msg.data.R5,\n    \"R8\":msg.data.R8,\n    \"ROB\":ROB(d)\n}\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        if(i==0||i==5){\n            continue;\n        }\n        res+=x[i][0].Liter;\n    }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":700,"wires":[["4bb62859.7894a8"]]},{"id":"74917c7.60a7a84","type":"mysql","z":"fd486f91.7596e","d":true,"g":"85055426.1b98b8","mydb":"be353e7e.73b9d","name":"","x":330,"y":700,"wires":[["609d291e.3bcac8"]]},{"id":"4bb62859.7894a8","type":"influxdb out","z":"fd486f91.7596e","g":"85055426.1b98b8","influxdb":"76f4cea2.88ada","name":"GrafanaRawLiter","measurement":"GrafanaRawLiterTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":690,"y":700,"wires":[]},{"id":"81537343.6dcbb","type":"link in","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"RESETALL","links":["ecd733b7.272f2"],"x":315,"y":540,"wires":[["6bc49007.84bd4"]]},{"id":"52093913.f8d898","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"ROB Complete","func":"var d = msg.payload;\nvar res = 0;\nif(d.F2>=2394){//FS002\n    res+=(Math.round((d.F2+d.F1)/2));//FS002+FS001/2\n    // res+=x[1][0].Liter;\n}else{\n    res+=d.F2;\n}\nif(d.F3>=2347){//FS003\n    res+=(Math.round((d.F3+d.F6)/2));//FS003+FS006/2\n    // res+=x[2][0].Liter;\n}else{\n    res+=d.F3;\n}\nres+=d.F4;//FS004\nres+=d.F5;//FS005\nmsg.payload = {\"time\":d.time,\"val\":res};\nmsg.measurement = \"ROBFrontBackTAMBAT\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":620,"wires":[["d6081bd.67e41e8","f353b3c7.cf77b"]]},{"id":"d6081bd.67e41e8","type":"influxdb out","z":"fd486f91.7596e","g":"85055426.1b98b8","influxdb":"76f4cea2.88ada","name":"ROBComplete","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1020,"y":620,"wires":[]},{"id":"8142d3bc.d5467","type":"debug","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":720,"y":520,"wires":[]},{"id":"f82b24e8.1a3688","type":"function","z":"fd486f91.7596e","g":"85055426.1b98b8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":580,"wires":[["330c2c95.98c264"]]},{"id":"330c2c95.98c264","type":"debug","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":870,"y":560,"wires":[]},{"id":"bbc628d6.76b8d8","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"To","func":"var b = flow.get(\"REPORTPOPUP2\");\nvar a = flow.get(\"REPORTPOPUP1\");\nvar n = msg.payload;\nvar c = \"\";\nc+=\"*MBP3222* DATA UPDATED \\n\";\nc+=a.LASTRECORDDATE.substring(0,25);\nc+=\" - \";\nc+=b.LASTRECORDDATE.substring(0,25);\nc+=\"\\n||\\n\";\nc+=a.CURRENTT;\nc+=\" -> \";\nc+=a.CURRENTT;\nc+=\"\\n\"+String(n)+\" DATA\";\nmsg.payload = c;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":420,"wires":[["7b49a365.7a587c"]]},{"id":"c78de680.770678","type":"inject","z":"80eab637.b91808","g":"50524935.d705d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":940,"y":400,"wires":[["bbc628d6.76b8d8"]]},{"id":"7a0225d3.58771c","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["47142fbd.ed386"],"x":55,"y":1040,"wires":[["2c269a58.096406"]]},{"id":"2c269a58.096406","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" Take GeoFence","func":"// msg.Valid = msg.payload;\nmsg.Create = {};\nmsg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` ASC;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":1040,"wires":[["d2649908.adb688"]]},{"id":"d2649908.adb688","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":330,"y":1040,"wires":[["69f3b52f.f99f0c"]]},{"id":"69f3b52f.f99f0c","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Proses","func":"msg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    msg.Valid['lat'] = prev.lat;\n    msg.Valid['lon'] = prev.lon;\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \n\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1040,"wires":[["2df0a7d8.9846b8","f4a0c7b8.9a98f8"]]},{"id":"68382160.57db1","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SELECTQUERY","func":"msg.imov = flow.get(\"IMOV\")[0];\nvar polpod = String(msg.imov.POL)+\"-\"+\"\"+String(msg.imov.POD);\nmsg.polpod = polpod;\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') ORDER BY `PathNum` ASC;\";\nmsg.topic += \"SELECT `Name`,`PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"';\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `VID` = 'A2';\";\nmsg.topic += \"UPDATE `TaskID` SET `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') WHERE `VID`='A2';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":1080,"wires":[["f0ca42cd.2b45b"]]},{"id":"2df0a7d8.9846b8","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["f852bb7b.3beb78"],"x":715,"y":1040,"wires":[]},{"id":"f852bb7b.3beb78","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["2df0a7d8.9846b8"],"x":75,"y":1080,"wires":[["68382160.57db1"]]},{"id":"6e16b577.fb6fac","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_RouteTAMBAT`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\n\nmsg.topic += \"UPDATE `TaskID` SET `PathNum` = \"+d.pathNum+\" WHERE `VID` = 'A2';\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":1080,"wires":[["d374510d.02228"]]},{"id":"f0ca42cd.2b45b","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":350,"y":1080,"wires":[["5624481e.63d668"]]},{"id":"5624481e.63d668","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Create Data TAMBAT","func":"var pN = msg.payload[0];var PathID = msg.payload[1][0].PathID;msg.deparv = msg.payload[1][0].Name;var cycle = msg.payload[2][0].Cycle\nvar Main = \"_\";var PathNum = 0;var Next = \"_\";\nvar Alur = flow.get(\"Alur\")\nmsg.topic = msg.countt;\nfor(i=0;i<pN.length;i++){\n    if(pN[i].geofenceID == msg.Create.geofenceID){\n        Main = pN[i].Main_Activity;\n        PathNum = pN[i].PathNum;\n        \n        if(i<1){\n            var ONSTART = flow.get(\"ONSTART\");\n            ONSTART['ROB'] = msg.ROB;\n            ONSTART['time'] = msg.Valid.time;\n            if(ONSTART!=undefined){\n            flow.set(\"ONSTART\",ONSTART);\n            }\n            flow.set(\"Alur\",\"Start\")\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"Start\"){\n            flow.set(\"Alur\",\"ToPoD\");\n        }else if(i>=Math.round(pN.length/2)){\n            // var ONEND = flow.get(\"POD\");\n            var ONEND = {};\n            ONEND['ROB'] = msg.ROB;\n            ONEND['time'] = msg.Valid.time;\n            flow.set(\"POD\",ONEND);\n            flow.set(\"Alur\",\"End\");\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"End\"){\n            flow.set(\"Alur\",\"ToPoL\");\n        }\n        Alur = flow.get(\"Alur\");\n        if(Alur == \"ToPoL\"){\n            Next = pN[i-1].Main_Activity;\n        }else{\n            Next = pN[i+1].Main_Activity;\n        }\n        break;\n    }\n}\nvar json = {\n    \"epoch\": msg.Valid.time,\n    \"date\": tcc(msg.Valid.time),\n    \"shipname\": \"TAMBAT\",\n    \"GPS\": String(msg.Valid.lat)+\",\"+String(msg.Valid.lon),\n    \"pathid\": PathID,\n    \"pathName\": msg.polpod,\n    \"pathNum\": PathNum,\n    \"geofenceID\":msg.Create.geofenceID,\n    \"curloc\": Main,\n    \"nexloc\": Next,\n    \"imoveid\": msg.imov.ID,\n    \"barge\":msg.imov.BARGE,\n    \"cycle\":cycle,\n    \"statuss\":\"\"\n}\nAlur = flow.get(\"Alur\");\nif(Alur == \"ToPoL\" || Alur == \"End\"){\n    msg.polpod = msg.polpod.split('-')[1]+\"-\"+msg.polpod.split('-')[0];\n    msg.deparv = msg.deparv.split('-')[1]+\"-\"+msg.deparv.split('-')[0];\n}\nmsg.Create = json;\nmsg.payload = json;\nreturn msg;\n\n\nfunction MainActive(x,pN){\n    var res = [];\n    \n    return [];\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":1080,"wires":[["6e16b577.fb6fac"]]},{"id":"d374510d.02228","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["facb04ff.3bf3d8"],"x":895,"y":1080,"wires":[]},{"id":"facb04ff.3bf3d8","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["d374510d.02228"],"x":75,"y":1120,"wires":[["be46f130.35198","87745895.2463c8"]]},{"id":"be46f130.35198","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Proses Alldata","func":"var speed =  \"\";\nmsg.topic = \"\";\nvar prev = flow.get(\"DataPrev\");\nif(isEmpty(prev)){\n    var j = {\n        \"time\":msg.Valid.time,\n        \"lat\":msg.Valid.lat,\n        \"lon\":msg.Valid.lon\n    }\n    flow.set(\"DataPrev\",j);\n    speed =\"0.00Kn/0.00°\";\n}else{\n    // prev.lat = parseFloat(prev.lat);prev.lon = parseFloat(prev.lon);\n    // msg.Valid.lat = parseFloat(msg.Valid.lat);msg.Valid.lon = parseFloat(msg.Valid.lon);\n    // var selisiht = Math.abs(msg.Valid.time - prev.time);\n    // var spd = distance(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon,\"K\")/(selisiht/(1000*3600));\n    // var knot = (1.852*spd).toFixed(2);\n    // if(String(knot)==\"NaN\"){\n    //     knot = 0;\n    // }\n    // speed = String(knot)+\"Kn/\"+String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon))+\"°\";\n    speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2))+\"Kn/\"+String(msg.Valid.angle)+\"°\";\n    msg.speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2));\n    flow.set(\"DataPrev\",msg.Valid);\n}\nvar json = {\n    \"EPO\":msg.Valid.time,\n    \"RECORDDATA\":formatdate(msg.Valid.time),\n    \"SHIP_NAME\":\"TAMBAT\",\n    \"LAT\":parseFloat(String(msg.Valid.lat)),\n    \"LON\":parseFloat(String(msg.Valid.lon)),\n    \"DEPARTURE\":msg.polpod.split('-')[0],\n    \"ARRIVAL\":msg.polpod.split('-')[1],\n    \"CURRENTT\":msg.Create.curloc, \n    \"NEXTT\":msg.Create.nexloc, //\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":Math.round((parseInt(String(msg.GrafanaTambat.R1)))),\n    \"RPMENGINE_S\":Math.round(parseInt(String(msg.GrafanaTambat.R2))),\n    \"RPMPROP_P\":0,//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"RPMPROP_S\":0,//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"WINDSPEED\":(parseFloat(String(msg.GrafanaTambat.ws))),\n    \"SPEEDCOURSE\":speed\n};\nmsg.alldata = json;\nmsg.payload = json;\nmsg.measurement = \"alldata\";\nreturn msg;\n\nfunction toStringEpo(x){\n    var date = String(new Date(x));\n    var sub = String(date).substring(0,date.length-25);\n    return sub;\n}\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}\n\nfunction isEmpty(obj) {\n  for(var prop in obj) {\n    if(Object.prototype.hasOwnProperty.call(obj, prop)) {\n      return false;\n    }\n  }\n  return JSON.stringify(obj) === JSON.stringify({});\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":1120,"wires":[["6786e187.358e","cf3ac02e.e43c3","8085519e.1feef"]]},{"id":"1a8ec8bc.ebaf37","type":"comment","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"ProcessToApex","info":"","x":180,"y":1000,"wires":[]},{"id":"6786e187.358e","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":330,"y":1260,"wires":[]},{"id":"fd3c82f6.d3f23","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":1000,"wires":[["f4687dd1.18242"]]},{"id":"f4687dd1.18242","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SetDataPrev","func":"flow.set(\"DataPrev\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1000,"wires":[[]]},{"id":"9d8b092a.225a28","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"ShowDataPrev","func":"msg.payload = flow.get(\"DataPrev\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":960,"wires":[["8c143627.d9d798"]]},{"id":"45e81e58.d0d4c","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":960,"wires":[["9d8b092a.225a28"]]},{"id":"cf3ac02e.e43c3","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Alldata","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1120,"wires":[["6b852f75.bfd0c"]]},{"id":"1e2a2d2a.d341d3","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":920,"wires":[[]]},{"id":"6b852f75.bfd0c","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" PopUpp","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":msg.alldata.DEPARTURE,\n    \"ARRIVAL\":msg.alldata.ARRIVAL,\n    \"CURRENTT\":msg.alldata.CURRENTT,\n    \"NEXTT\":msg.alldata.NEXTT,\n    \"LASTRECORDDATE\":msg.alldata.RECORDDATA,\n    \"LASTRECEIVEDATE\":formatdate(Date.now()),\n    \"LATITUDE\":parseFloat(String(msg.alldata.LAT)),\n    \"LONGITUDE\":parseFloat(String(msg.alldata.LON)),\n    \"NAMEE\":\"TAMBAT\",\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":msg.alldata.RPMENGINE_P,\n    \"RPMENGINE_S\":msg.alldata.RPMENGINE_S,\n    \"RPMPROPELLER_P\":msg.alldata.RPMPROP_P,\n    \"RPMPROPELLER_S\":msg.alldata.RPMPROP_S,\n    \"WINDSPEED\":msg.alldata.WINDSPEED,\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE,\n    \"BARGE\":msg.imov.BARGE,\n    \"DESTINATION\":msg.deparv.split('-')[1],\n    \"FROMM\":msg.deparv.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"ONSTART\").ROB),\n    \"TD\":TDDD(),\n    \"ETA\":ETAAA(),\n    \"RPMAVR\":Math.round((parseInt(String(msg.alldata.RPMENGINE_P))+parseInt(String(msg.alldata.RPMENGINE_S)))/2),\n    \"TARGET_FO\":parseFloat(String(msg.imov.fo_target))\n}\nmsg.popupp = msg.payload;\nmsg.measurement = \"popup\";\nflow.set(\"POPUPMBP3222\",msg.payload);\nreturn msg;\nfunction ETAAA(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time + ((msg.imov.TARGET_POL_POD)*(3600*1000))));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time + ((msg.imov.TARGET_POD_POL)*(3600*1000))));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction TDDD(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1120,"wires":[["bcc33025.e4f7f","2b999bfb.22e644","6b2a44bd.cac25c","c285415d.9aea5","2cb143d3.94012c"]]},{"id":"82f225ef.3748c8","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":920,"wires":[["64d74d1b.db8ee4"]]},{"id":"64d74d1b.db8ee4","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SetONSTART","func":"flow.set(\"ONSTART\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":920,"wires":[[]]},{"id":"3299e3aa.4756bc","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"ShowONSTART","func":"msg.payload = flow.get(\"ONSTART\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":880,"wires":[["287150c6.b159"]]},{"id":"3de754d8.15bb3c","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":880,"wires":[["3299e3aa.4756bc"]]},{"id":"dce69f73.80a0b","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":840,"wires":[["80b904a3.fe0298"]]},{"id":"80b904a3.fe0298","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SetAlur","func":"flow.set(\"Alur\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":840,"wires":[[]]},{"id":"3cb97cc2.90d8b4","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"ShowAlur","func":"msg.payload = flow.get(\"Alur\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":800,"wires":[["b7d7dcd6.91b8e"]]},{"id":"92aac65d.c31598","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":800,"wires":[["3cb97cc2.90d8b4"]]},{"id":"bcc33025.e4f7f","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":710,"y":1120,"wires":[]},{"id":"2976220f.1610ae","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":870,"y":800,"wires":[["46651d6e.321224"]]},{"id":"d9af7c98.5a994","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":870,"y":840,"wires":[["90dbd21e.931c6"]]},{"id":"46651d6e.321224","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"ShowPOD","func":"msg.payload = flow.get(\"POD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":800,"wires":[["fd4a4c59.b1917"]]},{"id":"90dbd21e.931c6","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SetPOD","func":"flow.set(\"POD\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":840,"wires":[[]]},{"id":"2b999bfb.22e644","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"SaveGPS","func":"var json = {\n    \"time\":msg.Valid.time,\n    \"Alur\":flow.get(\"Alur\"),\n    \"GPS\":String(msg.Valid.lat)+\",\"+String(msg.Valid.lon)\n}\nmsg.payload = json;\nmsg.measurement = \"PO\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1200,"wires":[["25d6b73e.037028"]]},{"id":"25d6b73e.037028","type":"influxdb out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","influxdb":"76f4cea2.88ada","name":"PO","measurement":"POTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":870,"y":1200,"wires":[]},{"id":"a34eb0fe.ea157","type":"inject","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3780","crontab":"","once":true,"onceDelay":0.1,"topic":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","payload":"","payloadType":"date","x":810,"y":960,"wires":[["9bf857e3d218ae89"]]},{"id":"4e3f4e2a.0fd16","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1170,"y":1020,"wires":[]},{"id":"85c384d1.de55c8","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Save","func":"flow.set(\"IMOV\",msg.payload);\nmsg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":960,"wires":[[]]},{"id":"6d59ccdc.330bc4","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"RESETALL","links":["ecd733b7.272f2"],"x":375,"y":840,"wires":[["80b904a3.fe0298"]]},{"id":"5bf0dd0c.098834","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"RESETALL","links":["ecd733b7.272f2"],"x":375,"y":920,"wires":[["64d74d1b.db8ee4"]]},{"id":"d976bbdf.e5ebd8","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"RESETALL","links":["ecd733b7.272f2"],"x":375,"y":1000,"wires":[["f4687dd1.18242"]]},{"id":"3ce3157d.8d829a","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"RESETALL","links":["ecd733b7.272f2"],"x":895,"y":840,"wires":[["90dbd21e.931c6"]]},{"id":"f0247fd7.b5a4e","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Msg.Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1140,"y":920,"wires":[]},{"id":"21b936af.45c75a","type":"link in","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["fd4a4c59.b1917","b7d7dcd6.91b8e","287150c6.b159","8c143627.d9d798"],"x":1015,"y":920,"wires":[["f0247fd7.b5a4e"]]},{"id":"fd4a4c59.b1917","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["21b936af.45c75a"],"x":1155,"y":800,"wires":[]},{"id":"b7d7dcd6.91b8e","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["21b936af.45c75a"],"x":575,"y":800,"wires":[]},{"id":"287150c6.b159","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["21b936af.45c75a"],"x":615,"y":880,"wires":[]},{"id":"8c143627.d9d798","type":"link out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","links":["21b936af.45c75a"],"x":615,"y":960,"wires":[]},{"id":"6b2a44bd.cac25c","type":"trigger","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":890,"y":1120,"wires":[["5fd6111b.516f7"],["37102c7f.57bfd4"]]},{"id":"5fd6111b.516f7","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"From","func":"flow.set(\"REPORTPOPUP1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":1080,"wires":[[]]},{"id":"f353b3c7.cf77b","type":"debug","z":"fd486f91.7596e","g":"85055426.1b98b8","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.val","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":1000,"y":660,"wires":[]},{"id":"37102c7f.57bfd4","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"To","func":"flow.set(\"REPORTPOPUP2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":1160,"wires":[[]]},{"id":"dffeb130.f4552","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":3820,"wires":[["1483dcc4.9e4403"]]},{"id":"1483dcc4.9e4403","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/Kalibrasi10Agus.xlsx","x":750,"y":3860,"wires":[["c05b6ee7.37a35"]]},{"id":"a3227de9.60b6e","type":"mqtt out","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","topic":"ToVBFahmi","qos":"","retain":"","broker":"c5ceb024.c8f2e","x":1190,"y":320,"wires":[]},{"id":"8a6f430.4ef7ec","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","func":"msg.payload['time'] = Math.round(Date.parse(msg.payload.time)/1000);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":320,"wires":[["a52ed9a4.b94668"]]},{"id":"a52ed9a4.b94668","type":"json","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","property":"payload","action":"str","pretty":false,"x":930,"y":320,"wires":[["63ceb196.a4008"]]},{"id":"63ceb196.a4008","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","func":"msg.payload = \"sensor/)\"+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":320,"wires":[["a3227de9.60b6e"]]},{"id":"f70af5d5.a6c088","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Rev5`\",\"`FS003Rev5`\",\"`FS004Rev5`\",\"`FS005Rev5`\",\"`FS006Ags`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":d.ws,\n    \"Sat\":d.sat,\n    \"F1\":pars(d.F1,1),\n    \"F2\":pars(d.F2,2),\n    \"F3\":pars(d.F3,3),\n    \"F4\":pars(d.F4,4),\n    \"F5\":pars(d.F5,5),\n    \"F6\":pars(d.F6,6),\n    \"R1\":pars(d.RP1,7),\n    \"R2\":pars(d.RP2,8),\n    \"R5\":pars(d.RP5,9),\n    \"R8\":pars(d.RP8,10)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    var num = Math.round(json['F'+String(i+1)])\n    msg.topic += \"SELECT * FROM \"+calitable[i]+\" WHERE `Value` = \"+String(num)+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":1580,"wires":[["4bce727c.720a4c"]]},{"id":"4bce727c.720a4c","type":"mysql","z":"80eab637.b91808","g":"641d28f8.063e48","mydb":"be353e7e.73b9d","name":"","x":330,"y":1620,"wires":[["71bd699b.81a318"]]},{"id":"71bd699b.81a318","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":msg.data.time,//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":msg.data.R1,\n    \"R2\":msg.data.R2,\n    \"R5\":msg.data.R5,\n    \"R8\":msg.data.R8,\n    \"ROB\":ROB(d),\n    \"F2cm\":d[1][0].Cm,\n    \"F3cm\":d[2][0].Cm,\n    \"F4cm\":d[3][0].Cm,\n    \"F5cm\":d[4][0].Cm\n}\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        if(i==0||i==5){\n            continue;\n        }\n        res+=x[i][0].Liter;\n    }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1620,"wires":[["453806ff.50c868","8323177b.3ff9f8"]]},{"id":"453806ff.50c868","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"GrafanaRawLiterTrim","measurement":"GrafanaRawLiterTrim","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":720,"y":1620,"wires":[]},{"id":"8323177b.3ff9f8","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":940,"y":1620,"wires":[]},{"id":"d3373584.6dac98","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":340,"y":3760,"wires":[]},{"id":"a23af2a1.bb8cd","type":"mqtt in","z":"720653e6.744a9c","name":"","topic":"lora/gw28/sta","qos":"2","datatype":"auto","broker":"3df154b8.35094c","x":250,"y":940,"wires":[["1e1fa255.8ac28e","11ee5861.7676b8"]]},{"id":"1e1fa255.8ac28e","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload;\nd = d.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\nvar split = d.split(',');\nvar json = {\n    \"Data\":d\n}\nmsg.measurement = \"SensorHidroPonik\";\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":940,"wires":[["8b94506f.d728c"]]},{"id":"8b94506f.d728c","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":"","measurement":"","precision":"ms","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":660,"y":940,"wires":[]},{"id":"aa3e2a7f.c0e718","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":1060,"wires":[]},{"id":"11ee5861.7676b8","type":"function","z":"720653e6.744a9c","name":"Save","func":"var d = msg.payload;\nd = d.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\nvar s= d.split(\",\");\nvar json = {};\nif(d[0] == \"S\"){\n    json[\"devID\"] =s[0];\n    json[\"Temp\"]  =parseFloat(s[1]);\n    json[\"Humidity\"]=parseFloat(s[2]); \n    json[\"Battery\"]=parseFloat(s[3])/1000;\n    msg.payload = json\n}else if(d[0] == \"I\"){\n    json[\"devID\"] =s[0];\n    json[\"Intensity\"]  =parseFloat(s[1]); \n    json[\"Battery\"]=parseFloat(s[2])/1000;\n    msg.payload = json\n}else if(d[0] == \"M\"){\n    json[\"devID\"] =s[0];\n    json[\"Moisture\"]  =parseFloat(s[1]); \n    json[\"Battery\"]=parseFloat(s[2])/1000;\n    msg.payload = json\n}else if(d[0] == \"T\"){\n    json[\"devID\"] =s[0];\n    json[\"Turbidity\"]  =parseFloat(s[1]); \n    json[\"Battery\"]=parseFloat(s[2])/1000;\n    msg.payload = json\n}\nmsg.measurement = \"Hidroponik-\"+s[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1000,"wires":[["8b94506f.d728c","a3ab7831.530408","aa3e2a7f.c0e718","8a13ee4a.11288"]]},{"id":"a3ab7831.530408","type":"function","z":"720653e6.744a9c","name":"Grafana","func":"msg.measurement += \"Grafana\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1000,"wires":[["7f68259a.db515c"]]},{"id":"7f68259a.db515c","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"","precision":"n","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":760,"y":1000,"wires":[]},{"id":"721ac277.fa491c","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"747b8a8a.26cb74","order":9,"width":0,"height":0,"gtype":"gage","title":"Humidity1","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":660,"y":1140,"wires":[]},{"id":"9688c57d.307be8","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"e40597f8.c624a8","order":0,"width":0,"height":0,"gtype":"gage","title":"Intensitas1","label":"units","format":"{{value}}","min":0,"max":"2000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":670,"y":1220,"wires":[]},{"id":"a99066af.4b2418","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"94f22afa.255ee8","order":0,"width":0,"height":0,"gtype":"gage","title":"Intensitas2","label":"units","format":"{{value}}","min":0,"max":"2000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":670,"y":1260,"wires":[]},{"id":"7544b042.d0967","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"6140daab.469a94","order":0,"width":0,"height":0,"gtype":"gage","title":"Turbidity","label":"units","format":"{{value}}","min":0,"max":"3000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":660,"y":1300,"wires":[]},{"id":"c507ed10.abe3","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"6f63c9e9.8be8a8","order":0,"width":0,"height":0,"gtype":"gage","title":"Moisture","label":"units","format":"{{value}}","min":0,"max":"4100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":660,"y":1340,"wires":[]},{"id":"4b45b4b6.97ee2c","type":"ui_gauge","z":"720653e6.744a9c","name":"","group":"2be7d32a.bb264c","order":0,"width":0,"height":0,"gtype":"gage","title":"Humidity2","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":660,"y":1180,"wires":[]},{"id":"44e505fe.7f3bbc","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-S001\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-S001\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1140,"wires":[["27e9a50a.e2fa9a"]]},{"id":"27e9a50a.e2fa9a","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1140,"wires":[["e1efdc55.61406"]]},{"id":"e1efdc55.61406","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Humidity/100;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1140,"wires":[["721ac277.fa491c","65ac5f1.fce0ea","e7cc04e1.c14d28"]]},{"id":"552510b8.8ff26","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-S002\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-S002\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1180,"wires":[["66032535.67fcec"]]},{"id":"66032535.67fcec","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1180,"wires":[["8a2e8172.872c7"]]},{"id":"8a2e8172.872c7","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Humidity/100;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1180,"wires":[["4b45b4b6.97ee2c","420c7f49.67d7e","f9cf4988.c94348"]]},{"id":"2f353387.028eac","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-I001\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-I001\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1220,"wires":[["a05bd60a.e01118"]]},{"id":"a05bd60a.e01118","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1220,"wires":[["5eff0ba3.c45454"]]},{"id":"5eff0ba3.c45454","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Intensity;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1220,"wires":[["9688c57d.307be8","b411c58d.cdfe08","92627b19.301018","d2949ae1.1736b8"]]},{"id":"5f256743.a465e8","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-I002\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-I002\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1260,"wires":[["2cb9aa5b.9ad2d6"]]},{"id":"2cb9aa5b.9ad2d6","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1260,"wires":[["ddd3f55c.c02f08"]]},{"id":"ddd3f55c.c02f08","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Intensity;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1260,"wires":[["a99066af.4b2418","6963b53f.9385fc","2b376082.09986"]]},{"id":"161bfe1.15cf002","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-T001\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-T001\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1300,"wires":[["1a24f38e.1389dc"]]},{"id":"1a24f38e.1389dc","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1300,"wires":[["631562f1.3d310c"]]},{"id":"631562f1.3d310c","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Turbidity;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1300,"wires":[["7544b042.d0967","193c5f89.8346d","483f7be3.8c3a34"]]},{"id":"33938a96.10bb46","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = 'SELECT * FROM \"Hidroponik-M001\" order by time desc limit 1;';\nmsg.query += 'SELECT * FROM \"Hidroponik-M001\" order by time desc limit 100;';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1340,"wires":[["8849bfb2.16b57"]]},{"id":"8849bfb2.16b57","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":390,"y":1340,"wires":[["333abd12.8e7132"]]},{"id":"333abd12.8e7132","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0][0].Moisture;\nmsg.grap = JSON.stringify(msg.payload[1]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1340,"wires":[["c507ed10.abe3","9fb04be0.3f8238","84ab23cf.c1675"]]},{"id":"8a13ee4a.11288","type":"link out","z":"720653e6.744a9c","name":"","links":["92b9a2f1.88773","fbfd1ba0.ae5cb8"],"x":555,"y":1040,"wires":[]},{"id":"92b9a2f1.88773","type":"link in","z":"720653e6.744a9c","name":"","links":["8a13ee4a.11288"],"x":135,"y":1240,"wires":[["44e505fe.7f3bbc","552510b8.8ff26","2f353387.028eac","5f256743.a465e8","161bfe1.15cf002","33938a96.10bb46"]]},{"id":"65ac5f1.fce0ea","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1140,"wires":[]},{"id":"420c7f49.67d7e","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1180,"wires":[]},{"id":"b411c58d.cdfe08","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1220,"wires":[]},{"id":"6963b53f.9385fc","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1260,"wires":[]},{"id":"193c5f89.8346d","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1300,"wires":[]},{"id":"9fb04be0.3f8238","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1340,"wires":[]},{"id":"9f634647.b967f8","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1140,"wires":[]},{"id":"f18e5726.ec7008","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1180,"wires":[]},{"id":"2c447c86.2670d4","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1220,"wires":[]},{"id":"c8debc2a.6114","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1260,"wires":[]},{"id":"a85bf299.da24a","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1300,"wires":[]},{"id":"d3c14f66.b4a22","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":1340,"wires":[]},{"id":"4a87909c.0ef6b","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1480,"y":1440,"wires":[]},{"id":"e7cc04e1.c14d28","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"747b8a8a.26cb74","order":1,"width":0,"height":0,"label":"Humidity1","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":980,"y":1140,"wires":[[]]},{"id":"f9cf4988.c94348","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"2be7d32a.bb264c","order":1,"width":0,"height":0,"label":"Humidity2","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":980,"y":1180,"wires":[[]]},{"id":"92627b19.301018","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"e40597f8.c624a8","order":1,"width":0,"height":0,"label":"Intensitas1","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":990,"y":1220,"wires":[[]]},{"id":"2b376082.09986","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"94f22afa.255ee8","order":1,"width":0,"height":0,"label":"Intensitas2","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":990,"y":1260,"wires":[[]]},{"id":"483f7be3.8c3a34","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"6140daab.469a94","order":1,"width":0,"height":0,"label":"Turbidity","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":980,"y":1300,"wires":[[]]},{"id":"84ab23cf.c1675","type":"ui_chart","z":"720653e6.744a9c","name":"","group":"6f63c9e9.8be8a8","order":1,"width":0,"height":0,"label":"Moisture","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"0","ymax":"","removeOlder":"200","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":980,"y":1340,"wires":[[]]},{"id":"d7711547.14b0c8","type":"inject","z":"720653e6.744a9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":750,"y":1080,"wires":[["291d58aa.965668"]]},{"id":"291d58aa.965668","type":"function","z":"720653e6.744a9c","name":"[]","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1080,"wires":[["e7cc04e1.c14d28","f9cf4988.c94348","92627b19.301018","2b376082.09986","483f7be3.8c3a34","84ab23cf.c1675"]]},{"id":"21f9f2fd.c3c2de","type":"ui_button","z":"720653e6.744a9c","name":"","group":"66dfbc48.411c84","order":0,"width":0,"height":0,"passthru":true,"label":"PumpON","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"RLY100,4,1#","payloadType":"str","topic":"topic","topicType":"msg","x":160,"y":1400,"wires":[["e0160637.1a7408","84992781.435bd8","de9ba538.a63508","3c3c5f7d.34941"]]},{"id":"981ffcc9.cfdbd","type":"ui_button","z":"720653e6.744a9c","name":"","group":"66dfbc48.411c84","order":0,"width":0,"height":0,"passthru":true,"label":"PumpOFF","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"RLY100,4,0#","payloadType":"str","topic":"topic","topicType":"msg","x":150,"y":1500,"wires":[["48bac684.c54888","84992781.435bd8","a2eb0f70.a093"]]},{"id":"8efdea12.3e2e78","type":"mqtt out","z":"720653e6.744a9c","name":"","topic":"lora/gw28/cmd","qos":"","retain":"","broker":"3df154b8.35094c","x":540,"y":1440,"wires":[]},{"id":"a93ca418.45ea98","type":"ui_text","z":"720653e6.744a9c","group":"66dfbc48.411c84","order":2,"width":0,"height":0,"name":"","label":"Status","format":"{{msg.payload}}","layout":"row-spread","className":"","x":850,"y":1440,"wires":[]},{"id":"e0160637.1a7408","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":1420,"wires":[["a93ca418.45ea98"]]},{"id":"48bac684.c54888","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload= \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":1460,"wires":[["a93ca418.45ea98"]]},{"id":"84992781.435bd8","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1010,"y":1440,"wires":[]},{"id":"de9ba538.a63508","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":1380,"wires":[]},{"id":"1979c263.63619e","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" StoreCm","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Cm`\",\"`FS002Cm`\",\"`FS003Cm`\",\"`FS004Cm`\",\"`FS005Cm`\",\"`FS006Cm`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":d.ws,\n    \"Sat\":d.sat,\n    \"F1\":pars(d.F1,1),\n    \"F2\":pars(d.F2,2),\n    \"F3\":pars(d.F3,3),\n    \"F4\":pars(d.F4,4),\n    \"F5\":pars(d.F5,5),\n    \"F6\":pars(d.F6,6),\n    \"R1\":pars(d.RP1,7),\n    \"R2\":pars(d.RP2,8),\n    \"R5\":pars(d.RP5,9),\n    \"R8\":pars(d.RP8,10)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    var num = Math.round(json['F'+String(i+1)])\n    msg.topic += \"SELECT * FROM \"+calitable[i]+\" WHERE `Value` = \"+String(num)+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":1660,"wires":[["95310c7.cd2e3f"]]},{"id":"95310c7.cd2e3f","type":"mysql","z":"80eab637.b91808","g":"641d28f8.063e48","mydb":"be353e7e.73b9d","name":"","x":330,"y":1680,"wires":[["b3139a1c.215238"]]},{"id":"b3139a1c.215238","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":msg.data.time,//1000\n    \"F1\":d[0][0].Cm,\n    \"F2\":d[1][0].Cm,\n    \"F3\":d[2][0].Cm,\n    \"F4\":d[3][0].Cm,\n    \"F5\":d[4][0].Cm,\n    \"F6\":d[5][0].Cm\n}\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        if(i==0||i==5){\n            continue;\n        }\n        res+=x[i][0].Liter;\n    }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1680,"wires":[["44ff5742.29f618","9b7fdf9d.d61be"]]},{"id":"9b7fdf9d.d61be","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"GrafanaRawCm","measurement":"GrafanaRawCm","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":680,"y":1680,"wires":[]},{"id":"f9553beb.817e88","type":"delay","z":"80eab637.b91808","g":"50524935.d705d8","name":"","pauseType":"rate","timeout":"10","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1020,"y":440,"wires":[[]]},{"id":"cdfa4bba.e145e8","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":70,"y":1920,"wires":[["fbea2d54.27792"]]},{"id":"fbea2d54.27792","type":"function","z":"80eab637.b91808","name":" ","func":"msg.query = \"select * from fromoffline where time >= 1658921820000 AND time <= 1659357387896;\";\nmsg.query += \"SELECT * FROM fromoffline where time > 1659357387896;\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":1920,"wires":[["e189ba75.009d28"]]},{"id":"e189ba75.009d28","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":370,"y":1960,"wires":[["cb0b81fa.70f43"]]},{"id":"cb0b81fa.70f43","type":"function","z":"80eab637.b91808","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar d2 = msg.payload.results[1].series[0].values;\nvar da2 = msg.payload.results[1].series[0].columns;\nvar arr = [];\nvar arr2 = [];\nvar res = []\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = String(Math.round(parseInt(d[i][1])/2));\n    json[da[2]] = String(Math.round(parseInt(d[i][2])/2));\n    json[da[3]] = String(Math.round(parseInt(d[i][3])/2));\n    json[da[4]] = String(Math.round(parseInt(d[i][4])/2));\n    json[da[5]] = String(Math.round(parseInt(d[i][5])/2));\n    json[da[6]] = String(Math.round(parseInt(d[i][6])/2));\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n    res.push(json);\n}\nfor(i=0;i<d2.length;i++){\n    var json2 = {};\n    json2[da2[0]] = d2[i][0];\n    json2[da2[1]] = d2[i][1];\n    json2[da2[2]] = d2[i][2];\n    json2[da2[3]] = d2[i][3];\n    json2[da2[4]] = d2[i][4];\n    json2[da2[5]] = d2[i][5];\n    json2[da2[6]] = d2[i][6];\n    json2[da2[7]] = d2[i][7];\n    json2[da2[8]] = d2[i][8];\n    json2[da2[9]] = d2[i][9];\n    json2[da2[10]] = d2[i][10];\n    json2[da2[11]] = d2[i][11];\n    json2[da2[12]] = d2[i][12];\n    json2[da2[13]] = d2[i][13];\n    json2[da2[14]] = d2[i][14];\n    arr2.push(json2);\n    res.push(json2);\n}\n\nmsg.payload= res;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2020,"wires":[["cfe7842e.8698c8","3c4ffa4e.f0ec76"]]},{"id":"c183e239.00bf3","type":"function","z":"80eab637.b91808","name":" StoreCm","func":"var d = msg.payload;\nvar calitable = [\"`FS001Cm`\",\"`FS002Cm`\",\"`FS003Cm`\",\"`FS004Cm`\",\"`FS005Cm`\",\"`FS006Cm`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":d.ws,\n    \"Sat\":d.sat,\n    \"F1\":pars(d.F1,1),\n    \"F2\":pars(d.F2,2),\n    \"F3\":pars(d.F3,3),\n    \"F4\":pars(d.F4,4),\n    \"F5\":pars(d.F5,5),\n    \"F6\":pars(d.F6,6),\n    \"R1\":pars(d.RP1,7),\n    \"R2\":pars(d.RP2,8),\n    \"R5\":pars(d.RP5,9),\n    \"R8\":pars(d.RP8,10)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    var num = Math.round(json['F'+String(i+1)])\n    msg.topic += \"SELECT * FROM \"+calitable[i]+\" WHERE `Value` = \"+String(num)+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1820,"wires":[["95310c7.cd2e3f"]]},{"id":"3c4ffa4e.f0ec76","type":"subflow:e9b71a55.b25c68","z":"80eab637.b91808","name":"","x":650,"y":1900,"wires":[["6a8df335.063bfc"],[]]},{"id":"44ff5742.29f618","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":530,"y":1800,"wires":[]},{"id":"cfe7842e.8698c8","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":1860,"wires":[]},{"id":"6a8df335.063bfc","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":800,"y":1900,"wires":[]},{"id":"5e28d5aa.296b2c","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":2200,"wires":[]},{"id":"244b78d.aba7388","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":2260,"wires":[]},{"id":"2df9c45b.a0841c","type":"inject","z":"720653e6.744a9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"RLY100,4,1#","payloadType":"str","x":170,"y":1360,"wires":[["21f9f2fd.c3c2de","de9ba538.a63508"]]},{"id":"3c3c5f7d.34941","type":"function","z":"720653e6.744a9c","name":"ON","func":"msg.topic = \"\";\nmsg.payload = \"RLY100,4,1#\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":1420,"wires":[[]]},{"id":"a2eb0f70.a093","type":"function","z":"720653e6.744a9c","name":"OFF","func":"msg.topic = \"\";\nmsg.payload = \"RLY100,4,0#\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":1460,"wires":[[]]},{"id":"d2949ae1.1736b8","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload;\nif(d>500){\n    msg.payload = \"ON\";\n}else{\n    msg.payload = \"OFF\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1100,"wires":[["4c671084.e59ba","a773d8b6.4f4fc8"]]},{"id":"a773d8b6.4f4fc8","type":"switch","z":"720653e6.744a9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":90,"y":1300,"wires":[["21f9f2fd.c3c2de"]]},{"id":"4c671084.e59ba","type":"switch","z":"720653e6.744a9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1600,"wires":[["981ffcc9.cfdbd"]]},{"id":"742a7f47.4b8d7","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":140,"wires":[["56c7fc65.9c2574"]]},{"id":"56c7fc65.9c2574","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":180,"wires":[]},{"id":"d4f568c6.5f6188","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"fuelMBP3222","func":"var d = msg.payload;\nvar imov = flow.get(\"IMOV\")[0];\nvar json = {\n    \"EPO\": msg.data.Time,\n    \"DATEE\":String(new Date(msg.data.Time)),\n    \"F1\":parseInt(String(d.F1)),\n    \"F2\":parseInt(String(d.F2)),\n    \"F3\":parseInt(String(d.F3)),\n    \"F4\":parseInt(String(d.F4)),\n    \"F5\":parseInt(String(d.F5)),\n    \"F6\":parseInt(String(d.F6)),\n    \"MAX_FUEL\":50000\n}\nmsg.payload = json;\n\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertfuel\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1500,"wires":[["5027eb68.949d24","4ae3a182.654af"]]},{"id":"c4909455.88f818","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1110,"y":1900,"wires":[["3f480198.3d05ee"]]},{"id":"3f480198.3d05ee","type":"function","z":"80eab637.b91808","name":"","func":"msg.payload = String(new Date(msg.payload));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":1900,"wires":[["9ad9b5a9.ed58e8"]]},{"id":"9ad9b5a9.ed58e8","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1450,"y":1900,"wires":[]},{"id":"5027eb68.949d24","type":"http request","z":"80eab637.b91808","g":"641d28f8.063e48","name":"Fuel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":850,"y":1500,"wires":[["54453824.ea6158","1a350f1b.b77931"]]},{"id":"cf90f83e.e418d8","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1130,"y":1580,"wires":[]},{"id":"54453824.ea6158","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1580,"wires":[["cf90f83e.e418d8"]]},{"id":"1a350f1b.b77931","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1010,"y":1500,"wires":[]},{"id":"4ae3a182.654af","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":850,"y":1460,"wires":[]},{"id":"ad381645.878fe8","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":500,"y":1460,"wires":[]},{"id":"b9e2fcf7.e13ce","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","func":"var d = msg.payload;\nd['Datee'] = String(epotostr(d.Time));\nd['time'] = d.Time;\nmsg.payload = d;\nreturn msg;\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1460,"wires":[["87116130.c063d","ad381645.878fe8","a4d0b3a5.edc42"]]},{"id":"87116130.c063d","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":" ","measurement":"RecordDatabase","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":490,"y":1500,"wires":[]},{"id":"caf775ba.451298","type":"http in","z":"80eab637.b91808","name":"","url":"/TakeDataCm","method":"get","upload":false,"swaggerDoc":"","x":150,"y":3920,"wires":[["d32b26f2.1f74f8","163bf363.89b96d"]]},{"id":"d32b26f2.1f74f8","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload;\nvar bfr = String(d.bfr);\nvar aft = String(d.aft);\n// msg.query = \"select * from RecordDatabase where \"+bfr+\"<=time and time<=\"+aft+\";\";\n// msg.query = \"SELECT lat AS Lat,lon AS Lon,time AS Time,F1,F2,F3,F4,F5,F6,RP1 AS R1,RP2 AS R2,RP5 AS R5,RP8 AS R8,sat AS Sat,ws AS WS FROM fromoffline;\";\nmsg.query = \"select * from RecordDatabase where time>=1664557200000 and time<=1670064298516;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":3920,"wires":[["12adca17.d07d36"]]},{"id":"12adca17.d07d36","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":560,"y":3920,"wires":[["609dc617.2034c8"]]},{"id":"a7b378cc.c43658","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;\n\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":3920,"wires":[["79d4a4a.e80e55c"]]},{"id":"306df90b.b5b4e6","type":"http response","z":"80eab637.b91808","name":"","statusCode":"","headers":{},"x":950,"y":3920,"wires":[]},{"id":"163bf363.89b96d","type":"function","z":"80eab637.b91808","name":"","func":"msg.payload = new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":3960,"wires":[["fec9febd.ea704"]]},{"id":"fec9febd.ea704","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":550,"y":3960,"wires":[]},{"id":"bb9dfabc.89f958","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","func":"msg.payload = msg.ROB2;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1300,"wires":[["ea8e654.d942b98"]]},{"id":"ea8e654.d942b98","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":"Grafana3","measurement":"Grafana3","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":880,"y":1300,"wires":[]},{"id":"a4d0b3a5.edc42","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","func":"var d = msg.payload;\nd['time'] = tonanosec(d.time);\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1540,"wires":[["9efee38c.29403"]]},{"id":"9efee38c.29403","type":"influxdb out","z":"80eab637.b91808","g":"641d28f8.063e48","influxdb":"76f4cea2.88ada","name":" ","measurement":"RecordDatabaseGrafana","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":610,"y":1540,"wires":[]},{"id":"340183ae.eb1d8c","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":" asd","func":"msg.payload = msg.ROB2;\nmsg.payload['KIRI'] = String(Math.round(msg.payload.Kiri));\nmsg.payload['KANAN'] = String(Math.round(msg.payload.Kanan));\nmsg.payload['DAILY1'] = String(Math.round(msg.payload.F4));\nmsg.payload['DAILY2'] = String(Math.round(msg.payload.F5));\nmsg.payload['IDD'] = msg.payload.time/1000000;\nvar week = flow.get(\"WeekChart\");\ndelete msg.payload['Kiri'];\ndelete msg.payload['Kanan'];\ndelete msg.payload['F4'];\ndelete msg.payload['F5'];\ndelete msg.payload['ROB'];\nif(msg.payload.IDD-week>=28800000){\n    flow.set(\"WeekChart\",msg.payload.IDD);\n}else{\n    msg.payload = null;\n}\n\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/mbp3222storage\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1240,"wires":[["6d5e59c6.5744d8","b93a0473.17b758","c88507a3.1af4f8"]]},{"id":"ee5a63ea.cd352","type":"function","z":"80eab637.b91808","g":"641d28f8.063e48","name":"WeekSet","func":"flow.set(\"WeekChart\",0)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1260,"wires":[[]]},{"id":"11e0e60c.efc5ea","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":"WeekChart","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1190,"y":1240,"wires":[]},{"id":"71ed0a81.ac2604","type":"inject","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":1260,"wires":[["ee5a63ea.cd352"]]},{"id":"6d5e59c6.5744d8","type":"switch","z":"80eab637.b91808","g":"641d28f8.063e48","name":"Not Null","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":880,"y":1240,"wires":[["7c77b55.1f8ed4c"]]},{"id":"b93a0473.17b758","type":"trigger","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"2","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":1020,"y":1280,"wires":[[],["7a4af1b7.0a26f"]]},{"id":"7a4af1b7.0a26f","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":"WeekChart","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1160,"y":1340,"wires":[]},{"id":"c88507a3.1af4f8","type":"trigger","z":"80eab637.b91808","g":"641d28f8.063e48","name":" ","op1":"1","op2":"","op1type":"str","op2type":"payl","duration":"8","extend":false,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1010,"y":1240,"wires":[[]]},{"id":"7c77b55.1f8ed4c","type":"http request","z":"80eab637.b91808","g":"641d28f8.063e48","name":"WeekChart","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1030,"y":1240,"wires":[["11e0e60c.efc5ea"]]},{"id":"6312ab48.2a3864","type":"mqtt in","z":"7399def9.9066","name":"","topic":"gw37/data","qos":"2","datatype":"auto","broker":"3df154b8.35094c","x":160,"y":140,"wires":[["f8d65e52.7fcb7"]]},{"id":"f8d65e52.7fcb7","type":"function","z":"7399def9.9066","name":"Store","func":"var d = msg.payload;\nvar spt = d.split(\",\");\nvar json = {\n    \"DeviceID\":spt[0],\n    \"RawValue\":parseInt(String(spt[1]))\n}\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":140,"wires":[["5941b21a.704a5c","62c58a83.9022d4","64b02d1a.0410f4","3c0e3a43.43caf6","b6962ccf.a889b"]]},{"id":"5941b21a.704a5c","type":"influxdb out","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":" ","measurement":"Tuhup1","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":910,"y":140,"wires":[]},{"id":"dde3d436.b45a08","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["4d6a4adc.c91d14"],"x":55,"y":900,"wires":[["ab7fdf93.dca08","71c44d41e40f17dc"]]},{"id":"ab7fdf93.dca08","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":" Take GeoFence","func":"// msg.Valid = msg.payload;\nmsg.Create = {};\nmsg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence`\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":900,"wires":[["5e2bd994.e2e6d8"]]},{"id":"5e2bd994.e2e6d8","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":330,"y":900,"wires":[["75ed68e0.099798"]]},{"id":"75ed68e0.099798","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Proses","func":"msg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    if(Object.keys(prev).length>0){\n        msg.Valid['lat'] = prev.lat;\n        msg.Valid['lon'] = prev.lon;\n    }\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \n\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0]){ //&& lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":900,"wires":[["c3109275.665f4","25da03b9.3763ac"]]},{"id":"c3109275.665f4","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payloadCurrentGeo","statusType":"auto","x":630,"y":860,"wires":[]},{"id":"5fd029a1.b44818","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SELECTQUERY","func":"msg.imov = flow.get(\"IMOV\")[0];\nvar polpod = String(msg.imov.POL)+\"-\"+\"\"+String(msg.imov.POD);\nmsg.polpod = polpod;\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') ORDER BY `PathNum` ASC;\";\nmsg.topic += \"SELECT `Name`,`PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"';\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `VID` = 'A1';\";\nmsg.topic += \"UPDATE `TaskID` SET `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') WHERE `VID`='A1';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":940,"wires":[["250d90c0.58685"]]},{"id":"25da03b9.3763ac","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["913d9025.f4f76"],"x":715,"y":900,"wires":[]},{"id":"913d9025.f4f76","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["25da03b9.3763ac"],"x":75,"y":940,"wires":[["5fd029a1.b44818"]]},{"id":"5995455f.2229cc","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_Route`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":940,"wires":[["6167db7.423bc24","8c9bfc9d.aafd5"]]},{"id":"250d90c0.58685","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":350,"y":940,"wires":[["df1bb320.69b74"]]},{"id":"df1bb320.69b74","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Create Data MBP3222","func":"var pN = msg.payload[0];var PathID = msg.payload[1][0].PathID;msg.deparv = msg.payload[1][0].Name;var cycle = msg.payload[2][0].Cycle\nvar Main = \"_\";var PathNum = 0;var Next = \"_\";\nvar Alur = flow.get(\"Alur\")\nmsg.topic = msg.countt;\nfor(i=0;i<pN.length;i++){\n    if(pN[i].geofenceID == msg.Create.geofenceID){\n        Main = pN[i].Main_Activity;\n        PathNum = pN[i].PathNum;\n        \n        if(i<1){\n            var ONSTART = flow.get(\"ONSTART\");\n            ONSTART['ROB'] = msg.ROB;\n            ONSTART['time'] = msg.Valid.time;\n            if(ONSTART!=undefined){\n            flow.set(\"ONSTART\",ONSTART);\n            }\n            flow.set(\"Alur\",\"Start\")\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"Start\"){\n            flow.set(\"Alur\",\"ToPoD\");\n        }else if(i>=Math.round(pN.length/2)){\n            // var ONEND = flow.get(\"POD\");\n            var ONEND = {};\n            ONEND['ROB'] = msg.ROB;\n            ONEND['time'] = msg.Valid.time;\n            flow.set(\"POD\",ONEND);\n            flow.set(\"Alur\",\"End\");\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"End\"){\n            flow.set(\"Alur\",\"ToPoL\");\n        }\n        Alur = flow.get(\"Alur\");\n        if(Alur == \"ToPoL\"){\n            Next = pN[i-1].Main_Activity;\n        }else{\n            Next = pN[i+1].Main_Activity;\n        }\n        break;\n    }\n}\nvar json = {\n    \"epoch\": msg.Valid.time,\n    \"date\": tcc(msg.Valid.time),\n    \"shipname\": \"MBP3222\",\n    \"GPS\": String(msg.Valid.lat)+\",\"+String(msg.Valid.lon),\n    \"pathid\": PathID,\n    \"pathName\": msg.polpod,\n    \"pathNum\": PathNum,\n    \"geofenceID\":msg.Create.geofenceID,\n    \"curloc\": Main,\n    \"nexloc\": Next,\n    \"imoveid\": msg.imov.ID,\n    \"barge\":msg.imov.BARGE,\n    \"cycle\":cycle,\n    \"statuss\":\"\"\n}\nAlur = flow.get(\"Alur\");\nif(Alur == \"ToPoL\" || Alur == \"End\"){\n    msg.polpod = msg.polpod.split('-')[1]+\"-\"+msg.polpod.split('-')[0];\n    msg.deparv = msg.deparv.split('-')[1]+\"-\"+msg.deparv.split('-')[0];\n}\nmsg.Create = json;\nmsg.payload = json;\nreturn msg;\n\n\nfunction MainActive(x,pN){\n    var res = [];\n    \n    return [];\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":940,"wires":[["5995455f.2229cc"]]},{"id":"6167db7.423bc24","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["c2c16d84.90f6b"],"x":895,"y":940,"wires":[]},{"id":"c2c16d84.90f6b","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["6167db7.423bc24"],"x":75,"y":980,"wires":[["8afe2eb6.99a23","33a3a30.97dbe5e"]]},{"id":"8afe2eb6.99a23","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Proses Alldata","func":"var speed =  \"\";\nmsg.topic = \"\";\nvar prev = flow.get(\"DataPrev\");\nif(isEmpty(prev)){\n    var j = {\n        \"time\":msg.Valid.time,\n        \"lat\":msg.Valid.lat,\n        \"lon\":msg.Valid.lon\n    }\n    flow.set(\"DataPrev\",j);\n    speed =\"0.00Kn/0.00°\";\n}else{\n    prev.lat = parseFloat(prev.lat);prev.lon = parseFloat(prev.lon);\n    msg.Valid.lat = parseFloat(msg.Valid.lat);msg.Valid.lon = parseFloat(msg.Valid.lon);\n    var selisiht = Math.abs(msg.Valid.time - prev.time);\n    var spd = distance(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon,\"K\")/(selisiht/(1000*3600));\n    var knot = (1.852*spd).toFixed(2);\n    if(String(knot)==\"NaN\"){\n        knot = 0;\n    }\n    speed = String(knot)+\"Kn/\"+String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon))+\"°\";\n    msg.speed = String(knot);\n    msg.Angle = String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon));\n    flow.set(\"DataPrev\",msg.Valid);\n}\nvar json = {\n    \"EPO\":msg.Valid.time,\n    \"RECORDDATA\":formatdate(msg.Valid.time),\n    \"SHIP_NAME\":\"MBP3222\",\n    \"LAT\":msg.Valid.lat,\n    \"LON\":msg.Valid.lon,\n    \"DEPARTURE\":msg.polpod.split('-')[0],\n    \"ARRIVAL\":msg.polpod.split('-')[1],\n    \"CURRENTT\":msg.Create.curloc, \n    \"NEXTT\":msg.Create.nexloc, //\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":Math.round(msg.Grafana2.R1),\n    \"RPMENGINE_S\":Math.round(msg.Grafana2.R2),\n    \"RPMPROP_P\":Math.round(parseInt(msg.Grafana2.R8)),\n    \"RPMPROP_S\":Math.round((parseInt(msg.Grafana2.R5))),\n    \"WINDSPEED\":(parseFloat(String(msg.Grafana2.ws))),\n    \"SPEEDCOURSE\":speed\n};\nmsg.alldata = json;\nmsg.payload = json;\nmsg.measurement = \"alldata\";\nreturn msg;\n\nfunction toStringEpo(x){\n    var date = String(new Date(x));\n    var sub = String(date).substring(0,date.length-25);\n    return sub;\n}\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}\n\nfunction isEmpty(obj) {\n  for(var prop in obj) {\n    if(Object.prototype.hasOwnProperty.call(obj, prop)) {\n      return false;\n    }\n  }\n  return JSON.stringify(obj) === JSON.stringify({});\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":980,"wires":[["6710947e.4376cc","98372a16.569fe8"]]},{"id":"b3b3c717.d35168","type":"comment","z":"80eab637.b91808","g":"5248f06a.76272","name":"ProcessToApex","info":"","x":180,"y":860,"wires":[]},{"id":"9c13f98d.5d8308","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":270,"y":1100,"wires":[]},{"id":"2277318a.6b0d4e","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":830,"y":900,"wires":[[]]},{"id":"3b9a9f1d.60079","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":860,"wires":[["a193e1f6.4514a"]]},{"id":"a193e1f6.4514a","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SetDataPrev","func":"flow.set(\"DataPrev\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":860,"wires":[[]]},{"id":"cb555a8e.d789d8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"ShowDataPrev","func":"msg.payload = flow.get(\"DataPrev\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":820,"wires":[["fe4478d0.f11298"]]},{"id":"2698458e.b38c6a","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":820,"wires":[["cb555a8e.d789d8"]]},{"id":"6710947e.4376cc","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Alldata","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldatadata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":980,"wires":[["885f5406.b99b98"]]},{"id":"eb681426.6669a8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":780,"wires":[[]]},{"id":"885f5406.b99b98","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":" PopUpp","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":msg.alldata.DEPARTURE,\n    \"ARRIVAL\":msg.alldata.ARRIVAL,\n    \"CURRENTT\":msg.alldata.CURRENTT,\n    \"NEXTT\":msg.alldata.NEXTT,\n    \"LASTRECORDDATE\":msg.alldata.RECORDDATA,\n    \"LASTRECEIVEDATE\":formatdate(Date.now()),\n    \"LATITUDE\":msg.alldata.LAT,\n    \"LONGITUDE\":msg.alldata.LON,\n    \"NAMEE\":\"MBP 3222\",\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":msg.alldata.RPMENGINE_P,\n    \"RPMENGINE_S\":msg.alldata.RPMENGINE_S,\n    \"RPMPROPELLER_P\":msg.alldata.RPMPROP_P,\n    \"RPMPROPELLER_S\":msg.alldata.RPMPROP_S,\n    \"WINDSPEED\":msg.alldata.WINDSPEED,\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE,\n    \"BARGE\":msg.imov.BARGE,\n    \"DESTINATION\":msg.deparv.split('-')[1],\n    \"FROMM\":msg.deparv.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"ONSTART\").ROB),\n    \"TD\":TDDD(),\n    \"ETA\":ETAAA(),\n    \"RPMAVR\":Math.round((msg.alldata.RPMENGINE_P+msg.alldata.RPMENGINE_S)/2),\n    \"TARGET_FO\":targetfo(msg.imov.fo_target)\n}\nmsg.popupp = msg.payload;\nmsg.topic = \"\";\nmsg.measurement = \"popup\";\nflow.set(\"POPUPMBP3222\",msg.payload);\nreturn msg;\nfunction targetfo(x){\n    if(x!=null){\n        return parseFloat(String(x));\n    }else{\n        return 0;\n    }\n}\nfunction ETAAA(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time + ((msg.imov.TARGET_POL_POD)*(3600*1000))));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time + ((msg.imov.TARGET_POD_POL)*(3600*1000))));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction TDDD(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":980,"wires":[["d2fe5fa.1e87da","8e429c4b.b7fc7","1b48ebe4.d959a4","8fc17cc8.c08dd","17c886ba.6b65b9"]]},{"id":"94d892b.4554f7","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":780,"wires":[["57b3a7b7.a66a18"]]},{"id":"57b3a7b7.a66a18","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SetONSTART","func":"var json = {\n    \"time\": 1675047600000,\n    \"ROB\": 73753\n};\n// var json = {};\nflow.set(\"ONSTART\",json);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":780,"wires":[[]]},{"id":"c6389731.c6f4e8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"ShowONSTART","func":"msg.payload = flow.get(\"ONSTART\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":740,"wires":[["1f259929.06cdf7"]]},{"id":"a12e2e61.a97df","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":740,"wires":[["c6389731.c6f4e8"]]},{"id":"638b1d65.ea70d4","type":"http request","z":"80eab637.b91808","g":"5248f06a.76272","name":"alldata","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":510,"y":1020,"wires":[["fde67b46.c55d68"]]},{"id":"7acc2b7a.3be684","type":"http request","z":"80eab637.b91808","g":"5248f06a.76272","name":"popupp","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":800,"y":1020,"wires":[["2c9cd878.3e58b8","f58de549.cea3e8"]]},{"id":"9753092b.78f868","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":350,"y":700,"wires":[["f62412ad.2deb6"]]},{"id":"f62412ad.2deb6","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SetAlur","func":"flow.set(\"Alur\",\"ToPoD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":700,"wires":[[]]},{"id":"cd7c8b58.49c428","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"ShowAlur","func":"msg.payload = flow.get(\"Alur\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":660,"wires":[["96f309d9.8c0bc8"]]},{"id":"ecb286c.188cd78","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":660,"wires":[["cd7c8b58.49c428"]]},{"id":"d2fe5fa.1e87da","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":710,"y":980,"wires":[]},{"id":"72aea59.c4a235c","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":870,"y":660,"wires":[["fa5f2c90.b5758"]]},{"id":"6318aa3a.caf1f4","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":870,"y":700,"wires":[["d11035c6.e1a4f8"]]},{"id":"fa5f2c90.b5758","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"ShowPOD","func":"msg.payload = flow.get(\"POD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":660,"wires":[["2948b09c.3da6b"]]},{"id":"d11035c6.e1a4f8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SetPOD","func":"flow.set(\"POD\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":700,"wires":[[]]},{"id":"8e429c4b.b7fc7","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"SaveGPS","func":"var json = {\n    \"time\":msg.Valid.time,\n    \"Alur\":flow.get(\"Alur\"),\n    \"GPS\":String(msg.Valid.lat)+\",\"+String(msg.Valid.lon)\n}\nmsg.payload = json;\nmsg.measurement = \"PO\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1060,"wires":[["a840537d.19d7a"]]},{"id":"a840537d.19d7a","type":"influxdb out","z":"80eab637.b91808","d":true,"g":"5248f06a.76272","influxdb":"76f4cea2.88ada","name":"PO","measurement":"PO","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":850,"y":1060,"wires":[]},{"id":"3bde898e.4534e6","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3660","crontab":"","once":true,"onceDelay":0.1,"topic":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'MBP 3222' ORDER BY DATE_TIME DESC","payloadType":"date","x":810,"y":820,"wires":[["813678d4b5e17a9a"]]},{"id":"509e6195.182e5","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1190,"y":880,"wires":[]},{"id":"3581f557.a7092a","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Save","func":"flow.set(\"IMOV\",msg.payload);\nmsg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":820,"wires":[[]]},{"id":"2c9cd878.3e58b8","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1030,"y":1020,"wires":[]},{"id":"c7aceb2f.2a6138","type":"function","z":"80eab637.b91808","d":true,"g":"5248f06a.76272","name":"Report","func":"try{\n    if(msg.payload.split(':')[0] == \"Error\"){\n        msg.payload = String(msg.measurement)+\" Apex Error\";\n    }else{\n        msg.payload = null;\n    }\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":1060,"wires":[["b1b90fcb.9d1e1"]]},{"id":"b1b90fcb.9d1e1","type":"switch","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1150,"y":1040,"wires":[["75a06ca8.5a8ec4"]]},{"id":"75a06ca8.5a8ec4","type":"mqtt out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1310,"y":1060,"wires":[]},{"id":"41e15b3e.e35bd4","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"RESETALL","links":["5bb156f5.c3eaf8"],"x":375,"y":700,"wires":[["f62412ad.2deb6"]]},{"id":"bfdad16d.077a4","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"RESETALL","links":["5bb156f5.c3eaf8"],"x":375,"y":780,"wires":[["57b3a7b7.a66a18"]]},{"id":"f88bd21e.1a2d4","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"RESETALL","links":["5bb156f5.c3eaf8"],"x":375,"y":860,"wires":[["a193e1f6.4514a"]]},{"id":"987815be.b9f298","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"RESETALL","links":["5bb156f5.c3eaf8"],"x":895,"y":700,"wires":[["d11035c6.e1a4f8"]]},{"id":"f58de549.cea3e8","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["11e0d0e3.85c00f"],"x":915,"y":1020,"wires":[]},{"id":"11e0d0e3.85c00f","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["fde67b46.c55d68","f58de549.cea3e8"],"x":935,"y":1060,"wires":[["c7aceb2f.2a6138"]]},{"id":"e920bf4e.5a398","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"Msg.Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1140,"y":780,"wires":[]},{"id":"6c22d906.4af448","type":"link in","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["2948b09c.3da6b","96f309d9.8c0bc8","1f259929.06cdf7","fe4478d0.f11298"],"x":1015,"y":780,"wires":[["e920bf4e.5a398"]]},{"id":"2948b09c.3da6b","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["6c22d906.4af448"],"x":1155,"y":660,"wires":[]},{"id":"96f309d9.8c0bc8","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["6c22d906.4af448"],"x":575,"y":660,"wires":[]},{"id":"1f259929.06cdf7","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["6c22d906.4af448"],"x":615,"y":740,"wires":[]},{"id":"fe4478d0.f11298","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["6c22d906.4af448"],"x":615,"y":820,"wires":[]},{"id":"fde67b46.c55d68","type":"link out","z":"80eab637.b91808","g":"5248f06a.76272","name":"","links":["11e0d0e3.85c00f"],"x":595,"y":1040,"wires":[]},{"id":"1b48ebe4.d959a4","type":"trigger","z":"80eab637.b91808","g":"5248f06a.76272","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":890,"y":980,"wires":[["f475e59c.d2f8b8"],[]]},{"id":"f475e59c.d2f8b8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"From","func":"flow.set(\"REPORTPOPUP1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":940,"wires":[[]]},{"id":"bea9228d.dd1ca","type":"influxdb out","z":"80eab637.b91808","g":"5248f06a.76272","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":490,"y":1060,"wires":[]},{"id":"d2c6e533.334478","type":"influxdb out","z":"80eab637.b91808","g":"5248f06a.76272","influxdb":"76f4cea2.88ada","name":"Popupp","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":860,"y":1100,"wires":[]},{"id":"62c58a83.9022d4","type":"function","z":"7399def9.9066","name":" ","func":"var d = msg.payload;\nd['Meter'] = parseFloat((15.7-parseFloat(rumus(d.RawValue))).toFixed(3));\ndelete d['RawValue'];\nmsg.payload = d;\nreturn msg;\n\nfunction rumus(x){\n    return ((-15.284*x) + 30686)/1000;\n}\n\n// -14,699x + 30838","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":180,"wires":[["9903fe00.db671","6241879e.7e0c48","98df88ef.449248","32adb113.ae270e"]]},{"id":"9903fe00.db671","type":"debug","z":"7399def9.9066","name":"Meter","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.Meter","targetType":"msg","statusVal":"payload.Meter","statusType":"auto","x":600,"y":180,"wires":[]},{"id":"64b02d1a.0410f4","type":"debug","z":"7399def9.9066","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.RawValue","targetType":"msg","statusVal":"payload","statusType":"auto","x":290,"y":180,"wires":[]},{"id":"6241879e.7e0c48","type":"influxdb out","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":" ","measurement":"Tuhup1Meter","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":590,"y":180,"wires":[]},{"id":"e497671.a069098","type":"inject","z":"7399def9.9066","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from Tuhup1 ","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":190,"y":820,"wires":[["d092908c.1e00c"]]},{"id":"d092908c.1e00c","type":"influxdb in","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":340,"y":820,"wires":[["f928d42d.717ce8"]]},{"id":"655b0a77.0552f4","type":"debug","z":"7399def9.9066","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":980,"wires":[]},{"id":"fefccd54.7d001","type":"debug","z":"7399def9.9066","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":800,"y":920,"wires":[]},{"id":"f928d42d.717ce8","type":"subflow:e9b71a55.b25c68","z":"7399def9.9066","name":"","x":360,"y":920,"wires":[["2f597bd5.ba43e4"],[]]},{"id":"2f597bd5.ba43e4","type":"function","z":"7399def9.9066","name":" ","func":"var dat = new Date(msg.payload.time);\nmsg.payload['time'] = dat.getTime();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":980,"wires":[["ebd36f6d.06d71"]]},{"id":"f4aa6d21.92bb7","type":"inject","z":"7399def9.9066","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1665024466868,\"DeviceID\":\"FS100\",\"RawValue\":1660}","payloadType":"json","x":170,"y":1000,"wires":[["2f597bd5.ba43e4"]]},{"id":"ebd36f6d.06d71","type":"function","z":"7399def9.9066","name":" ","func":"var d = msg.payload;\nd['Meter'] = parseFloat((15.7-parseFloat(rumus(d.RawValue).toFixed(3))).toFixed(3));\ndelete d['RawValue'];\nd['time'] = d.time*1000000\nmsg.payload = d;\nreturn msg;\n\nfunction rumus(x){\n    return ((-15.284*x) + 30686)/1000;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":880,"wires":[["fefccd54.7d001"]]},{"id":"3c0e3a43.43caf6","type":"function","z":"7399def9.9066","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":100,"wires":[["bfb33b52.25af38"]]},{"id":"bfb33b52.25af38","type":"debug","z":"7399def9.9066","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":550,"y":100,"wires":[]},{"id":"0d95233a9ea32f53","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"IDD\":1660727708800,\"CHLORINE\":\"5.759\",\"RESERVOIR_VOL\":\"0\",\"RESERVOIR_HEIGHT\":\"0\",\"RAW_TBD\":\"0\",\"RAW_PH\":\"10.23\",\"RAW_FLOW\":\"0\",\"PRODUCT_TBD\":\"0\",\"PRODUCT_PH\":\"7.67\",\"PRODUCT_FLOW\":\"0\",\"PRODUCT_PRESSURE\":\"0\",\"SENDIMEN_1\":\"0\",\"SENDIMEN_2\":\"6\"}","payloadType":"json","x":870,"y":3420,"wires":[["67d92e35.22635"]]},{"id":"2b05660c6a23e668","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1110,"y":3560,"wires":[]},{"id":"67d92e35.22635","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertwtpdti\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":3660,"wires":[["2b05660c6a23e668","f58495ee.7f8f68"]]},{"id":"f58495ee.7f8f68","type":"http request","z":"fdac93f7.bec1b","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":3660,"wires":[["2b05660c6a23e668"]]},{"id":"a5f554f6.284c58","type":"link in","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"","links":["7e26af6.789d45"],"x":95,"y":680,"wires":[["79406cf2.c77844","d3a9b6b3.db8b78"]]},{"id":"d3a9b6b3.db8b78","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar ss = d.ws.split(',')\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(ss[1]),\n    \"WS\":detectInt(ss[0]),\n    \"F1\":MA(d.FS101,1),\n    \"F2\":MA(d.FS107,2),\n    \"F3\":MA(d.FS135,3),\n    \"F4\":MA(d.FS119,4),\n    \"F5\":MA(d.FS118,5),\n    \"F6\":MA(d.FS123,6),\n    \"F7\":MA(d.FS129,7),\n    \"Speed\":parseFloat(ss[2])\n}\njson['cmStorageKanan'] = storagekanan(json.F6,json.F7);\njson['cmStorageKiri'] = storagekiri(json.F4,json.F5);\njson['cmdailydepan'] = dailydepan(json.F1);\njson['cmdailytengah'] = dailytengah(json.F2);\njson['cmdailybelakang'] = dailybelakang(json.F3);\n\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPSTORAGEIBUF` WHERE `Sonde` = \"+String(json.cmStorageKanan)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPSTORAGEIBUF` WHERE `Sonde` = \"+String(json.cmStorageKiri)+\";\";\n\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYAEIBUF` WHERE `Sonde` = \"+String(json.cmdailydepan)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYME1IBUF` WHERE `Sonde` = \"+String(json.cmdailytengah)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYME2IBUF` WHERE `Sonde` = \"+String(json.cmdailybelakang)+\";\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(a != \"-1\"){\n        if(b<8){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=7){\n            a = parseInt(String(a));\n        }\n        var cekk = isNaN(a);\n        if(!cekk){\n            n.push(a);    \n        }\n        \n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<8){\n        if(avr(n)<=400){\n            return 400;\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\nfunction storagekiri(x,y){\n    if(x<550){\n        x = 550;\n    }\n    if(y<550){\n        y = 550;\n    }\n    return Math.round((x * -0.1342635707859126)+(y * 0.4510283648761688)+(-173.2365949520938));\n}\nfunction storagekanan(x,y){\n    if(x<450){\n        x = 450;\n    }\n    if(y<450){\n        y = 450;\n    }\n    return Math.round((x * 0.17324194421034042)+(y * 0.0806177486684608)+(-112.99561379766477));\n}\nfunction dailydepan(x){\n    return Math.round((0.063*x) - 20.954);\n}\nfunction dailytengah(x){\n    return Math.round((0.095*x) - 34.643);\n}\nfunction dailybelakang(x){\n    return Math.round((0.0987*x) - 42.462);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":680,"wires":[["7fc7962d.cb1548","86219589.53bc58"]]},{"id":"d61c2f7.6cd58d","type":"comment","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"StoretoDatabase","info":"","x":160,"y":640,"wires":[]},{"id":"aa262aea.323d68","type":"inject","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":640,"wires":[["6a9a35b7.ea5f3c"]]},{"id":"ba8bb479.9ecd78","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=11;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":600,"wires":[["c3c00a46.6763a8"]]},{"id":"5a5e5f9a.4f44d","type":"inject","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":600,"wires":[["ba8bb479.9ecd78"]]},{"id":"c3c00a46.6763a8","type":"debug","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":600,"wires":[]},{"id":"818d5030.a504d","type":"debug","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":710,"y":760,"wires":[]},{"id":"86219589.53bc58","type":"mysql","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","mydb":"be353e7e.73b9d","name":"","x":410,"y":680,"wires":[["6e03c0d3.f0097"]]},{"id":"6e03c0d3.f0097","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"StorageKananLiter\":d[0][0].Liter,\n    \"StorageKiriLiter\":d[1][0].Liter,\n    \"DailyAELiter\":d[2][0].Liter,\n    \"DailyME1Liter\":d[3][0].Liter,\n    \"DailyME2Liter\":d[4][0].Liter,\n    \"ROB\":ROB(d),\n    \"ws\":convertws(msg.data.WS),\n    \"StorageKananCm\":msg.data.cmStorageKanan,\n    \"StorageKiriCm\":msg.data.cmStorageKiri,\n    \"DailyAECm\":msg.data.cmdailydepan,\n    \"DailyME1Cm\":msg.data.cmdailytengah,\n    \"DailyME2Cm\":msg.data.cmdailybelakang\n}\nmsg.GrafanaIBUF = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    res+=x[0][0].Liter;\n    res+=x[1][0].Liter;\n    res+=x[2][0].Liter;\n    res+=x[3][0].Liter;\n    res+=x[4][0].Liter;\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":680,"wires":[["818d5030.a504d","35f1061.1ff9bfa","f0dbd8b0.62ecc8","f2423db4.80f74","5d4d656b.813b0c"]]},{"id":"5d4d656b.813b0c","type":"link out","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"","links":["ec8ad53d.6eff68"],"x":675,"y":640,"wires":[]},{"id":"35f1061.1ff9bfa","type":"influxdb out","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"GrafanaIBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":720,"y":720,"wires":[]},{"id":"1042909d.91529f","type":"influxdb out","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","influxdb":"76f4cea2.88ada","name":"GrafanaMA","measurement":"GrafanaMAIBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":550,"y":720,"wires":[]},{"id":"1022a007.6e304","type":"influxdb out","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","influxdb":"76f4cea2.88ada","name":"GrafanaRaw","measurement":"GrafanaRawIBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":390,"y":760,"wires":[]},{"id":"79406cf2.c77844","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nd['angle'] = d.ws.split(',')[1];\nd['speed'] = d.ws.split(',')[2];\nd['ws'] = d.ws.split(',')[0];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":parseFloat(d.ws),\n    \"Angle\":parseFloat(d.angle),\n    \"F1\":parseInt(String(d.FS101)),\n    \"F2\":parseInt(String(d.FS107)),\n    \"F3\":parseInt(String(d.FS135)),\n    \"F4\":parseInt(String(d.FS119)),\n    \"F5\":parseInt(String(d.FS118)),\n    \"F6\":parseInt(String(d.FS123)),\n    \"F7\":parseInt(String(d.FS129)),\n    \"Speed\":parseFloat(d.speed)\n}\njson['cmStorageKanan'] = storagekanan(json.F6,json.F7);\njson['cmStorageKiri'] = storagekiri(json.F4,json.F5);\njson['cmdailydepan'] = dailydepan(json.F1);\njson['cmdailytengah'] = dailytengah(json.F2);\njson['cmdailybelakang'] = dailybelakang(json.F3);\n\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPSTORAGEIBUF` WHERE `Sonde` = \"+String(json.cmStorageKanan)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPSTORAGEIBUF` WHERE `Sonde` = \"+String(json.cmStorageKiri)+\";\";\n\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYAEIBUF` WHERE `Sonde` = \"+String(json.cmdailydepan)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYME1IBUF` WHERE `Sonde` = \"+String(json.cmdailytengah)+\";\";\nmsg.topic += \"SELECT `Liter` FROM `LOOKUPDAILYME2IBUF` WHERE `Sonde` = \"+String(json.cmdailybelakang)+\";\";\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction storagekiri(x,y){\n    if(x<550){\n        x = 550;\n    }\n    if(y<550){\n        y = 550;\n    }\n    return Math.round((x * -0.1342635707859126)+(y * 0.4510283648761688)+(-173.2365949520938));\n}\nfunction storagekanan(x,y){\n    if(x<450){\n        x = 450;\n    }\n    if(y<450){\n        y = 450;\n    }\n    return Math.round((x * 0.17324194421034042)+(y * 0.0806177486684608)+(-112.99561379766477));\n}\nfunction dailydepan(x){\n    return Math.round((0.063*x) - 20.954);\n}\nfunction dailytengah(x){\n    return Math.round((0.095*x) - 34,643);\n}\nfunction dailybelakang(x){\n    return Math.round((0.0987*x) - 42.462);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":760,"wires":[["1022a007.6e304","f5046ab5.2c6128","fef6fa5e.3020c8"]]},{"id":"7fc7962d.cb1548","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" Store MA","func":"var a = msg.payload;\nvar t = a.Time;\na['time'] = tonanosec(t);\nmsg.payload = a\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":720,"wires":[["1042909d.91529f"]]},{"id":"d05319ad.d96d38","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.time),//1000\n    \"StorageKananLiter\":d[0][0].Liter,\n    \"StorageKiriLiter\":d[1][0].Liter,\n    \"DailyAELiter\":d[2][0].Liter,\n    \"DailyME1Liter\":d[3][0].Liter,\n    \"DailyME2Liter\":d[4][0].Liter,\n    \"ROB\":ROB(d),\n    \"ws\":msg.data.WS,\n    \"StorageKananCm\":msg.data.cmStorageKanan,\n    \"StorageKiriCm\":msg.data.cmStorageKiri,\n    \"DailyAECm\":msg.data.cmdailydepan,\n    \"DailyME1Cm\":msg.data.cmdailytengah,\n    \"DailyME2Cm\":msg.data.cmdailybelakang\n}\n\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    res+=x[0][0].Liter;\n    res+=x[1][0].Liter;\n    res+=x[2][0].Liter;\n    res+=x[3][0].Liter;\n    res+=x[4][0].Liter;\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":820,"wires":[["f49cdda3.a2db7"]]},{"id":"f5046ab5.2c6128","type":"mysql","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","mydb":"be353e7e.73b9d","name":"","x":370,"y":820,"wires":[["d05319ad.d96d38"]]},{"id":"f49cdda3.a2db7","type":"influxdb out","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","influxdb":"76f4cea2.88ada","name":"GrafanaRawLiter","measurement":"GrafanaRawLiterIBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":790,"y":820,"wires":[]},{"id":"f2423db4.80f74","type":"debug","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":760,"y":620,"wires":[]},{"id":"f0dbd8b0.62ecc8","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":680,"wires":[["645b7ace.20e1f4"]]},{"id":"645b7ace.20e1f4","type":"debug","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":660,"wires":[]},{"id":"ec8ad53d.6eff68","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["5d4d656b.813b0c"],"x":115,"y":1180,"wires":[["abaea431.b6ab18"]]},{"id":"abaea431.b6ab18","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" Take GeoFence","func":"// msg.Valid = msg.payload;\nmsg.Create = {};\nmsg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `geofenceID` ASC;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":1180,"wires":[["202e42ce.f3f2ae"]]},{"id":"202e42ce.f3f2ae","type":"mysql","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","mydb":"be353e7e.73b9d","name":"","x":390,"y":1180,"wires":[["96771a3c.58faf8"]]},{"id":"96771a3c.58faf8","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Proses","func":"msg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    msg.Valid['lat'] = prev.lat;\n    msg.Valid['lon'] = prev.lon;\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \n\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0]){ //&& lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1180,"wires":[["4a66d8b5.2afbc8","1f514f1c.c6d471"]]},{"id":"dc33570c.7a7a98","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SELECTQUERY","func":"msg.imov = flow.get(\"IMOV\")[0];\nvar polpod = String(msg.imov.POL)+\"-\"+\"\"+String(msg.imov.POD);\nmsg.polpod = polpod;\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') ORDER BY `PathNum` ASC;\";\nmsg.topic += \"SELECT `Name`,`PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"';\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `VID` = 'A2';\";\nmsg.topic += \"UPDATE `TaskID` SET `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') WHERE `VID`='A2';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1220,"wires":[["7cf50b78.45d6a4"]]},{"id":"4a66d8b5.2afbc8","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["82e51829.ded438"],"x":775,"y":1180,"wires":[]},{"id":"82e51829.ded438","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["4a66d8b5.2afbc8"],"x":135,"y":1220,"wires":[["dc33570c.7a7a98"]]},{"id":"45f1151b.9f72ac","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_RouteIBUF`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\n\nmsg.topic += \"UPDATE `TaskID` SET `PathNum` = \"+d.pathNum+\" WHERE `VID` = 'A2';\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1220,"wires":[["44bf73a3.c8342c","b883ac45.4cf46"]]},{"id":"7cf50b78.45d6a4","type":"mysql","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","mydb":"be353e7e.73b9d","name":"","x":410,"y":1220,"wires":[["e9cc4ba1.a6c658","30ec27c3.678148"]]},{"id":"e9cc4ba1.a6c658","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Create Data MBP3222","func":"var pN = msg.payload[0];var PathID = msg.payload[1][0].PathID;msg.deparv = msg.payload[1][0].Name;var cycle = msg.payload[2][0].Cycle\nvar Main = \"\";var PathNum = 0;var Next = \"\";\nvar Alur = flow.get(\"Alur\")\nmsg.topic = msg.countt;\nfor(i=0;i<pN.length;i++){\n    if(pN[i].geofenceID == msg.Create.geofenceID){\n        Main = pN[i].Main_Activity;\n        PathNum = pN[i].PathNum;\n        \n        if(i<1){\n            var ONSTART = flow.get(\"ONSTART\");\n            ONSTART['ROB'] = msg.ROB;\n            ONSTART['time'] = msg.Valid.time;\n            if(ONSTART!=undefined){\n            flow.set(\"ONSTART\",ONSTART);\n            }\n            flow.set(\"Alur\",\"Start\")\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"Start\"){\n            flow.set(\"Alur\",\"ToPoD\");\n        }else if(i>=Math.round(pN.length/2)){\n            // var ONEND = flow.get(\"POD\");\n            var ONEND = {};\n            ONEND['ROB'] = msg.ROB;\n            ONEND['time'] = msg.Valid.time;\n            flow.set(\"POD\",ONEND);\n            flow.set(\"Alur\",\"End\");\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"End\"){\n            flow.set(\"Alur\",\"ToPoL\");\n        }\n        Alur = flow.get(\"Alur\");\n        if(Alur == \"ToPoL\"){\n            Next = pN[i-1].Main_Activity;\n        }else{\n            Next = pN[i+1].Main_Activity;\n        }\n        break;\n    }\n}\nvar json = {\n    \"epoch\": msg.Valid.time,\n    \"date\": tcc(msg.Valid.time),\n    \"shipname\": \"TAMBAT\",\n    \"GPS\": String(msg.Valid.lat)+\",\"+String(msg.Valid.lon),\n    \"pathid\": PathID,\n    \"pathName\": msg.polpod,\n    \"pathNum\": PathNum,\n    \"geofenceID\":msg.Create.geofenceID,\n    \"curloc\": Main,\n    \"nexloc\": Next,\n    \"imoveid\": msg.imov.ID,\n    \"barge\":msg.imov.BARGE,\n    \"cycle\":cycle,\n    \"statuss\":\"\"\n}\nAlur = flow.get(\"Alur\");\nif(Alur == \"ToPoL\" || Alur == \"End\"){\n    msg.polpod = msg.polpod.split('-')[1]+\"-\"+msg.polpod.split('-')[0];\n    msg.deparv = msg.deparv.split('-')[1]+\"-\"+msg.deparv.split('-')[0];\n}\nmsg.Create = json;\nmsg.payload = json;\nreturn msg;\n\n\nfunction MainActive(x,pN){\n    var res = [];\n    \n    return [];\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1220,"wires":[["45f1151b.9f72ac"]]},{"id":"44bf73a3.c8342c","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["c3cd1add.b91bc8"],"x":955,"y":1220,"wires":[]},{"id":"c3cd1add.b91bc8","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["44bf73a3.c8342c"],"x":135,"y":1260,"wires":[["71c279ed.eee3b8"]]},{"id":"71c279ed.eee3b8","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Proses Alldata","func":"var speed =  \"\";\nmsg.topic = \"\";\nvar prev = flow.get(\"DataPrev\");\nif(isEmpty(prev)){\n    var j = {\n        \"time\":msg.Valid.time,\n        \"lat\":parseFloat(String(msg.Valid.lat)),\n        \"lon\":parseFloat(String(msg.Valid.lon))\n    }\n    flow.set(\"DataPrev\",j);\n    speed =\"0.00Kn/0.00°\";\n}else{\n    prev.lat = parseFloat(prev.lat);prev.lon = parseFloat(prev.lon);\n    msg.Valid.lat = parseFloat(msg.Valid.lat);msg.Valid.lon = parseFloat(msg.Valid.lon);\n    var selisiht = Math.abs(msg.Valid.time - prev.time);\n    var spd = distance(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon,\"K\")/(selisiht/(1000*3600));\n    var knot = (1.852*spd).toFixed(2);\n    if(String(knot)==\"NaN\"){\n        knot = 0;\n    }\n    // speed = String(knot)+\"Kn/\"+String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon))+\"°\";\n    speed = String(msg.Valid.speed)+\"Kn/\"+String(msg.Valid.angle)+\"°\";\n    \n    flow.set(\"DataPrev\",msg.Valid);\n}\nvar json = {\n    \"EPO\":msg.Valid.time,\n    \"RECORDDATA\":formatdate(msg.Valid.time),\n    \"SHIP_NAME\":\"IBUF\",\n    \"LAT\":msg.Valid.lat,\n    \"LON\":msg.Valid.lon,\n    \"DEPARTURE\":\"__\",\n    \"ARRIVAL\":\"__\",\n    \"CURRENTT\":msg.Create.curloc, \n    \"NEXTT\":\"__\", //\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":0,\n    \"RPMENGINE_S\":0,\n    \"RPMPROP_P\":0,\n    \"RPMPROP_S\":0,\n    \"WINDSPEED\":(parseFloat(String(msg.GrafanaIBUF.ws))),\n    \"SPEEDCOURSE\":\"__\"\n};\nmsg.alldata = json;\nmsg.payload = json;\nmsg.measurement = \"alldata\";\nreturn msg;\n\nfunction toStringEpo(x){\n    var date = String(new Date(x));\n    var sub = String(date).substring(0,date.length-25);\n    return sub;\n}\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}\n\nfunction isEmpty(obj) {\n  for(var prop in obj) {\n    if(Object.prototype.hasOwnProperty.call(obj, prop)) {\n      return false;\n    }\n  }\n  return JSON.stringify(obj) === JSON.stringify({});\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1260,"wires":[["6bdf45d8.1ae9cc","9ae49310.cdfea","2c8499cd.96f2a6"]]},{"id":"f1de1887.b06738","type":"comment","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"ProcessToApex","info":"","x":240,"y":1140,"wires":[]},{"id":"6bdf45d8.1ae9cc","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":1360,"wires":[]},{"id":"b883ac45.4cf46","type":"mysql","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","mydb":"be353e7e.73b9d","name":"","x":890,"y":1180,"wires":[[]]},{"id":"229a9a3.e829b66","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1140,"wires":[["ef28d4ab.15ef58"]]},{"id":"ef28d4ab.15ef58","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SetDataPrev","func":"flow.set(\"DataPrev\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1140,"wires":[[]]},{"id":"fe575826.ae4fc8","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"ShowDataPrev","func":"msg.payload = flow.get(\"DataPrev\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1100,"wires":[["d841d151.6f1f8"]]},{"id":"ec87b3fc.03e83","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1100,"wires":[["fe575826.ae4fc8"]]},{"id":"9ae49310.cdfea","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Alldata","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1260,"wires":[["5354c1a3.24f1f"]]},{"id":"188c30de.c5ca0f","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1060,"wires":[[]]},{"id":"5354c1a3.24f1f","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" PopUpp","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":\"__\",\n    \"ARRIVAL\":\"__\",\n    \"CURRENTT\":msg.Create.curloc,\n    \"NEXTT\":\"__\",\n    \"LASTRECORDDATE\":msg.alldata.RECORDDATA,\n    \"LASTRECEIVEDATE\":formatdate(Date.now()),\n    \"LATITUDE\":msg.alldata.LAT,\n    \"LONGITUDE\":msg.alldata.LON,\n    \"NAMEE\":\"IBUF\",\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":0,//msg.alldata.RPMENGINE,\n    \"RPMENGINE_S\":0,//msg.alldata.RPMENGINE,\n    \"RPMPROPELLER_P\":0,\n    \"RPMPROPELLER_S\":0,\n    \"WINDSPEED\":msg.alldata.WINDSPEED,\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE,\n    \"BARGE\":\"__\",\n    \"DESTINATION\":\"__\",\n    \"FROMM\":\"__\",\n    \"ROBONSTART\":\"__\",\n    \"TD\":TDDD(),\n    \"ETA\":ETAAA(),\n    \"RPMAVR\":0,//msg.alldata.RPMENGINE,\n    \"TARGET_FO\":0\n}\nmsg.popupp=msg.payload;\nmsg.measurement = \"popup\";\nflow.set(\"POPUPMBP3222\",msg.payload);\nreturn msg;\nfunction ETAAA(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time + ((msg.imov.TARGET_POL_POD)*(3600*1000))));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time + ((msg.imov.TARGET_POD_POL)*(3600*1000))));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction TDDD(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1260,"wires":[["5fd15150.ff2c4","bc97fd31.13e31","d572433f.e022a","f2990aa5.b97c58"]]},{"id":"cf28e50a.113a28","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1060,"wires":[["3a8acd4e.b2c502"]]},{"id":"3a8acd4e.b2c502","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SetONSTART","func":"flow.set(\"ONSTART\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1060,"wires":[[]]},{"id":"2edc3bb7.cdf614","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"ShowONSTART","func":"msg.payload = flow.get(\"ONSTART\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1020,"wires":[["f06ca5a2.a9cd98"]]},{"id":"dab2839d.ee4c","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1020,"wires":[["2edc3bb7.cdf614"]]},{"id":"b2488e8c.9a50b","type":"http request","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"alldata","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":570,"y":1300,"wires":[["fcbe03a9.2a08f","74cefc9a.7cec64"]]},{"id":"d1358b73.ce2ed8","type":"http request","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"popupp","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":780,"y":1300,"wires":[["71482b84.0311a4","f3362410.5aa3e8"]]},{"id":"4c266d0.79e3094","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":980,"wires":[["9ca1ba93.0fd9e8"]]},{"id":"9ca1ba93.0fd9e8","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SetAlur","func":"flow.set(\"Alur\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":980,"wires":[[]]},{"id":"c5e0dabb.40b508","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"ShowAlur","func":"msg.payload = flow.get(\"Alur\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":940,"wires":[["808efc12.e87d9"]]},{"id":"321e8ed7.8d6642","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":940,"wires":[["c5e0dabb.40b508"]]},{"id":"5fd15150.ff2c4","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":1260,"wires":[]},{"id":"4fd66244.e33ffc","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":940,"wires":[["6d5f47d4.d8ec08"]]},{"id":"c8aa43b1.92472","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":980,"wires":[["8af1825e.7eb83"]]},{"id":"6d5f47d4.d8ec08","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"ShowPOD","func":"msg.payload = flow.get(\"POD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":940,"wires":[["94c848d.32cf8b8"]]},{"id":"8af1825e.7eb83","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SetPOD","func":"flow.set(\"POD\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":980,"wires":[[]]},{"id":"b36328a9.e7da78","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"SaveGPS","func":"var json = {\n    \"time\":msg.Valid.time,\n    \"Alur\":flow.get(\"Alur\"),\n    \"GPS\":String(msg.Valid.lat)+\",\"+String(msg.Valid.lon)\n}\nmsg.payload = json;\nmsg.measurement = \"PO\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1340,"wires":[["fe445d8f.af92d"]]},{"id":"fe445d8f.af92d","type":"influxdb out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","influxdb":"76f4cea2.88ada","name":"PO","measurement":"POTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":910,"y":1340,"wires":[]},{"id":"3e48693.f1fe896","type":"inject","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3720","crontab":"","once":true,"onceDelay":0.1,"topic":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","payloadType":"date","x":870,"y":1100,"wires":[["b9b8f74935bbf75a"]]},{"id":"8813107e.d371f","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1250,"y":1140,"wires":[]},{"id":"38e14f66.f4575","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Save","func":"flow.set(\"IMOV\",msg.payload);\nmsg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1140,"wires":[[]]},{"id":"71482b84.0311a4","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1280,"wires":[]},{"id":"d8fbe89.406d818","type":"function","z":"b6837abd.323fd8","d":true,"g":"5f95045c.cd76fc","name":"Report","func":"try{\n    if(msg.payload.split(':')[0] == \"Error\"){\n        msg.payload = String(msg.measurement)+\" Apex Error\";\n    }else{\n        msg.payload = null;\n    }\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1320,"wires":[["74949411.31ea5c"]]},{"id":"74949411.31ea5c","type":"switch","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1210,"y":1320,"wires":[["dbe04746.1ac248"]]},{"id":"dbe04746.1ac248","type":"mqtt out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1370,"y":1340,"wires":[]},{"id":"91c7d47d.d4d968","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"RESETALL","links":["b3ea6152.e7e6d"],"x":435,"y":980,"wires":[["9ca1ba93.0fd9e8"]]},{"id":"19ad0ea7.fbc441","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"RESETALL","links":["b3ea6152.e7e6d"],"x":435,"y":1060,"wires":[["3a8acd4e.b2c502"]]},{"id":"3a1d2d65.b549e2","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"RESETALL","links":["b3ea6152.e7e6d"],"x":435,"y":1140,"wires":[["ef28d4ab.15ef58"]]},{"id":"c10d99c5.ba4a08","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"RESETALL","links":["b3ea6152.e7e6d"],"x":955,"y":980,"wires":[["8af1825e.7eb83"]]},{"id":"f3362410.5aa3e8","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["e0f49ba5.bd8a08"],"x":895,"y":1300,"wires":[]},{"id":"e0f49ba5.bd8a08","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["fcbe03a9.2a08f","f3362410.5aa3e8"],"x":995,"y":1340,"wires":[["d8fbe89.406d818"]]},{"id":"2553ac6d.fce054","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Msg.Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1200,"y":1060,"wires":[]},{"id":"6a01015f.e2a79","type":"link in","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["94c848d.32cf8b8","808efc12.e87d9","f06ca5a2.a9cd98","d841d151.6f1f8"],"x":1075,"y":1060,"wires":[["2553ac6d.fce054"]]},{"id":"94c848d.32cf8b8","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["6a01015f.e2a79"],"x":1215,"y":940,"wires":[]},{"id":"808efc12.e87d9","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["6a01015f.e2a79"],"x":635,"y":940,"wires":[]},{"id":"f06ca5a2.a9cd98","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["6a01015f.e2a79"],"x":675,"y":1020,"wires":[]},{"id":"d841d151.6f1f8","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["6a01015f.e2a79"],"x":675,"y":1100,"wires":[]},{"id":"fcbe03a9.2a08f","type":"link out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","links":["e0f49ba5.bd8a08"],"x":655,"y":1320,"wires":[]},{"id":"bc97fd31.13e31","type":"trigger","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":950,"y":1260,"wires":[["fcaa5779.0a6958"],["2d0a2edb.423f32"]]},{"id":"fcaa5779.0a6958","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"From","func":"flow.set(\"REPORTPOPUP1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1220,"wires":[[]]},{"id":"2d0a2edb.423f32","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"To","func":"flow.set(\"REPORTPOPUP2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1220,"wires":[[]]},{"id":"30ec27c3.678148","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":1420,"wires":[]},{"id":"74cefc9a.7cec64","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":610,"y":1380,"wires":[]},{"id":"c5b57944.0388b8","type":"inject","z":"7399def9.9066","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM Tuhup1 ","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1120,"wires":[["ab51420d.9fc7a"]]},{"id":"ab51420d.9fc7a","type":"influxdb in","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":470,"y":1140,"wires":[["c591d0af.05c12","220bb8f8.004088"]]},{"id":"c591d0af.05c12","type":"debug","z":"7399def9.9066","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":840,"wires":[]},{"id":"220bb8f8.004088","type":"excel","z":"7399def9.9066","name":"","file":"/var/www/html/Tuhup.xlsx","x":600,"y":1220,"wires":[["c591d0af.05c12"]]},{"id":"98df88ef.449248","type":"function","z":"7399def9.9066","name":" ","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/waterlevel\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload['DEVICEID'] = msg.payload.DeviceID;\ndelete msg.payload['DeviceID'];\nmsg.payload['VALUEE'] = String(msg.payload.Meter);\ndelete msg.payload['Meter'];\nmsg.payload['IDD'] = Date.now();\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":260,"wires":[["3315d857.c212f8","78b2161f.843e08","a13b33d9.14b01","d42b03fa.af61c","269512cc.dbd61e"]]},{"id":"78b2161f.843e08","type":"http request","z":"7399def9.9066","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":770,"y":260,"wires":[["3315d857.c212f8"]]},{"id":"3315d857.c212f8","type":"debug","z":"7399def9.9066","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":930,"y":260,"wires":[]},{"id":"b6962ccf.a889b","type":"trigger","z":"7399def9.9066","name":"Online?","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"2","extend":true,"overrideDelay":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":300,"y":180,"wires":[[]]},{"id":"25f0a37f.a0694c","type":"inject","z":"7399def9.9066","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"asd","payloadType":"str","x":210,"y":740,"wires":[["befd3c3a.05a0e"]]},{"id":"43fece8d.d1cd","type":"debug","z":"7399def9.9066","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":800,"wires":[]},{"id":"befd3c3a.05a0e","type":"function","z":"7399def9.9066","name":"","func":"msg.payload = Date.now();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":720,"wires":[["43fece8d.d1cd"]]},{"id":"6cc1039d.7f480c","type":"http in","z":"fdac93f7.bec1b","name":"","url":"/nyoba","method":"get","upload":false,"swaggerDoc":"","x":940,"y":3760,"wires":[[]]},{"id":"cd3c523c.942a1","type":"http response","z":"fdac93f7.bec1b","name":"","statusCode":"","headers":{},"x":1240,"y":3740,"wires":[]},{"id":"f5b4ab05.ce7028","type":"link in","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"","links":["f396f498.da45d8"],"x":75,"y":640,"wires":[["dcd0f100.10328","b0505d84.2dd2b"]]},{"id":"b0505d84.2dd2b","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar angle = d.ws.split(',')[1];\nvar speed = d.ws.split(',')[2];\nif(isNaN(speed)){\n    speed=\"0\";\n}\nvar wind = d.ws.split(',')[0];\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(angle),\n    \"WS\":detectInt(wind),\n    // \"WS\":0,\n    \"F1\":MA(d.FS125,1),//Daily\n    \"F2\":MA(d.FS124,2),//KiriBlkng\n    \"F3\":MA(d.FS127,3),//KiriDepan\n    \"F4\":MA(d.FS120,4),//KananDepan\n    \"F5\":MA(d.FS121,5),//KananBlkng\n    \"F6\":MA(d.FS105,6),//TengahDepan\n    \"F7\":MA(d.FS112,7),//TengahBlkng\n    \"RPM106\":MA(d.RPM106,8),\n    \"RPM104\":MA(d.RPM104,9),\n    \"RPM209\":MA(d.RPM209,10),\n    \"RPM205\":MA(d.RPM205,11),\n    \"Speed\":parseFloat(speed)//MA(speed,8)\n}\njson['StorageCenter'] = StorageCenter(json.F6,json.F7);\njson['StorageKanan'] = StorageKanan(json.F4,json.F5);\njson['StorageKiri'] = StorageKiri(json.F3,json.F2);\njson['Daily'] = DailyTank(json.F1);\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\n// for(i=0;i<6;i++){\n//     var val = Math.round(json['F'+String(i+1)]);\n//     msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(val)+\";\";\n// }\nmsg.topic += \"SELECT * FROM `LOOKUPDAILYMBP3206` WHERE `Sonde`>=\"+String(json.Daily)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGEKANANMBP3206` WHERE `Sonde`>=\"+String(json.StorageKanan)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGEKIRIMBP3206` WHERE `Sonde`>=\"+String(json.StorageKiri)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGETENGAHMBP3206` WHERE `Sonde`>=\"+String(json.StorageCenter)+\" limit 1;\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(a != \"-1\"){\n        if(b<8){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=8){\n            a = parseFloat(String(a));\n        }\n        if(a % 1 === 0){\n            n.push(a);\n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=400){\n            return 400;\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\nfunction StorageCenter(x,y){\n    var res = (x * 0.42841243648887317)+(y * -0.2056183258097715)+(-103.94678576592575);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction StorageKanan(x,y){\n    var res = (x * 0.057270078054845235)+(y * 0.1335491517895142)+(-78.97277610267666);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction StorageKiri(x,y){\n    var res = (x * 0.6021531180443854)+(y * -0.4176463630886229)+(-78.74300956569955);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction DailyTank(x){\n    var res = (0.177*x) - 92.637;\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":640,"wires":[["239d5494.db9a6c","edf8f5fa.82ad98"]]},{"id":"4dadca11.448ec4","type":"comment","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"StoretoDatabase","info":"","x":140,"y":600,"wires":[]},{"id":"d8e1c04a.5f70a","type":"inject","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":310,"y":600,"wires":[["1cf77d14.598433"]]},{"id":"1cf77d14.598433","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"SetAvr","func":"for(i=1;i<=15;i++){\n    flow.set(\"avr\"+String(i),[]);\n    \n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":600,"wires":[[]]},{"id":"6ab3f15d.dfa82","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=11;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":560,"wires":[["11b4d325.9e143d"]]},{"id":"e950873e.3f1008","type":"inject","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":310,"y":560,"wires":[["6ab3f15d.dfa82"]]},{"id":"11b4d325.9e143d","type":"debug","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":560,"wires":[]},{"id":"1747df4.1f36b21","type":"debug","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":740,"wires":[]},{"id":"edf8f5fa.82ad98","type":"mysql","z":"ce7006a0.688478","g":"840bdfee.a61db","mydb":"be353e7e.73b9d","name":"","x":370,"y":640,"wires":[["596085d9.3ab0dc","6a35fb0e.07d4f4"]]},{"id":"6a35fb0e.07d4f4","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"CenterLiter\":d[3][0].Liter,\n    \"CenterCm\":d[3][0].Sonde,\n    \"KananLiter\":d[1][0].Liter,\n    \"KananCm\":d[1][0].Sonde,\n    \"KiriLiter\":d[2][0].Liter,\n    \"KiriCm\":d[2][0].Sonde,\n    \"DailyLiter\":d[0][0].Liter,\n    \"DailyCm\":d[0][0].Sonde,\n    \"ws\":convertws(msg.data.WS),\n    \"RPMKanan\":RPMkanan(msg.data.RPM106),\n    \"RPMKiri\":RPMkiri(msg.data.RPM104),\n    \"PropKanan\":String(msg.data.RPM209),\n    \"PropKiri\":String(msg.data.RPM205)\n}\njson['ROB'] = json.CenterLiter+json.KananLiter+json.KiriLiter+json.DailyLiter;\nmsg.Grafana3206 = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    if(x[1][0].Liter>=2394){//FS002\n        // res+=(Math.round((x[1][0].Liter+x[0][0].Liter)/2));//FS002+FS001/2\n        res+=x[1][0].Liter;\n    }else{\n        res+=x[1][0].Liter;\n    }\n    if(x[2][0].Liter>=2347){//FS003\n        // res+=(Math.round((x[2][0].Liter+x[5][0].Liter)/2));//FS003+FS006/2\n        res+=x[2][0].Liter;\n    }else{\n        res+=x[2][0].Liter;\n    }\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}\n\nfunction RPMkiri(x){\n    var res = 0;\n    res = (2.76871285876849*x) - 42.57238588949300\n    if(res<600){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction RPMkanan(x){\n    var res = 0;\n    res = (0.750754160044114*x) - 13.576238513829700;\n    if(res<500){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":640,"wires":[["1747df4.1f36b21","2d68b7d1.29d038","ad39e73f.49beb8","332f9703.450968","cdcd6694.3289c8","5a4b19fc.0d6438","c89db517.60d7f8"]]},{"id":"cdcd6694.3289c8","type":"link out","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"","links":["99900402.9f99d8"],"x":655,"y":600,"wires":[]},{"id":"5a4b19fc.0d6438","type":"influxdb out","z":"ce7006a0.688478","g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"Grafana3206","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":700,"y":680,"wires":[]},{"id":"11bfc50d.62239b","type":"influxdb out","z":"ce7006a0.688478","g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"GrafanaMA","measurement":"GrafanaMA3206","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":530,"y":680,"wires":[]},{"id":"b299e5f3.27a008","type":"influxdb out","z":"ce7006a0.688478","g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"GrafanaRaw","measurement":"GrafanaRaw3206","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":370,"y":740,"wires":[]},{"id":"dcd0f100.10328","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar speed = d.ws.split(',')[2];\nvar angle = d.ws.split(',')[1];\nvar ws = d.ws.split(',')[0];\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    // \"Lat\":parseFloat(d.lat),\n    // \"Lon\":parseFloat(d.lon),\n    \"WS\":parseFloat(ws),\n    \"Angle\":parseFloat(angle),\n    \"F1\":parseInt(String(d.FS125)),\n    \"F2\":parseInt(String(d.FS124)),\n    \"F3\":parseInt(String(d.FS127)),\n    \"F4\":parseInt(String(d.FS120)),\n    \"F5\":parseInt(String(d.FS121)),\n    \"F6\":parseInt(String(d.FS105)),\n    \"RPM106\":parseInt(String(d.RPM106)),\n    \"RPM104\":parseInt(String(d.RPM104)),\n    \n    // \"F1\":MA(d.FS107,1),\n    // \"F2\":MA(d.FS118,2),\n    // \"F3\":MA(d.FS119,3),\n    // \"F4\":MA(d.FS123,4),\n    // \"F5\":MA(d.FS126,5),\n    // \"F6\":MA(d.FS128,6),\n    // \"F7\":MA(d.FS129,7),\n    //--------------------\n    // \"F1\":pars(d.FS111,1),\n    // \"F2\":pars(d.FS113,2),\n    // \"F3\":pars(d.FS114,3),\n    // \"F4\":pars(d.FS115,4),\n    // \"F5\":pars(d.FS116,5),\n    // \"F6\":pars(d.FS117,6),\n    // \"R1\":pars(d.RPM113,7),\n    // \"R2\":pars(d.RPM114,8),\n    \"Speed\":parseFloat(speed)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(Math.round(json['F'+String(i+1)]))+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":720,"wires":[["b813b387.4b884","1747df4.1f36b21","b299e5f3.27a008"]]},{"id":"1e3c66e1.cc4d89","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" Store MA","func":"var a = msg.payload;\nvar t = a.Time;\na['time'] = tonanosec(t);\nmsg.payload = a\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":680,"wires":[["11bfc50d.62239b"]]},{"id":"65ae254f.1ff61c","type":"function","z":"ce7006a0.688478","d":true,"g":"840bdfee.a61db","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":msg.data.time,//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":msg.data.R1,\n    \"R2\":msg.data.R2,\n    \"R5\":msg.data.R5,\n    \"R8\":msg.data.R8,\n    \"ROB\":ROB(d)\n}\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        if(i==0||i==5){\n            continue;\n        }\n        res+=x[i][0].Liter;\n    }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":780,"wires":[["3a0c1fd0.29c3c"]]},{"id":"b813b387.4b884","type":"mysql","z":"ce7006a0.688478","d":true,"g":"840bdfee.a61db","mydb":"be353e7e.73b9d","name":"","x":350,"y":780,"wires":[["65ae254f.1ff61c"]]},{"id":"3a0c1fd0.29c3c","type":"influxdb out","z":"ce7006a0.688478","g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"GrafanaRawLiter","measurement":"GrafanaRawLiterIBUF","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":730,"y":780,"wires":[]},{"id":"ff4f56fa.a22808","type":"link in","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"RESETALL","links":[],"x":335,"y":600,"wires":[["1cf77d14.598433"]]},{"id":"2d68b7d1.29d038","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"ROB Complete","func":"var d = msg.payload;\nvar res = 0;\nif(d.F2>=2394){//FS002\n    res+=(Math.round((d.F2+d.F1)/2));//FS002+FS001/2\n    // res+=x[1][0].Liter;\n}else{\n    res+=d.F2;\n}\nif(d.F3>=2347){//FS003\n    res+=(Math.round((d.F3+d.F6)/2));//FS003+FS006/2\n    // res+=x[2][0].Liter;\n}else{\n    res+=d.F3;\n}\nres+=d.F4;//FS004\nres+=d.F5;//FS005\nmsg.payload = {\"time\":d.time,\"val\":res};\nmsg.measurement = \"ROBFrontBackIBUF\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":680,"wires":[["1f2a359a.fc511a"]]},{"id":"1f2a359a.fc511a","type":"influxdb out","z":"ce7006a0.688478","d":true,"g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"ROBComplete","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1040,"y":680,"wires":[]},{"id":"ad39e73f.49beb8","type":"debug","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":740,"y":580,"wires":[]},{"id":"332f9703.450968","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":640,"wires":[["73da23dc.245f9c"]]},{"id":"73da23dc.245f9c","type":"debug","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":890,"y":620,"wires":[]},{"id":"99900402.9f99d8","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["cdcd6694.3289c8"],"x":115,"y":1140,"wires":[["b8f6f994.a78008"]]},{"id":"b8f6f994.a78008","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" Take GeoFence","func":"// msg.Valid = msg.data;\nmsg.Create = {};\nmsg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `geofenceID` ASC;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":1140,"wires":[["e4d51f8b.830fe"]]},{"id":"e4d51f8b.830fe","type":"mysql","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mydb":"be353e7e.73b9d","name":"","x":390,"y":1140,"wires":[["c790af37.9f3d5"]]},{"id":"c790af37.9f3d5","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Proses","func":"msg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    msg.Valid['lat'] = prev.lat;\n    msg.Valid['lon'] = prev.lon;\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \n\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0]){ //&& lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1140,"wires":[["90cd3061.4c776","855fcc0d.ea371"]]},{"id":"c1dae8ce.a4a138","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SELECTQUERY","func":"msg.imov = flow.get(\"IMOV\")[0];\nvar polpod = String(msg.imov.POL)+\"-\"+\"\"+String(msg.imov.POD);\nmsg.polpod = polpod;\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') ORDER BY `PathNum` ASC;\";\nmsg.topic += \"SELECT `Name`,`PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"';\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `VID` = 'A3';\";\nmsg.topic += \"UPDATE `TaskID` SET `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') WHERE `VID`='A2';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1180,"wires":[["aa6a87b5.ebedb8","c9126f18.879e8"]]},{"id":"90cd3061.4c776","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["54f40a0c.730004"],"x":775,"y":1140,"wires":[]},{"id":"54f40a0c.730004","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["90cd3061.4c776"],"x":135,"y":1180,"wires":[["c1dae8ce.a4a138"]]},{"id":"245599c1.b52da6","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_Route3206`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\n\nmsg.topic += \"UPDATE `TaskID` SET `PathNum` = \"+d.pathNum+\" WHERE `VID` = 'A2';\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1180,"wires":[["c608a7e.c160758","2bd325cc.4a2d3a"]]},{"id":"aa6a87b5.ebedb8","type":"mysql","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mydb":"be353e7e.73b9d","name":"","x":410,"y":1180,"wires":[["98ecf42e.0e6dd8","e4f1b3ed.e3f9b"]]},{"id":"98ecf42e.0e6dd8","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Create Data MBP3206","func":"var pN = msg.payload[0];var PathID = msg.payload[1][0].PathID;msg.deparv = msg.payload[1][0].Name;var cycle = msg.payload[2][0].Cycle\nvar Main = \"_\";var PathNum = 0;var Next = \"_\";\nvar Alur = flow.get(\"Alur\")\nmsg.topic = msg.countt;\nfor(i=0;i<pN.length;i++){\n    if(pN[i].geofenceID == msg.Create.geofenceID){\n        Main = pN[i].Main_Activity;\n        PathNum = pN[i].PathNum;\n        \n        if(i<1){\n            var ONSTART = flow.get(\"ONSTART\");\n            ONSTART['ROB'] = msg.ROB;\n            ONSTART['time'] = msg.Valid.time;\n            if(ONSTART != undefined){\n                flow.set(\"ONSTART\",ONSTART);\n            }\n            flow.set(\"Alur\",\"Start\")\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"Start\"){\n            flow.set(\"Alur\",\"ToPoD\");\n        }else if(i>=Math.round(pN.length/2)){\n            // var ONEND = flow.get(\"POD\");\n            var ONEND = {};\n            ONEND['ROB'] = msg.ROB;\n            ONEND['time'] = msg.Valid.time;\n            flow.set(\"POD\",ONEND);\n            flow.set(\"Alur\",\"End\");\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"End\"){\n            flow.set(\"Alur\",\"ToPoL\");\n        }\n        Alur = flow.get(\"Alur\");\n        if(Alur == \"ToPoL\"){\n            Next = pN[i-1].Main_Activity;\n        }else{\n            Next = pN[i+1].Main_Activity;\n        }\n        break;\n    }\n}\nvar json = {\n    \"epoch\": msg.Valid.time,\n    \"date\": tcc(msg.Valid.time),\n    \"shipname\": \"TAMBAT\",\n    \"GPS\": String(msg.Valid.lat)+\",\"+String(msg.Valid.lon),\n    \"pathid\": PathID,\n    \"pathName\": msg.polpod,\n    \"pathNum\": PathNum,\n    \"geofenceID\":msg.Create.geofenceID,\n    \"curloc\": Main,\n    \"nexloc\": Next,\n    \"imoveid\": msg.imov.ID,\n    \"barge\":msg.imov.BARGE,\n    \"cycle\":cycle,\n    \"statuss\":\"\"\n}\nAlur = flow.get(\"Alur\");\nif(Alur == \"ToPoL\" || Alur == \"End\"){\n    msg.polpod = msg.polpod.split('-')[1]+\"-\"+msg.polpod.split('-')[0];\n    msg.deparv = msg.deparv.split('-')[1]+\"-\"+msg.deparv.split('-')[0];\n}\nmsg.Create = json;\nmsg.payload = json;\nreturn msg;\n\n\nfunction MainActive(x,pN){\n    var res = [];\n    \n    return [];\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":1180,"wires":[["245599c1.b52da6"]]},{"id":"c608a7e.c160758","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["6264edee.6f4f04"],"x":955,"y":1180,"wires":[]},{"id":"6264edee.6f4f04","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["c608a7e.c160758"],"x":135,"y":1220,"wires":[["1c0b96e5.038139"]]},{"id":"1c0b96e5.038139","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Proses Alldata","func":"var speed =  \"\";\nmsg.topic = \"\";\nvar prev = flow.get(\"DataPrev\");\nif(isEmpty(prev)){\n    try{\n        var j = {\n            \"time\":msg.Valid.time,\n            \"lat\":msg.Valid.lat,\n            \"lon\":msg.Valid.lon\n        }\n        if(j!=undefined){\n            flow.set(\"DataPrev\",j);\n        }\n        speed =\"0.00Kn/0.00°\";\n    }catch(x){\n        msg.CEK = true;\n    }\n}else{\n    try{\n    // prev.lat = parseFloat(prev.lat);\n    // prev.lon = parseFloat(prev.lon);\n    // msg.Valid.lat = parseFloat(msg.Valid.lat);msg.Valid.lon = parseFloat(msg.Valid.lon);\n    // var selisiht = Math.abs(msg.Valid.time - prev.time);\n    // var spd = distance(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon,\"K\")/(selisiht/(1000*3600));\n    // var knot = (1.852*spd).toFixed(2);\n    // if(String(knot)==\"NaN\"){\n    //     knot = 0;\n    // }\n    msg.Valid['speed'] = msg.Valid.ws.split(',')[2];\n    msg.Valid['angle'] = msg.Valid.ws.split(',')[1];\n    // speed = String(knot)+\"Kn/\"+String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon))+\"°\";\n    speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2))+\"Kn/\"+String(msg.Valid.angle)+\"°\";\n    msg.speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2));\n    flow.set(\"DataPrev\",msg.Valid);\n    }catch(x){\n        msg.CEK = false;\n    }\n}\nvar json = {\n    \"EPO\":msg.Valid.time,\n    \"RECORDDATA\":formatdate(msg.Valid.time),\n    \"SHIP_NAME\":\"MBP3206\",\n    \"LAT\":msg.data.Lat,\n    \"LON\":msg.data.Lon,\n    \"DEPARTURE\":msg.polpod.split('-')[0],\n    \"ARRIVAL\":msg.polpod.split('-')[1],\n    \"CURRENTT\":msg.Create.curloc, \n    \"NEXTT\":msg.Create.nexloc, //\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":msg.Grafana3206.RPMKiri,//Math.round((parseInt(msg.Valid.RPM1)+parseInt(msg.Valid.RPM2))/2),\n    \"RPMENGINE_S\":msg.Grafana3206.RPMKanan,//Math.round((parseInt(msg.Valid.RPM1)+parseInt(msg.Valid.RPM2))/2),\n    \"RPMPROP_P\":parseFloat(msg.Grafana3206.PropKanan),//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"RPMPROP_S\":parseFloat(msg.Grafana3206.PropKiri),//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"WINDSPEED\":Math.round(parseFloat(String(msg.Valid.ws))/100),\n    \"SPEEDCOURSE\":speed\n};\nmsg.alldata = json;\nmsg.payload = json;\nmsg.measurement = \"alldata\";\nreturn msg;\n\nfunction toStringEpo(x){\n    var date = String(new Date(x));\n    var sub = String(date).substring(0,date.length-25);\n    return sub;\n}\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}\n\nfunction isEmpty(obj) {\n  for(var prop in obj) {\n    if(Object.prototype.hasOwnProperty.call(obj, prop)) {\n      return false;\n    }\n  }\n  return JSON.stringify(obj) === JSON.stringify({});\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1220,"wires":[["7832c71d.8368c8","8fe909cd.7d1b98","ff8ed24a.a8b9a"]]},{"id":"ea44e728.6d0138","type":"comment","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"ProcessToApex","info":"","x":240,"y":1100,"wires":[]},{"id":"7832c71d.8368c8","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":1320,"wires":[]},{"id":"2bd325cc.4a2d3a","type":"mysql","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mydb":"be353e7e.73b9d","name":"","x":890,"y":1140,"wires":[[]]},{"id":"862b1113.8d9d9","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1100,"wires":[["357b6531.d092fa"]]},{"id":"357b6531.d092fa","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SetDataPrev","func":"flow.set(\"DataPrev\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1100,"wires":[[]]},{"id":"7aa60394.71b61c","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"ShowDataPrev","func":"msg.payload = flow.get(\"DataPrev\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1060,"wires":[["bf61f0c5.06d4"]]},{"id":"13c9bcb9.163213","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1060,"wires":[["7aa60394.71b61c"]]},{"id":"8fe909cd.7d1b98","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Alldata","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1220,"wires":[["10e5206f.98375"]]},{"id":"a858b469.484598","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1020,"wires":[[]]},{"id":"10e5206f.98375","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" PopUpp","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":msg.alldata.DEPARTURE,\n    \"ARRIVAL\":msg.alldata.ARRIVAL,\n    \"CURRENTT\":msg.alldata.CURRENTT,\n    \"NEXTT\":msg.alldata.NEXTT,\n    \"LASTRECORDDATE\":msg.alldata.RECORDDATA,\n    \"LASTRECEIVEDATE\":formatdate(Date.now()),\n    \"LATITUDE\":msg.alldata.LAT,\n    \"LONGITUDE\":msg.alldata.LON,\n    \"NAMEE\":\"MBP 3206\",\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":msg.alldata.RPMENGINE_P,\n    \"RPMENGINE_S\":msg.alldata.RPMENGINE_S,\n    \"RPMPROPELLER_P\":msg.alldata.RPMPROP_P,\n    \"RPMPROPELLER_S\":msg.alldata.RPMPROP_S,\n    \"WINDSPEED\":msg.alldata.WINDSPEED,\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE,\n    \"BARGE\":msg.imov.BARGE,\n    \"DESTINATION\":msg.deparv.split('-')[1],\n    \"FROMM\":msg.deparv.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"ONSTART\").ROB),\n    \"TD\":TDDD(),\n    \"ETA\":ETAAA(),\n    \"RPMAVR\":0,//msg.alldata.RPMENGINE,\n    \"TARGET_FO\":targetfo(msg.imov.fo_target)\n}\nmsg.popupp = msg.payload;\nmsg.measurement = \"popup\";\nflow.set(\"POPUPMBP3222\",msg.payload);\nreturn msg;\nfunction targetfo(x){\n    if(x==null){\n        return 0;\n    }else{\n        return parseFloat(String(x));\n    }\n}\nfunction ETAAA(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time + ((msg.imov.TARGET_POL_POD)*(3600*1000))));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time + ((msg.imov.TARGET_POD_POL)*(3600*1000))));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction TDDD(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1220,"wires":[["30fa5c4b.ed4ba4","1733e5da.74d4ea","c1771354.0ea98","2111e402.2b5d1c","b33efd62.a84e7"]]},{"id":"8b6aba68.2379b8","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1020,"wires":[["4c6587b0.883af8"]]},{"id":"4c6587b0.883af8","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SetONSTART","func":"flow.set(\"ONSTART\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1020,"wires":[[]]},{"id":"36715be3.c59a14","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"ShowONSTART","func":"msg.payload = flow.get(\"ONSTART\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":980,"wires":[["b4fca700.425db8"]]},{"id":"c73b0d7a.989d5","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":980,"wires":[["36715be3.c59a14"]]},{"id":"68c5e533.b6d08c","type":"http request","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"alldata","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":570,"y":1260,"wires":[["44946c9e.cdea14","2b0e947b.1c32cc"]]},{"id":"28fb0f0e.e2663","type":"http request","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"popupp","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":780,"y":1260,"wires":[["ccbce152.814d2","3e57a1a7.152cae"]]},{"id":"63bdda47.a262f4","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":940,"wires":[["a38417d1.e24a28"]]},{"id":"a38417d1.e24a28","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SetAlur","func":"flow.set(\"Alur\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":940,"wires":[[]]},{"id":"9cd7f0ba.3fe24","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"ShowAlur","func":"msg.payload = flow.get(\"Alur\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":900,"wires":[["69fe2268.9a5dcc"]]},{"id":"89a2856e.595888","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":900,"wires":[["9cd7f0ba.3fe24"]]},{"id":"30fa5c4b.ed4ba4","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":1220,"wires":[]},{"id":"28f6b124.33728e","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":900,"wires":[["9b9952b7.aa5b5"]]},{"id":"e8cd79e1.9a6388","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":940,"wires":[["1bf3ecd2.340823"]]},{"id":"9b9952b7.aa5b5","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"ShowPOD","func":"msg.payload = flow.get(\"POD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":900,"wires":[["a2f94c3d.e0f5e"]]},{"id":"1bf3ecd2.340823","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SetPOD","func":"flow.set(\"POD\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":940,"wires":[[]]},{"id":"fa0c12f4.d3cd3","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"SaveGPS","func":"var json = {\n    \"time\":msg.Valid.time,\n    \"Alur\":flow.get(\"Alur\"),\n    \"GPS\":String(msg.Valid.lat)+\",\"+String(msg.Valid.lon)\n}\nmsg.payload = json;\nmsg.measurement = \"PO\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1300,"wires":[["710b2722.784858"]]},{"id":"710b2722.784858","type":"influxdb out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","influxdb":"76f4cea2.88ada","name":"PO","measurement":"POTAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":910,"y":1300,"wires":[]},{"id":"78c26879.151a68","type":"inject","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3840","crontab":"","once":true,"onceDelay":0.1,"topic":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'MBP 3206' ORDER BY DATE_TIME DESC","payload":"","payloadType":"date","x":870,"y":1060,"wires":[["d6869cfd122385d0"]]},{"id":"1362f2bd.4b1b0d","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1250,"y":1100,"wires":[]},{"id":"76f9243b.3c1d2c","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Save","func":"flow.set(\"IMOV\",msg.payload);\nmsg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1060,"wires":[[]]},{"id":"ccbce152.814d2","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1240,"wires":[]},{"id":"a72d143b.29eb68","type":"function","z":"ce7006a0.688478","d":true,"g":"eb56ff57.5b80d","name":"Report","func":"try{\n    if(msg.payload.split(':')[0] == \"Error\"){\n        msg.payload = String(msg.measurement)+\" Apex Error\";\n    }else{\n        msg.payload = null;\n    }\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1280,"wires":[["f9f48924.d09ec8"]]},{"id":"f9f48924.d09ec8","type":"switch","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1210,"y":1280,"wires":[["8a63f5a9.ea2bc8"]]},{"id":"8a63f5a9.ea2bc8","type":"mqtt out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","topic":"WhatsAppFahmi","qos":"","retain":"","broker":"3df154b8.35094c","x":1370,"y":1300,"wires":[]},{"id":"2f92acb8.dc4104","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"RESETALL","links":[],"x":435,"y":940,"wires":[["a38417d1.e24a28"]]},{"id":"c01c08cc.19ea48","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"RESETALL","links":[],"x":435,"y":1020,"wires":[["4c6587b0.883af8"]]},{"id":"4c2b9947.fe69e8","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"RESETALL","links":[],"x":435,"y":1100,"wires":[["357b6531.d092fa"]]},{"id":"a1558c5b.23622","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"RESETALL","links":[],"x":955,"y":940,"wires":[["1bf3ecd2.340823"]]},{"id":"3e57a1a7.152cae","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["304d339.0a5dbcc"],"x":895,"y":1260,"wires":[]},{"id":"304d339.0a5dbcc","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["44946c9e.cdea14","3e57a1a7.152cae"],"x":995,"y":1300,"wires":[["a72d143b.29eb68"]]},{"id":"433d88fd.9a8c08","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Msg.Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1200,"y":1020,"wires":[]},{"id":"ff056d7e.7927f","type":"link in","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["a2f94c3d.e0f5e","69fe2268.9a5dcc","b4fca700.425db8","bf61f0c5.06d4"],"x":1075,"y":1020,"wires":[["433d88fd.9a8c08"]]},{"id":"a2f94c3d.e0f5e","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["ff056d7e.7927f"],"x":1215,"y":900,"wires":[]},{"id":"69fe2268.9a5dcc","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["ff056d7e.7927f"],"x":635,"y":900,"wires":[]},{"id":"b4fca700.425db8","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["ff056d7e.7927f"],"x":675,"y":980,"wires":[]},{"id":"bf61f0c5.06d4","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["ff056d7e.7927f"],"x":675,"y":1060,"wires":[]},{"id":"44946c9e.cdea14","type":"link out","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","links":["304d339.0a5dbcc"],"x":655,"y":1280,"wires":[]},{"id":"1733e5da.74d4ea","type":"trigger","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":950,"y":1220,"wires":[["e0c94366.fcfea"],["f2dc8c0a.59c65"]]},{"id":"e0c94366.fcfea","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"From","func":"flow.set(\"REPORTPOPUP1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1180,"wires":[[]]},{"id":"f2dc8c0a.59c65","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"To","func":"flow.set(\"REPORTPOPUP2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1180,"wires":[[]]},{"id":"e4f1b3ed.e3f9b","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":1420,"wires":[]},{"id":"2b0e947b.1c32cc","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":1380,"wires":[]},{"id":"8d0bbda5.99ab8","type":"influxdb out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","influxdb":"76f4cea2.88ada","name":"IBUF2","measurement":"IBUF2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1090,"y":220,"wires":[]},{"id":"1cbb4dfd.0258e2","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"DTIExcel","qos":"2","datatype":"auto","broker":"5069a677.3406e8","x":1110,"y":2440,"wires":[["3025f8c.40caa08"]]},{"id":"d6932660.393a08","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1360,"y":2420,"wires":[]},{"id":"3025f8c.40caa08","type":"json","z":"fdac93f7.bec1b","name":"","property":"payload","action":"","pretty":false,"x":1190,"y":2520,"wires":[["9d8924af.508188"]]},{"id":"9d8924af.508188","type":"excel","z":"fdac93f7.bec1b","name":"","file":"/var/www/html/DTIExcelRelay.xlsx","x":1310,"y":2560,"wires":[["d6932660.393a08"]]},{"id":"bd079df7.1b7df","type":"function","z":"7399def9.9066","name":"Atas","func":"var d = [];\nfor(i=Date.now();i>=1664680929581;i-=60000){\n    var json = {\n        \"time\":i*1000000,\n        \"Atas\":12.3\n    }\n    d.push(json);\n}\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":340,"wires":[["8327b8a7.9be038"]]},{"id":"279a155a.60b8ca","type":"influxdb out","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":" ","measurement":"BatasTuhup1Atas","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1010,"y":300,"wires":[]},{"id":"a13b33d9.14b01","type":"function","z":"7399def9.9066","name":"atas","func":"var json = {\n        \"time\":Date.now()*1000000,\n        \"Atas\":12.3\n    }\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":300,"wires":[["279a155a.60b8ca"]]},{"id":"8327b8a7.9be038","type":"subflow:e9b71a55.b25c68","z":"7399def9.9066","name":"","x":890,"y":340,"wires":[["279a155a.60b8ca","9187023.e0199"],[]]},{"id":"4968b3fb.ced73c","type":"subflow:e9b71a55.b25c68","z":"7399def9.9066","name":"","x":890,"y":440,"wires":[["feabd6c5.85fe38","9bb634ad.379408"],[]]},{"id":"3ae920ec.6d45c","type":"function","z":"7399def9.9066","name":"Bawah","func":"var d = [];\nfor(i=Date.now();i>=1664680929581;i-=60000){\n    var json = {\n        \"time\":i*1000000,\n        \"Bawah\":4.3\n    }\n    d.push(json);\n}\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":440,"wires":[["4968b3fb.ced73c"]]},{"id":"feabd6c5.85fe38","type":"influxdb out","z":"7399def9.9066","influxdb":"76f4cea2.88ada","name":" ","measurement":"BatasTuhup1Bawah","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1010,"y":400,"wires":[]},{"id":"d42b03fa.af61c","type":"function","z":"7399def9.9066","name":"bwh","func":"var json = {\n        \"time\":Date.now()*1000000,\n        \"Bawah\":4.3\n    }\nmsg.payload = json;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":400,"wires":[["feabd6c5.85fe38"]]},{"id":"2dff4e67.044b32","type":"debug","z":"7399def9.9066","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1290,"y":220,"wires":[]},{"id":"269512cc.dbd61e","type":"function","z":"7399def9.9066","name":"/15min","func":"var d = msg.payload;\nvar prev = flow.get(\"/15MinTuhup1\");\nif(d.IDD >= prev.IDD+900000){\n    flow.set(\"/15MinTuhup1\",{\"IDD\":d.IDD});\n    msg.method = \"POST\";\n    msg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/waterlevel15m\";\n    msg.headers = {};\n    msg.headers[\"Content-Type\"] = \"application/json\";\n    d['VALUEE']= String(MA(d.VALUEE));\n    msg.payload = d;\n}else{\n    msg.payload = null;\n    return msg;\n}\n\nreturn msg;\n\nfunction MA(a){\n    var n = flow.get(\"Tuhup1MA\");\n    if(n.length<10){\n        n.push(parseFloat(String(a)));\n    }else{\n        n.push(parseFloat(String(a)));\n        n.shift();\n    }\n    return avr(n);\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = parseFloat((rs/n.length).toFixed(3));\n    return rs;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":220,"wires":[["345eeef9.41cb52"]]},{"id":"32adb113.ae270e","type":"debug","z":"7399def9.9066","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":180,"wires":[]},{"id":"922e5049.22766","type":"inject","z":"7399def9.9066","name":"/15MinSetFlow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":440,"y":520,"wires":[["98f3b5b9.2f9438"]]},{"id":"98f3b5b9.2f9438","type":"function","z":"7399def9.9066","name":" ","func":"flow.set(\"/15MinTuhup1\",{\"IDD\":1666656000000});\nflow.set(\"Tuhup1MA\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":520,"wires":[[]]},{"id":"345eeef9.41cb52","type":"switch","z":"7399def9.9066","name":"NotNull","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":900,"y":220,"wires":[["cc1d1bd5.fc5b88","f7aa6429.c10398","3fed77d.2880588","87fcd5ea.5007e8"]]},{"id":"f7aa6429.c10398","type":"http request","z":"7399def9.9066","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1090,"y":220,"wires":[["2dff4e67.044b32"]]},{"id":"5d0d98c2.235328","type":"inject","z":"7399def9.9066","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":560,"wires":[["4c30392a.dbd928"]]},{"id":"4c30392a.dbd928","type":"function","z":"7399def9.9066","name":" ","func":"msg.payload = [flow.get(\"Tuhup1MA\"),flow.get(\"/15MinTuhup1\")];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":560,"wires":[["b7217334.44b12"]]},{"id":"b7217334.44b12","type":"debug","z":"7399def9.9066","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":560,"wires":[]},{"id":"87fcd5ea.5007e8","type":"debug","z":"7399def9.9066","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1230,"y":160,"wires":[]},{"id":"cc1d1bd5.fc5b88","type":"debug","z":"7399def9.9066","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1280,"y":300,"wires":[]},{"id":"3fed77d.2880588","type":"trigger","z":"7399def9.9066","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"14","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1070,"y":220,"wires":[[]]},{"id":"8085519e.1feef","type":"function","z":"fd486f91.7596e","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"AlldataTambat\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_S\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROP_P)+\",\";\nmsg.topic += String(d.RPMPROP_S)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1200,"wires":[["8ff67750.e3cf68","c3ad2924.a28218"]]},{"id":"8ff67750.e3cf68","type":"influxdb out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":530,"y":1180,"wires":[]},{"id":"c285415d.9aea5","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"PopupTambat\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_S\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROPELLER_P)+\",\";\nmsg.topic += String(d.RPMPROPELLER_S)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":1240,"wires":[["643982e4.5910dc","bda525b2.b10548","367a161.4de00ea"]]},{"id":"643982e4.5910dc","type":"influxdb out","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","influxdb":"76f4cea2.88ada","name":"Popupp","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":880,"y":1240,"wires":[]},{"id":"afc1e6dd.ddc438","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM MBP3206","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":3360,"wires":[["85e4fff5.45c5e"]]},{"id":"442447bc.ec7058","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":3440,"wires":[]},{"id":"78edf850.553668","type":"influxdb out","z":"b6837abd.323fd8","influxdb":"76f4cea2.88ada","name":"Popupp","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":920,"y":1380,"wires":[]},{"id":"bbea1ca5.26dd6","type":"influxdb out","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":560,"y":1320,"wires":[]},{"id":"b87a4806.90a118","type":"influxdb out","z":"ce7006a0.688478","d":true,"influxdb":"76f4cea2.88ada","name":"Popupp","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":920,"y":1340,"wires":[]},{"id":"7f202577.6a365c","type":"influxdb out","z":"ce7006a0.688478","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":560,"y":1300,"wires":[]},{"id":"e0154272.3ff04","type":"delay","z":"80eab637.b91808","g":"5248f06a.76272","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":660,"y":1020,"wires":[["7acc2b7a.3be684"]]},{"id":"10d7f6eb.44fee9","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":1240,"wires":[]},{"id":"c29b6052.05c03","type":"function","z":"fdac93f7.bec1b","name":"","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/delete/deletewtpdti\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":3840,"wires":[["6fc17dbe.2bb924"]]},{"id":"7397f825.1a90d8","type":"inject","z":"fdac93f7.bec1b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"IDD\":1660727708800,\"CHLORINE\":\"5.759\",\"RESERVOIR_VOL\":\"0\",\"RESERVOIR_HEIGHT\":\"0\",\"RAW_TBD\":\"0\",\"RAW_PH\":\"10.23\",\"RAW_FLOW\":\"0\",\"PRODUCT_TBD\":\"0\",\"PRODUCT_PH\":\"7.67\",\"PRODUCT_FLOW\":\"0\",\"PRODUCT_PRESSURE\":\"0\",\"SENDIMEN_1\":\"0\",\"SENDIMEN_2\":\"6\"}","payloadType":"json","x":990,"y":3800,"wires":[["c29b6052.05c03"]]},{"id":"6fc17dbe.2bb924","type":"http request","z":"fdac93f7.bec1b","name":"","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":3820,"wires":[["4e3ad021.2f8b"]]},{"id":"4e3ad021.2f8b","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1390,"y":3880,"wires":[]},{"id":"540dd4f095f7eaf6","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000+(3600*8));\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":340,"wires":[["60013134c14ddc96"]]},{"id":"60013134c14ddc96","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1210,"y":340,"wires":[]},{"id":"6a9a35b7.ea5f3c","type":"function","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"SetAvr","func":"for(i=1;i<=11;i++){\n    flow.set(\"avr\"+String(i),[]);\n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":640,"wires":[[]]},{"id":"f2ee90e3.8bb8e","type":"inject","z":"7399def9.9066","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":340,"wires":[["bd079df7.1b7df","3ae920ec.6d45c"]]},{"id":"9187023.e0199","type":"function","z":"7399def9.9066","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time/1000000))/1000+(3600*8));\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":360,"wires":[["d401112f.b8e75"]]},{"id":"d401112f.b8e75","type":"debug","z":"7399def9.9066","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1230,"y":360,"wires":[]},{"id":"9bb634ad.379408","type":"function","z":"7399def9.9066","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time/1000000))/1000+(3600*8));\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":440,"wires":[["24cc3a9f.72a856"]]},{"id":"24cc3a9f.72a856","type":"debug","z":"7399def9.9066","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1230,"y":440,"wires":[]},{"id":"f70a08e.ef781f8","type":"mqtt in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"PingLocalServer","topic":"PingKelanis","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":110,"y":180,"wires":[["742a7f47.4b8d7","b047cdbb.cac52"]]},{"id":"b047cdbb.cac52","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":310,"y":180,"wires":[]},{"id":"fef6fa5e.3020c8","type":"debug","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":760,"wires":[]},{"id":"8295f305.725bc","type":"function","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS101','FS107','FS118','FS119','FS123','FS129','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":140,"wires":[["de9293d.98e787"]]},{"id":"de9293d.98e787","type":"switch","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":140,"wires":[["7e26af6.789d45"]]},{"id":"8c9bfc9d.aafd5","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1190,"y":920,"wires":[]},{"id":"550ca08c.0a12f","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1669270224809,\"lat\":\"-2.314044\",\"lon\":\"114.876475\",\"ws\":\"200\",\"sat\":\"-1\",\"F1\":\"449\",\"F2\":\"732\",\"F3\":\"0\",\"F4\":\"1187\",\"F5\":\"1201\",\"F6\":\"411\",\"RP1\":\"0\",\"RP2\":\"148\",\"RP5\":\"2\",\"RP8\":\"2\"}","payloadType":"json","x":820,"y":3120,"wires":[["6344cf21.f148"]]},{"id":"6344cf21.f148","type":"debug","z":"80eab637.b91808","name":"asd","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":980,"y":3120,"wires":[]},{"id":"4c32e106.e5785","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":350,"y":1500,"wires":[]},{"id":"cb381cdf.a234","type":"influxdb out","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":"","measurement":"testing","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1160,"y":3340,"wires":[]},{"id":"123e2175.2c92df","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1669270224809,\"lat\":\"-2.314044\",\"lon\":\"114.876475\",\"ws\":\"200\",\"sat\":\"-1\",\"F1\":\"449\",\"F2\":\"732\",\"F3\":\"0\",\"F4\":\"1187\",\"F5\":\"1201\",\"F6\":\"411\",\"RP1\":\"0\",\"RP2\":\"148\",\"RP5\":\"2\",\"RP8\":\"2\"}","payloadType":"json","x":870,"y":3340,"wires":[["cb381cdf.a234","d2df9b8c.0f1d98"]]},{"id":"d2df9b8c.0f1d98","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":3380,"wires":[]},{"id":"3386583b.4c6f58","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":940,"y":3500,"wires":[["2c91c75f.4395e8"]]},{"id":"90fc7953.4075b8","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1170,"y":3500,"wires":[]},{"id":"a428575b.9f2a48","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM testing","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":780,"y":3500,"wires":[["3386583b.4c6f58"]]},{"id":"2c91c75f.4395e8","type":"function","z":"80eab637.b91808","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":3540,"wires":[["90fc7953.4075b8"]]},{"id":"c3ad2924.a28218","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":530,"y":1280,"wires":[["cb284eb2.1482e"]]},{"id":"cb284eb2.1482e","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":1280,"wires":[]},{"id":"98372a16.569fe8","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"Alldata3222\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_S\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROP_P)+\",\";\nmsg.topic += String(d.RPMPROP_S)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1040,"wires":[["9c13f98d.5d8308","bea9228d.dd1ca","e35fc8e7.70f108"]]},{"id":"e35fc8e7.70f108","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":490,"y":1100,"wires":[["94ddbe14.889a3"]]},{"id":"94ddbe14.889a3","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":630,"y":1100,"wires":[]},{"id":"2c8499cd.96f2a6","type":"function","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"AlldataIBUF\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_S\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROP_P)+\",\";\nmsg.topic += String(d.RPMPROP_S)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1320,"wires":[["bbea1ca5.26dd6","5e7ad5ea.923ffc","60f6d360.869a2c"]]},{"id":"5e7ad5ea.923ffc","type":"mysql","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","mydb":"be353e7e.73b9d","name":"","x":530,"y":1420,"wires":[["b816f9df.bf2e58"]]},{"id":"b816f9df.bf2e58","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":1420,"wires":[]},{"id":"ff8ed24a.a8b9a","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"Alldata3206\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_S\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROP_P)+\",\";\nmsg.topic += String(d.RPMPROP_S)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1280,"wires":[["7f202577.6a365c","8b011e1.3f468e"]]},{"id":"8b011e1.3f468e","type":"mysql","z":"ce7006a0.688478","mydb":"be353e7e.73b9d","name":"","x":490,"y":1400,"wires":[["5525bab6.202aa4"]]},{"id":"5525bab6.202aa4","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":630,"y":1420,"wires":[]},{"id":"bda525b2.b10548","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":870,"y":1280,"wires":[["8372cf6d.7af2b"]]},{"id":"8372cf6d.7af2b","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1030,"y":1280,"wires":[]},{"id":"8fc17cc8.c08dd","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"Popup3222\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_S\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROPELLER_P)+\",\";\nmsg.topic += String(d.RPMPROPELLER_S)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":1100,"wires":[["d2c6e533.334478","db54f22c.f760d","b306b774.880498","d8575dc9.48b91"]]},{"id":"b306b774.880498","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":1190,"y":1100,"wires":[[]]},{"id":"d8575dc9.48b91","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1350,"y":1120,"wires":[]},{"id":"d572433f.e022a","type":"function","z":"b6837abd.323fd8","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"PopupIBUF\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_S\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROPELLER_P)+\",\";\nmsg.topic += String(d.RPMPROPELLER_S)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1380,"wires":[["56b73223.1e8efc","78edf850.553668","84e08f29.5eb04","894d3200.67f1f"]]},{"id":"56b73223.1e8efc","type":"mysql","z":"b6837abd.323fd8","mydb":"be353e7e.73b9d","name":"","x":910,"y":1420,"wires":[["3e28057c.9c431a"]]},{"id":"3e28057c.9c431a","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1070,"y":1420,"wires":[]},{"id":"c1771354.0ea98","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"Popup3206\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_S\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROPELLER_P)+\",\";\nmsg.topic += String(d.RPMPROPELLER_S)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1340,"wires":[["b87a4806.90a118","5483ff.17800c","785ce802.b88d98"]]},{"id":"5483ff.17800c","type":"mysql","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mydb":"be353e7e.73b9d","name":"","x":930,"y":1380,"wires":[["644e954b.767c4c"]]},{"id":"644e954b.767c4c","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1130,"y":1380,"wires":[]},{"id":"1536058.0c270fb","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":540,"wires":[["3dec1f12.c78eb","933a74ba.0ef758"]]},{"id":"ed0721c8.514e3","type":"trigger","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"1 min","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"70","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":490,"y":600,"wires":[["c6a8b4b7.bf7478","956b0ece.03cac","7cf49193.bead3"]]},{"id":"38f4418a.b6859e","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"set","func":"flow.set(\"ToApex\",true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":360,"wires":[[]]},{"id":"81088aae.aa4a48","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Set","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":360,"wires":[["38f4418a.b6859e"]]},{"id":"933a74ba.0ef758","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Check","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\n//SETTING\nvar limit = 50///////////\nvar freq = 2;\nmsg.limitt = Math.round(limit/freq);\nmsg.delay = 100;\n\nreturn msg;\n\nfunction count(){\n    var a = flow.get(\"Count\");\n    a+=1;\n    flow.set(\"Count\",a);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":540,"wires":[["d590d8d1.8969f8","545df55f.32a83c","69b37ca4.99df64"]]},{"id":"d590d8d1.8969f8","type":"switch","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":540,"wires":[["ed0721c8.514e3","3bfe79d2.cb9696"]]},{"id":"cd380dba.34eb5","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":400,"wires":[["6a443c41.591964"]]},{"id":"6a443c41.591964","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Show","func":"if(flow.get(\"ToApex\")){\n   msg.payload = \"O_O_O_O_O_O_O_O_O\"; \n}else{\n    msg.payload = \"X-X-X-X-X-X-X-X-X\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":400,"wires":[["7f7c68f1.a3d9c8"]]},{"id":"7f7c68f1.a3d9c8","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":400,"wires":[]},{"id":"c6a8b4b7.bf7478","type":"delay","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"1 min","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":670,"y":600,"wires":[["90ae8a76.48c5f8"]]},{"id":"90ae8a76.48c5f8","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Reset","func":"msg.reset = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":600,"wires":[["7a2fa434.b8b47c"]]},{"id":"c6127353.b122c","type":"link in","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["7a2fa434.b8b47c"],"x":375,"y":600,"wires":[["ed0721c8.514e3"]]},{"id":"7a2fa434.b8b47c","type":"link out","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["c6127353.b122c"],"x":1055,"y":600,"wires":[]},{"id":"70972d3d.f8fc04","type":"inject","z":"47ec9b6e.206e24","d":true,"g":"e90ee691.a45788","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":820,"wires":[["e1d85b19.a86398","550bf9ea.0b5368"]]},{"id":"e1d85b19.a86398","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Check Buffer","func":"msg.topic = \"SELECT count(`EPO`) FROM `VMSDATA`;\"\nmsg.topic += \"SELECT count(`time`) FROM `POPUP`;\"\nmsg.topic += \"SELECT count(`EPO`) FROM `FuelData`;\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":820,"wires":[["873cb1fe.af7e6"]]},{"id":"873cb1fe.af7e6","type":"mysql","z":"47ec9b6e.206e24","g":"e90ee691.a45788","mydb":"be353e7e.73b9d","name":"","x":490,"y":820,"wires":[["de69feca.f9fb2"]]},{"id":"de69feca.f9fb2","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","func":"var d = msg.payload;\nmsg.payload = [d[0][0]['count(`EPO`)'],d[1][0]['count(`time`)'],d[2][0]['count(`EPO`)']]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":820,"wires":[["f026fd32.1e5f4"]]},{"id":"f026fd32.1e5f4","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Alldata,Popup,Fuel","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":850,"y":820,"wires":[]},{"id":"947ea49e.0ad598","type":"link in","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"","links":["b5e073d8.9e317","9fa5a1b6.e174c","f8482fc.c8541d","a4cfd3e6.58225","b160692a.a8bd08"],"x":155,"y":220,"wires":[["3b4601ba.ab60fe","ea7e9c5.b765f6","1e21bb78.888cc5"]]},{"id":"b90d109c.3003f","type":"delay","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":670,"y":180,"wires":[["cd61effa.ac573","cd645d6a.0b229"]]},{"id":"318c2d13.6f4342","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Stop Mode","func":"flow.set(\"ToApex\",false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":180,"wires":[["1d1065a.437889a"]]},{"id":"cd61effa.ac573","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Start Mode","func":"flow.set(\"ToApex\",true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":180,"wires":[["f0349909.6e7eb8"]]},{"id":"a7058a1c.31e018","type":"inject","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" Reset","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"RESET","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":180,"wires":[["1e21bb78.888cc5","1d1065a.437889a","1c0d9a93.3363e5","6d0d8444.93628c","8facbc86.7cf02","e524840f.2676e8"]]},{"id":"3bfe79d2.cb9696","type":"trigger","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":540,"wires":[["a1be4bb2.003ff8"]]},{"id":"a1be4bb2.003ff8","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":540,"wires":[["5aa04069.7927d","1f8089f8.6a0936"]]},{"id":"5aa04069.7927d","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":850,"y":540,"wires":[]},{"id":"545df55f.32a83c","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":500,"wires":[["4dc2bc87.305af4"]]},{"id":"4dc2bc87.305af4","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":550,"y":480,"wires":[]},{"id":"cd645d6a.0b229","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":220,"wires":[["3b7c4985.6a6fd6"]]},{"id":"3b7c4985.6a6fd6","type":"debug","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":220,"wires":[]},{"id":"3b4601ba.ab60fe","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"TimeError\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":260,"wires":[["523cc76c.157dc8"]]},{"id":"523cc76c.157dc8","type":"debug","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":390,"y":260,"wires":[]},{"id":"f0349909.6e7eb8","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Reset","func":"msg.reset = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":180,"wires":[["78e72c6e.eb5e54"]]},{"id":"78e72c6e.eb5e54","type":"link out","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"","links":["14c8631d.31c65d"],"x":1035,"y":180,"wires":[]},{"id":"84e08f29.5eb04","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1140,"y":1520,"wires":[]},{"id":"956b0ece.03cac","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"Triggered\",msg.payload);\nflow.set(\"Count\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":680,"wires":[["bf64fa3.38b1908"]]},{"id":"bf64fa3.38b1908","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":790,"y":680,"wires":[]},{"id":"550bf9ea.0b5368","type":"trigger","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":330,"y":860,"wires":[[]]},{"id":"62db012.c0c4d","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Run","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":620,"wires":[["933a74ba.0ef758"]]},{"id":"1f8089f8.6a0936","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Time","func":"msg.payload= 60-((Date.parse(new Date()+(3600*8))-Date.parse(flow.get(\"Triggered\")))/1000);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":540,"wires":[["d7af74dd.717a38"]]},{"id":"93a7acd6.0eb78","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" Countdown","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":740,"wires":[]},{"id":"1f514f1c.c6d471","type":"debug","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.CurrentGeo","targetType":"msg","statusVal":"payloadCurrentGeo","statusType":"auto","x":750,"y":1140,"wires":[]},{"id":"f4a0c7b8.9a98f8","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.CurrentGeo","targetType":"msg","statusVal":"payloadCurrentGeo","statusType":"auto","x":690,"y":1000,"wires":[]},{"id":"855fcc0d.ea371","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.CurrentGeo","targetType":"msg","statusVal":"payloadCurrentGeo","statusType":"auto","x":779,"y":1103,"wires":[]},{"id":"760a2a06.195604","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" RESET TIMER","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"RESET","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":1000,"y":640,"wires":[["7a2fa434.b8b47c"]]},{"id":"367a161.4de00ea","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"Fuel","func":"var d= msg.GrafanaTambat;\nvar json = {\n    \"EPO\":parseInt(String(msg.data.Time)),\n    \"DATEE\":String(msg.alldata.RECORDDATA),\n    \"STORAGE1\":parseInt(String(d.Kanan)),\n    \"STORAGE2\":parseInt(String(d.Kiri)),\n    \"STORAGE3\":parseInt(String(d.Center)),\n    \"STORAGE4\":parseInt(String(\"0\")),\n    \"STORAGE5\":parseInt(String(\"0\")),\n    \"DAILY1\":parseInt(String(d.DailyKanan)),\n    \"DAILY2\":parseInt(String(d.DailyKiri)),\n    \"DAILY3\":parseInt(String(\"0\")),\n    \"DAILY4\":parseInt(String(\"0\")),\n    \"DAILY5\":parseInt(String(\"0\"))\n}\nmsg.topic = \"INSERT INTO `FuelData`(`EPO`,`DATEE`,`SHIPNAME`,`STORAGE1`,`STORAGE2`,`STORAGE3`,`STORAGE4`,`STORAGE5`,`DAILY1`,`DAILY2`,`DAILY3`,`DAILY4`,`DAILY5`)\";\nmsg.topic += \"VALUES(\"+\"'\"+String(json.EPO)+\"',\"+\"'\"+String(json.DATEE)+\"','TAMBAT',\"+\"'\"+String(json.STORAGE1)+\"',\"+\"'\"+String(json.STORAGE2)+\"',\"+\"'\"+String(json.STORAGE3)+\"',\"+\"'\"+String(json.STORAGE4)+\"',\"+\"'\"+String(json.STORAGE5)+\"',\"+\"'\"+String(json.DAILY1)+\"',\"+\"'\"+String(json.DAILY2)+\"',\"+\"'\"+String(json.DAILY3)+\"',\"+\"'\"+String(json.DAILY4)+\"',\"+\"'\"+String(json.DAILY5)+\"');\";\n\n// INSERT INTO FUEL_VMS(EPO,DATEE,STORAGE1,STORAGE2,STORAGE3,STORAGE4,STORAGE5,DAILY1,DAILY2,DAILY3,DAILY4,DAILY5) \n// VALUES(:EPO,:DATEE,:STORAGE1,:STORAGE2,:STORAGE3,:STORAGE4,:STORAGE5,:DAILY1,:DAILY2,:DAILY3,:DAILY4,:DAILY5)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":1240,"wires":[["1829c885.1fb727"]]},{"id":"1829c885.1fb727","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":1170,"y":1240,"wires":[["e151e3e2.a3183"]]},{"id":"e151e3e2.a3183","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1330,"y":1240,"wires":[]},{"id":"db54f22c.f760d","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"Fuel","func":"var d= msg.ROB2;\nvar json = {\n    \"EPO\":parseInt(String(msg.data.Time)),\n    \"DATEE\":String(msg.alldata.RECORDDATA),\n    \"STORAGE1\":parseInt(String(d.Kanan)),\n    \"STORAGE2\":parseInt(String(d.Kiri)),\n    \"STORAGE3\":parseInt(String(\"0\")),\n    \"STORAGE4\":parseInt(String(\"0\")),\n    \"STORAGE5\":parseInt(String(\"0\")),\n    \"DAILY1\":parseInt(String(d.F5)),\n    \"DAILY2\":parseInt(String(d.F4)),\n    \"DAILY3\":parseInt(String(\"0\")),\n    \"DAILY4\":parseInt(String(\"0\")),\n    \"DAILY5\":parseInt(String(\"0\"))\n}\nmsg.topic = \"INSERT INTO `FuelData`(`EPO`,`DATEE`,`SHIPNAME`,`STORAGE1`,`STORAGE2`,`STORAGE3`,`STORAGE4`,`STORAGE5`,`DAILY1`,`DAILY2`,`DAILY3`,`DAILY4`,`DAILY5`)\";\nmsg.topic += \"VALUES(\"+\"'\"+String(json.EPO)+\"',\"+\"'\"+String(json.DATEE)+\"','MBP3222',\"+\"'\"+String(json.STORAGE1)+\"',\"+\"'\"+String(json.STORAGE2)+\"',\"+\"'\"+String(json.STORAGE3)+\"',\"+\"'\"+String(json.STORAGE4)+\"',\"+\"'\"+String(json.STORAGE5)+\"',\"+\"'\"+String(json.DAILY1)+\"',\"+\"'\"+String(json.DAILY2)+\"',\"+\"'\"+String(json.DAILY3)+\"',\"+\"'\"+String(json.DAILY4)+\"',\"+\"'\"+String(json.DAILY5)+\"');\";\n\n// INSERT INTO FUEL_VMS(EPO,DATEE,STORAGE1,STORAGE2,STORAGE3,STORAGE4,STORAGE5,DAILY1,DAILY2,DAILY3,DAILY4,DAILY5) \n// VALUES(:EPO,:DATEE,:STORAGE1,:STORAGE2,:STORAGE3,:STORAGE4,:STORAGE5,:DAILY1,:DAILY2,:DAILY3,:DAILY4,:DAILY5)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":1080,"wires":[["b6d2b684.1d52b8"]]},{"id":"b6d2b684.1d52b8","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":1590,"y":1080,"wires":[["3b113cad.f38c94"]]},{"id":"3b113cad.f38c94","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1750,"y":1080,"wires":[]},{"id":"894d3200.67f1f","type":"function","z":"b6837abd.323fd8","name":"Fuel","func":"var d= msg.GrafanaIBUF;\nvar json = {\n    \"EPO\":parseInt(String(msg.data.Time)),\n    \"DATEE\":String(msg.alldata.RECORDDATA),\n    \"STORAGE1\":parseInt(String(d.StorageKananLiter)),\n    \"STORAGE2\":parseInt(String(d.StorageKiriLiter)),\n    \"STORAGE3\":parseInt(String(\"0\")),\n    \"STORAGE4\":parseInt(String(\"0\")),\n    \"STORAGE5\":parseInt(String(\"0\")),\n    \"DAILY1\":parseInt(String(d.DailyAELiter)),\n    \"DAILY2\":parseInt(String(d.DailyME1Liter)),\n    \"DAILY3\":parseInt(String(d.DailyME2Liter)),\n    \"DAILY4\":parseInt(String(\"0\")),\n    \"DAILY5\":parseInt(String(\"0\"))\n}\nmsg.topic = \"INSERT INTO `FuelData`(`EPO`,`DATEE`,`SHIPNAME`,`STORAGE1`,`STORAGE2`,`STORAGE3`,`STORAGE4`,`STORAGE5`,`DAILY1`,`DAILY2`,`DAILY3`,`DAILY4`,`DAILY5`)\";\nmsg.topic += \"VALUES(\"+\"'\"+String(json.EPO)+\"',\"+\"'\"+String(json.DATEE)+\"','IBUF',\"+\"'\"+String(json.STORAGE1)+\"',\"+\"'\"+String(json.STORAGE2)+\"',\"+\"'\"+String(json.STORAGE3)+\"',\"+\"'\"+String(json.STORAGE4)+\"',\"+\"'\"+String(json.STORAGE5)+\"',\"+\"'\"+String(json.DAILY1)+\"',\"+\"'\"+String(json.DAILY2)+\"',\"+\"'\"+String(json.DAILY3)+\"',\"+\"'\"+String(json.DAILY4)+\"',\"+\"'\"+String(json.DAILY5)+\"');\";\n\n// INSERT INTO FUEL_VMS(EPO,DATEE,STORAGE1,STORAGE2,STORAGE3,STORAGE4,STORAGE5,DAILY1,DAILY2,DAILY3,DAILY4,DAILY5) \n// VALUES(:EPO,:DATEE,:STORAGE1,:STORAGE2,:STORAGE3,:STORAGE4,:STORAGE5,:DAILY1,:DAILY2,:DAILY3,:DAILY4,:DAILY5)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":1380,"wires":[["ebec21f.845dde"]]},{"id":"ebec21f.845dde","type":"mysql","z":"b6837abd.323fd8","mydb":"be353e7e.73b9d","name":"","x":1210,"y":1380,"wires":[["2b133f5a.960b4"]]},{"id":"2b133f5a.960b4","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1370,"y":1380,"wires":[]},{"id":"f9f7b87a.03cf48","type":"mysql","z":"ce7006a0.688478","mydb":"be353e7e.73b9d","name":"","x":1190,"y":1340,"wires":[["2993a6f7.a3242a"]]},{"id":"2993a6f7.a3242a","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1350,"y":1340,"wires":[]},{"id":"836e81ef.d906","type":"trigger","z":"47ec9b6e.206e24","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":140,"y":1580,"wires":[["6aaeea82.39d7e4","9c602fcf.68c9c"]]},{"id":"870f79f9.10ced8","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" FuelData","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/fuelvms\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.topic = String(parseInt(String(msg.topic))+1);\nmsg.data3 = msg.payload;\nmsg.data = msg.payload;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":1680,"wires":[["380bed0b.9239d2","713a60bb.a5ee3"]]},{"id":"1ecb831b.92780d","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","func":"msg.topic = \"SELECT * FROM `FuelData` ORDER BY `EPO` DESC limit \"+String(msg.limitt)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":1660,"wires":[["22754978.418996"]]},{"id":"22754978.418996","type":"mysql","z":"47ec9b6e.206e24","g":"53d851bc.74e43","mydb":"be353e7e.73b9d","name":"","x":270,"y":1660,"wires":[["ef00fb17.ca28c8"]]},{"id":"afaa2d26.7a48","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" Start Loop","func":"var d = msg.payload;\nvar arr = [];\nfor(i=0;i<msg.payload.length;i++){\n    var json = {\n        \"EPO\":parseInt(String(d[i].EPO)),\n        \"DATEE\":String(d[i].DATEE),\n        \"SHIPNAME\":String(d[i].SHIPNAME),\n        \"STORAGE1\":parseInt(String(d[i].STORAGE1)),\n        \"STORAGE2\":parseInt(String(d[i].STORAGE2)),\n        \"STORAGE3\":parseInt(String(d[i].STORAGE3)),\n        \"STORAGE4\":parseInt(String(d[i].STORAGE4)),\n        \"STORAGE5\":parseInt(String(d[i].STORAGE5)),\n        \"DAILY1\":parseInt(String(d[i].DAILY1)),\n        \"DAILY2\":parseInt(String(d[i].DAILY2)),\n        \"DAILY3\":parseInt(String(d[i].DAILY3)),\n        \"DAILY4\":parseInt(String(d[i].DAILY4)),\n        \"DAILY5\":parseInt(String(d[i].DAILY5))\n    }\n    \n    arr.push(json);\n}\nmsg.payload=  arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1720,"wires":[["7dc39e33.8fe6c"]]},{"id":"854c8411.a20078","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"FuelResponse","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":180,"y":1860,"wires":[]},{"id":"7dc39e33.8fe6c","type":"subflow:e9b71a55.b25c68","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","x":510,"y":1720,"wires":[["a1bb7b21.713568","870f79f9.10ced8","5f7ab9a3.a2f218"],["d7977316.81b67"]]},{"id":"380bed0b.9239d2","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":780,"y":1660,"wires":[]},{"id":"eaebaf5e.5d116","type":"http request","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Insert","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1050,"y":1680,"wires":[["16436be6.833614"]]},{"id":"5a6e4511.c26dcc","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","func":"if(msg.payload!=\"\"){\n    msg.errorr = msg.payload;\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":1820,"wires":[["ce652cfd.f2d89","26dcdd6.0fda022"]]},{"id":"ce652cfd.f2d89","type":"switch","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":1800,"wires":[["98e6001a.41618"]]},{"id":"98e6001a.41618","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","func":"var d = msg.data3;\nif(flow.get(\"ToApex\")==true){\n    count();    \n}\nmsg.topic = \"DELETE FROM `FuelData` WHERE `EPO` = \"+String(d.EPO)+\";\";\nreturn msg;\n\n\nfunction count(){\n    var a = flow.get(\"Count\");\n    a+=1;\n    flow.set(\"Count\",a);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1800,"wires":[["70029a4d.9338f4"]]},{"id":"70029a4d.9338f4","type":"mysql","z":"47ec9b6e.206e24","g":"53d851bc.74e43","mydb":"be353e7e.73b9d","name":"","x":530,"y":1800,"wires":[["8bbe972a.221c88"]]},{"id":"26dcdd6.0fda022","type":"switch","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Null","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":1840,"wires":[["f8482fc.c8541d"]]},{"id":"f8482fc.c8541d","type":"link out","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","links":["947ea49e.0ad598"],"x":365,"y":1840,"wires":[]},{"id":"713a60bb.a5ee3","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Check Mode","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1660,"wires":[["ed1ca77e.3a0058"]]},{"id":"ed1ca77e.3a0058","type":"switch","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Ok?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":1680,"wires":[["eaebaf5e.5d116"]]},{"id":"dc2ebc80.343c1","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Date","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":890,"y":1740,"wires":[]},{"id":"a1bb7b21.713568","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.EPO))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1740,"wires":[["dc2ebc80.343c1"]]},{"id":"f8536997.83ae08","type":"link in","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","links":["6aaeea82.39d7e4"],"x":55,"y":1660,"wires":[["1ecb831b.92780d"]]},{"id":"6aaeea82.39d7e4","type":"link out","z":"47ec9b6e.206e24","name":"","links":["f8536997.83ae08"],"x":235,"y":1580,"wires":[]},{"id":"8bbe972a.221c88","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":1800,"wires":[["cf4161b3.bb1f2"]]},{"id":"cf4161b3.bb1f2","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":810,"y":1800,"wires":[]},{"id":"ef00fb17.ca28c8","type":"function","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","func":"if(msg.payload.length<1){\n    msg.topic = \"EMPTY\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1660,"wires":[["f704dd48.b0f09"]]},{"id":"f704dd48.b0f09","type":"switch","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"Data Available","property":"topic","propertyType":"msg","rules":[{"t":"neq","v":"EMPTY","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":200,"y":1720,"wires":[["afaa2d26.7a48"]]},{"id":"cd9b1ab9.6d6a78","type":"link in","z":"47ec9b6e.206e24","name":"","links":["61c50798.f4c7d8","31a62e1b.faa2f2","e1972be4.98dab8","c9d1294b.aed868"],"x":35,"y":1580,"wires":[["836e81ef.d906"]]},{"id":"69cdba50.362694","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"Show Save","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":530,"y":360,"wires":[["35e6a301.80057c"]]},{"id":"35e6a301.80057c","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","func":"msg.payload = flow.get(\"Save\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":360,"wires":[["a7bcbdca.02588"]]},{"id":"a7bcbdca.02588","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":840,"y":360,"wires":[]},{"id":"ea7e9c5.b765f6","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"Save","func":"flow.set(\"Save\",[msg.data,msg.errorr]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":220,"wires":[[]]},{"id":"1e21bb78.888cc5","type":"trigger","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"10 Min","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"10","extend":true,"overrideDelay":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":270,"y":180,"wires":[["318c2d13.6f4342","1c0d9a93.3363e5"]]},{"id":"57304d57.a1f3a4","type":"inject","z":"80eab637.b91808","g":"50524935.d705d8","name":"Check Last Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":80,"wires":[["b0299d27.caa54"]]},{"id":"b0299d27.caa54","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","func":"msg.query = \"SELECT * from fuelLevel3 order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":80,"wires":[["d894231a.bc71c"]]},{"id":"d894231a.bc71c","type":"influxdb in","z":"80eab637.b91808","g":"50524935.d705d8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":450,"y":80,"wires":[["3ff6c654.0a649a"]]},{"id":"3ff6c654.0a649a","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.results[0].series[0].values[0][0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":80,"wires":[["529bedf6.6b8134"]]},{"id":"529bedf6.6b8134","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":730,"y":80,"wires":[]},{"id":"4e9d2913.aa0b28","type":"inject","z":"b6837abd.323fd8","name":"Check Last Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":380,"y":60,"wires":[["ab668346.28454"]]},{"id":"ab668346.28454","type":"function","z":"b6837abd.323fd8","name":" ","func":"msg.query = \"SELECT * from IBUF2 order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":60,"wires":[["76422927.fda118"]]},{"id":"76422927.fda118","type":"influxdb in","z":"b6837abd.323fd8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":670,"y":60,"wires":[["b3911edd.b8234"]]},{"id":"b3911edd.b8234","type":"function","z":"b6837abd.323fd8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.results[0].series[0].values[0][0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":60,"wires":[["96d552a6.7539e"]]},{"id":"96d552a6.7539e","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":950,"y":60,"wires":[]},{"id":"726354f5.fbd01c","type":"inject","z":"ce7006a0.688478","name":"Check Last Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":360,"y":40,"wires":[["e4d8117d.29a8"]]},{"id":"e4d8117d.29a8","type":"function","z":"ce7006a0.688478","name":" ","func":"msg.query = \"SELECT * from MBP3206 order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":40,"wires":[["b520ae47.8220a"]]},{"id":"b520ae47.8220a","type":"influxdb in","z":"ce7006a0.688478","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":650,"y":40,"wires":[["7776984d.a4a8a8"]]},{"id":"7776984d.a4a8a8","type":"function","z":"ce7006a0.688478","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.results[0].series[0].values[0][0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":40,"wires":[["c5a5a410.2240b8"]]},{"id":"c5a5a410.2240b8","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":930,"y":40,"wires":[]},{"id":"19e70f08.fe9631","type":"link out","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["f071c4b8.958be8"],"x":795,"y":640,"wires":[]},{"id":"5f7ab9a3.a2f218","type":"trigger","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"3","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":630,"y":1740,"wires":[["f0d2afe6.6954b"]]},{"id":"f0d2afe6.6954b","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"[\"Fuel\",payload]","targetType":"jsonata","statusVal":"[\"Fuel\",payload]","statusType":"auto","x":750,"y":1740,"wires":[]},{"id":"16436be6.833614","type":"link out","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","links":["51baad12.0d4994"],"x":1155,"y":1680,"wires":[]},{"id":"51baad12.0d4994","type":"link in","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":"","links":["16436be6.833614"],"x":55,"y":1820,"wires":[["854c8411.a20078","5a6e4511.c26dcc"]]},{"id":"14c8631d.31c65d","type":"link in","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"","links":["78e72c6e.eb5e54"],"x":155,"y":140,"wires":[["1e21bb78.888cc5"]]},{"id":"9c602fcf.68c9c","type":"trigger","z":"47ec9b6e.206e24","name":" ","op1":"","op2":"","op1type":"nul","op2type":"nul","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":330,"y":1580,"wires":[[]]},{"id":"bbf3ccdd.6e3ff","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":" ","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"\"IBUF Update \"&$string(payload, true)&\" Data\"\t","targetType":"jsonata","statusVal":"payload","statusType":"auto","x":830,"y":460,"wires":[]},{"id":"1539036d.d1b99d","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"\"MBP3222 Update \"&$string(payload, true)&\" Data\"\t","targetType":"jsonata","statusVal":"payload","statusType":"auto","x":830,"y":520,"wires":[]},{"id":"4086a028.3f476","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"\"MBP3206 Update \"&$string(payload, true)&\" Data\"\t","targetType":"jsonata","statusVal":"payload","statusType":"auto","x":810,"y":440,"wires":[]},{"id":"1c0d9a93.3363e5","type":"trigger","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"7.5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":385,"y":140,"wires":[["6d0d8444.93628c"]]},{"id":"6d0d8444.93628c","type":"trigger","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"6","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":510,"y":140,"wires":[["8facbc86.7cf02"]]},{"id":"8facbc86.7cf02","type":"trigger","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"4","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":630,"y":140,"wires":[["e524840f.2676e8"]]},{"id":"e524840f.2676e8","type":"trigger","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"2","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":140,"wires":[[]]},{"id":"1d1065a.437889a","type":"delay","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":"10m","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":180,"wires":[["b90d109c.3003f"]]},{"id":"11676e0d.938512","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":3960,"wires":[]},{"id":"79d4a4a.e80e55c","type":"excel","z":"80eab637.b91808","name":"","file":"/var/www/html/BackupOctToDec.xlsx","x":930,"y":3880,"wires":[["aad99000.ba456"]]},{"id":"aad99000.ba456","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1100,"y":3880,"wires":[]},{"id":"50b2b706.c81d58","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":3880,"wires":[["d32b26f2.1f74f8"]]},{"id":"609dc617.2034c8","type":"json","z":"80eab637.b91808","name":"","property":"payload","action":"str","pretty":false,"x":730,"y":3960,"wires":[["11676e0d.938512","d53584c8.e92d28"]]},{"id":"d53584c8.e92d28","type":"mqtt out","z":"80eab637.b91808","name":"","topic":"ToExcelPC","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1140,"y":3940,"wires":[]},{"id":"e01483ce.89236","type":"mqtt in","z":"80eab637.b91808","name":"","topic":"ToExcelPC","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":1170,"y":4000,"wires":[["8beee429.5b7d58"]]},{"id":"8beee429.5b7d58","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1340,"y":3980,"wires":[]},{"id":"d7af74dd.717a38","type":"link out","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["6f1db37d.bfdb2c"],"x":1095,"y":540,"wires":[]},{"id":"6f1db37d.bfdb2c","type":"link in","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["d7af74dd.717a38"],"x":345,"y":740,"wires":[["93a7acd6.0eb78"]]},{"id":"851e2eb1.1a258","type":"mqtt in","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","topic":"LastLocMBP3206","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":580,"y":80,"wires":[["23b018c6.9b1338"]]},{"id":"23b018c6.9b1338","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","func":"flow.set(\"LastLocMBP3206\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":80,"wires":[[]]},{"id":"b005afe.4b1db5","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"LastLocMBP3206","func":"msg.payload = flow.get(\"LastLocMBP3206\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":120,"wires":[["245701dc.eb691e"]]},{"id":"fbff0317.50656","type":"inject","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":630,"y":120,"wires":[["b005afe.4b1db5"]]},{"id":"582d18ec.57c198","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1090,"y":120,"wires":[]},{"id":"245701dc.eb691e","type":"json","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","property":"payload","action":"","pretty":false,"x":950,"y":120,"wires":[["582d18ec.57c198"]]},{"id":"b830d8d7.edf698","type":"mqtt in","z":"ce7006a0.688478","name":"","topic":"sendtoexcel","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":220,"y":1580,"wires":[["c63e33a8.e8f39"]]},{"id":"c63e33a8.e8f39","type":"function","z":"ce7006a0.688478","name":"flowset","func":"flow.set(\"sendtoexcel\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1560,"wires":[["d7d3f44d.1618c8","6a0ca585.495b2c"]]},{"id":"d7d3f44d.1618c8","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":620,"y":1540,"wires":[]},{"id":"6a0ca585.495b2c","type":"trigger","z":"ce7006a0.688478","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":1580,"wires":[[]]},{"id":"a0bdb879.067918","type":"excel","z":"ce7006a0.688478","name":"","file":"/var/www/html/MBP3206Daily.xlsx","x":490,"y":1700,"wires":[["4bc58ce3.bff464","a4af0b97.0c1678"]]},{"id":"66aaff26.14991","type":"inject","z":"ce7006a0.688478","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":1680,"wires":[["d1b6e60.5482218"]]},{"id":"d1b6e60.5482218","type":"function","z":"ce7006a0.688478","name":"","func":"msg.payload = flow.get(\"sendtoexcel\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1680,"wires":[["87b6b87.2e66248"]]},{"id":"a4af0b97.0c1678","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":640,"y":1700,"wires":[]},{"id":"4bc58ce3.bff464","type":"trigger","z":"ce7006a0.688478","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":650,"y":1660,"wires":[[]]},{"id":"87b6b87.2e66248","type":"json","z":"ce7006a0.688478","name":"","property":"payload","action":"","pretty":false,"x":350,"y":1760,"wires":[["a0bdb879.067918"]]},{"id":"2824e94.cf6f416","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":2000,"wires":[[]]},{"id":"d7e5252a.7572a8","type":"function","z":"47ec9b6e.206e24","name":"MBP3222","func":"msg.topic = \"SELECT * FROM `POPUP` WHERE `NAMEE` = 'MBP 3222' order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":1940,"wires":[["1aaca853.b4a5e8"]]},{"id":"1aaca853.b4a5e8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":410,"y":1940,"wires":[["dc5f99a1.172a28"]]},{"id":"742b0a1e.55b264","type":"function","z":"47ec9b6e.206e24","name":"IBUF","func":"msg.topic = \"SELECT * FROM `POPUP` WHERE `NAMEE` = 'IBUF' order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":1980,"wires":[["4522bebc.866ed"]]},{"id":"4522bebc.866ed","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":410,"y":1980,"wires":[["72274f40.37e93"]]},{"id":"a794e71d.0ce598","type":"function","z":"47ec9b6e.206e24","name":"TAMBAT","func":"msg.topic = \"SELECT * FROM `POPUP` WHERE `NAMEE` = 'TAMBAT' order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":2020,"wires":[["8f8134da.deb6d8"]]},{"id":"8f8134da.deb6d8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":410,"y":2020,"wires":[["c45a0a31.79d288"]]},{"id":"cd48bbca.edaf88","type":"function","z":"47ec9b6e.206e24","name":"MBP3206","func":"msg.topic = \"SELECT * FROM `POPUP` WHERE `NAMEE` = 'MBP 3206' order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":2060,"wires":[["22b288c1.d39a78"]]},{"id":"22b288c1.d39a78","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":410,"y":2060,"wires":[["c87c5156.c395f"]]},{"id":"72274f40.37e93","type":"switch","z":"47ec9b6e.206e24","name":"Empty?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":1980,"wires":[["57048271.c893dc"]]},{"id":"c45a0a31.79d288","type":"switch","z":"47ec9b6e.206e24","name":"Empty?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":2020,"wires":[["57048271.c893dc"]]},{"id":"c87c5156.c395f","type":"switch","z":"47ec9b6e.206e24","name":"Empty?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":2060,"wires":[["57048271.c893dc"]]},{"id":"dc5f99a1.172a28","type":"switch","z":"47ec9b6e.206e24","name":"Empty?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":1940,"wires":[["57048271.c893dc"]]},{"id":"6e668382.15e64c","type":"function","z":"47ec9b6e.206e24","name":"Update","func":"var d = msg.payload[0];\nmsg.topic = \"\";\nvar key = ['time','ARRIVAL','BARGE','CURRENTT','DEPARTURE','DESTINATION','ETA','FROMM','LASTRECEIVEDATE','LASTRECORDDATE','LATITUDE','LONGITUDE','NAMEE','NEXTT','ROB','ROBONSTART','RPMAVR','RPMENGINE','RPMPROPELLER','SPEEDCOURSE','TARGET_FO','TD','WINDSPEED'];\nmsg.topic = \"UPDATE `POPUPUPDATE` SET \"\nfor(i=0;i<key.length;i++){\n    msg.topic += \"`\"+String(key[i])+\"`=\";\n    if(typeof(d[key[i]])==\"number\"){\n        msg.topic += d[key[i]];\n    }else if(typeof(d[key[i]])==\"string\"){\n        if(key[i]==\"ROBONSTART\"){\n            d[key[i]] = String(parseInt(String(d[key[i]])));\n        }\n        msg.topic += \"'\"+String(d[key[i]])+\"'\";\n    }\n    if(i!=key.length-1){\n        msg.topic += \",\";\n    }\n}\nmsg.topic += \" WHERE `NAMEE` = '\"+String(d.NAMEE)+\"'\";\nmsg.delete = [d.time,d.NAMEE];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2000,"wires":[["c0ebd4d4.e1db68"]]},{"id":"c0ebd4d4.e1db68","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":850,"y":2000,"wires":[["61f252e5.55de7c","357cfc0f.77e224"]]},{"id":"61f252e5.55de7c","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.affectedRows","targetType":"msg","statusVal":"payload","statusType":"auto","x":970,"y":2000,"wires":[]},{"id":"357cfc0f.77e224","type":"function","z":"47ec9b6e.206e24","name":"DELETE","func":"msg.topic = \"DELETE FROM `POPUP` WHERE NOT `time` = \"+String(msg.delete[0])+\" AND `NAMEE` = '\"+String(msg.delete[1])+\"';\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":2000,"wires":[["975c0423.228b28"]]},{"id":"5de339b2.fb64e8","type":"debug","z":"47ec9b6e.206e24","name":"Done","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.affectedRows","targetType":"msg","statusVal":"topic","statusType":"auto","x":1370,"y":2000,"wires":[]},{"id":"975c0423.228b28","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":1250,"y":2000,"wires":[["5de339b2.fb64e8","9179ff34.1f011"]]},{"id":"dc1c76e.9cdd588","type":"trigger","z":"47ec9b6e.206e24","name":"MBP3222","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1660,"y":1940,"wires":[[]]},{"id":"9179ff34.1f011","type":"switch","z":"47ec9b6e.206e24","name":" ","property":"delete[1]","propertyType":"msg","rules":[{"t":"eq","v":"MBP 3222","vt":"str"},{"t":"eq","v":"IBUF","vt":"str"},{"t":"eq","v":"TAMBAT","vt":"str"},{"t":"eq","v":"MBP 3206","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":1510,"y":2000,"wires":[["dc1c76e.9cdd588"],["41bedaf3.d807c4"],["e6f2bd28.e9344"],["9f168c01.c98fa"]]},{"id":"41bedaf3.d807c4","type":"trigger","z":"47ec9b6e.206e24","name":"IBUF","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1650,"y":1980,"wires":[[]]},{"id":"e6f2bd28.e9344","type":"trigger","z":"47ec9b6e.206e24","name":"TAMBAT","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1660,"y":2020,"wires":[[]]},{"id":"9f168c01.c98fa","type":"trigger","z":"47ec9b6e.206e24","name":"MBP3206","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1662,"y":2062,"wires":[[]]},{"id":"596085d9.3ab0dc","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":540,"wires":[]},{"id":"239d5494.db9a6c","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1220,"y":580,"wires":[]},{"id":"79f88877.791218","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"Center\":d[0][0].Center,\n    \"Kanan\":d[1][0].Kanan,\n    \"Kiri\":d[2][0].Kiri,\n    \"DailyKanan\":d[3][0].DailyKanan,\n    \"DailyKiri\":d[4][0].DailyKiri,\n    \"R1\":convertrpm(parseInt(String(msg.data.R1))),\n    \"R2\":convertrpm(parseInt(String(msg.data.R2))),\n    \"ROB\":ROB(d),\n    \"ws\":msg.data.WS,\n    \"CmCenter\":msg.data.StorageCenter,\n    \"CmKanan\":msg.data.StorageKanan,\n    \"CmKiri\":msg.data.StorageKiri,\n    \"CmDailyKanan\":msg.data.DailyKanan,\n    \"CmDailyKiri\":msg.data.DailyKiri\n}\n\nmsg.GrafanaTambat = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    res += d[0][0].Center;\n    res += d[1][0].Kanan;\n    res += d[2][0].Kiri;\n    res += d[3][0].DailyKanan;\n    res += d[4][0].DailyKiri;\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":720,"wires":[[]]},{"id":"785ce802.b88d98","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"Fuel","func":"var d= msg.Grafana3206;\nvar json = {\n    \"EPO\":parseInt(String(msg.data.Time)),\n    \"DATEE\":String(msg.alldata.RECORDDATA),\n    \"STORAGE1\":parseInt(String(d.KananLiter)),\n    \"STORAGE2\":parseInt(String(d.KiriLiter)),\n    \"STORAGE3\":parseInt(String(d.CenterLiter)),\n    \"STORAGE4\":parseInt(String(\"0\")),\n    \"STORAGE5\":parseInt(String(\"0\")),\n    \"DAILY1\":parseInt(String(d.DailyLiter)),\n    \"DAILY2\":parseInt(String(\"0\")),\n    \"DAILY3\":parseInt(String(\"0\")),\n    \"DAILY4\":parseInt(String(\"0\")),\n    \"DAILY5\":parseInt(String(\"0\"))\n}\nmsg.topic = \"INSERT INTO `FuelData`(`EPO`,`DATEE`,`SHIPNAME`,`STORAGE1`,`STORAGE2`,`STORAGE3`,`STORAGE4`,`STORAGE5`,`DAILY1`,`DAILY2`,`DAILY3`,`DAILY4`,`DAILY5`)\";\nmsg.topic += \"VALUES(\"+\"'\"+String(json.EPO)+\"',\"+\"'\"+String(json.DATEE)+\"','MBP3206',\"+\"'\"+String(json.STORAGE1)+\"',\"+\"'\"+String(json.STORAGE2)+\"',\"+\"'\"+String(json.STORAGE3)+\"',\"+\"'\"+String(json.STORAGE4)+\"',\"+\"'\"+String(json.STORAGE5)+\"',\"+\"'\"+String(json.DAILY1)+\"',\"+\"'\"+String(json.DAILY2)+\"',\"+\"'\"+String(json.DAILY3)+\"',\"+\"'\"+String(json.DAILY4)+\"',\"+\"'\"+String(json.DAILY5)+\"');\";\n\n// INSERT INTO FUEL_VMS(EPO,DATEE,STORAGE1,STORAGE2,STORAGE3,STORAGE4,STORAGE5,DAILY1,DAILY2,DAILY3,DAILY4,DAILY5) \n// VALUES(:EPO,:DATEE,:STORAGE1,:STORAGE2,:STORAGE3,:STORAGE4,:STORAGE5,:DAILY1,:DAILY2,:DAILY3,:DAILY4,:DAILY5)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1340,"wires":[["f9f7b87a.03cf48"]]},{"id":"b3aecbd5.85d6a8","type":"function","z":"ce7006a0.688478","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":160,"wires":[["3b79e53a.6c708a"]]},{"id":"3b79e53a.6c708a","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1210,"y":160,"wires":[]},{"id":"17cc519e.bda25e","type":"link out","z":"80eab637.b91808","g":"50524935.d705d8","name":"ONLINE3222","links":["5e6cdb4d.f528f4"],"x":435,"y":160,"wires":[]},{"id":"d9688dfb.e381f","type":"link out","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"ONLINEIBUF","links":["476c6bd1.348914"],"x":435,"y":100,"wires":[]},{"id":"1b4220f3.583c2f","type":"link out","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"ONLINE3206","links":["64141804.897298"],"x":115,"y":80,"wires":[]},{"id":"3b59fd83.071372","type":"inject","z":"b6837abd.323fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1760,"wires":[["36c18fcc.110dc"]]},{"id":"36c18fcc.110dc","type":"influxdb in","z":"b6837abd.323fd8","influxdb":"76f4cea2.88ada","name":"","query":"SELECT * FROM PopupIBUF order by time desc limit 1;","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":560,"y":1760,"wires":[["dd12e787.95bda8","91a32a9f.e32d98"]]},{"id":"dd12e787.95bda8","type":"function","z":"b6837abd.323fd8","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    json[da[21]] = d[i][21];\n    json[da[22]] = d[i][22];\n    \n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1740,"wires":[["91a32a9f.e32d98"]]},{"id":"91a32a9f.e32d98","type":"debug","z":"b6837abd.323fd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":900,"y":1800,"wires":[]},{"id":"ffa59821.f29ed8","type":"inject","z":"b6837abd.323fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1400,"y":120,"wires":[["d36dd24e.a1a34"]]},{"id":"d36dd24e.a1a34","type":"function","z":"b6837abd.323fd8","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1570,"y":120,"wires":[["a3d1c31e.8f6c8"]]},{"id":"a3d1c31e.8f6c8","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1730,"y":120,"wires":[]},{"id":"a82513fa.0f88c","type":"inject","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":550,"y":260,"wires":[["8e5f48cc.f26358"]]},{"id":"8e5f48cc.f26358","type":"function","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","func":"if(flow.get(\"ToApex\")==false){\n    msg.payload= 600-((Date.parse(new Date()+(3600*8))-Date.parse(flow.get(\"TimeError\")))/1000)-5;\n}else{\n    msg.payload = \"-\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":260,"wires":[["598ab60e.4b98d8"]]},{"id":"598ab60e.4b98d8","type":"debug","z":"47ec9b6e.206e24","g":"3e5f8b9c.6d2c74","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":810,"y":260,"wires":[]},{"id":"69b37ca4.99df64","type":"function","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"count","func":"msg.payload = flow.get(\"Count\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":460,"wires":[["3d4a5116.5614ee"]]},{"id":"3d4a5116.5614ee","type":"debug","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":440,"wires":[]},{"id":"d7977316.81b67","type":"debug","z":"47ec9b6e.206e24","g":"53d851bc.74e43","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":630,"y":1740,"wires":[]},{"id":"7cf49193.bead3","type":"delay","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":640,"wires":[["19e70f08.fe9631"]]},{"id":"c6ea6f26.790bf","type":"inject","z":"b6837abd.323fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1120,"y":580,"wires":[["cb2bf761.707278"]]},{"id":"cb2bf761.707278","type":"function","z":"b6837abd.323fd8","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":560,"wires":[["3480cbd7.264504"]]},{"id":"d3794a5.81433b8","type":"inject","z":"ce7006a0.688478","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1220,"y":660,"wires":[["70d401d4.007de"]]},{"id":"70d401d4.007de","type":"function","z":"ce7006a0.688478","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":640,"wires":[["232f58be.76b6e8"]]},{"id":"232f58be.76b6e8","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":640,"wires":[]},{"id":"d99419ee.5d4d38","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":160,"wires":[["6a3a2f7c.b2b9d"]]},{"id":"6a3a2f7c.b2b9d","type":"function","z":"80eab637.b91808","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":140,"wires":[["4d4b37fe.7d6608"]]},{"id":"4d4b37fe.7d6608","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":890,"y":120,"wires":[]},{"id":"57048271.c893dc","type":"function","z":"47ec9b6e.206e24","name":"Update","func":"var d = msg.payload[0];\nmsg.topic = \"\";\nvar key = ['time','ARRIVAL','BARGE','CURRENTT','DEPARTURE','DESTINATION','ETA','FROMM','LASTRECEIVEDATE','LASTRECORDDATE','LATITUDE','LONGITUDE','NAMEE','NEXTT','ROB','ROBONSTART','RPMAVR','RPMENGINE_P','RPMENGINE_S','RPMPROPELLER_P','RPMPROPELLER_S','SPEEDCOURSE','TARGET_FO','TD','WINDSPEED'];\nmsg.topic = \"UPDATE `POPUPUPDATE` SET \"\nfor(i=0;i<key.length;i++){\n    msg.topic += \"`\"+String(key[i])+\"`=\";\n    if(typeof(d[key[i]])==\"number\"){\n        msg.topic += d[key[i]];\n    }else if(typeof(d[key[i]])==\"string\"){\n        if(key[i]==\"ROBONSTART\"){\n            d[key[i]] = String(parseInt(String(d[key[i]])));\n        }\n        msg.topic += \"'\"+String(d[key[i]])+\"'\";\n    }\n    if(i!=key.length-1){\n        msg.topic += \",\";\n    }\n}\nmsg.topic += \" WHERE `NAMEE` = '\"+String(d.NAMEE)+\"'\";\nmsg.delete = [d.time,d.NAMEE];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1940,"wires":[["c0ebd4d4.e1db68"]]},{"id":"af2e2cb5.71b34","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":840,"y":2100,"wires":[]},{"id":"ff2b6fac.0bec8","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1390,"y":1300,"wires":[]},{"id":"b84ac9a.83e0f38","type":"mqtt in","z":"80eab637.b91808","name":"Debug","topic":"Debug3222","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":650,"y":220,"wires":[["84a124cb.b05238"]]},{"id":"84a124cb.b05238","type":"debug","z":"80eab637.b91808","name":"Debug3222","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":840,"y":220,"wires":[]},{"id":"8287eaaa.f5a3d8","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":650,"y":1760,"wires":[["93e648d9.197078"]]},{"id":"93e648d9.197078","type":"function","z":"80eab637.b91808","name":"","func":"msg.payload = String(new Date(Date.now())).substring(0,33);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1780,"wires":[["7391a4c6.6c8a9c"]]},{"id":"7391a4c6.6c8a9c","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":960,"y":1800,"wires":[]},{"id":"a5933501.6d0458","type":"function","z":"ce7006a0.688478","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"Alldata3222\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_L\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_L\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE)+\",\";\nmsg.topic += String(d.RPMENGINE_L)+\",\";\nmsg.topic += String(d.RPMPROP)+\",\";\nmsg.topic += String(d.RPMPROP_L)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1540,"wires":[[]]},{"id":"717a3ed3.c3925","type":"function","z":"ce7006a0.688478","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"Popup3222\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_L\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_L\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE)+\",\";\nmsg.topic += String(d.RPMENGINE_L)+\",\";\nmsg.topic += String(d.RPMPROPELLER)+\",\";\nmsg.topic += String(d.RPMPROPELLER_L)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1600,"wires":[[]]},{"id":"92827fb7.8234b","type":"inject","z":"47ec9b6e.206e24","name":"MBP3222","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":2340,"wires":[["8291eeda.0c107"]]},{"id":"cc43f678.e341f8","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/MBP3222_2023.xlsx","x":790,"y":2340,"wires":[[]]},{"id":"ac517255.4f828","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":2340,"wires":[["31051401d1af3d6f"]]},{"id":"b1cd023f.e3de5","type":"influxdb in","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":2340,"wires":[["ac517255.4f828"]]},{"id":"8291eeda.0c107","type":"function","z":"47ec9b6e.206e24","name":" Query","func":"msg.query = \"SELECT * FROM fuelLevel4 where time >= 1701749880128 limit 20;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":2340,"wires":[["b1cd023f.e3de5"]]},{"id":"2faa794e.588be6","type":"inject","z":"47ec9b6e.206e24","name":"IBUF","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2400,"wires":[["eb98c98.3c36938"]]},{"id":"eadb399f.bf0ad8","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/IBUF_2023.xlsx","x":790,"y":2400,"wires":[[]]},{"id":"68ebb95b.cc4a58","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":2400,"wires":[[]]},{"id":"2df76f60.6165c","type":"influxdb in","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":2400,"wires":[["68ebb95b.cc4a58"]]},{"id":"eb98c98.3c36938","type":"function","z":"47ec9b6e.206e24","name":" Query","func":"msg.query = \"SELECT * FROM IBUF2 WHERE time > 1672509661000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2400,"wires":[["2df76f60.6165c"]]},{"id":"19b34e76.e1c4e2","type":"inject","z":"47ec9b6e.206e24","name":"TAMBAT","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":2460,"wires":[["39248c2d.a0b274"]]},{"id":"703bbcce.f2af94","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/TAMBAT_2023.xlsx","x":790,"y":2460,"wires":[[]]},{"id":"310420b1.e8c98","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":2460,"wires":[[]]},{"id":"1e4c50bf.c98c4f","type":"influxdb in","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":2460,"wires":[["310420b1.e8c98"]]},{"id":"39248c2d.a0b274","type":"function","z":"47ec9b6e.206e24","name":" Query","func":"msg.query = \"SELECT * FROM TAMBAT3 WHERE time > 1672509661000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2460,"wires":[["1e4c50bf.c98c4f"]]},{"id":"9af8537b.86405","type":"inject","z":"47ec9b6e.206e24","name":"MBP3206","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":2520,"wires":[["6fe419c0.c5f2f8"]]},{"id":"d20394e3.ec3158","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/MBP3206_2023.xlsx","x":790,"y":2520,"wires":[[]]},{"id":"c4302319.d3517","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":2520,"wires":[[]]},{"id":"4bce96bc.ae8638","type":"influxdb in","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":470,"y":2520,"wires":[["c4302319.d3517"]]},{"id":"6fe419c0.c5f2f8","type":"function","z":"47ec9b6e.206e24","name":" Query","func":"msg.query = \"SELECT * FROM MBP3206 WHERE time > 1672509661000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2520,"wires":[["4bce96bc.ae8638"]]},{"id":"2111e402.2b5d1c","type":"function","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"VMSDATA","func":"if(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\n\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.data.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n        }else if(column[i]==\"SPEED\"){\n            res = String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else{\n            res = fromdata[column[i]];    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":1440,"wires":[["301f903c.ce8f4","783c7fa7.2bacb"]]},{"id":"b2345672.49c578","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1390,"y":1440,"wires":[]},{"id":"301f903c.ce8f4","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1220,"y":1480,"wires":[]},{"id":"19b707e1.9c4148","type":"function","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"LASTDATA","func":"msg.payload = flow.get(\"RSRT\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":380,"wires":[["2a611480.ff107c","f3201f75.e4b88"]]},{"id":"2a611480.ff107c","type":"debug","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":420,"wires":[]},{"id":"21147a6b.5531a6","type":"inject","z":"ce7006a0.688478","g":"aeafb94d.da92e8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":380,"wires":[["19b707e1.9c4148"]]},{"id":"47b6a498.1cedbc","type":"inject","z":"ce7006a0.688478","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":610,"y":1820,"wires":[["9f1e8897.53edf8"]]},{"id":"9f1e8897.53edf8","type":"function","z":"ce7006a0.688478","name":"","func":"msg.payload = flow.get(\"fahmi\");\nif(flow.get(\"fahmi\") == undefined){\n    msg.payload = \"kosong\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1820,"wires":[["f78f18e5.e8b568"]]},{"id":"f78f18e5.e8b568","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":960,"y":1820,"wires":[]},{"id":"783c7fa7.2bacb","type":"mysql","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mydb":"be353e7e.73b9d","name":"","x":1210,"y":1440,"wires":[["b2345672.49c578"]]},{"id":"7e227324.d1c52c","type":"inject","z":"ce7006a0.688478","name":"MBP3206","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1240,"y":820,"wires":[["2b544c6a.01f7f4"]]},{"id":"2b544c6a.01f7f4","type":"function","z":"ce7006a0.688478","name":" Query","func":"msg.query = \"SELECT * FROM Grafana3206 WHERE time > 1678229765149000000 order by time desc;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":820,"wires":[["1ca36aa.767c695"]]},{"id":"1ca36aa.767c695","type":"influxdb in","z":"ce7006a0.688478","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1570,"y":820,"wires":[["dded4fef.08537"]]},{"id":"dded4fef.08537","type":"function","z":"ce7006a0.688478","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":820,"wires":[["4af6db83.e8b864","a5e2164c.b5d2b8"]]},{"id":"64bb2571.d3a8fc","type":"excel","z":"ce7006a0.688478","name":"","file":"/var/www/html/MBP3206_2023.xlsx","x":1890,"y":820,"wires":[[]]},{"id":"7c1f4b8b.16dbf4","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1960,"y":920,"wires":[]},{"id":"45b162ae.72afac","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":940,"wires":[["ffcf0c2a.9424e"]]},{"id":"1e9cebd7.8bc364","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" PopUpp","func":"\nmsg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/VMSDATA2024\";\n// msg.url = \"https://apex.oracle.com/pls/apex/iotelkafi/insert/insertalldata\";\n\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\ndelete msg.payload['time'];\ndelete msg['responseUrl'];\nmsg.measurement = \"popup\";\nflow.set(\"VMSDATAMBP3222\",msg.payload);\nmsg.topic = String(parseInt(String(msg.topic))+1);\nmsg.data = msg.payload;\ndelete msg['measurement'];\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":1080,"wires":[["dc91eb23.56e988","f9c97186.94ec4"]]},{"id":"ffcf0c2a.9424e","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"msg.topic = \"SELECT * FROM `VMSDATA` ORDER BY `EPO` ASC limit \"+String(msg.limitt)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":1040,"wires":[["3d1fe5b9.5bc5ba"]]},{"id":"3d1fe5b9.5bc5ba","type":"mysql","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","mydb":"be353e7e.73b9d","name":"","x":290,"y":1040,"wires":[["e7f8b071.33a18","70d8eba8e5ccbce1"]]},{"id":"7a266f24.10d47","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"VMSDataResponse","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":210,"y":1280,"wires":[]},{"id":"dc91eb23.56e988","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Count","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":890,"y":1060,"wires":[]},{"id":"d8eada66.d1cc58","type":"http request","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Update","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1180,"y":1080,"wires":[["6f309c8a.d6ee94"]]},{"id":"d0455da8.ac986","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"if(msg.topic == \"NoCur\"){\n    msg.payload = \"\";\n    return msg;   \n}\nif(msg.payload!=\"\"){\n    msg.errorr = msg.payload;\n    msg.payload = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":1240,"wires":[["1a1f7626.47cb9a","d9bf0f7f.96e92"]]},{"id":"1a1f7626.47cb9a","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":300,"y":1220,"wires":[["9bf512a3.c2c2f"]]},{"id":"9bf512a3.c2c2f","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"var d = msg.data2;\nmsg.topic = \"DELETE FROM `VMSDATA` WHERE `EPO` = \"+String(msg.EPO)+\";\";\nif(flow.get(\"ToApex\")==true){\n    count();    \n}\nreturn msg;\n\n\nfunction count(){\n    var a = flow.get(\"Count\");\n    a+=1;\n    flow.set(\"Count\",a);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1220,"wires":[["fdf27af8.32cad8"]]},{"id":"fdf27af8.32cad8","type":"mysql","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","mydb":"be353e7e.73b9d","name":"","x":570,"y":1220,"wires":[["78e74020.f73d2","c9d1294b.aed868"]]},{"id":"d9bf0f7f.96e92","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Null","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":1260,"wires":[["d828724c.7fcf"]]},{"id":"b160692a.a8bd08","type":"link out","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["947ea49e.0ad598"],"x":875,"y":1320,"wires":[]},{"id":"78e74020.f73d2","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":1220,"wires":[["934c4cb6.02b67"]]},{"id":"934c4cb6.02b67","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":1220,"wires":[]},{"id":"a9c27a85.284548","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"msg.EPO = msg.payload.EPO;\nmsg.payload[\"ROB\"] = parseInt(String(msg.payload.ROB));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1080,"wires":[["1e9cebd7.8bc364"]]},{"id":"f9c97186.94ec4","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Check Mode","func":"if(flow.get(\"ToApex\")==true){\n    msg.topic = \"On\";\n}\nif(msg.payload.CURRENTT == \"\"){\n    msg.topic = \"NoCur\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1060,"wires":[["7e281a5c.c84aa4"]]},{"id":"7e281a5c.c84aa4","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Ok?","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":1080,"wires":[["d8eada66.d1cc58","4f1b087c.6c9218","d5f5e2d66dea1bd7"]]},{"id":"5dbe05b5.609cfc","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" Date","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":1120,"wires":[]},{"id":"82cb1743.3767c8","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.EPO))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1120,"wires":[["5dbe05b5.609cfc"]]},{"id":"e7f8b071.33a18","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"if(msg.payload.length<1){\n    msg.topic = \"EMPTY\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1040,"wires":[["ff77a9e8.a5e698","ecddb313.ef6f5"]]},{"id":"ecddb313.ef6f5","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Data Available","property":"topic","propertyType":"msg","rules":[{"t":"neq","v":"EMPTY","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":200,"y":1100,"wires":[["d6fc8228.81193"]]},{"id":"ff77a9e8.a5e698","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"Empty","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"EMPTY","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":1040,"wires":[["e1972be4.98dab8"]]},{"id":"e1972be4.98dab8","type":"link out","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["cd9b1ab9.6d6a78"],"x":635,"y":1040,"wires":[]},{"id":"76512ed1.ecf5f","type":"trigger","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"3","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":630,"y":1120,"wires":[["da62429b.6db66"]]},{"id":"da62429b.6db66","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"[\"VMSDATA\",payload]","targetType":"jsonata","statusVal":"[\"Popup\",payload]","statusType":"auto","x":750,"y":1120,"wires":[]},{"id":"f071c4b8.958be8","type":"link in","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["19e70f08.fe9631"],"x":75,"y":1040,"wires":[["ffcf0c2a.9424e"]]},{"id":"6f309c8a.d6ee94","type":"link out","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["35dd739.362388c"],"x":1275,"y":1080,"wires":[]},{"id":"35dd739.362388c","type":"link in","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["6f309c8a.d6ee94","df2eb8f.eeee248"],"x":75,"y":1240,"wires":[["d0455da8.ac986","7a266f24.10d47"]]},{"id":"c9d1294b.aed868","type":"link out","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","links":["cd9b1ab9.6d6a78"],"x":655,"y":1180,"wires":[]},{"id":"d13e6c2a.6a5b8","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":630,"y":1120,"wires":[]},{"id":"372e1f38.b21a7","type":"subflow:e9b71a55.b25c68","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","env":[],"x":510,"y":1100,"wires":[["82cb1743.3767c8","76512ed1.ecf5f","a9c27a85.284548","6e102191.b6dd6","ac1e26a6fb544816"],["d13e6c2a.6a5b8"]]},{"id":"d6fc8228.81193","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" Start Loop","func":"var d = msg.payload;\nvar arr = [];\nvar column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[column[0]] = parseInt(String(d[i][column[0]]));//EPO\n    json[column[1]] = d[i][column[1]]; //SHIPNAME\n    json[column[2]] = d[i][column[2]]; //BARGE\n    json[column[3]] = d[i][column[3]]; //DEPARTURE\n    json[column[4]] = d[i][column[4]]; //ARRIVAL\n    json[column[5]] = d[i][column[5]]; //CURRENT\n    json[column[6]] = d[i][column[6]]; //NEXTT \n    json[column[7]] = d[i][column[7]]; //TD \n    json[column[8]] = d[i][column[8]]; //ETA\n    json[column[9]] = d[i][column[9]]; //LASTRECORDDATE\n    json[column[10]] = d[i][column[10]]; //LASTRECEIVEDATE\n    json[column[11]] = parseFloat(String(d[i][column[11]])); //LATITUDE\n    json[column[12]] = parseFloat(String(d[i][column[12]])); //LONGITUDE\n    json[column[13]] = d[i][column[13]]; //FROMM\n    json[column[14]] = d[i][column[14]]; //DESTINATION\n    json[column[15]] = parseFloat(String(d[i][column[15]])); //STATUS\n    json[column[16]] = parseFloat(String(d[i][column[16]])); //ANGLE\n    json[column[17]] = parseFloat(String(d[i][column[17]])); //ROB\n    json[column[18]] = d[i][column[18]]; //ROBONSTART\n    json[column[19]] = d[i][column[19]]; //ESTROB\n    json[column[20]] = d[i][column[20]]; //FUELCONS\n    json[column[21]] = d[i][column[21]]; //ST\n    json[column[22]] = parseFloat(String(d[i][column[22]])); //RPMENGINE_S\n    json[column[23]] = parseFloat(String(d[i][column[23]])); //RPMENGINE_P\n    json[column[24]] = parseFloat(String(d[i][column[24]])); //RPMAVR\n    json[column[25]] = parseFloat(String(d[i][column[25]])); //RPMPROPELLER_S\n    json[column[26]] = parseFloat(String(d[i][column[26]])); //RPMPROPELLER_P\n    json[column[27]] = parseFloat(String(d[i][column[27]])); //WINDSPEED\n    json[column[28]] = d[i][column[28]]; //SPEED\n    json[column[29]] = parseFloat(String(d[i][column[29]])); //TARGET_FO\n    arr.push(json);\n}\nmsg.payload=  arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1100,"wires":[["372e1f38.b21a7"]]},{"id":"862169e1.4b27e8","type":"influxdb out","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","influxdb":"76f4cea2.88ada","name":"VMSDATA","measurement":"VMSDATA","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1370,"y":1040,"wires":[]},{"id":"4f1b087c.6c9218","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"msg.payload['time'] = msg.payload.EPO;\nmsg.payload['ROB'] = String(msg.payload.ROB);\nmsg.payload['RPMAVR'] = String(msg.payload.RPMAVR);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1210,"y":1040,"wires":[["862169e1.4b27e8"]]},{"id":"77149e59.a238f","type":"inject","z":"fd486f91.7596e","name":"TAMBAT","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3140,"y":1800,"wires":[["d412d3da.910d2"]]},{"id":"d412d3da.910d2","type":"function","z":"fd486f91.7596e","name":" Query","func":"msg.query = \"SELECT * FROM TAMBAT3 WHERE time > 1672509661000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3290,"y":1800,"wires":[["b388a221.69f38"]]},{"id":"b388a221.69f38","type":"influxdb in","z":"fd486f91.7596e","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":3470,"y":1800,"wires":[["e8646120.13e1a"]]},{"id":"e8646120.13e1a","type":"function","z":"fd486f91.7596e","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3610,"y":1800,"wires":[["8ed81cb3.6bd9b"]]},{"id":"8ed81cb3.6bd9b","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3800,"y":1860,"wires":[]},{"id":"f332f1eb.a3179","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1910,"y":1240,"wires":[]},{"id":"684a999c.17e448","type":"inject","z":"b6837abd.323fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":400,"wires":[["220823e8.c7514c"]]},{"id":"220823e8.c7514c","type":"function","z":"b6837abd.323fd8","name":"LASTDATA","func":"msg.payload = flow.get(\"RSRT\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":400,"wires":[["8df9b58f.e85bf8","b647ec97.743bf"]]},{"id":"8df9b58f.e85bf8","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":590,"y":460,"wires":[]},{"id":"e1d2b739.d36e78","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"asdvms","x":840,"y":1040,"wires":[[]]},{"id":"614434bb.0e79dc","type":"mysql","z":"80eab637.b91808","g":"5248f06a.76272","mydb":"be353e7e.73b9d","name":"","x":1430,"y":960,"wires":[["8a4c819f.725e5","3103e8b6.56ed88"]]},{"id":"2476c2e0.6067ee","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1440,"y":1000,"wires":[]},{"id":"8a4c819f.725e5","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.affectedRows","targetType":"msg","statusVal":"payload.affectedRows","statusType":"auto","x":1590,"y":960,"wires":[]},{"id":"17c886ba.6b65b9","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"VMSDATA","func":"if(flow.get(\"prevday\") != msg.alldata.RECORDDATA.split(\"/\")[0]){\n    flow.set(\"HalfHour\",undefined);\n}\nif(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\nflow.set(\"prevday\",msg.alldata.RECORDDATA.split(\"/\")[0]);\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n            if(res==\"\"){\n                res = \"_\";\n            }\n        }else if(column[i]==\"SPEED\"){\n            res = String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else if(column[i]==\"EPO\" || column[i]==\"LATITUDE\" || column[i]==\"LONGITUDE\"){\n            res = fromdata[column[i]];    \n        }else{\n            res = String(fromdata[column[i]]);    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":980,"wires":[["614434bb.0e79dc","2476c2e0.6067ee"]]},{"id":"7760eab5.396054","type":"inject","z":"80eab637.b91808","g":"50524935.d705d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":360,"y":540,"wires":[["ce282d92.7623"]]},{"id":"ce282d92.7623","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"LASTDATA","func":"msg.payload = flow.get(\"RSRT\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":540,"wires":[["ddc785a8.ceaf68"]]},{"id":"3353775.f824488","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":500,"wires":[]},{"id":"16b4740c.8d6f3c","type":"inject","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1410,"y":160,"wires":[["d5831f5.bfef8e"]]},{"id":"24b88b27.20be44","type":"influxdb in","z":"80eab637.b91808","g":"a12e1f8a.e83e8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1440,"y":260,"wires":[["af514300.74fce"]]},{"id":"9f4f155a.e897d8","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1950,"y":140,"wires":[]},{"id":"2bc40121.3bc0fe","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1930,"y":300,"wires":[["c2cab59b.99caf8"]]},{"id":"f6cf7284.91a9f","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1850,"y":420,"wires":[["cb85bde1.fdb9a"]]},{"id":"f9ab8a49.478318","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1950,"y":80,"wires":[]},{"id":"c2cab59b.99caf8","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2050,"y":220,"wires":[]},{"id":"cb85bde1.fdb9a","type":"switch","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2010,"y":440,"wires":[["ea4755c6.266af8","8982ca28.b605c8"]]},{"id":"ea4755c6.266af8","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2020,"y":340,"wires":[]},{"id":"c837abd4.226ea8","type":"inject","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1600,"y":480,"wires":[[]]},{"id":"e39e1783.fa5318","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","func":"msg.payload = flow.get(\"cekkosong\")[5449];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1760,"y":480,"wires":[["d525abc5.066aa8"]]},{"id":"d4d66fff.2ab61","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":520,"wires":[[]]},{"id":"d525abc5.066aa8","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1930,"y":480,"wires":[]},{"id":"221b4248.aef21e","type":"inject","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1580,"y":540,"wires":[["d4d66fff.2ab61"]]},{"id":"d5831f5.bfef8e","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","func":"msg.query = \"select * from fuelLevel4 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672415999000;\";\nmsg.payload = msg.query;\nreturn msg;\n\n// var data1 = {\n//     time:data.Time,\n//     lat:data.Lat,\n//     lon:data.Lon,\n//     ws:data.WS,\n//     sat:data.Sat,\n//     F1:data.F1,\n//     F2:data.F2,\n//     F3:data.F3,\n//     F4:data.F4,\n//     F5:data.F5,\n//     F6:data.F6,\n//     RP1:data.R1,\n//     RP2:data.R2,\n//     RP5:data.R5,\n//     RP8:data.R8\n    \n// };","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":200,"wires":[["24b88b27.20be44"]]},{"id":"af514300.74fce","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1590,"y":300,"wires":[["9f4f155a.e897d8","72a1b9a1.de9338"]]},{"id":"d828724c.7fcf","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"\ntry{\n    msg.payload = JSON.parse(msg.errorr);\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1280,"wires":[["d8d3d9ec.3ddd48"]]},{"id":"d8d3d9ec.3ddd48","type":"function","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","func":"if(msg.payload == null){\n    return msg;\n}\nvar cause = msg.payload.cause;\nif(cause.includes('WKSP_IOTELKAFI.VMSDATA_PK')){\n    msg.topic = \"DELETE FROM `VMSDATA` WHERE `EPO` = \"+String(msg.EPO)+\";\";\n}else{\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1280,"wires":[["880d0912.6538e8","9443017a.a4a18"]]},{"id":"880d0912.6538e8","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"PK Error?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":1280,"wires":[["bfd54fde.57998"]]},{"id":"279626c.40055da","type":"trigger","z":"47ec9b6e.206e24","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1210,"y":1220,"wires":[[]]},{"id":"50460fdc.84b36","type":"trigger","z":"47ec9b6e.206e24","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1350,"y":1220,"wires":[[]]},{"id":"9443017a.a4a18","type":"switch","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":1320,"wires":[["b160692a.a8bd08"]]},{"id":"ddc785a8.ceaf68","type":"json","z":"80eab637.b91808","g":"50524935.d705d8","name":"","property":"payload","action":"","pretty":false,"x":510,"y":500,"wires":[["173c1707.fde679"]]},{"id":"173c1707.fde679","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"","func":"msg.payload = [msg.payload[0]];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":540,"wires":[["3353775.f824488"]]},{"id":"da05e7d4.15fe98","type":"debug","z":"47ec9b6e.206e24","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1360,"y":1480,"wires":[]},{"id":"7e80674.9c66598","type":"debug","z":"47ec9b6e.206e24","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1370,"y":1400,"wires":[]},{"id":"bfd54fde.57998","type":"mysql","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","mydb":"be353e7e.73b9d","name":"","x":1050,"y":1240,"wires":[["279626c.40055da","50460fdc.84b36","7e80674.9c66598"]]},{"id":"a9d0834f.4f91b","type":"debug","z":"47ec9b6e.206e24","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"EPO","targetType":"msg","statusVal":"","statusType":"auto","x":1350,"y":1520,"wires":[]},{"id":"e8ec018b.241c","type":"comment","z":"80eab637.b91808","name":" ","info":"","x":1910,"y":2480,"wires":[]},{"id":"a4f1a01b.65654","type":"link in","z":"80eab637.b91808","name":"","links":["276a77ba.499ab8"],"x":1935,"y":640,"wires":[["a9fa3421.3f5268"]]},{"id":"a9fa3421.3f5268","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2070,"y":640,"wires":[]},{"id":"5e6cdb4d.f528f4","type":"link in","z":"47ec9b6e.206e24","name":"","links":["17cc519e.bda25e"],"x":1175,"y":40,"wires":[["f236ab25.c10108"]]},{"id":"476c6bd1.348914","type":"link in","z":"47ec9b6e.206e24","name":"","links":["d9688dfb.e381f"],"x":1175,"y":80,"wires":[["89c0099b.402368"]]},{"id":"228e8277.f9ee6e","type":"link in","z":"47ec9b6e.206e24","name":"","links":["87964e94.b2df2"],"x":1175,"y":120,"wires":[["ef9a7590.80e268"]]},{"id":"64141804.897298","type":"link in","z":"47ec9b6e.206e24","name":"","links":["1b4220f3.583c2f"],"x":1175,"y":160,"wires":[["db07097a.df85b8"]]},{"id":"f236ab25.c10108","type":"trigger","z":"47ec9b6e.206e24","name":" 3222","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"12","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":40,"wires":[[]]},{"id":"89c0099b.402368","type":"trigger","z":"47ec9b6e.206e24","name":" IBUF","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"12","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":80,"wires":[[]]},{"id":"ef9a7590.80e268","type":"trigger","z":"47ec9b6e.206e24","name":" Tambat","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"12","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1280,"y":120,"wires":[[]]},{"id":"db07097a.df85b8","type":"trigger","z":"47ec9b6e.206e24","name":" 3206","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"12","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":160,"wires":[[]]},{"id":"3480cbd7.264504","type":"debug","z":"b6837abd.323fd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1440,"y":600,"wires":[]},{"id":"c471f241.e609a","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2040,"y":900,"wires":[["febe130d.2d278"]]},{"id":"febe130d.2d278","type":"function","z":"80eab637.b91808","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":880,"wires":[["1ad9f441.1136ac"]]},{"id":"1ad9f441.1136ac","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2360,"y":920,"wires":[]},{"id":"1f0c1d00.a81293","type":"inject","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2210,"y":360,"wires":[["626f0b52.567974"]]},{"id":"626f0b52.567974","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2350,"y":360,"wires":[["1714e4bc.d9db8b","db0c2e6.af7c3d","72f61c2c.a9a564"]]},{"id":"1714e4bc.d9db8b","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2490,"y":360,"wires":[["99a9414c.e267e"]]},{"id":"99a9414c.e267e","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2670,"y":360,"wires":[]},{"id":"68ead9cd.458ba8","type":"inject","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" resetflow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2220,"y":440,"wires":[["fbd60615.2ff648"]]},{"id":"fbd60615.2ff648","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2370,"y":440,"wires":[[]]},{"id":"db0c2e6.af7c3d","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[1]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2490,"y":360,"wires":[[]]},{"id":"b81de4d5.b5b1d8","type":"debug","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2680,"y":420,"wires":[]},{"id":"3103e8b6.56ed88","type":"trigger","z":"80eab637.b91808","g":"5248f06a.76272","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1590,"y":900,"wires":[[]]},{"id":"72f61c2c.a9a564","type":"function","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2510,"y":420,"wires":[["b81de4d5.b5b1d8"]]},{"id":"72a1b9a1.de9338","type":"subflow:e9b71a55.b25c68","z":"80eab637.b91808","g":"a12e1f8a.e83e8","name":"","x":1730,"y":340,"wires":[["2bc40121.3bc0fe","f6cf7284.91a9f","f9ab8a49.478318"],[]]},{"id":"9e8bff91.843c1","type":"inject","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from IBUF2 where \"FS101\" != '-1' AND \"FS107\" != '-1' AND \"FS118\" != '-1' AND time > 1666713028272","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2220,"y":120,"wires":[["f5e4943a.44af58"]]},{"id":"15972b43.34c0c5","type":"influxdb in","z":"b6837abd.323fd8","g":"b2a8424.21928c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":2240,"y":220,"wires":[[]]},{"id":"da9ee776.38f9f8","type":"debug","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2750,"y":100,"wires":[]},{"id":"643d752.b46bb8c","type":"function","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2730,"y":260,"wires":[["35d75a4c.b20f56"]]},{"id":"41102d3c.59d6b4","type":"function","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2650,"y":380,"wires":[["eaae2f1c.b0e7d"]]},{"id":"51348c2d.7d7764","type":"debug","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2750,"y":40,"wires":[]},{"id":"35d75a4c.b20f56","type":"debug","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2850,"y":180,"wires":[]},{"id":"eaae2f1c.b0e7d","type":"switch","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":400,"wires":[["4380133a.ae93bc"]]},{"id":"4380133a.ae93bc","type":"debug","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2820,"y":300,"wires":[]},{"id":"eb9b4085.7eb5","type":"inject","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2400,"y":440,"wires":[["fda66cab.7d2fd"]]},{"id":"fda66cab.7d2fd","type":"function","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","func":"msg.payload = flow.get(\"cekkosong\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2560,"y":440,"wires":[["b7f5ecdf.f6962"]]},{"id":"2584aa68.4d9626","type":"function","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2530,"y":480,"wires":[[]]},{"id":"b7f5ecdf.f6962","type":"debug","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2730,"y":440,"wires":[]},{"id":"8c3a523d.0a80d","type":"inject","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2380,"y":500,"wires":[["2584aa68.4d9626"]]},{"id":"f5e4943a.44af58","type":"function","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","func":"msg.query = \"select * from IBUF2 where \";\nvar keyy = ['FS101','FS107','FS118','FS119','FS123','FS129','lat','lon','ws'];\nfor(i=0;i<keyy.length;i++){\n    msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n}\nmsg.query += \" time > 1672509661000\";\nmsg.payload = msg.query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":160,"wires":[["15972b43.34c0c5"]]},{"id":"ba423b03.60ee08","type":"subflow:e9b71a55.b25c68","z":"b6837abd.323fd8","g":"b2a8424.21928c","name":"","x":2530,"y":300,"wires":[["643d752.b46bb8c","41102d3c.59d6b4","51348c2d.7d7764"],[]]},{"id":"839bf7bd.fde878","type":"inject","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2210,"y":680,"wires":[["89b63d21.4294d"]]},{"id":"6e73a5ad.a42acc","type":"influxdb in","z":"b6837abd.323fd8","g":"3b614174.164cfe","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":2240,"y":780,"wires":[["d1b563d.6cffca"]]},{"id":"ab7fe28d.840d","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2750,"y":660,"wires":[]},{"id":"1392f3ae.2a194c","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2730,"y":820,"wires":[["b8cc1ab9.8d2538"]]},{"id":"48efd7e0.bc4588","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2650,"y":940,"wires":[["37088e00.dea9c2"]]},{"id":"ac8147f0.4c1ac8","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2750,"y":600,"wires":[]},{"id":"b8cc1ab9.8d2538","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2850,"y":740,"wires":[]},{"id":"37088e00.dea9c2","type":"switch","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":960,"wires":[["76560afb.774d64","7e26af6.789d45"]]},{"id":"76560afb.774d64","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2820,"y":860,"wires":[]},{"id":"863e3f8f.3af94","type":"inject","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2400,"y":1000,"wires":[[]]},{"id":"b4ad5889.d57e78","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","func":"msg.payload = flow.get(\"cekkosong\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2560,"y":1000,"wires":[["9ed4179a.76f6b8"]]},{"id":"e77383ab.da881","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2530,"y":1040,"wires":[[]]},{"id":"9ed4179a.76f6b8","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2730,"y":1000,"wires":[]},{"id":"870403fd.c0527","type":"inject","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2380,"y":1060,"wires":[["e77383ab.da881"]]},{"id":"89b63d21.4294d","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","func":"msg.query = \"select * from IBUF2 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672415999000;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":720,"wires":[["6e73a5ad.a42acc"]]},{"id":"538a8ca4.7bc8a4","type":"inject","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" resetflow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3020,"y":960,"wires":[["e04d4470.592e78"]]},{"id":"e04d4470.592e78","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3170,"y":960,"wires":[[]]},{"id":"492aeff6.91d3","type":"inject","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3010,"y":880,"wires":[["c2a268d7.c88d78"]]},{"id":"c2a268d7.c88d78","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3150,"y":880,"wires":[["39ad5365.11760c","b1c02495.ed0528","f7f90dbb.56895"]]},{"id":"39ad5365.11760c","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3290,"y":880,"wires":[["dd8b7eab.ef0f"]]},{"id":"b1c02495.ed0528","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[1]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3290,"y":880,"wires":[[]]},{"id":"dd8b7eab.ef0f","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3470,"y":880,"wires":[]},{"id":"f7d52737.44c108","type":"debug","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3480,"y":940,"wires":[]},{"id":"f7f90dbb.56895","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3310,"y":940,"wires":[["f7d52737.44c108"]]},{"id":"d1b563d.6cffca","type":"function","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2370,"y":820,"wires":[["ab7fe28d.840d","6c1f28d8.f9e5c8"]]},{"id":"f2990aa5.b97c58","type":"function","z":"b6837abd.323fd8","name":"VMSDATA","func":"if(flow.get(\"prevday\") != msg.alldata.RECORDDATA.split(\"/\")[0]){\n    flow.set(\"HalfHour\",undefined);\n}\nif(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\nflow.set(\"prevday\",msg.alldata.RECORDDATA.split(\"/\")[0]);\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.data.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = \"_\"//secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n            if(res==\"\"){\n                res = \"_\";\n            }\n        }else if(column[i]==\"SPEED\"){\n            res = \"_\";//String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = \"_\";//String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = \"_\";//String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else if(column[i]==\"EPO\" || column[i]==\"LATITUDE\" || column[i]==\"LONGITUDE\"){\n            res = fromdata[column[i]];    \n        }else{\n            res = String(fromdata[column[i]]);    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1570,"y":1240,"wires":[["7fc306b7.5f90d8","744f0390.59cc9c"]]},{"id":"e34be91e.7225e8","type":"trigger","z":"b6837abd.323fd8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1890,"y":1160,"wires":[[]]},{"id":"744f0390.59cc9c","type":"mysql","z":"b6837abd.323fd8","mydb":"be353e7e.73b9d","name":"","x":1730,"y":1240,"wires":[["e34be91e.7225e8","f332f1eb.a3179"]]},{"id":"7fc306b7.5f90d8","type":"debug","z":"b6837abd.323fd8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1740,"y":1280,"wires":[]},{"id":"5086c9eb.e6d908","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1530,"y":1120,"wires":[]},{"id":"2cb143d3.94012c","type":"function","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"VMSDATA","func":"if(flow.get(\"prevday\") != msg.alldata.RECORDDATA.split(\"/\")[0]){\n    flow.set(\"HalfHour\",undefined);\n}\nif(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\nflow.set(\"prevday\",msg.alldata.RECORDDATA.split(\"/\")[0]);\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.data.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n            if(res==\"\"){\n                res = \"_\";\n            }\n        }else if(column[i]==\"SPEED\"){\n            res = String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else if(column[i]==\"EPO\" || column[i]==\"LATITUDE\" || column[i]==\"LONGITUDE\"){\n            res = fromdata[column[i]];    \n        }else{\n            res = String(fromdata[column[i]]);    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1120,"wires":[["647acaa2.80e564","28478031.4a2eb"]]},{"id":"1ccfe0c2.d3d9ef","type":"trigger","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1530,"y":1060,"wires":[[]]},{"id":"28478031.4a2eb","type":"mysql","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mydb":"be353e7e.73b9d","name":"","x":1390,"y":1120,"wires":[["1ccfe0c2.d3d9ef","5086c9eb.e6d908"]]},{"id":"647acaa2.80e564","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1520,"y":1180,"wires":[]},{"id":"49d4dbbb.7569e4","type":"inject","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1620,"wires":[["89981ce4.172b"]]},{"id":"9bb6205e.2288e","type":"influxdb in","z":"fd486f91.7596e","g":"fcbdbec6.319c5","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":350,"y":1620,"wires":[["62d920d6.e8547"]]},{"id":"c87fea34.727198","type":"debug","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":610,"y":1660,"wires":[]},{"id":"63cf1660.aa1c98","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1660,"wires":[["344e2d31.a087d2"]]},{"id":"d8d1b240.ea435","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1700,"wires":[["83659f88.38fb9"]]},{"id":"74f5a27e.7bbcdc","type":"debug","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"count","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":770,"y":1620,"wires":[]},{"id":"344e2d31.a087d2","type":"debug","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":1660,"wires":[]},{"id":"83659f88.38fb9","type":"switch","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":910,"y":1700,"wires":[["4a8a01fb.f947f","2078cfaab63051a2"]]},{"id":"4a8a01fb.f947f","type":"debug","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1050,"y":1660,"wires":[]},{"id":"3fc071d5.867c6e","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","func":"msg.payload = flow.get(\"cekkosong\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1660,"wires":[["7c9af236.5d5b7c"]]},{"id":"59b64bf3.652794","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1700,"wires":[[]]},{"id":"7c9af236.5d5b7c","type":"debug","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":410,"y":1660,"wires":[]},{"id":"84d2f344.77dd2","type":"inject","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"Reset Kosong","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":140,"y":1700,"wires":[["59b64bf3.652794"]]},{"id":"89981ce4.172b","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","func":"msg.query = \"select * from TAMBAT3 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672415999000;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":1620,"wires":[["9bb6205e.2288e"]]},{"id":"62d920d6.e8547","type":"function","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1620,"wires":[["c87fea34.727198","a20ad130.8bad"]]},{"id":"6c1f28d8.f9e5c8","type":"subflow:e9b71a55.b25c68","z":"b6837abd.323fd8","g":"3b614174.164cfe","name":"","x":2530,"y":860,"wires":[["1392f3ae.2a194c","48efd7e0.bc4588","ac8147f0.4c1ac8"],[]]},{"id":"a20ad130.8bad","type":"subflow:e9b71a55.b25c68","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"","x":610,"y":1620,"wires":[["63cf1660.aa1c98","d8d1b240.ea435","74f5a27e.7bbcdc"],[]]},{"id":"6b6e8074.fc3a4","type":"inject","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from IBUF2 where \"FS101\" != '-1' AND \"FS107\" != '-1' AND \"FS118\" != '-1' AND time > 1666713028272","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1800,"y":300,"wires":[["51d98d07.d6d304"]]},{"id":"51d98d07.d6d304","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","func":"msg.query = \"select * from MBP3206 where \";\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\n// var keyy = ['FS125'];\nfor(i=0;i<keyy.length;i++){\n    msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n}\nmsg.query += \" time > 1672705296751;\";\nmsg.payload = msg.query;\nreturn msg;\n\n// \"time\":data.Time,\n//     \"lat\":data.Lat, \n//     \"lon\":data.Lon, \n//     \"ws\":data.WS, \n//     \"FS125\":data.FS125, \n//     \"FS121\":data.FS121, \n//     \"FS124\":data.FS124, \n//     \"FS127\":data.FS127, \n//     \"FS112\":data.FS112, \n//     \"FS105\":data.FS105, \n//     \"FS120\":data.FS120, \n//     \"RPM113\":data.RPM113, \n//     \"RPM114\":data.RPM114, \n//     \"RPM115\":data.RPM115,\n//     \"RPM116\":data.RPM116","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1880,"y":340,"wires":[["77d72c9b.48a214"]]},{"id":"77d72c9b.48a214","type":"influxdb in","z":"ce7006a0.688478","g":"e1041fc7.f509f","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1820,"y":400,"wires":[["aebec9d7.8e2bd8"]]},{"id":"aebec9d7.8e2bd8","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1990,"y":460,"wires":[["9cbf4837.840548","7de06874.051548"]]},{"id":"9cbf4837.840548","type":"debug","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2330,"y":280,"wires":[]},{"id":"d244d938.d2d008","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2310,"y":440,"wires":[["754429fa.c98e38"]]},{"id":"875c6652.69a588","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2230,"y":560,"wires":[["a14731b6.67485"]]},{"id":"f0762b5.30e77d8","type":"debug","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2330,"y":220,"wires":[]},{"id":"754429fa.c98e38","type":"debug","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2430,"y":360,"wires":[]},{"id":"a14731b6.67485","type":"switch","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2390,"y":580,"wires":[["3ce1e3d2.88417c"]]},{"id":"3ce1e3d2.88417c","type":"debug","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2400,"y":480,"wires":[]},{"id":"b03dd22f.ca7f9","type":"inject","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1980,"y":620,"wires":[["da19b58b.fe4278"]]},{"id":"da19b58b.fe4278","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","func":"msg.payload = flow.get(\"cekkosong\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":620,"wires":[["2d5fed2.e082912"]]},{"id":"a5a55a2e.f4b9e8","type":"function","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2110,"y":660,"wires":[[]]},{"id":"2d5fed2.e082912","type":"debug","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2310,"y":620,"wires":[]},{"id":"8825845f.22c0d8","type":"inject","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1960,"y":680,"wires":[["a5a55a2e.f4b9e8"]]},{"id":"7de06874.051548","type":"subflow:e9b71a55.b25c68","z":"ce7006a0.688478","g":"e1041fc7.f509f","name":"","x":2110,"y":480,"wires":[["d244d938.d2d008","875c6652.69a588","f0762b5.30e77d8"],[]]},{"id":"b636e70f.ebddf8","type":"inject","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2670,"y":300,"wires":[["4b586528.555a0c"]]},{"id":"c51cee38.a29cf","type":"influxdb in","z":"ce7006a0.688478","g":"6f19b97d.5656b8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":2700,"y":400,"wires":[["59ab4a24.d896d4"]]},{"id":"eb0cdf30.62d26","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3210,"y":280,"wires":[]},{"id":"3641c031.6d8a5","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3190,"y":440,"wires":[["6007c31c.14595c"]]},{"id":"a7b5aaf6.4a0108","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3110,"y":560,"wires":[["36025038.e550c"]]},{"id":"4a082fb8.ae131","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":3210,"y":220,"wires":[]},{"id":"6007c31c.14595c","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3310,"y":360,"wires":[]},{"id":"36025038.e550c","type":"switch","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":3270,"y":580,"wires":[["4adde03a.65d24","f396f498.da45d8"]]},{"id":"4adde03a.65d24","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3280,"y":480,"wires":[]},{"id":"eee6b762.356228","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","func":"msg.payload = flow.get(\"cekkosong\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3020,"y":620,"wires":[["152df20.983150e"]]},{"id":"6078ed38.0e7dc4","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2990,"y":660,"wires":[[]]},{"id":"152df20.983150e","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3190,"y":620,"wires":[]},{"id":"d9da8f72.0741","type":"inject","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2840,"y":680,"wires":[["6078ed38.0e7dc4"]]},{"id":"4b586528.555a0c","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","func":"msg.query = \"select * from MBP3206 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672415999000;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2740,"y":340,"wires":[["c51cee38.a29cf"]]},{"id":"81247a27.cc8dc8","type":"inject","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" resetflow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3480,"y":580,"wires":[["b8fbb2e5.56964"]]},{"id":"b8fbb2e5.56964","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3630,"y":580,"wires":[[]]},{"id":"88133364.11bb9","type":"inject","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3470,"y":500,"wires":[["38bda411.71bddc"]]},{"id":"38bda411.71bddc","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3610,"y":500,"wires":[["7bcd6b97.4b7c04","49231215.5ed54c","edf5a926.597618"]]},{"id":"7bcd6b97.4b7c04","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3750,"y":500,"wires":[["c751a3eb.b8347"]]},{"id":"49231215.5ed54c","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[1]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3750,"y":500,"wires":[[]]},{"id":"c751a3eb.b8347","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3930,"y":500,"wires":[]},{"id":"b9878070.3165b","type":"debug","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3940,"y":560,"wires":[]},{"id":"edf5a926.597618","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3770,"y":560,"wires":[["b9878070.3165b"]]},{"id":"a647e7e4.c58168","type":"subflow:e9b71a55.b25c68","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":"","x":2990,"y":480,"wires":[["3641c031.6d8a5","a7b5aaf6.4a0108","4a082fb8.ae131"],[]]},{"id":"59ab4a24.d896d4","type":"function","z":"ce7006a0.688478","g":"6f19b97d.5656b8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2830,"y":420,"wires":[["eb0cdf30.62d26","a647e7e4.c58168"]]},{"id":"5953f896.53df88","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":1280,"wires":[]},{"id":"b33efd62.a84e7","type":"function","z":"ce7006a0.688478","name":"VMSDATA","func":"if(flow.get(\"prevday\") != msg.alldata.RECORDDATA.split(\"/\")[0]){\n    flow.set(\"HalfHour\",undefined);\n}\nif(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\nflow.set(\"prevday\",msg.alldata.RECORDDATA.split(\"/\")[0]);\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.data.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n            if(res==\"\"){\n                res = \"_\";\n            }\n        }else if(column[i]==\"SPEED\"){\n            res = String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else if(column[i]==\"EPO\" || column[i]==\"LATITUDE\" || column[i]==\"LONGITUDE\"){\n            res = fromdata[column[i]];    \n        }else{\n            res = String(fromdata[column[i]]);    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1610,"y":1280,"wires":[["3efc96f4.e277ca","3edc5f0.a125ea2"]]},{"id":"4701cb5b.927594","type":"trigger","z":"ce7006a0.688478","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1950,"y":1200,"wires":[[]]},{"id":"3edc5f0.a125ea2","type":"mysql","z":"ce7006a0.688478","mydb":"be353e7e.73b9d","name":"","x":1790,"y":1280,"wires":[["4701cb5b.927594","5953f896.53df88"]]},{"id":"3efc96f4.e277ca","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1800,"y":1320,"wires":[]},{"id":"54657a7f.c1cbd4","type":"function","z":"80eab637.b91808","g":"50524935.d705d8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.Time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":180,"wires":[["f58f94f1.027418"]]},{"id":"f58f94f1.027418","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1150,"y":60,"wires":[]},{"id":"f693689.d315b98","type":"mqtt in","z":"fdac93f7.bec1b","name":"","topic":"TabelRelay","qos":"2","datatype":"auto","broker":"5069a677.3406e8","x":730,"y":340,"wires":[["6ac11559.ca6b4c"]]},{"id":"6ac11559.ca6b4c","type":"json","z":"fdac93f7.bec1b","name":"","property":"payload","action":"","pretty":false,"x":880,"y":340,"wires":[["f333baa3.1d4cd8","eb1edd14.45234"]]},{"id":"f333baa3.1d4cd8","type":"debug","z":"fdac93f7.bec1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":990,"y":300,"wires":[]},{"id":"eb1edd14.45234","type":"excel","z":"fdac93f7.bec1b","name":"","file":"/var/www/html/TabelRelay.xlsx","x":1050,"y":320,"wires":[["f333baa3.1d4cd8"]]},{"id":"2eda7861.aecf08","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":2540,"wires":[]},{"id":"9c8feb2a.1c2b88","type":"inject","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_Operation].[dbo].[VMS_STAGGING_BUNKER] WHERE SHIP = 'TAMBAT' ORDER BY TIME_START ASC;","payloadType":"str","x":110,"y":1960,"wires":[[]]},{"id":"40beb8f.3bfdb48","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":"Check Length","func":"var qty = flow.get(\"QTYBunker\");\nvar d = msg.payload\nvar arr = []\nif(d.length!=qty){\n    for(i=qty;i<d.length;i++){\n        arr.push(d[i]);\n    }\n    msg.payload = arr;\n}else{\n    msg.payload = null;\n}\nmsg.lenlen = d.length;\nmsg.delay = 1000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1960,"wires":[["eb323d6e.f6bf5"]]},{"id":"d111b315.ab0fc","type":"inject","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":2100,"wires":[["8d5358b1.0581c8"]]},{"id":"8d5358b1.0581c8","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":"Set","func":"flow.set(\"QTYBunker\",6);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":2100,"wires":[[]]},{"id":"eb323d6e.f6bf5","type":"switch","z":"fd486f91.7596e","g":"382e1e18.723212","name":"NewData?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":1960,"wires":[["75f87627.bc4968"]]},{"id":"cc979ea4.ee9d8","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","func":"var d = msg.payload;\nvar json = {\n    \"TIMEBFRVMS\":\"\",\n    \"TIMEAFTVMS\":\"\",\n    \"ROB_BEFORE_VMS\":\"\",\n    \"ROB_AFTER_VMS\":\"\",\n    \"SHIP\":String(d.SHIP),\n    \"datee\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_START\":String(d.ROB_START),\n    \"TIME_START\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_FINISH\":String(d.ROB_FINISH),\n    \"TIME_COMPLETE\":toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).substring(0,toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).length-25),\n    \"BUNKER_QTY\":String(d.BUNKER_QTY),\n    \"FO_RECEIVED\":String(d.FO_RECEIVED),\n    \"recorddate\":epoch(String(d.TIME_START)),\n    \"FO_CONS\":String(d.FO_CONS),\n    \"vmsrob\":\"\",\n    \"dif\":\"\"\n}\nvar timebfr = (epoch(d.TIME_START)-(8*3600000)-300000)*1000000;\nvar timeaft = (epoch(d.TIME_COMPLETE)-(8*3600000)-300000)*1000000;\nmsg.Bunker = json;\nvar tabelROB = \"GrafanaTAMBAT\";\nmsg.query = \"SELECT ROB FROM \"+tabelROB+\" WHERE time <= \"+timebfr+\" ORDER BY time DESC limit 3;\";\nmsg.query += \"SELECT ROB FROM \"+tabelROB+\" WHERE time >= \"+timeaft+\" ORDER BY time ASC limit 3;\";\n// msg.payload = json;\nmsg.payload = [timebfr,timeaft];\nreturn msg;\n\nfunction epoch (date) {\n  return Date.parse(date)\n}\nfunction toDate(date){\n    return String(new Date(date));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1960,"wires":[["42047341.2e802c","df804088.82ad7"]]},{"id":"8d547c68.ea3c5","type":"influxdb in","z":"fd486f91.7596e","g":"382e1e18.723212","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":170,"y":2020,"wires":[["fa196d09.2240d"]]},{"id":"32659ce8.1a5834","type":"switch","z":"fd486f91.7596e","g":"382e1e18.723212","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":600,"y":2020,"wires":[["9266f3ee.dbbfd"]]},{"id":"d059dcdf.006da","type":"debug","z":"fd486f91.7596e","g":"382e1e18.723212","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":2080,"wires":[]},{"id":"42047341.2e802c","type":"link out","z":"fd486f91.7596e","g":"382e1e18.723212","name":"","links":["2755a16a.e939ee"],"x":995,"y":1960,"wires":[]},{"id":"2755a16a.e939ee","type":"link in","z":"fd486f91.7596e","g":"382e1e18.723212","name":"","links":["42047341.2e802c"],"x":75,"y":2020,"wires":[["8d547c68.ea3c5"]]},{"id":"9266f3ee.dbbfd","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","func":"flow.set(\"QTYBunker\",msg.lenlen);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":2020,"wires":[[]]},{"id":"ecf18cb3.98178","type":"http request","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertbunker","tls":"","persist":false,"proxy":"","authType":"basic","x":470,"y":2020,"wires":[["32659ce8.1a5834","d059dcdf.006da"]]},{"id":"fa196d09.2240d","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":" ","func":"var avrb= avr(msg.payload.results[0].series[0].values);\nvar avra= avr(msg.payload.results[1].series[0].values);\nvar timeb = String(new Date(Math.round(msg.payload.results[0].series[0].values[0][0]/1000000)));\ntimeb = timeb.substring(0,timeb.length-25);\nvar timea = String(new Date(Math.round(msg.payload.results[1].series[0].values[0][0]/1000000)));\ntimea = timea.substring(0,timea.length-25);\nvar robvms = Math.round(Math.abs(avrb-avra));\nmsg.Bunker['TIMEBFRVMS'] = timeb.split(' ')[2]+\"-\"+gm(timeb.split(' ')[1])+\"-\"+timeb.split(' ')[3]+\" \"+timeb.split(' ')[4];\nmsg.Bunker['TIMEAFTVMS'] = timea.split(' ')[2]+\"-\"+gm(timea.split(' ')[1])+\"-\"+timea.split(' ')[3]+\" \"+timea.split(' ')[4];\nmsg.Bunker['vmsrob'] = String(robvms);\nmsg.Bunker['dif'] = String(Math.round(Math.abs(msg.Bunker.FO_RECEIVED - robvms)));\nmsg.Bunker['ROB_BEFORE_VMS'] = String(avrb);\nmsg.Bunker['ROB_AFTER_VMS'] = String(avra);\nmsg.Bunker['RECORD_ID'] = Date.parse(msg.Bunker.TIME_START);\nmsg.Bunker['datee'] = msg.Bunker.datee.split(' ')[2]+\"-\"+gm(msg.Bunker.datee.split(' ')[1])+\"-\"+msg.Bunker.datee.split(' ')[3];//+\" \"+msg.Bunker.datee.split(' ')[4];\nmsg.Bunker['TIME_START'] = msg.Bunker.TIME_START.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_START.split(' ')[1])+\"-\"+msg.Bunker.TIME_START.split(' ')[3]+\" \"+msg.Bunker.TIME_START.split(' ')[4];\nmsg.Bunker['TIME_COMPLETE'] = msg.Bunker.TIME_COMPLETE.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_COMPLETE.split(' ')[1])+\"-\"+msg.Bunker.TIME_COMPLETE.split(' ')[3]+\" \"+msg.Bunker.TIME_COMPLETE.split(' ')[4];\nmsg.payload= msg.Bunker;\nreturn msg;\n\nfunction avr(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        res+=x[i][1];\n    }\n    res = Math.round(res / x.length);\n    return res;\n}\n\nfunction gm(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n       var res = \"\";\n       if(String(new Date(d).getMonth() + 1).length<2){\n           res = \"0\" + String(new Date(d).getMonth() + 1);\n       }else{\n           res = String(new Date(d).getMonth() + 1);\n       }\n      return res;\n   }\n   return -1;\n }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2020,"wires":[["d059dcdf.006da","ecf18cb3.98178"]]},{"id":"644492e5.f4ab8c","type":"function","z":"fd486f91.7596e","g":"382e1e18.723212","name":"Get","func":"msg.payload = flow.get(\"QTYBunker\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":2060,"wires":[["d059dcdf.006da"]]},{"id":"75f87627.bc4968","type":"subflow:e9b71a55.b25c68","z":"fd486f91.7596e","g":"382e1e18.723212","name":"","env":[],"x":790,"y":1960,"wires":[["cc979ea4.ee9d8","df804088.82ad7"],[]]},{"id":"df804088.82ad7","type":"debug","z":"fd486f91.7596e","g":"382e1e18.723212","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":2020,"wires":[]},{"id":"3f2f1f6.2ea28e","type":"inject","z":"fd486f91.7596e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3010,"y":1860,"wires":[[]]},{"id":"55f8fe9f.4adbf","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3360,"y":1900,"wires":[]},{"id":"feb5ad37.79ebd","type":"inject","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING_BUNKER] WHERE SHIP = 'MBP 3206' ORDER BY TIME_START ASC;","payloadType":"str","x":130,"y":1920,"wires":[[]]},{"id":"1a4ae8cb.3daf57","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"Check Length","func":"var qty = flow.get(\"QTYBunker\");\nvar d = msg.payload\nvar arr = []\nif(d.length!=qty){\n    for(i=qty;i<d.length;i++){\n        arr.push(d[i]);\n    }\n    msg.payload = arr;\n}else{\n    msg.payload = null;\n}\nmsg.lenlen = d.length;\nmsg.delay = 1000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1920,"wires":[["2cfcc1f4.1c409e"]]},{"id":"acf9d66f.22ee68","type":"inject","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":2060,"wires":[["79a1e39e.ab6aac"]]},{"id":"79a1e39e.ab6aac","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"Set","func":"flow.set(\"QTYBunker\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2060,"wires":[[]]},{"id":"2cfcc1f4.1c409e","type":"switch","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"NewData?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":1920,"wires":[["864ca1d9.4d02d"]]},{"id":"48047a3b.6ae164","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","func":"var d = msg.payload;\nvar json = {\n    \"TIMEBFRVMS\":\"\",\n    \"TIMEAFTVMS\":\"\",\n    \"ROB_BEFORE_VMS\":\"\",\n    \"ROB_AFTER_VMS\":\"\",\n    \"SHIP\":String(d.SHIP),\n    \"datee\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_START\":String(d.ROB_START),\n    \"TIME_START\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_FINISH\":String(d.ROB_FINISH),\n    \"TIME_COMPLETE\":toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).substring(0,toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).length-25),\n    \"BUNKER_QTY\":String(d.BUNKER_QTY),\n    \"FO_RECEIVED\":String(d.FO_RECEIVED),\n    \"recorddate\":epoch(String(d.TIME_START)),\n    \"FO_CONS\":String(d.FO_CONS),\n    \"vmsrob\":\"\",\n    \"dif\":\"\"\n}\nvar timebfr = (epoch(d.TIME_START)-(8*3600000)-300000)*1000000;\nvar timeaft = (epoch(d.TIME_COMPLETE)-(8*3600000)-300000)*1000000;\nmsg.Bunker = json;\nvar tabelROB = \"Grafana3206\";\nmsg.query = \"SELECT ROB FROM \"+tabelROB+\" WHERE time <= \"+timebfr+\" ORDER BY time DESC limit 3;\";\nmsg.query += \"SELECT ROB FROM \"+tabelROB+\" WHERE time >= \"+timeaft+\" ORDER BY time ASC limit 3;\";\n// msg.payload = json;\nmsg.payload = [timebfr,timeaft];\nreturn msg;\n\nfunction epoch (date) {\n  return Date.parse(date)\n}\nfunction toDate(date){\n    return String(new Date(date));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":1920,"wires":[["8cceb287.1694d"]]},{"id":"c28ec34d.2a071","type":"influxdb in","z":"ce7006a0.688478","g":"d943fe42.7259e","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":190,"y":1980,"wires":[["ead0a698.33aef8"]]},{"id":"c3665c94.15dac","type":"switch","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":620,"y":1980,"wires":[["2af03970.175c86"]]},{"id":"cf9381b.1654c8","type":"debug","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":530,"y":2040,"wires":[]},{"id":"8cceb287.1694d","type":"link out","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"","links":["119fe324.3eb31d"],"x":1015,"y":1920,"wires":[]},{"id":"119fe324.3eb31d","type":"link in","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"","links":["8cceb287.1694d"],"x":95,"y":1980,"wires":[["c28ec34d.2a071"]]},{"id":"2af03970.175c86","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","func":"flow.set(\"QTYBunker\",msg.lenlen);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1980,"wires":[[]]},{"id":"8c2ff36e.f4394","type":"http request","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertbunker","tls":"","persist":false,"proxy":"","authType":"basic","x":490,"y":1980,"wires":[["c3665c94.15dac","cf9381b.1654c8"]]},{"id":"ead0a698.33aef8","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":" ","func":"var avrb= avr(msg.payload.results[0].series[0].values);\nvar avra= avr(msg.payload.results[1].series[0].values);\nvar timeb = String(new Date(Math.round(msg.payload.results[0].series[0].values[0][0]/1000000)));\ntimeb = timeb.substring(0,timeb.length-25);\nvar timea = String(new Date(Math.round(msg.payload.results[1].series[0].values[0][0]/1000000)));\ntimea = timea.substring(0,timea.length-25);\nvar robvms = Math.round(Math.abs(avrb-avra));\nmsg.Bunker['TIMEBFRVMS'] = timeb.split(' ')[2]+\"-\"+gm(timeb.split(' ')[1])+\"-\"+timeb.split(' ')[3]+\" \"+timeb.split(' ')[4];\nmsg.Bunker['TIMEAFTVMS'] = timea.split(' ')[2]+\"-\"+gm(timea.split(' ')[1])+\"-\"+timea.split(' ')[3]+\" \"+timea.split(' ')[4];\nmsg.Bunker['vmsrob'] = String(robvms);\nmsg.Bunker['dif'] = String(Math.round(Math.abs(msg.Bunker.FO_RECEIVED - robvms)));\nmsg.Bunker['ROB_BEFORE_VMS'] = String(avrb);\nmsg.Bunker['ROB_AFTER_VMS'] = String(avra);\nmsg.Bunker['RECORD_ID'] = Date.parse(msg.Bunker.TIME_START);\nmsg.Bunker['datee'] = msg.Bunker.datee.split(' ')[2]+\"-\"+gm(msg.Bunker.datee.split(' ')[1])+\"-\"+msg.Bunker.datee.split(' ')[3];//+\" \"+msg.Bunker.datee.split(' ')[4];\nmsg.Bunker['TIME_START'] = msg.Bunker.TIME_START.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_START.split(' ')[1])+\"-\"+msg.Bunker.TIME_START.split(' ')[3]+\" \"+msg.Bunker.TIME_START.split(' ')[4];\nmsg.Bunker['TIME_COMPLETE'] = msg.Bunker.TIME_COMPLETE.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_COMPLETE.split(' ')[1])+\"-\"+msg.Bunker.TIME_COMPLETE.split(' ')[3]+\" \"+msg.Bunker.TIME_COMPLETE.split(' ')[4];\nmsg.payload= msg.Bunker;\nreturn msg;\n\nfunction avr(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        res+=x[i][1];\n    }\n    res = Math.round(res / x.length);\n    return res;\n}\n\nfunction gm(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n       var res = \"\";\n       if(String(new Date(d).getMonth() + 1).length<2){\n           res = \"0\" + String(new Date(d).getMonth() + 1);\n       }else{\n           res = String(new Date(d).getMonth() + 1);\n       }\n      return res;\n   }\n   return -1;\n }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1980,"wires":[["cf9381b.1654c8","8c2ff36e.f4394"]]},{"id":"80f595cc.94f158","type":"function","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"Get","func":"msg.payload = flow.get(\"QTYBunker\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":2020,"wires":[["cf9381b.1654c8"]]},{"id":"864ca1d9.4d02d","type":"subflow:e9b71a55.b25c68","z":"ce7006a0.688478","g":"d943fe42.7259e","name":"","env":[],"x":810,"y":1920,"wires":[["48047a3b.6ae164"],[]]},{"id":"e64b0c98.19478","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":880,"y":1840,"wires":[]},{"id":"4d8985c187ed494e","type":"inject","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 07 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":2640,"wires":[["fd0a9dc6.22fe2"]]},{"id":"4a1b1df5116616ac","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"fadlurrahmanfahmibudiman@gmail.com","dname":"","x":900,"y":2640,"wires":[]},{"id":"ae92eecf31a0b75b","type":"debug","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":2920,"wires":[]},{"id":"fd0a9dc6.22fe2","type":"function","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":" ","func":"flow.set(\"ReportUpdate\",msg.payload);\nmsg.topic = \"\";\nvar ship = [\"MBP3222\",\"MBP3206\",\"TAMBAT\",\"IBUF\", \"TULUS\"];\nfor(i=0;i<ship.length;i++){\n    msg.topic += \"SELECT * FROM `VMSDATA_RECORD` WHERE `SHIP_NAME`= '\"+String(ship[i])+\"' order by `EPO` desc limit 1;\";    \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":2640,"wires":[["aa30b7cb.d93218"]]},{"id":"aa30b7cb.d93218","type":"mysql","z":"47ec9b6e.206e24","g":"e29f94d3.283128","mydb":"be353e7e.73b9d","name":"","x":430,"y":2640,"wires":[["51e0ef56.917be"]]},{"id":"51e0ef56.917be","type":"function","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":" ","func":"var d = msg.payload;\nvar arr = [];\nvar report = \"\";\nfor(i=0;i<d.length;i++){\n    var json = {\n        \"Ship\":d[i][0].SHIP_NAME,\n        \"Last Data\":d[i][0].LASTRECORDDATE,\n        \"Last Online\":d[i][0].LASTRECEIVEDATE,\n        \"Status Update\":secondsToDhms(Math.round((Date.now()-d[i][0].EPO)/1000)),\n        \"ROB\":d[i][0].ROB,\n        \"GPS\":String(d[i][0].LATITUDE)+\",\"+String(d[i][0].LONGITUDE)\n    };\n    arr.push(json);\n}\n\nmsg.topic = \"VMS Report\";\nreport += \"DATE : \"+String(new Date(Date.now()))+\"\\n\\n\\n\";\nfor(i=0;i<arr.length;i++){\n    var objkey = Object.keys(arr[i]);\n    report += String(objkey[0])+\" : \"+String(arr[i][objkey[0]])+\"\\n\";\n    report += String(objkey[1])+\" : \"+String(arr[i][objkey[1]])+\"\\n\";\n    report += String(objkey[2])+\" : \"+String(arr[i][objkey[2]])+\"\\n\";\n    report += String(objkey[3])+\" : \"+String(arr[i][objkey[3]])+\"\\n\";\n    report += String(objkey[4])+\" : \"+String(arr[i][objkey[4]])+\"\\n\";\n    report += String(objkey[5])+\" : \"+String(arr[i][objkey[5]])+\"\\n\";\n    report += \"\\n\\n\";\n}\nmsg.payload = report;\nreturn msg;\n\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    var res = dDisplay + hDisplay + mDisplay ;\n    if(res.length<1){\n        return \"less than a minute\";\n    }\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":2640,"wires":[["ae92eecf31a0b75b","3ec5f4c3.7a618c"]]},{"id":"76cca9ca.d048d8","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"freddy.winarso@adaro.com","dname":"","x":860,"y":2680,"wires":[]},{"id":"360f3b01.bae684","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"ravellerhaven@gmail.com","dname":"","x":850,"y":2720,"wires":[]},{"id":"924583f9.a56aa","type":"comment","z":"47ec9b6e.206e24","name":"1672509661000","info":"","x":580,"y":2280,"wires":[]},{"id":"1c0cb22.f6cb74e","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3460,"y":1960,"wires":[]},{"id":"846a8c01.2342a","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"august.tantowi@adaro.com","dname":"","x":860,"y":2760,"wires":[]},{"id":"c893e887.526d78","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"Wahyu.Widodo@adaro.com","dname":"","x":860,"y":2800,"wires":[]},{"id":"af4ff82b.cc3768","type":"inject","z":"ce7006a0.688478","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":320,"y":2120,"wires":[["16805b04.078cf5"]]},{"id":"c4aba88a.619878","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":2120,"wires":[]},{"id":"16805b04.078cf5","type":"function","z":"ce7006a0.688478","name":"","func":"msg.payload = new Date(\"2023-02-04T10:50:00.000Z\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2120,"wires":[["c4aba88a.619878"]]},{"id":"6decb252.0228bc","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"mamanbudiman@yahoo.com","dname":"","x":870,"y":2840,"wires":[]},{"id":"c9126f18.879e8","type":"debug","z":"ce7006a0.688478","g":"eb56ff57.5b80d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":1020,"wires":[]},{"id":"76c2a638.494e78","type":"e-mail","z":"47ec9b6e.206e24","g":"e29f94d3.283128","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"ismirajprawira09@gmail.com","dname":"","x":870,"y":2880,"wires":[]},{"id":"eb5ff20b.27b84","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":3020,"wires":[["1eb63820.b65b98"]]},{"id":"1eb63820.b65b98","type":"function","z":"47ec9b6e.206e24","name":" ","func":"flow.set(\"ReportUpdate\",msg.payload);\nmsg.topic = \"\";\nvar ship = [\"MBP3222\",\"MBP3206\",\"TAMBAT\",\"IBUF\"];\nfor(i=0;i<ship.length;i++){\n    msg.topic += \"SELECT * FROM `VMSDATA_RECORD` WHERE `SHIP_NAME`= '\"+String(ship[i])+\"' order by `EPO` desc limit 1;\";    \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":3020,"wires":[["8bc78afc.d0aca8"]]},{"id":"8bc78afc.d0aca8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":390,"y":3020,"wires":[["4cc0a5b4.15faec"]]},{"id":"4cc0a5b4.15faec","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload;\nvar arr = [];\nvar report = \"\";\nfor(i=0;i<d.length;i++){\n    var json = {\n        \"Ship\":d[i][0].SHIP_NAME,\n        \"Last Data\":d[i][0].LASTRECORDDATE,\n        \"Last Online\":d[i][0].LASTRECEIVEDATE,\n        \"Status Update\":secondsToDhms(Math.round((Date.now()-d[i][0].EPO)/1000)),\n        \"ROB\":d[i][0].ROB,\n        \"GPS\":String(d[i][0].LATITUDE)+\",\"+String(d[i][0].LONGITUDE)\n    };\n    arr.push(json);\n}\n\nmsg.topic = \"VMS Report\";\nreport += \"DATE : \"+String(new Date(Date.now()))+\"\\n\\n\\n\";\nfor(i=0;i<arr.length;i++){\n    var objkey = Object.keys(arr[i]);\n    report += String(objkey[0])+\" : \"+String(arr[i][objkey[0]])+\"\\n\";\n    report += String(objkey[1])+\" : \"+String(arr[i][objkey[1]])+\"\\n\";\n    report += String(objkey[2])+\" : \"+String(arr[i][objkey[2]])+\"\\n\";\n    report += String(objkey[3])+\" : \"+String(arr[i][objkey[3]])+\"\\n\";\n    report += String(objkey[4])+\" : \"+String(arr[i][objkey[4]])+\"\\n\";\n    report += String(objkey[5])+\" : \"+String(arr[i][objkey[5]])+\"\\n\";\n    report += \"\\n\\n\";\n}\nmsg.payload = report;\nreturn msg;\n\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    var res = dDisplay + hDisplay + mDisplay ;\n    if(res.length<1){\n        return \"less than a minute\";\n    }\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3020,"wires":[["ee70c853.009848"]]},{"id":"ee70c853.009848","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":3020,"wires":[]},{"id":"a8317515.144e08","type":"ui_text_input","z":"47ec9b6e.206e24","name":"","label":"SHIP","tooltip":"","group":"63c9411b.ed21d","order":0,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"topic","sendOnBlur":true,"className":"","topicType":"msg","x":190,"y":3140,"wires":[["b411ed0.6d9611"]]},{"id":"45769bd4.47a614","type":"ui_button","z":"47ec9b6e.206e24","name":"","group":"63c9411b.ed21d","order":9,"width":0,"height":0,"passthru":false,"label":"Search","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":200,"y":3320,"wires":[["dd8d05dc.99a738"]]},{"id":"b411ed0.6d9611","type":"function","z":"47ec9b6e.206e24","name":" ","func":"flow.set(\"SHIPNAME\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":3140,"wires":[["9e44efdb.2e89a","445b9e06.d6559"]]},{"id":"9e44efdb.2e89a","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":3140,"wires":[]},{"id":"78b45c31.85c3a4","type":"ui_date_picker","z":"47ec9b6e.206e24","name":"","label":"From","group":"63c9411b.ed21d","order":10,"width":0,"height":0,"passthru":true,"topic":"topic","topicType":"msg","className":"","x":190,"y":3200,"wires":[["9ebfc47.eae3e38"]]},{"id":"9ebfc47.eae3e38","type":"function","z":"47ec9b6e.206e24","name":" ","func":"flow.set(\"DATEFROM\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":3200,"wires":[["2fa7923b.45f00e","445b9e06.d6559"]]},{"id":"2fa7923b.45f00e","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":3200,"wires":[]},{"id":"6f36afde.af88c","type":"ui_date_picker","z":"47ec9b6e.206e24","name":"","label":"To","group":"63c9411b.ed21d","order":10,"width":0,"height":0,"passthru":true,"topic":"topic","topicType":"msg","className":"","x":190,"y":3260,"wires":[["9d868908.19c128"]]},{"id":"9d868908.19c128","type":"function","z":"47ec9b6e.206e24","name":" ","func":"flow.set(\"DATETO\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":3260,"wires":[["5d4bdb60.99be14","445b9e06.d6559"]]},{"id":"5d4bdb60.99be14","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":3260,"wires":[]},{"id":"dd8d05dc.99a738","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.topic = \"SELECT * FROM `VMSDATA_RECORD` WHERE \";\nmsg.topic += \"`EPO` > \"+String(flow.get(\"DATEFROM\"));\nmsg.topic += \" AND `EPO` < \"+String(flow.get(\"DATETO\"));\nmsg.topic += \" order by `EPO` ASC;\";\nmsg.payload = \"Loading\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":3320,"wires":[["51c5ae6b.95b86","d327f0b2.25c5e"]]},{"id":"b22b19fd.453788","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":630,"y":3320,"wires":[["6ea8149d.9a7e2c"]]},{"id":"2cac08a9.5aa168","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":3320,"wires":[]},{"id":"445b9e06.d6559","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.payload = \"-\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":3220,"wires":[["51c5ae6b.95b86","4a245a35.0ff8c4"]]},{"id":"51c5ae6b.95b86","type":"ui_text","z":"47ec9b6e.206e24","group":"63c9411b.ed21d","order":4,"width":0,"height":0,"name":"","label":"Status","format":"{{msg.payload}}","layout":"row-spread","className":"","x":910,"y":3240,"wires":[]},{"id":"6ea8149d.9a7e2c","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/VMS.xlsx","x":770,"y":3320,"wires":[["2cac08a9.5aa168","36987465.e70fdc"]]},{"id":"4a245a35.0ff8c4","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":830,"y":3180,"wires":[]},{"id":"36987465.e70fdc","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.payload = \"OK\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":3280,"wires":[["51c5ae6b.95b86"]]},{"id":"d327f0b2.25c5e","type":"delay","z":"47ec9b6e.206e24","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":3320,"wires":[["b22b19fd.453788"]]},{"id":"cbff7a80.d9dd38","type":"http in","z":"47ec9b6e.206e24","name":"","url":"/GetDataVMS.xlsx","method":"get","upload":false,"swaggerDoc":"","x":120,"y":3440,"wires":[["4566f2d.a659d0c"]]},{"id":"4566f2d.a659d0c","type":"file in","z":"47ec9b6e.206e24","name":"","filename":"/var/www/html/VMS.xlsx","format":"","chunk":false,"sendError":false,"encoding":"none","x":360,"y":3440,"wires":[["ae2a67c6.09ab58"]]},{"id":"ae2a67c6.09ab58","type":"http response","z":"47ec9b6e.206e24","name":"","statusCode":"","headers":{},"x":670,"y":3440,"wires":[]},{"id":"cc0605c7.b638b8","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.query = \"SELECT * FROM fuelLevel4 where time > 1672502399000;\";\nreturn msg;\n\n//1672502399000","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":3540,"wires":[["f8234ff1.2b45f"]]},{"id":"ace999e0.14fd88","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":3540,"wires":[["cc0605c7.b638b8"]]},{"id":"be22c9c9.111d28","type":"ui_button","z":"47ec9b6e.206e24","name":"","group":"63c9411b.ed21d","order":6,"width":0,"height":0,"passthru":false,"label":"Download","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":200,"y":3380,"wires":[["8cc210c6.3c79d"]]},{"id":"8cc210c6.3c79d","type":"open","z":"47ec9b6e.206e24","name":"","target":"http://36.92.113.244:1880/GetDataVMS.xlsx","app":"","wait":false,"urlencode":false,"x":350,"y":3380,"wires":[["e08c6baa.804fd8"]]},{"id":"e08c6baa.804fd8","type":"debug","z":"47ec9b6e.206e24","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":500,"y":3380,"wires":[]},{"id":"f8234ff1.2b45f","type":"influxdb in","z":"47ec9b6e.206e24","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":330,"y":3540,"wires":[["aba725c5.517cc8"]]},{"id":"aba725c5.517cc8","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":3540,"wires":[["ab67951.be52468"]]},{"id":"28c063c0.0783ac","type":"function","z":"47ec9b6e.206e24","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar calitable = [\"`FS001Ags`\",\"`FS002Rev5`\",\"`FS003Rev5`\",\"`FS004Rev5`\",\"`FS005Rev5`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"WS\":detectInt(d.ws),\n    \"Sat\":detectInt(d.sat),\n    \"F1\":d.F1,\n    \"F2\":d.F2,\n    \"F3\":d.F3,\n    \"F4\":d.F4,\n    \"F5\":d.F5,\n    \"F6\":d.F6,\n    \"R1\":parseFloat(d.RP1),\n    \"R2\":parseFloat(d.RP2),\n    \"R5\":parseFloat(d.RP5),\n    \"R8\":parseFloat(d.RP8)\n}\njson['CmKiri'] = Math.round(rumuskiri28double(json.F3,json.F6));\njson['CmKanan'] = Math.round(rumuskanan10double(json.F2,json.F1));\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    var val = Math.round(json['F'+String(i+1)]);\n    msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(val)+\";\";\n}\n\nmsg.topic += \"SELECT * FROM `TabelSondeKiri` WHERE `Cm` = \"+String(Math.round(json.CmKiri))+\";\";\nmsg.topic += \"SELECT * FROM `TabelSondeKanan` WHERE `Cm` = \"+String(Math.round(json.CmKanan))+\";\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        if(x==\"-1\"){\n            x=\"0\";\n        }\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(b==9 || b == 10){\n        if(a<10){\n            a = 0;\n        }\n    }\n    if(a < 100){\n        if(avr(n)<=400){\n            return avr(n);\n        }else{\n            return avr(n);\n        }\n    }\n    if(a != \"-1\"){\n        if(b<7){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=7){\n            a = parseInt(String(a));\n        }\n        var cekk = isNaN(a);\n        if(!cekk){\n            n.push(a);    \n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=400){\n            if(avr(n)>=200){\n                return 400;\n            }\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\n\nfunction rumuskiri28double(dpn,blg){\n    return (dpn * -0.0715895679807236)+(blg * 0.2189957537736704)+(54.37558133121867)\t\n}\nfunction rumuskanan10double(dpn,blg){\n    return (dpn * 0.06983610340529135)+(blg * 0.09880988417745153)+(2.072062588656962)\t\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":3640,"wires":[["d5b8cbfb.235ad8"]]},{"id":"d5b8cbfb.235ad8","type":"mysql","z":"47ec9b6e.206e24","mydb":"be353e7e.73b9d","name":"","x":390,"y":3640,"wires":[["52a45760.665ec8"]]},{"id":"52a45760.665ec8","type":"function","z":"47ec9b6e.206e24","name":"CreateJson","func":"var d = msg.payload;\nvar LiterKiri = msg.payload[6][0].Volume;\nvar LiterKanan = msg.payload[7][0].Volume;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"F1\":d[0][0].Liter,\n    \"F2\":d[1][0].Liter,\n    \"F3\":d[2][0].Liter,\n    \"F4\":d[3][0].Liter,\n    \"F5\":d[4][0].Liter,\n    \"F6\":d[5][0].Liter,\n    \"R1\":RPMKANAN(parseInt(String(msg.data.R1))),\n    \"R2\":RPMKIRI(parseInt(String(msg.data.R2))),\n    \"R5\":PropKiri(msg.data.R5),\n    \"R8\":PropKanan(msg.data.R8),\n    \"ROB\":ROB2(d),\n    \"ws\":convertws(msg.data.WS)\n}\nmsg.ROB = json.ROB;\nvar json2 = {\n    \"time\":msg.data.Time,//1000\n    \"Lat\":msg.data.Lat,\n    \"Lon\":msg.data.Lon,\n    \"StorageKiri\":parseFloat((LiterKiri*1000).toFixed(2)),\n    \"StorageKanan\":parseFloat((LiterKanan*1000).toFixed(2)),\n    \"DailyKiri\":d[3][0].Liter,\n    \"DailyKanan\":d[4][0].Liter,\n    \"RPMKanan\":RPMKANAN(parseInt(String(msg.data.R1))),\n    \"RPMKiri\":RPMKIRI(parseInt(String(msg.data.R2))),\n    \"PropKanan\":PropKanan(msg.data.R8),\n    \"PropKiri\":PropKiri(msg.data.R5),\n    \"ROB\":ROB2(d),\n    \"RawStorageKananBlkng\":parseInt(msg.data.F1),\n    \"RawStorageKananDepan\":parseInt(msg.data.F2),\n    \"RawStorageKiriDepan\":parseInt(msg.data.F3),\n    \"RawStorageKiriBlkng\":parseInt(msg.data.F6),\n    \"RawDailyKanan\":parseInt(msg.data.F5),\n    \"RawDailyKiri\":parseInt(msg.data.F4)\n    \n}\nvar aaa = flow.get(\"MBP3222Backup\");\naaa.push(json2);\nflow.set(\"MBP3222Backup\",aaa);\nmsg.ROB2 = json2;\nmsg.Grafana2 = json;\nmsg.payload = json2;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    if(x[1][0].Liter>=2394){//FS002\n        // res+=(Math.round((x[1][0].Liter+x[0][0].Liter)/2));//FS002+FS001/2\n        res+=x[1][0].Liter;\n    }else{\n        res+=x[1][0].Liter;\n    }\n    if(x[2][0].Liter>=2347){//FS003\n        // res+=(Math.round((x[2][0].Liter+x[5][0].Liter)/2));//FS003+FS006/2\n        res+=x[2][0].Liter;\n    }else{\n        res+=x[2][0].Liter;\n    }\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\n\nfunction ROB2(x){\n    var res = 0;\n    res+=LiterKiri*1000;\n    res+=LiterKanan*1000;\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    \n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n\n\nfunction RPMKANAN(x){\n    var res = (0.4909 * x) - 7.1141;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return res;\n}\n\nfunction RPMKIRI(x){\n    var res = (0.4126 * x) - 14.878;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return res;\n}\n\nfunction PropKanan(x){\n    var res = (0.2376*x)+21.024;\n    if(res<40 || x<70){\n        res = 0;\n    }\n    return res;\n}\nfunction PropKiri(x){\n    var res = (0.2373*x)+0.0967;\n    if(res<40 || x<70){\n        res = 0;\n    }\n    return res;\n}\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":3640,"wires":[["d8bf7919.2abef8"]]},{"id":"ab67951.be52468","type":"subflow:e9b71a55.b25c68","z":"47ec9b6e.206e24","name":"","x":430,"y":3580,"wires":[["28c063c0.0783ac","da0bda9d.bac328"],[]]},{"id":"d8bf7919.2abef8","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":3600,"wires":[]},{"id":"918bc227.4e287","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":3500,"wires":[["c412489e.3a0bb8"]]},{"id":"c412489e.3a0bb8","type":"function","z":"47ec9b6e.206e24","name":" ","func":"flow.set(\"MBP3222Backup\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":3500,"wires":[[]]},{"id":"e429554f.d59ee8","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.payload = flow.get(\"MBP3222Backup\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":3500,"wires":[["17e5d116.6f98df"]]},{"id":"17e5d116.6f98df","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":3500,"wires":[]},{"id":"15ec4179.907a1f","type":"inject","z":"47ec9b6e.206e24","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":3700,"wires":[["ed915776.0021b8"]]},{"id":"ed915776.0021b8","type":"function","z":"47ec9b6e.206e24","name":" ","func":"msg.payload = flow.get(\"MBP3222Backup\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":3700,"wires":[["c6b1687d.d15378","215be0dd.3e37f"]]},{"id":"c6b1687d.d15378","type":"debug","z":"47ec9b6e.206e24","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":450,"y":3700,"wires":[]},{"id":"da0bda9d.bac328","type":"debug","z":"47ec9b6e.206e24","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":640,"y":3560,"wires":[]},{"id":"215be0dd.3e37f","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/VMSMBP3222.xlsx","x":450,"y":3740,"wires":[[]]},{"id":"2219e3f8.0511cc","type":"inject","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":160,"wires":[["498126c1.b09c48"]]},{"id":"533be77c.bdf1f8","type":"influxdb in","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":160,"y":260,"wires":[["48f7c074.63013","53867bb5.6395b4"]]},{"id":"48f7c074.63013","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":140,"wires":[]},{"id":"5576869e.1fe238","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":300,"wires":[["7fe0ffce.a1a76"]]},{"id":"f3063b.e3a8f9c8","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.Valid = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":420,"wires":[["441f1348.b5bedc"]]},{"id":"9803719b.75b48","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":670,"y":80,"wires":[]},{"id":"7fe0ffce.a1a76","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":770,"y":220,"wires":[]},{"id":"441f1348.b5bedc","type":"switch","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":730,"y":440,"wires":[["3e74e00b.d7adf","65c46949.216c28"]]},{"id":"3e74e00b.d7adf","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":740,"y":340,"wires":[]},{"id":"ff666134.99219","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","func":"msg.payload = flow.get(\"cekkosong\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":480,"wires":[["8350e85c.2722b8"]]},{"id":"51e3e7ec.646588","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":520,"wires":[[]]},{"id":"8350e85c.2722b8","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":480,"wires":[]},{"id":"aaacd4f0.94b798","type":"inject","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":540,"wires":[["51e3e7ec.646588"]]},{"id":"498126c1.b09c48","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","func":"msg.query = \"select * from MBP3206 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672502399000 limit 10;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":200,"wires":[["533be77c.bdf1f8"]]},{"id":"9ac736f4.3aa348","type":"inject","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" resetflow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":940,"y":440,"wires":[["4f56c938.d20a48"]]},{"id":"4f56c938.d20a48","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":440,"wires":[[]]},{"id":"37994dc4.da1852","type":"inject","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":360,"wires":[["3ee1cf7.3f5aa3"]]},{"id":"3ee1cf7.3f5aa3","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":360,"wires":[["453f661.4526d98","7c871cf6.f96454","e6f3174e.3af208"]]},{"id":"453f661.4526d98","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":360,"wires":[["c3a14577.2785d8"]]},{"id":"7c871cf6.f96454","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[1]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":360,"wires":[[]]},{"id":"c3a14577.2785d8","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1390,"y":360,"wires":[]},{"id":"8242807b.46ca3","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1400,"y":420,"wires":[]},{"id":"e6f3174e.3af208","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":420,"wires":[["8242807b.46ca3"]]},{"id":"6f2ea617.ced7d8","type":"subflow:e9b71a55.b25c68","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","x":450,"y":340,"wires":[["5576869e.1fe238","f3063b.e3a8f9c8","9803719b.75b48"],[]]},{"id":"53867bb5.6395b4","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    json[da[21]] = d[i][21];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":340,"wires":[["48f7c074.63013","76e37580.524d0c"]]},{"id":"65c46949.216c28","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" Take GeoFence","func":"// msg.Valid = msg.payload;\n// msg.Create = {};\n// msg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":280,"wires":[["994fef44.13237"]]},{"id":"994fef44.13237","type":"mysql","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","mydb":"be353e7e.73b9d","name":"","x":1070,"y":240,"wires":[["d3a5fe5e.88666"]]},{"id":"d3a5fe5e.88666","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"Proses","func":"msg.Create = {};\nmsg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    msg.Valid['lat'] = prev.lat;\n    msg.Valid['lon'] = prev.lon;\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0]){ //&& lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            // msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1180,"y":280,"wires":[["964d050b.a95628"]]},{"id":"964d050b.a95628","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1300,"y":200,"wires":[]},{"id":"76e37580.524d0c","type":"mysql","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","mydb":"be353e7e.73b9d","name":"","x":310,"y":380,"wires":[["7a1c1d56.35c654"]]},{"id":"7a1c1d56.35c654","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":420,"wires":[["a279519b.3054d","65a1eee2.29e91","1d2495eb.d5dd4a"]]},{"id":"a279519b.3054d","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":240,"wires":[]},{"id":"e9a70803.ef8ed8","type":"excel","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","file":"/var/www/html/GeoFenceOldTambat.xlsx","x":590,"y":540,"wires":[["e21d3066.e17d4","6537b4f5.2ee04c"]]},{"id":"e21d3066.e17d4","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":560,"wires":[]},{"id":"1a4cac1.5042954","type":"mysql","z":"eb274b9b.a25048","mydb":"be353e7e.73b9d","name":"","x":950,"y":500,"wires":[["1ed97d8b.800052"]]},{"id":"1ed97d8b.800052","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.Create = {};\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.arrr[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.arrr[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.arrr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":540,"wires":[["2bd867a3.545478"]]},{"id":"6537b4f5.2ee04c","type":"function","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":" ","func":"msg.topic = \"SELECT * FROM `GeofenceRev` ORDER BY `lat1` DESC;\";\nmsg.payload= msg.arrr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":480,"wires":[["1a4cac1.5042954"]]},{"id":"2bd867a3.545478","type":"excel","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","file":"/var/www/html/GeoFenceNewTambat.xlsx","x":1130,"y":540,"wires":[["6f1bc7ec.9bfba8"]]},{"id":"6f1bc7ec.9bfba8","type":"debug","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1270,"y":540,"wires":[]},{"id":"a08660a3.d0083","type":"excel","z":"31a1ac1c.c57c44","name":"","file":"/var/www/html/DataKelanis.xlsx","x":1830,"y":1800,"wires":[[]]},{"id":"75a84b43.345d14","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1540,"y":1700,"wires":[["5b3cd71c.c9f008"]]},{"id":"5b3cd71c.c9f008","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.query = \"SELECT * FROM fuelkelanis order by time asc;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1700,"wires":[["d49f4f99.0aa64"]]},{"id":"d49f4f99.0aa64","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1790,"y":1700,"wires":[["16ed97de.0dc798"]]},{"id":"16ed97de.0dc798","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    arr.push(json);\n}\nmsg.data= arr;\nmsg.payload = arr;\nmsg.topic = \"SELECT * FROM `TableTangkiKelanis`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1910,"y":1700,"wires":[["c5d78ed0.e851e","facf3c55.9c228"]]},{"id":"c5d78ed0.e851e","type":"mysql","z":"31a1ac1c.c57c44","mydb":"be353e7e.73b9d","name":"","x":1990,"y":1740,"wires":[["4717bbb3.c48c24"]]},{"id":"4717bbb3.c48c24","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var table = msg.payload;\nvar arr = [];\n\nvar t1 = 1100,t2 = 1100, t3 = 600, t4 = 600;\nvar tk1 = 0,tk2 = 0,tk3 = 0,tk4 = 0;\n\nfor(i=0;i<=msg.data.length-1;i++){\n    // try{\n    var payload = msg.data[i];\n    var cm = [];\n    if(payload.FuelTangki1<400 || String(payload.FuelTangki1)==\"-1\"){\n        cm.push(tk1);\n    }else{\n        tk1 = convertRange(payload.FuelTangki1);\n        cm.push(tk1);\n    }\n    if(payload.FuelTangki2<400 || String(payload.FuelTangki2)==\"-1\"){\n        cm.push(tk2);\n    }else{\n        tk2 = convertRange(payload.FuelTangki2);\n        cm.push(tk2);\n    }\n    if(payload.FuelTangki3<400 || String(payload.FuelTangki3)==\"-1\"){\n        cm.push(tk3);\n    }else{\n        tk3 = convertRange(payload.FuelTangki3);\n        cm.push(tk3);\n    }\n    if(payload.FuelTangki4<400 || String(payload.FuelTangki4)==\"-1\"){\n        cm.push(tk4);\n    }else{\n        tk4 = convertRange(payload.FuelTangki4);\n        cm.push(tk4);\n    }\n    // cm.push(convertRange(payload.FuelTangki1));\n    // cm.push(convertRange(payload.FuelTangki2));\n    // cm.push(convertRange(payload.FuelTangki3)-400);\n    // cm.push(convertRange(payload.FuelTangki4)-400);\n    var json = {};\n    json['time'] = Math.round(payload.time/1000000);\n    if(cm[0]>0){\n        json[\"Tangki\"+String(1)] = table[cm[0]][\"Tangki\"+String(1)];\n    }else{\n        json[\"Tangki\"+String(1)] = table[0][\"Tangki\"+String(1)];\n    }\n    if(cm[1]>0){\n        json[\"Tangki\"+String(2)] = table[cm[1]][\"Tangki\"+String(2)];\n    }else{\n        json[\"Tangki\"+String(2)] = table[0][\"Tangki\"+String(2)];\n    }\n    if(cm[2]>0){\n        json[\"Tangki\"+String(3)] = table[cm[2]][\"Tangki\"+String(3)];\n    }else{\n        json[\"Tangki\"+String(3)] = table[0][\"Tangki\"+String(3)];\n    }\n    if(cm[3]>0){\n        json[\"Tangki\"+String(4)] = table[cm[3]][\"Tangki\"+String(4)];\n    }else{\n        json[\"Tangki\"+String(4)] = table[0][\"Tangki\"+String(4)];\n    }\n    json['Temp1'] = convertRange2(payload.TempTangki1);\n    json['Temp2'] = convertRange2(payload.TempTangki2);\n    json['Temp3'] = convertRange2(payload.TempTangki3);\n    json['Temp4'] = convertRange2(payload.TempTangki4);\n    json['DSG3'] = density(payload.DSG3);\n    json['time'] = Math.round(payload.time/1000000);\n    arr.push(json);\n    // }catch(x){\n    //     msg.payload = [msg.data[i],x,i];\n    //     // continue;\n    //     return msg;\n    // }\n}\nfor(i=0;i<cm.length;i++){\n    cm[i] = cm[i]/100;\n}\n// arr.push(json);\n// arr.push(cm);\nmsg.payload = arr;\nmsg.res = arr;\nreturn msg;\n\nfunction convertRange(value) { \n    if(value>2000){\n        value = 2000;\n    }else if(value<400){\n        value = 400;\n    }\n    var r1 = [400,2000];\n    var r2 = [0,1000];\n    return Math.round(( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]);\n}\nfunction convertRange2(value) { \n    var r1 = [400,2000];\n    var r2 = [0,100];\n    return Math.round(( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]);\n}\n\nfunction density(value) { \n    if(value == null || value < 400){\n        value = 400;\n    }else if(value > 2000){\n        value = 2000;\n    }\n    var r1 = [400,2000];\n    var r2 = [0,2];\n    return parseFloat((( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]).toFixed(3));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2010,"y":1780,"wires":[["94a2996b.3d29d8"]]},{"id":"facf3c55.9c228","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2090,"y":1680,"wires":[]},{"id":"b4a25554.f739e8","type":"range","z":"31a1ac1c.c57c44","minin":"400","maxin":"2000","minout":"0","maxout":"1000","action":"scale","round":false,"property":"payload","name":"","x":1680,"y":1880,"wires":[["8b18bab6.592c58"]]},{"id":"8b18bab6.592c58","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1810,"y":1920,"wires":[]},{"id":"55e7ba47.afa8e4","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1555","payloadType":"num","x":1550,"y":1840,"wires":[["b4a25554.f739e8"]]},{"id":"94a2996b.3d29d8","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var d = msg.payload;\nvar res = [];\nvar timee = \"\";\nvar json = {}\nfor(i=0;i<d.length;i++){\n     timee = String(new Date(d[i].time));\n     json = {\n        \"EPOCH\":d[i].time,\n        \"DEVICEID\":\"Tangki1\",\n        \"DATEE\":timee.split(' ')[2]+\"-\"+gm(timee.split(' ')[1])+\"-\"+timee.split(' ')[3]+\" \"+timee.split(' ')[4],\n        \"OBS\":String(d[i].Tangki1),\n        \"DEG15\":String(0),\n        \"DENSITY\":String(0),\n        \"TEMPERATURE\":String(d[i].Temp1)\n    }\n    res.push(json);\n}\nfor(i=0;i<d.length;i++){\n     timee = String(new Date(d[i].time));\n     json = {\n        \"EPOCH\":d[i].time,\n        \"DEVICEID\":\"Tangki2\",\n        \"DATEE\":timee.split(' ')[2]+\"-\"+gm(timee.split(' ')[1])+\"-\"+timee.split(' ')[3]+\" \"+timee.split(' ')[4],\n        \"OBS\":String(d[i].Tangki2),\n        \"DEG15\":String(0),\n        \"DENSITY\":String(0),\n        \"TEMPERATURE\":String(d[i].Temp2)\n    }\n    res.push(json);\n}\nfor(i=0;i<d.length;i++){\n     timee = String(new Date(d[i].time));\n     json = {\n        \"EPOCH\":d[i].time,\n        \"DEVICEID\":\"Tangki3\",\n        \"DATEE\":timee.split(' ')[2]+\"-\"+gm(timee.split(' ')[1])+\"-\"+timee.split(' ')[3]+\" \"+timee.split(' ')[4],\n        \"OBS\":String(d[i].Tangki3),\n        \"DEG15\":String(0),\n        \"DENSITY\":String(d[i].DSG3),\n        \"TEMPERATURE\":String(d[i].Temp3)\n    }\n    res.push(json);\n}\nfor(i=0;i<d.length;i++){\n     timee = String(new Date(d[i].time));\n     json = {\n        \"EPOCH\":d[i].time,\n        \"DEVICEID\":\"Tangki4\",\n        \"DATEE\":timee.split(' ')[2]+\"-\"+gm(timee.split(' ')[1])+\"-\"+timee.split(' ')[3]+\" \"+timee.split(' ')[4],\n        \"OBS\":String(d[i].Tangki4),\n        \"DEG15\":String(0),\n        \"DENSITY\":String(0),\n        \"TEMPERATURE\":String(d[i].Temp4)\n    }\n    res.push(json);\n}\nmsg.payload = res;\nreturn msg;\n\nfunction gm(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n       var res = \"\";\n       if(String(new Date(d).getMonth() + 1).length<2){\n           res = \"0\" + String(new Date(d).getMonth() + 1);\n       }else{\n           res = String(new Date(d).getMonth() + 1);\n       }\n      return res;\n   }\n   return -1;\n }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1990,"y":1820,"wires":[["fe3138a5.a210c8","d2bb91d0.261bd"]]},{"id":"8863e6f2.76c068","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1670,"y":2000,"wires":[["65d2f270.86fc6c"]]},{"id":"65d2f270.86fc6c","type":"function","z":"31a1ac1c.c57c44","name":"","func":"if(flow.get(\"CekData\")==undefined){\n    flow.set(\"CekData\",[]);\n}else{\n    msg.payload = flow.get(\"CekData\");\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":2000,"wires":[["d01cde7b.8b5b6"]]},{"id":"d01cde7b.8b5b6","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2020,"y":2000,"wires":[]},{"id":"5598711b.8bd48","type":"function","z":"31a1ac1c.c57c44","name":" PopUpp","func":"\nmsg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/FMS_HISTORICALSENSOR\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.valid = msg.payload;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2240,"y":1920,"wires":[["c34aed68.b34a6","d221bc98.72d1b"]]},{"id":"d221bc98.72d1b","type":"http request","z":"31a1ac1c.c57c44","name":"Update","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":2400,"y":1940,"wires":[["39617e26.a2b4b2","c95f7cb8.4f30e"]]},{"id":"39617e26.a2b4b2","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2490,"y":2000,"wires":[]},{"id":"c95f7cb8.4f30e","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"if(msg.payload != \"\"){\n    var data = flow.get(\"CekData\");\n    data.push(msg.valid);\n    flow.set(\"CekData\",data);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2540,"y":1880,"wires":[[]]},{"id":"c34aed68.b34a6","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.DATEE","targetType":"msg","statusVal":"topic","statusType":"auto","x":2330,"y":1780,"wires":[]},{"id":"fe3138a5.a210c8","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.length","targetType":"msg","statusVal":"topic","statusType":"auto","x":2190,"y":1740,"wires":[]},{"id":"d94ba9a0.42fb78","type":"function","z":"31a1ac1c.c57c44","name":"","func":"flow.set(\"CekData\",[]);\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2270,"y":2060,"wires":[[]]},{"id":"c466195a.bf3508","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2100,"y":2060,"wires":[["d94ba9a0.42fb78"]]},{"id":"380a4352.c28e6c","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2230,"y":1980,"wires":[]},{"id":"6f76caf5.a1aaa4","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2260,"y":1840,"wires":[]},{"id":"c0476759.dd29c8","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","name":"","env":[],"x":2070,"y":1860,"wires":[["5598711b.8bd48","380a4352.c28e6c","6f76caf5.a1aaa4"],[]]},{"id":"d2bb91d0.261bd","type":"mqtt out","z":"31a1ac1c.c57c44","name":"","topic":"topckelanis","qos":"","retain":"","broker":"4803b37b.b88cfc","x":2030,"y":1920,"wires":[]},{"id":"45386062.94989","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1870,"y":1860,"wires":[["d2bb91d0.261bd"]]},{"id":"bfd77cd3.4695","type":"inject","z":"eb274b9b.a25048","name":"set","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":680,"wires":[["ab482b00.351678"]]},{"id":"ab482b00.351678","type":"function","z":"eb274b9b.a25048","name":" ","func":"var time  = \"1672502399000 \";\n// var ship = ['Grafana3','GrafanaIBUF','GrafanaTAMBAT','Grafana3206'];\nvar ship = ['fuelLevel4','IBUF2','TAMBAT3','MBP3206'];\nmsg.add = \"LIMIT 2;\";\n// msg.add = \";\";\nmsg.query = \"\";\nfor(i=0;i<ship.length;i++){\n    msg.query += \"SELECT * FROM \"+String(ship[i])+\" where time >= \"+time+msg.add;\n}\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":680,"wires":[["47e5d78f.26cb98","13f50171.a905ff"]]},{"id":"47e5d78f.26cb98","type":"influxdb in","z":"eb274b9b.a25048","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":190,"y":760,"wires":[["82b1c590.a72458","13f50171.a905ff"]]},{"id":"5fa8db21.c48144","type":"function","z":"eb274b9b.a25048","name":" ","func":"var json = {};\nvar d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar mbp3222 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    mbp3222.push(json);\n}\n\nd = msg.payload.results[1].series[0].values;\nda = msg.payload.results[1].series[0].columns;\nvar ibuf = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    ibuf.push(json);\n}\n\nd = msg.payload.results[2].series[0].values;\nda = msg.payload.results[2].series[0].columns;\nvar tambat = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    \n    tambat.push(json);\n}\n\nd = msg.payload.results[3].series[0].values;\nda = msg.payload.results[3].series[0].columns;\nvar mbp3206 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    mbp3206.push(json);\n}\n\nmsg.allship = [mbp3222,ibuf,tambat,mbp3206];\nmsg.payload = msg.allship;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":1160,"wires":[[]]},{"id":"2cd61f77.5370e","type":"function","z":"eb274b9b.a25048","name":"MBP3222","func":"msg.payload = msg.allship[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":680,"wires":[["4f6768b6.98b258","78f2cd92.bc4fe4"]]},{"id":"4f6768b6.98b258","type":"function","z":"eb274b9b.a25048","name":"IBUF","func":"msg.payload = msg.allship[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":740,"wires":[["d7588fc0.5d148","5a29354.22f0acc"]]},{"id":"d7588fc0.5d148","type":"function","z":"eb274b9b.a25048","name":"TAMBAT","func":"msg.payload = msg.allship[2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":800,"wires":[["a9cc5d2a.d9d33","612989b5.5550c8"]]},{"id":"a9cc5d2a.d9d33","type":"function","z":"eb274b9b.a25048","name":"MBP3206","func":"msg.payload = msg.allship[3];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":860,"wires":[["ccac9827.de9f48"]]},{"id":"babff4a9.f43d38","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":680,"wires":[]},{"id":"d44b21b1.02ba8","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":740,"wires":[]},{"id":"802eb9db.2153e8","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":800,"wires":[]},{"id":"87d2677e.0b88d8","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":860,"wires":[]},{"id":"78f2cd92.bc4fe4","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/RawData/RawMBP3222.xlsx","x":850,"y":680,"wires":[["babff4a9.f43d38"]]},{"id":"5a29354.22f0acc","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/RawData/RawIBUF.xlsx","x":850,"y":740,"wires":[["d44b21b1.02ba8"]]},{"id":"612989b5.5550c8","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/RawData/RawTAMBAT.xlsx","x":850,"y":800,"wires":[["802eb9db.2153e8"]]},{"id":"ccac9827.de9f48","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/RawData/RawMBP3206.xlsx","x":850,"y":860,"wires":[["87d2677e.0b88d8"]]},{"id":"19edb2bf.3a08cd","type":"mqtt out","z":"eb274b9b.a25048","name":"","topic":"TarikRaw","qos":"","retain":"","broker":"4803b37b.b88cfc","x":700,"y":1000,"wires":[]},{"id":"13f50171.a905ff","type":"debug","z":"eb274b9b.a25048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":410,"y":740,"wires":[]},{"id":"bea8fc59.0ad61","type":"inject","z":"eb274b9b.a25048","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from `LOOKUPDAILYME2IBUF`;","payload":"","payloadType":"date","x":190,"y":1320,"wires":[["bea70f96.bfd27"]]},{"id":"bea70f96.bfd27","type":"mysql","z":"eb274b9b.a25048","mydb":"be353e7e.73b9d","name":"","x":340,"y":1300,"wires":[["b6f655da.5e56a8"]]},{"id":"5cc06598.65d57c","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":780,"y":1380,"wires":[]},{"id":"b6f655da.5e56a8","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/LOOKUPDAILYME2IBUF.xlsx","x":540,"y":1340,"wires":[["5cc06598.65d57c"]]},{"id":"65a1eee2.29e91","type":"excel","z":"eb274b9b.a25048","d":true,"g":"cf2ae4eb.728d18","name":"","file":"/var/www/html/MBP3206Geo.xlsx","x":570,"y":380,"wires":[["3e74e00b.d7adf"]]},{"id":"82b1c590.a72458","type":"function","z":"eb274b9b.a25048","name":" ","func":"var json = {};\nvar d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar mbp3222 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    mbp3222.push(json);\n}\n\nd = msg.payload.results[1].series[0].values;\nda = msg.payload.results[1].series[0].columns;\nvar ibuf = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    ibuf.push(json);\n}\n\nd = msg.payload.results[2].series[0].values;\nda = msg.payload.results[2].series[0].columns;\nvar tambat = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    tambat.push(json);\n}\n\nd = msg.payload.results[3].series[0].values;\nda = msg.payload.results[3].series[0].columns;\nvar mbp3206 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    mbp3206.push(json);\n}\n\nmsg.allship = [mbp3222,ibuf,tambat,mbp3206];\nmsg.payload = msg.allship;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":800,"wires":[["13f50171.a905ff","fcebfbd6.e4b498"]]},{"id":"fcebfbd6.e4b498","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.ar = msg.payload;\nmsg.payload= msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":860,"wires":[["df0c1036.31245"]]},{"id":"df0c1036.31245","type":"mysql","z":"eb274b9b.a25048","mydb":"be353e7e.73b9d","name":"","x":330,"y":920,"wires":[["f729fa8b.e90518"]]},{"id":"965ef96b.dba798","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.Create = {};\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":920,"wires":[[]]},{"id":"f729fa8b.e90518","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.payload = [msg.ar,msg.payload];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":960,"wires":[["19edb2bf.3a08cd"]]},{"id":"6f7a4909.c76ec8","type":"mqtt in","z":"eb274b9b.a25048","name":"","topic":"BalikinRaw","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":130,"y":1040,"wires":[["ce3d9438.6b92b8"]]},{"id":"d5c9d966.daa048","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":970,"y":1100,"wires":[]},{"id":"ce3d9438.6b92b8","type":"json","z":"eb274b9b.a25048","name":"","property":"payload","action":"","pretty":false,"x":290,"y":1040,"wires":[["c6865179.27e0d","995523d.fef4fe"]]},{"id":"c6865179.27e0d","type":"function","z":"eb274b9b.a25048","name":" ","func":"var res = [];\nvar json = {};\nvar arr = [];\nfor(i=0;i<msg.payload.length;i++){\n    arr = [];\n    for(j=0;j<msg.payload[i].length;j++){\n        json = {};\n        json['No'] = j+1;\n        json['Epoch'] = msg.payload[i][j].time;\n        json['Date'] = String(new Date(msg.payload[i][j].time)).substring(0,24);\n        json['Latitude'] = msg.payload[i][j].lat;\n        json['Longitude'] = msg.payload[i][j].lon;\n        json['Current'] = msg.payload[i][j].Current;\n        arr.push(json);\n    }\n    res.push(arr);\n}\nmsg.json = res;\n\nvar time  = \"1672502399000000000 \";\nvar ship = ['Grafana3','GrafanaIBUF','GrafanaTAMBAT','Grafana3206'];\nmsg.add = \"LIMIT 2;\";\n// msg.add = \";\";\nmsg.query = \"\";\nfor(i=0;i<ship.length;i++){\n    msg.query += \"SELECT * FROM \"+String(ship[i])+\" where time >= \"+time+msg.add;\n}\nmsg.payload = msg.query;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1100,"wires":[["40e07870.e4d6e8"]]},{"id":"40e07870.e4d6e8","type":"influxdb in","z":"eb274b9b.a25048","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":530,"y":1120,"wires":[["5c71fb4a.ece1d4"]]},{"id":"5c71fb4a.ece1d4","type":"function","z":"eb274b9b.a25048","name":" ","func":"var json = {};\nvar d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar mbp3222 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    mbp3222.push(json);\n}\n\nd = msg.payload.results[1].series[0].values;\nda = msg.payload.results[1].series[0].columns;\nvar ibuf = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    ibuf.push(json);\n}\n\nd = msg.payload.results[2].series[0].values;\nda = msg.payload.results[2].series[0].columns;\nvar tambat = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    \n    tambat.push(json);\n}\n\nd = msg.payload.results[3].series[0].values;\nda = msg.payload.results[3].series[0].columns;\nvar mbp3206 = [];\nfor(i=0;i<d.length;i++){\n    json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    mbp3206.push(json);\n}\n\nmsg.allship = [mbp3222,ibuf,tambat,mbp3206];\nmsg.payload = msg.allship;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":1140,"wires":[["f69c64c7.3624e8","b6093d21.618ff"]]},{"id":"f69c64c7.3624e8","type":"function","z":"eb274b9b.a25048","name":" ","func":"\nvar res = msg.json;\n\nfor(j=0;j<msg.payload[0].length;j++){\n    for(i=0;i<res[0].length;i++){\n        if((res[0][i].Epoch) == (msg.payload[0][i].time/1000000)){\n            res[0][i]['ROB'] = msg.payload[0][j].ROB;\n            res[0][i]['Daily Kanan'] = msg.payload[0][j].F5;\n            res[0][i]['Daily Kiri'] = msg.payload[0][j].F4;\n            res[0][i]['Storage Kanan'] = msg.payload[0][j].Kanan;\n            res[0][i]['Storage Kiri'] = msg.payload[0][j].Kiri;\n        }\n    }\n}\nmsg.payload = res;\nreturn msg;\n\n\n// for(j=0;j<msg.payload[i].length;j++){\n//         if((msg.payload[i][j].time/1000000) == (res[i][j].Epoch)){\n//             res[0][i][j]['Epoch'] = msg.payload[i][j].time/1000000;    \n//         }\n//     }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1120,"wires":[["d5c9d966.daa048"]]},{"id":"b6093d21.618ff","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":1180,"wires":[]},{"id":"995523d.fef4fe","type":"trigger","z":"eb274b9b.a25048","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":450,"y":1040,"wires":[[]]},{"id":"1ba2a1f8.6c3cde","type":"inject","z":"eb274b9b.a25048","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":1440,"wires":[["975e24ed.59e3e8"]]},{"id":"975e24ed.59e3e8","type":"function","z":"eb274b9b.a25048","name":"","func":"msg.query = \"select * from Grafana3 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672502399000000000;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":1480,"wires":[["1ec25925.5e7267"]]},{"id":"1ec25925.5e7267","type":"influxdb in","z":"eb274b9b.a25048","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":450,"y":1480,"wires":[["8e08903.f07f77","f8a5f8d8.006ce8"]]},{"id":"8e08903.f07f77","type":"function","z":"eb274b9b.a25048","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    // json[da[15]] = d[i][15];\n    // json[da[16]] = d[i][16];\n    // json[da[17]] = d[i][17];\n    // json[da[18]] = d[i][18];\n    // json[da[19]] = d[i][19];\n    // json[da[20]] = d[i][20];\n    // json[da[21]] = d[i][21];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":1480,"wires":[["e04bc46c.a50778","181f74fb.396eeb"]]},{"id":"181f74fb.396eeb","type":"excel","z":"eb274b9b.a25048","name":"","file":"/var/www/html/FuelMBP3222OK.xlsx","x":750,"y":1480,"wires":[["5cc06598.65d57c"]]},{"id":"6f4511ef.4d335","type":"mqtt out","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","topic":"topclagi","qos":"","retain":"","broker":"4803b37b.b88cfc","x":280,"y":480,"wires":[]},{"id":"1d2495eb.d5dd4a","type":"json","z":"eb274b9b.a25048","g":"cf2ae4eb.728d18","name":"","property":"payload","action":"str","pretty":false,"x":130,"y":480,"wires":[["6f4511ef.4d335"]]},{"id":"e04bc46c.a50778","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":1580,"wires":[]},{"id":"f8a5f8d8.006ce8","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":1380,"wires":[]},{"id":"fa4859d1.ac5d18","type":"debug","z":"b6837abd.323fd8","g":"f1faa51d.03ad28","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":140,"wires":[]},{"id":"5f541aa3.15b774","type":"inject","z":"eb274b9b.a25048","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1650,"y":220,"wires":[["10c71a76.e7a266"]]},{"id":"10c71a76.e7a266","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.query = \"select * from fuelLevel4 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672502399000 order by time desc limit 1;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1770,"y":220,"wires":[["a49033d6.61996"]]},{"id":"a49033d6.61996","type":"influxdb in","z":"eb274b9b.a25048","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1890,"y":220,"wires":[["69d1463a.a445b8"]]},{"id":"69d1463a.a445b8","type":"function","z":"eb274b9b.a25048","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    // json[da[15]] = d[i][15];\n    // json[da[16]] = d[i][16];\n    // json[da[17]] = d[i][17];\n    // json[da[18]] = d[i][18];\n    // json[da[19]] = d[i][19];\n    // json[da[20]] = d[i][20];\n    // json[da[21]] = d[i][21];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2010,"y":220,"wires":[["2fa564d.2e0199c"]]},{"id":"2fa564d.2e0199c","type":"mysql","z":"eb274b9b.a25048","mydb":"be353e7e.73b9d","name":"","x":2130,"y":220,"wires":[["a0612196.f3a7c"]]},{"id":"a0612196.f3a7c","type":"function","z":"eb274b9b.a25048","name":" ","func":"msg.Create = {};\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\n\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n            msg.ar[j]['Current'] = d[i].geofenceName;\n            res.push(d[i].geofenceName);\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\n\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2250,"y":220,"wires":[["9b6ff752.0f82a8"]]},{"id":"9b6ff752.0f82a8","type":"debug","z":"eb274b9b.a25048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2390,"y":220,"wires":[]},{"id":"3633ca3c.903ad6","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":220,"wires":[["210eeef8.9797e2"]]},{"id":"4ccfb100.4afef8","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":220,"wires":[["530db012.c2a2b8"]]},{"id":"210eeef8.9797e2","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from MBP3206 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\n//1\n\n//msg.query += \" time > 1672502399000 and time < 1675083601000\";\n//2\n//msg.query += \" time >= 1675083601000 and time < 1677762001000\";\n//3\n//msg.query += \" time >= 1677762001000 and time < 1680181201000\";\n//4\n//msg.query += \" time > 1680181201000 and time < 1682859601000\";\n//5\n//msg.query += \" time > 1682859601000 and time < 1685451601000\";\n//6\n//msg.query += \" time > 1685451601000 and time < 1688130001000\";\n//7\n//msg.query += \" time > 1688130001000 and time < 1690722001000\";\n//8\n//msg.query += \" time > 1690722001000 and time < 1693400401000\";\n//9\nmsg.query += \"time > 1696114555000\";\n//10\n//msg.query += \" time > 1696078801000 ;\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":220,"wires":[["4ccfb100.4afef8","d3dc9db9.0ae42"]]},{"id":"530db012.c2a2b8","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    json[da[21]] = d[i][21];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":220,"wires":[["aecc72b2.9bc988"]]},{"id":"aecc72b2.9bc988","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":220,"wires":[["54293ec5.a7c598"]]},{"id":"54293ec5.a7c598","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":220,"wires":[["a7c3f97a.733f2","d3dc9db9.0ae42"]]},{"id":"1e7947af.3bb5c","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"mbp3206-report","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1300,"y":220,"wires":[]},{"id":"a7c3f97a.733f2","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":220,"wires":[["1e7947af.3bb5c"]]},{"id":"6341324c.6c2d44","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":280,"wires":[["30fbc211.f9756e"]]},{"id":"c64ad5d6.db31f","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":280,"wires":[["20c97b09.b59f64"]]},{"id":"30fbc211.f9756e","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from fuelLevel4 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672531200000\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":280,"wires":[["c64ad5d6.db31f"]]},{"id":"20c97b09.b59f64","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":280,"wires":[["e8b926e4.36968"]]},{"id":"e8b926e4.36968","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":280,"wires":[["34b1e2ad.aa6086"]]},{"id":"34b1e2ad.aa6086","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":280,"wires":[["fa03aa21.65fdd8"]]},{"id":"79e8fbfd.89fd3c","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"mbp3222-report","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1300,"y":280,"wires":[]},{"id":"fa03aa21.65fdd8","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":280,"wires":[["79e8fbfd.89fd3c","ee6fea8e.2a62e8"]]},{"id":"7aee02c4.e8b3dc","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":340,"wires":[["cfc3b5e4.eeeb08"]]},{"id":"6f83a1bc.37078","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":340,"wires":[["ffda85da.23f11"]]},{"id":"cfc3b5e4.eeeb08","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from TAMBAT3 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1696114555000 and F1 <> 'undefined' \";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":340,"wires":[["6f83a1bc.37078"]]},{"id":"ffda85da.23f11","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":340,"wires":[["3d901df7.204c42"]]},{"id":"3d901df7.204c42","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":340,"wires":[["4b9c8556.024594"]]},{"id":"4b9c8556.024594","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":340,"wires":[["17be941c.cc3dc4"]]},{"id":"b8a3b53.7a184c8","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"tambat-report","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1300,"y":340,"wires":[]},{"id":"17be941c.cc3dc4","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":340,"wires":[["b8a3b53.7a184c8","ee6fea8e.2a62e8"]]},{"id":"3158d1bb.5ea286","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":400,"wires":[["d678356e.fa962"]]},{"id":"2976df2f.2fc4d","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":400,"wires":[["5982cf1.51b633"]]},{"id":"d678356e.fa962","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from IBUF2 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1696114555000 \";\nmsg.payload = msg.query;\nreturn msg; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":400,"wires":[["2976df2f.2fc4d"]]},{"id":"5982cf1.51b633","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":400,"wires":[["84331584.4288a"]]},{"id":"84331584.4288a","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":400,"wires":[["1825161d.b5776a"]]},{"id":"1825161d.b5776a","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":400,"wires":[["ca7bfa14.144af"]]},{"id":"d766168e.068db8","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"ibuf-report","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":1290,"y":400,"wires":[]},{"id":"ca7bfa14.144af","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":400,"wires":[["d766168e.068db8","ee6fea8e.2a62e8"]]},{"id":"852a4e29.4e1be","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1120,"wires":[["a62474e1.5af898"]]},{"id":"bfc86f88.30d69","type":"trigger","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"1 min","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"0","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":490,"y":1180,"wires":[["82c1b8ae.298098","ec14aa41.5c9828","c249d6c7.c5aca8"]]},{"id":"cd34e1ef.e0855","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"set","func":"flow.set(\"ToApex\",true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":940,"wires":[[]]},{"id":"1b9070d3.bdff6f","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Set","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":940,"wires":[["cd34e1ef.e0855"]]},{"id":"a62474e1.5af898","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Check","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\n//SETTING\nvar limit = 50///////////\nvar freq = 2;\nmsg.limitt = Math.round(limit/freq);\nmsg.delay = 100;\n\nreturn msg;\n\nfunction count(){\n    var a = flow.get(\"Count\");\n    a+=1;\n    flow.set(\"Count\",a);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":1120,"wires":[["23b8ed3c.f5b702","19824683.2209f9","49583937.066e68"]]},{"id":"23b8ed3c.f5b702","type":"switch","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":1120,"wires":[["bfc86f88.30d69","361ecdb4.e14ea2"]]},{"id":"12acf92f.4d9767","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":980,"wires":[["93dc6145.fcff5"]]},{"id":"93dc6145.fcff5","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Show","func":"if(flow.get(\"ToApex\")){\n   msg.payload = \"O_O_O_O_O_O_O_O_O\"; \n}else{\n    msg.payload = \"X-X-X-X-X-X-X-X-X\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":980,"wires":[["f5bc26e9.a44008"]]},{"id":"f5bc26e9.a44008","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":980,"wires":[]},{"id":"53aa886c.d80498","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Reset","func":"msg.reset = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":1180,"wires":[["24658ed0.277432"]]},{"id":"106acba8.7668f4","type":"link in","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","links":["24658ed0.277432"],"x":375,"y":1180,"wires":[["bfc86f88.30d69"]]},{"id":"24658ed0.277432","type":"link out","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","links":["106acba8.7668f4"],"x":1055,"y":1180,"wires":[]},{"id":"2773b227.d266ce","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"120","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1400,"wires":[["18218edc.a75871"]]},{"id":"2aed5054.cbed2","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Check Buffer","func":"msg.topic = \"SELECT count(`EPOCH`) as abc FROM `FMS_DASHBOARD` WHERE `STA` = 0;\"\n// msg.topic += \"SELECT count(`time`) FROM `POPUP`;\"\n// msg.topic += \"SELECT count(`EPO`) FROM `FuelData`;\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1400,"wires":[["740162f3.cb0b1c"]]},{"id":"740162f3.cb0b1c","type":"mysql","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","mydb":"b21187dd.19c978","name":"","x":490,"y":1400,"wires":[["516ee81f.b47cb8"]]},{"id":"516ee81f.b47cb8","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","func":"var d = msg.payload;\nmsg.payload = [d[0]['abc']]//,d[1][0]['count(`time`)'],d[2][0]['count(`EPO`)']]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1400,"wires":[["bd7be530.6b7f08"]]},{"id":"bd7be530.6b7f08","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Alldata,Popup,Fuel","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":850,"y":1400,"wires":[]},{"id":"361ecdb4.e14ea2","type":"trigger","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":1120,"wires":[["f665ec0f.f2441"]]},{"id":"f665ec0f.f2441","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":1120,"wires":[["aefa40c9.5eecf","3413a3f2.35681c"]]},{"id":"aefa40c9.5eecf","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":850,"y":1120,"wires":[]},{"id":"19824683.2209f9","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1080,"wires":[["d532dcc4.bfcf8"]]},{"id":"d532dcc4.bfcf8","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":550,"y":1060,"wires":[]},{"id":"ec14aa41.5c9828","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"Triggered\",msg.payload);\nflow.set(\"Count\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1260,"wires":[["99eaa341.ffa83"]]},{"id":"99eaa341.ffa83","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":790,"y":1260,"wires":[]},{"id":"18218edc.a75871","type":"trigger","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":330,"y":1440,"wires":[[]]},{"id":"d486f6aa.c6b0a8","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Run","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1200,"wires":[["a62474e1.5af898"]]},{"id":"3413a3f2.35681c","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Time","func":"msg.payload= 60-((Date.parse(new Date()+(3600*8))-Date.parse(flow.get(\"Triggered\")))/1000);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1120,"wires":[["4851b3fc.d2348c"]]},{"id":"c7c4b04e.db65f","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" Countdown","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":1320,"wires":[]},{"id":"2e21cdbc.bf2de2","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"RESET","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":970,"y":1220,"wires":[["24658ed0.277432"]]},{"id":"7a7a8127.c495d","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"Show Save","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":530,"y":940,"wires":[["14ad3282.d7fb1d"]]},{"id":"14ad3282.d7fb1d","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","func":"msg.payload = flow.get(\"Save\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":940,"wires":[["27314c94.a65f64"]]},{"id":"27314c94.a65f64","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":840,"y":940,"wires":[]},{"id":"916de746.519338","type":"link out","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","links":["61a4cc21.bbfda4","ff81a9f5.623d88"],"x":795,"y":1220,"wires":[]},{"id":"4851b3fc.d2348c","type":"link out","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","links":["9a2e0086.8a436"],"x":1095,"y":1120,"wires":[]},{"id":"9a2e0086.8a436","type":"link in","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","links":["4851b3fc.d2348c"],"x":345,"y":1320,"wires":[["c7c4b04e.db65f"]]},{"id":"49583937.066e68","type":"function","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"count","func":"msg.payload = flow.get(\"Count\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1040,"wires":[["9d4fca9c.d5e538"]]},{"id":"9d4fca9c.d5e538","type":"debug","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":1020,"wires":[]},{"id":"82c1b8ae.298098","type":"delay","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":1220,"wires":[["916de746.519338"]]},{"id":"61a4cc21.bbfda4","type":"link in","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","links":["916de746.519338"],"x":75,"y":1620,"wires":[["e2445ede.10c75"]]},{"id":"e2445ede.10c75","type":"function","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","func":"msg.topic = \"SELECT * FROM `FMS_DASHBOARD` WHERE `STA` = 0 order by `EPOCH` desc limit 200;\";\nmsg.delay = 150;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":1620,"wires":[["16197d11.881323","6fc07de9.769894"]]},{"id":"2460cfe0.80692","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1040,"y":1560,"wires":[]},{"id":"e543ed1e.83322","type":"function","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Dashboard Data","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/FMS_DASHBOARD\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.data = msg.payload\ndelete msg.payload['STA'];\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":1620,"wires":[["665db025.77e5a"]]},{"id":"665db025.77e5a","type":"function","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Check Mode","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1450,"y":1620,"wires":[["29fdb04.00ef75"]]},{"id":"29fdb04.00ef75","type":"switch","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Ok?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1590,"y":1620,"wires":[["bc5e95b1.7d3b48"]]},{"id":"bc5e95b1.7d3b48","type":"http request","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Insert","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1710,"y":1620,"wires":[["615a75ef.5a2b9c","5fb40f18.92729","8237ec92.84c9"]]},{"id":"615a75ef.5a2b9c","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1680,"y":1680,"wires":[]},{"id":"89dc0128.7afc5","type":"link in","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"","links":["a0b2a7dc.bb6378","67330b22.978554"],"x":155,"y":780,"wires":[["f55842c3.7f395","e0ec3016.dec16","f98430c2.0d708"]]},{"id":"35e064ec.f6cc0c","type":"delay","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":670,"y":740,"wires":[["3170c5fd.a70b8a","98d1a77e.5df2a8"]]},{"id":"fafcf88d.8689b8","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Stop Mode","func":"flow.set(\"ToApex\",false);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":740,"wires":[["ae2f5f6.ba16ca"]]},{"id":"3170c5fd.a70b8a","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Start Mode","func":"flow.set(\"ToApex\",true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":740,"wires":[["93d8a5f0.053ef8"]]},{"id":"175a13ba.953bec","type":"inject","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" Reset","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"RESET","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":740,"wires":[["f98430c2.0d708","ae2f5f6.ba16ca","811359a3.95cd68","ec752389.0849b","fa80ef2f.d2c62","a801e39.e13392"]]},{"id":"98d1a77e.5df2a8","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":780,"wires":[["c33e708.63f459"]]},{"id":"c33e708.63f459","type":"debug","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":780,"wires":[]},{"id":"f55842c3.7f395","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"TimeError\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":820,"wires":[["914c5ed0.bdc2d"]]},{"id":"914c5ed0.bdc2d","type":"debug","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":390,"y":820,"wires":[]},{"id":"93d8a5f0.053ef8","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Reset","func":"msg.reset = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":740,"wires":[["786b36f6.872e08"]]},{"id":"786b36f6.872e08","type":"link out","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"","links":["a91c3161.3f5e4"],"x":1035,"y":740,"wires":[]},{"id":"e0ec3016.dec16","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"Save","func":"flow.set(\"Save\",[msg.data,msg.errorr]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":780,"wires":[[]]},{"id":"f98430c2.0d708","type":"trigger","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"2 Min","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"2","extend":true,"overrideDelay":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":270,"y":740,"wires":[["fafcf88d.8689b8","811359a3.95cd68"]]},{"id":"a91c3161.3f5e4","type":"link in","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"","links":["786b36f6.872e08"],"x":155,"y":700,"wires":[["f98430c2.0d708"]]},{"id":"811359a3.95cd68","type":"trigger","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"7.5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":385,"y":700,"wires":[["ec752389.0849b"]]},{"id":"ec752389.0849b","type":"trigger","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"6","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":510,"y":700,"wires":[["fa80ef2f.d2c62"]]},{"id":"fa80ef2f.d2c62","type":"trigger","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"4","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":630,"y":700,"wires":[["a801e39.e13392"]]},{"id":"a801e39.e13392","type":"trigger","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"2","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":700,"wires":[[]]},{"id":"ae2f5f6.ba16ca","type":"delay","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":"2m","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":740,"wires":[["35e064ec.f6cc0c"]]},{"id":"e1c52fc3.6dc34","type":"inject","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":550,"y":820,"wires":[["12ee95f4.7f863a"]]},{"id":"12ee95f4.7f863a","type":"function","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","func":"if(flow.get(\"ToApex\")==false){\n    msg.payload= 120-((Date.parse(new Date()+(3600*8))-Date.parse(flow.get(\"TimeError\")))/1000)-5;\n}else{\n    msg.payload = \"-\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":820,"wires":[["65a9072d.9fe008"]]},{"id":"65a9072d.9fe008","type":"debug","z":"31a1ac1c.c57c44","g":"ca2a1220.a872d","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":810,"y":820,"wires":[]},{"id":"88c20d89.4b4f6","type":"switch","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":180,"y":1540,"wires":[["acbf180c.b7f4c8"]]},{"id":"93ccc5b.609f138","type":"link in","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","links":["5fb40f18.92729"],"x":75,"y":1540,"wires":[["88c20d89.4b4f6","8147d8ab.a37a88"]]},{"id":"5fb40f18.92729","type":"link out","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","links":["93ccc5b.609f138"],"x":1815,"y":1600,"wires":[]},{"id":"8147d8ab.a37a88","type":"switch","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Failed","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":170,"y":1580,"wires":[["a0b2a7dc.bb6378"]]},{"id":"a0b2a7dc.bb6378","type":"link out","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","links":["89dc0128.7afc5"],"x":275,"y":1580,"wires":[]},{"id":"fb07a1fc.166cd","type":"mysql","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","mydb":"b21187dd.19c978","name":"","x":470,"y":1540,"wires":[["ddc44bdc.7cae48"]]},{"id":"acbf180c.b7f4c8","type":"function","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","func":"var d = msg.data;\nmsg.topic = \"UPDATE `FMS_DASHBOARD` SET `STA` = 1 WHERE `EPOCH` = \"+String(d.EPOCH)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":1540,"wires":[["9e520115.c37fc","fb07a1fc.166cd","5febb4b5.106e6c"]]},{"id":"c249d6c7.c5aca8","type":"trigger","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":"1 min","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"60","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":670,"y":1180,"wires":[["53aa886c.d80498"]]},{"id":"9e520115.c37fc","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":1580,"wires":[]},{"id":"07280a60847cad1e","type":"inject","z":"31a1ac1c.c57c44","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2030,"y":80,"wires":[["3d4d57a294b284a0"]]},{"id":"3d4d57a294b284a0","type":"function","z":"31a1ac1c.c57c44","name":"Dashboard","func":"msg.topic= \"\"\nvar epoch = \"\";var datee = \"\";var obs = \"\";var deg = \"\";var den = \"\";var temp = \"\";\nvar totalday = 30;\nmsg.topic = \"\";\nvar epo = 1672502400000;\nvar arr = [];\nmsg.arr = [];\nvar ID = \"tank\"\nfor(i=0;i<12;i++){\n    flow.set(\"set\"+String(i),0);\n    flow.set(\"setd\"+String(i),1);\n    flow.set(\"sett\"+String(i),30);\n}\n\nID = \"tank1\";\nvar num = 1;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+1+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank2\";\nnum = 2;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+2+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank3\";\nnum = 3;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+3+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank4\";\nnum = 4;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+4+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\nmsg.payload = msg.topic;\nreturn msg;\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}\n\nfunction randomp(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    number = Math.abs(number + (Math.round(Math.random()*100)));\n    number = Math.abs(number);\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\nfunction randomm(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    number = Math.abs(number - (Math.round(Math.random()*100)));\n    number = Math.abs(number);\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\nfunction random(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0){\n        number = Math.abs(number - (Math.round(Math.random()*10)));\n        number = Math.abs(number);\n    }else if(plusOrMinus >= 0){\n        number = Math.abs(number + (Math.round(Math.random()*10)));\n    }\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\n\nfunction randomd(x){\n    var number = flow.get(\"setd\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0 || number >= 2){\n        number = Math.abs(number - (Math.random()/100));\n        number = Math.abs(number);\n        if(number < 0){\n            number = 0;\n        }\n    }\n    if(plusOrMinus >= 0 || number <= 0){\n        number = Math.abs(number + (Math.random()/100));\n        if(number > 2){\n            number = 2;\n        }\n    }\n    flow.set(\"setd\"+String(x),number);\n    return String(number);\n}\nfunction randomt(x){\n    var number = flow.get(\"sett\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0 || number >= 43){\n        number = Math.abs(number - (Math.round(Math.random())));\n        number = Math.abs(number);\n    }\n    if(plusOrMinus >= 0|| number <= 25){\n        number = Math.abs(number + (Math.round(Math.random())));\n    }\n    flow.set(\"sett\"+String(x),number);\n    return String(number);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2070,"y":260,"wires":[["75d0fc740a8e7fb9"]]},{"id":"75d0fc740a8e7fb9","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var d = msg.topic;\nmsg.payload = d.split(\";\");\nmsg.delay = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2170,"y":220,"wires":[["eeb66cc64f183e73","23563ca7.acade4"]]},{"id":"eeb66cc64f183e73","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2310,"y":260,"wires":[]},{"id":"5ed8e8a876eae59a","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.payload = msg.payload + \";\";\nmsg.topic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2460,"y":200,"wires":[["88cbe1d6cddc7830"]]},{"id":"984e172e8f581a6e","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2470,"y":260,"wires":[]},{"id":"88cbe1d6cddc7830","type":"mysql","z":"31a1ac1c.c57c44","mydb":"b21187dd.19c978","name":"","x":2590,"y":220,"wires":[["de404eedca4eea24"]]},{"id":"de404eedca4eea24","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":2750,"y":220,"wires":[]},{"id":"23563ca7.acade4","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","name":"","x":2320,"y":200,"wires":[["5ed8e8a876eae59a","984e172e8f581a6e"],[]]},{"id":"3b25be5d.cedc22","type":"inject","z":"31a1ac1c.c57c44","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2310,"y":320,"wires":[["5f576877.bd2518"]]},{"id":"5f576877.bd2518","type":"function","z":"31a1ac1c.c57c44","name":"Dashboard","func":"msg.topic= \"\"\nvar epoch = \"\";var datee = \"\";var obs = \"\";var deg = \"\";var den = \"\";var temp = \"\";\nvar totalday = 30;\nmsg.topic = \"\";\nvar epo = 1672502400000;\nvar arr = [];\nmsg.arr = [];\nvar ID = \"tank\"\nfor(i=0;i<12;i++){\n    flow.set(\"set\"+String(i),0);\n    flow.set(\"setd\"+String(i),1);\n    flow.set(\"sett\"+String(i),30);\n}\n\nID = \"Vessel 1\";\nvar num = 1;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+1+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `VESSEL`, `STARTFUELIN`, `ENDFUELIN`, `FLOWMETER`, `OBS(FM)`, `15DEG(FM)`, `OBS(TANK)`, `15DEG(TANK)`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank2\";\nnum = 2;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+2+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank3\";\nnum = 3;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+3+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\n\nID = \"tank4\";\nnum = 4;\nfor(i=0;i<(30*24)*totalday;i++){ \n// for(i=0;i<2;i++){ \n    epoch = String(epo+4+((3600000*2/60)*i));\n    datee = simpledate(String(new Date(parseFloat(epoch))));\n    obs = \"\";\n    if(parseInt(datee.split(\" \")[1].split(\":\")[0])<8){\n        obs = randomp(num-1)\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=8 && parseInt(datee.split(\" \")[1].split(\":\")[0])<10){\n        obs = random(num-1);\n    }else if(parseInt(datee.split(\" \")[1].split(\":\")[0])>=10 && parseInt(datee.split(\" \")[1].split(\":\")[0])<19){\n        obs = randomm(num-1);\n    }else{\n        obs = random(num-1);\n    }\n    deg = (parseFloat(obs)*0.9522312).toFixed(3);\n    den = parseFloat(randomd(num-1)).toFixed(3);\n    temp = String(randomt(num-1));\n    msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES \";\n    msg.topic += \"(\"+epoch+\",'\"+datee+\"','\"+ID+\"','\"+obs+\"','\"+deg+\"','\"+den+\"','\"+temp+\"',0);\"\n}\nmsg.payload = msg.topic;\nreturn msg;\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}\n\nfunction randomp(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    number = Math.abs(number + (Math.round(Math.random()*100)));\n    number = Math.abs(number);\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\nfunction randomm(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    number = Math.abs(number - (Math.round(Math.random()*100)));\n    number = Math.abs(number);\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\nfunction random(x){\n    var number = flow.get(\"set\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0){\n        number = Math.abs(number - (Math.round(Math.random()*10)));\n        number = Math.abs(number);\n    }else if(plusOrMinus >= 0){\n        number = Math.abs(number + (Math.round(Math.random()*10)));\n    }\n    flow.set(\"set\"+String(x),number);\n    return String(number);\n}\n\nfunction randomd(x){\n    var number = flow.get(\"setd\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0 || number >= 2){\n        number = Math.abs(number - (Math.random()/100));\n        number = Math.abs(number);\n        if(number < 0){\n            number = 0;\n        }\n    }\n    if(plusOrMinus >= 0 || number <= 0){\n        number = Math.abs(number + (Math.random()/100));\n        if(number > 2){\n            number = 2;\n        }\n    }\n    flow.set(\"setd\"+String(x),number);\n    return String(number);\n}\nfunction randomt(x){\n    var number = flow.get(\"sett\"+String(x));\n    var plusOrMinus = Math.random() < 0.5 ? -1 : 1;\n    if(plusOrMinus <0 || number >= 43){\n        number = Math.abs(number - (Math.round(Math.random())));\n        number = Math.abs(number);\n    }\n    if(plusOrMinus >= 0|| number <= 25){\n        number = Math.abs(number + (Math.round(Math.random())));\n    }\n    flow.set(\"sett\"+String(x),number);\n    return String(number);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":300,"wires":[["9a5d03d5.496d5","c9ffd31f.31e21"]]},{"id":"9a5d03d5.496d5","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2890,"y":280,"wires":[]},{"id":"4cab45f3.cea8bc","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.payload = msg.payload + \";\";\nmsg.topic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2180,"y":380,"wires":[["53f04ac0.39b084"]]},{"id":"409dd92d.974ae8","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2190,"y":440,"wires":[]},{"id":"53f04ac0.39b084","type":"mysql","z":"31a1ac1c.c57c44","mydb":"b21187dd.19c978","name":"","x":2310,"y":400,"wires":[["8954bb34.e8ed48"]]},{"id":"8954bb34.e8ed48","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":2470,"y":400,"wires":[]},{"id":"df9ec40a.951318","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","name":"","x":2040,"y":380,"wires":[["4cab45f3.cea8bc","409dd92d.974ae8"],[]]},{"id":"c9ffd31f.31e21","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var spt1 = msg.payload.split(\";\");\nvar spt2 = [];\nfor(i=0;i<spt1.length;i++){\n    spt2.push(spt1[i].split(\"`\"));\n}\nvar res = [];\n// for(i=0;i<spt2.length;i++){\n    // var spt3 = spt2[i][18].split(\",\");\n//     var json = {};\n//     json[spt2[i][3]] = parseInt(spt3[1]);\n//     json[spt2[i][5]] = (spt3[2]);\n//     json[spt2[i][7]] = (spt3[3]);\n//     json[spt2[i][9]] = (spt3[4]);\n//     json[spt2[i][11]] = (spt3[5]);\n//     json[spt2[i][13]] = (spt3[6]);\n//     json[spt2[i][15]] = (spt3[7]);\n//     json[spt2[i][17]] = (spt3[8]);\n//     res.push(json);\n// }\nmsg.payload = spt2[0][18].split(\"(\")[1].split(\",\");\nreturn msg;\n\n// INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (1672502400001,'01/1/2023 00:00','tank1','35','33.328','0.990','31',0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2620,"y":320,"wires":[["fc735af3.edbf58"]]},{"id":"fc735af3.edbf58","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":340,"wires":[]},{"id":"c74b6a22.8c5038","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2320,"y":1060,"wires":[["f66ce163.7c5ce"]]},{"id":"f66ce163.7c5ce","type":"function","z":"31a1ac1c.c57c44","name":"","func":"msg.query = \"SELECT * FROM fuelkelanisliters where time >= 1680282000000000000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2460,"y":1060,"wires":[["b51a8afa.ea95a8"]]},{"id":"b51a8afa.ea95a8","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":2590,"y":1060,"wires":[["8428ade5.81ea4"]]},{"id":"177a7675.cf905a","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2970,"y":1060,"wires":[]},{"id":"157f26f1.8ef9c9","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":860,"wires":[[]]},{"id":"8428ade5.81ea4","type":"function","z":"31a1ac1c.c57c44","name":"","func":"var d = msg.payload;\nfor(i=0;i<d.length;i++){\n    d[i]['time'] = d[i].time*1;\n    d[i]['Date'] = String(new Date(d[i].time)).substring(0,24);\n}\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2720,"y":1040,"wires":[["48587a4e.899634"]]},{"id":"48587a4e.899634","type":"excel","z":"31a1ac1c.c57c44","name":"","file":"/var/www/html/TankKelanis.xlsx","x":2810,"y":1100,"wires":[["177a7675.cf905a"]]},{"id":"bafada45.3619c8","type":"switch","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":1620,"wires":[["fb06a5bb.0a9e28"]]},{"id":"a592759a.d3d038","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","func":"msg.data = msg.payload;\nmsg.topic = \"SELECT * FROM `tabel15deg`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":180,"wires":[["45e7e819.855888"]]},{"id":"45e7e819.855888","type":"mysql","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","mydb":"b21187dd.19c978","name":"Get","x":1210,"y":180,"wires":[["8dd3c5d9.ef8be8"]]},{"id":"8dd3c5d9.ef8be8","type":"function","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" Formula","func":"var tab = msg.payload;\nvar data = msg.datatank;\nvar tank = msg.data;\nvar json = {};\nvar arr = [];\nvar convs = 0.0;\nmsg.topic = \"\";\n////\nvar Den1 = 0.787;\nvar res1 = 0;\nvar den151 = 0;\nvar temp1 = 0;\njson['1Obs'] = tank.Tangki1;\nfor(i=0;i<tab.length;i++){\n    convs = ConvertToTemp(data['TempTangki1']);\n    if(convs===0){\n        convs = 16;\n    }\n    if(convs==tab[i].Temp){\n        res1 = tank15deg(tab[i]['Column_'+String(Den1*1000)],tab[i].Temp);\n        json['1Obs15']=parseFloat((res1*tank.Tangki1).toFixed(2));\n        den151 = tab[i]['Column_'+String(Den1*1000)];\n        temp1 = tab[i].Temp;\n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";        msg.topic += String((data.time/1000000)+1)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank1',\";\n        msg.topic += \"'\"+String(json['1Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['1Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den1)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        break;\n    }\n}\n////\n////\nvar Den2 = 0.787;\nvar res2 = 0;\nvar den152 = 0;\nvar temp2 = 0;\njson['2Obs'] = tank.Tangki2;\nfor(i=0;i<tab.length;i++){\n    convs = ConvertToTemp(data['TempTangki2']);\n    if(convs===0){\n        convs = 16;\n    }\n    if(convs==tab[i].Temp){\n        res2 = tank15deg(tab[i]['Column_'+String(Den2*1000)],tab[i].Temp);\n        json['2Obs15']=parseFloat((res2*tank.Tangki2).toFixed(2));\n        den152 = tab[i]['Column_'+String(Den2*1000)];\n        temp2 = tab[i].Temp;\n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+2)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank2',\";\n        msg.topic += \"'\"+String(json['2Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['2Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den2)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den3 = map_range(data['DSG3'],400,2000,0,2);\nvar res3 = 0;\nvar den153 = 0;\nvar temp3 = 0;\njson['3Obs'] = tank.Tangki3;\nfor(i=0;i<tab.length;i++){\n    convs = ConvertToTemp(data['TempTangki3']);\n    if(convs===0){\n        convs = 16;\n    }\n    if(convs==tab[i].Temp){\n        res3 = tank15deg(tab[i]['Column_'+String(Den3*1000)],tab[i].Temp);\n        json['3Obs15']=parseFloat((res3*tank.Tangki3).toFixed(2));\n        den153 = tab[i]['Column_'+String(Den3*1000)];\n        temp3 = tab[i].Temp;\n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+3)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank3',\";\n        msg.topic += \"'\"+String(json['3Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['3Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den3)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den4 = 0.787;\nvar res4 = 0;\nvar den154 = 0;\nvar temp4 = 0;\njson['4Obs'] = tank.Tangki4;\nfor(i=0;i<tab.length;i++){\n    convs = ConvertToTemp(data['TempTangki4']);\n    if(convs===0){\n        convs = 16;\n    }\n    if(convs==tab[i].Temp){\n        res4 = tank15deg(tab[i]['Column_'+String(Den4*1000)],tab[i].Temp);\n        json['4Obs15']=parseFloat((res4*tank.Tangki4).toFixed(2));\n        den154 = tab[i]['Column_'+String(Den4*1000)];\n        temp4 = tab[i].Temp;\n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+4)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank4',\";\n        msg.topic += \"'\"+String(json['4Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['4Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den4)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        // msg.payload = [res4];\n        // return msg;\n        break;\n    }\n}\n////\nvar resarr = [];\nresarr.push([res1,den151,temp1,json['1Obs'],json['1Obs15']]);\nresarr.push([res2,den152,temp2,json['2Obs'],json['2Obs15']]);\nresarr.push([res3,den153,temp3,json['3Obs'],json['3Obs15']]);\nresarr.push([res4,den154,temp4,json['4Obs'],json['4Obs15']]);\nresarr.push(msg.topic);\nmsg.payload = resarr;\nreturn msg;\n\nfunction ConvertToTemp(value){\n    var r1 = [400,2000];\n    var r2 = [0,100];\n    var res =  parseFloat((( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]).toFixed(0));\n    if(res<=0){\n        res = 0;\n    }else if(res>=100){\n        res = 100;\n    }\n    return res;\n}\n\nfunction tank15deg(x,y){\n    var k0less770 = 346.42278;\n    var k0around778839 = 594.5418;\n    var k0more839 = 186.9696;\n    var k1less770 = 0.43884;\n    var k1around778839 = 0;\n    var k1more839 = 0.48618;\n    var alpha = 0.0;\n    if(x<=770){\n        alpha = createalpha(k0less770,k1less770,x);\n    }else if(x>=778 && x<839){\n        alpha = createalpha(k0around778839,k1around778839,x);\n    }else if(x>=839){\n        alpha = createalpha(k0more839,k1more839,x);\n    }\n    var DegC = y-15;\n    return parseFloat(Math.pow(2.71828,((alpha*-1)*DegC*(1+0.8*alpha*DegC))).toFixed(4));\n}\n\nfunction createalpha(x,y,z){\n    return (x+(y*z))/Math.pow(z,2)\n}\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}\n\nfunction map_range(value, low1, high1, low2, high2) {\n    var res = low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n    if(res<0){\n        return 0;\n    }else{\n        return parseFloat((res).toFixed(3));\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":180,"wires":[["9365861a.8e4398","fb1478c1.97cf68"]]},{"id":"9365861a.8e4398","type":"mysql","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","mydb":"b21187dd.19c978","name":"Update","x":1480,"y":180,"wires":[[]]},{"id":"1e21b54.f70624b","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1960,"y":680,"wires":[["929e408f.c2bad"]]},{"id":"929e408f.c2bad","type":"function","z":"31a1ac1c.c57c44","name":"","func":"msg.query = \"SELECT * FROM fuelkelanis where time < 1669955211002000000 order by time DESC\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":680,"wires":[["e6f94d6b.ca6dd"]]},{"id":"e6f94d6b.ca6dd","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":2230,"y":680,"wires":[["b4b3c635.ef6ec8","8bc70aa0.d3b168"]]},{"id":"30934fe9.99394","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":2500,"y":760,"wires":[]},{"id":"7cbbfc8b.896304","type":"function","z":"31a1ac1c.c57c44","name":"Select Table","func":"msg.datatank = msg.payload;\nmsg.payload['time'] = Date.parse(msg.payload.time)*1000000;\n\nmsg.topic = \"SELECT * FROM `TableTangkiKelanis`;\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":680,"wires":[["23723a69.e67ce6"]]},{"id":"23723a69.e67ce6","type":"mysql","z":"31a1ac1c.c57c44","mydb":"be353e7e.73b9d","name":"","x":2670,"y":660,"wires":[["b01ad5df.f65ec8"]]},{"id":"b01ad5df.f65ec8","type":"function","z":"31a1ac1c.c57c44","name":"Scalling","func":"var payload = msg.datatank;\nvar table = msg.payload;\nvar arr = [];\nvar cm = [];\nvar t1 = 1100,t2 = 1100, t3 = 600, t4 = 600;\ncm.push(convertRange(payload.FuelTangki1));\ncm.push(convertRange(payload.FuelTangki2));\ncm.push(convertRange(payload.FuelTangki3)-400);\ncm.push(convertRange(payload.FuelTangki4)-400);\nvar json = {};\nfor(i=1;i<=4;i++){\n    if(cm[i-1]>0){\n        json[\"Tangki\"+String(i)] = table[cm[i-1]][\"Tangki\"+String(i)];\n    }else{\n        json[\"Tangki\"+String(i)] = table[0][\"Tangki\"+String(i)];\n    }\n}\nfor(i=0;i<cm.length;i++){\n    cm[i] = cm[i]/100;\n}\narr.push(json);\narr.push(cm);\nmsg.payload = arr;\nreturn msg;\n\nfunction convertRange(value) { \n    var r1 = [400,2000];\n    var r2 = [0,1000];\n    return Math.round(( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2660,"y":720,"wires":[["a6893c6c.1cab4"]]},{"id":"a6893c6c.1cab4","type":"function","z":"31a1ac1c.c57c44","name":"Store","func":"msg.payload = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":760,"wires":[["f2548716.c89b08","ec0efdbe.40777"]]},{"id":"f2548716.c89b08","type":"debug","z":"31a1ac1c.c57c44","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2980,"y":720,"wires":[]},{"id":"ec0efdbe.40777","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.data = msg.payload;\nmsg.topic = \"SELECT * FROM `tabel15deg`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2890,"y":820,"wires":[["8fcd594d.61f268"]]},{"id":"8fcd594d.61f268","type":"mysql","z":"31a1ac1c.c57c44","mydb":"b21187dd.19c978","name":"","x":3010,"y":820,"wires":[["1d386efe.dabf21"]]},{"id":"1d386efe.dabf21","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var tab = msg.payload;\nvar data = msg.datatank;\nvar tank = msg.data;\nvar json = {};\nvar arr = [];\nmsg.topic = \"\";\n////\nvar Den1 = 0.787;\nvar res1 = 0;\njson['1Obs'] = tank.Tangki1;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki1'])==tab[i].Temp){\n        res1 = tank15deg(tab[i]['Column_'+String(Den1*1000)],tab[i].Temp);\n        json['1Obs15']=parseFloat((res1*tank.Tangki1).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";        msg.topic += String((data.time/1000000)+1)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank1',\";\n        msg.topic += \"'\"+String(json['1Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['1Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den1)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den2 = 0.787;\nvar res2 = 0;\njson['2Obs'] = tank.Tangki2;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki2'])==tab[i].Temp){\n        res2 = tank15deg(tab[i]['Column_'+String(Den2*1000)],tab[i].Temp);\n        json['2Obs15']=parseFloat((res2*tank.Tangki2).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+2)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank2',\";\n        msg.topic += \"'\"+String(json['2Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['2Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den2)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den3 = 0.787;\nvar res3 = 0;\njson['3Obs'] = tank.Tangki3;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki3'])==tab[i].Temp){\n        res3 = tank15deg(tab[i]['Column_'+String(Den3*1000)],tab[i].Temp);\n        json['3Obs15']=parseFloat((res3*tank.Tangki3).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+3)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank3',\";\n        msg.topic += \"'\"+String(json['3Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['3Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den3)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den4 = 0.787;\nvar res4 = 0;\njson['4Obs'] = tank.Tangki4;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki4'])==tab[i].Temp){\n        res4 = tank15deg(tab[i]['Column_'+String(Den4*1000)],tab[i].Temp);\n        json['4Obs15']=parseFloat((res4*tank.Tangki4).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+4)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank4',\";\n        msg.topic += \"'\"+String(json['4Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['4Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den4)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\nmsg.payload = msg.topic;\n\n\nreturn msg;\n\nfunction ConvertToTemp(value){\n    var r1 = [400,2000];\n    var r2 = [0,100];\n    var res =  parseFloat((( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]).toFixed(0));\n    if(res<=0){\n        res = 0;\n    }else if(res>=100){\n        res = 100;\n    }\n    return res;\n}\n\nfunction tank15deg(x,y){\n    var k0less770 = 346.42278;\n    var k0around778839 = 594.5418;\n    var k0more839 = 186.9696;\n    var k1less770 = 0.43884;\n    var k1around778839 = 0;\n    var k1more839 = 0.48618;\n    var alpha = 0.0;\n    if(x<=770){\n        alpha = createalpha(k0less770,k1less770,x);\n    }else if(x>=778 && x<839){\n        alpha = createalpha(k0around778839,k1around778839,x);\n    }else if(x>=839){\n        alpha = createalpha(k0more839,k1more839,x);\n    }\n    var DegC = y-15;\n    return Math.pow(2.71828,((alpha*-1)*DegC*(1+0.8*alpha*DegC)));\n}\n\nfunction createalpha(x,y,z){\n    return (x+(y*z))/Math.pow(z,2)\n}\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3010,"y":880,"wires":[["934f2403.e16668"]]},{"id":"934f2403.e16668","type":"mysql","z":"31a1ac1c.c57c44","mydb":"b21187dd.19c978","name":"","x":3150,"y":880,"wires":[[]]},{"id":"f3c623af.2e097","type":"inject","z":"31a1ac1c.c57c44","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2380,"y":500,"wires":[["a572780.8c25988"]]},{"id":"a572780.8c25988","type":"function","z":"31a1ac1c.c57c44","name":"","func":"msg.payload = \"1639178434736652432\".length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2540,"y":500,"wires":[["a5df6353.d4246"]]},{"id":"a5df6353.d4246","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2690,"y":500,"wires":[]},{"id":"b4b3c635.ef6ec8","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2320,"y":580,"wires":[]},{"id":"2489e574.fc77fa","type":"comment","z":"31a1ac1c.c57c44","name":"262579","info":"","x":2290,"y":640,"wires":[]},{"id":"3f356622.a445da","type":"function","z":"ce7006a0.688478","name":" ","func":"msg.payload['PropKanan'] = parseInt(msg.payload.PropKanan)\nmsg.payload['PropKiri'] = parseInt(msg.payload.PropKiri)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1870,"y":860,"wires":[["7c1f4b8b.16dbf4","fa1c46b8.2b15e8"]]},{"id":"c89db517.60d7f8","type":"function","z":"ce7006a0.688478","g":"840bdfee.a61db","name":" ","func":"msg.payload['PropKanan'] = parseInt(msg.payload.PropKanan)\nmsg.payload['PropKiri'] = parseInt(msg.payload.PropKiri)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":760,"wires":[["ed0d3a73.051578"]]},{"id":"ed0d3a73.051578","type":"influxdb out","z":"ce7006a0.688478","g":"840bdfee.a61db","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"Grafana3206Prop","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1020,"y":760,"wires":[]},{"id":"fa1c46b8.2b15e8","type":"influxdb out","z":"ce7006a0.688478","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"Grafana3206Prop","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":2020,"y":840,"wires":[]},{"id":"25cfda7a.5e9386","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":1750,"y":760,"wires":[]},{"id":"4af6db83.e8b864","type":"debug","z":"ce7006a0.688478","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.length","targetType":"msg","statusVal":"payload.length","statusType":"auto","x":1710,"y":960,"wires":[]},{"id":"a5e2164c.b5d2b8","type":"subflow:e9b71a55.b25c68","z":"ce7006a0.688478","name":"","x":1750,"y":900,"wires":[["3f356622.a445da","25cfda7a.5e9386"],[]]},{"id":"e7875863.4c1d78","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var tab = msg.payload;\nvar data = msg.datatank;\nvar tank = msg.data;\nvar json = {};\nvar arr = [];\nmsg.topic = \"\";\n////\nvar Den1 = 0.787;\nvar res1 = 0;\njson['1Obs'] = tank.Tangki1;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki1'])==tab[i].Temp){\n        res1 = tank15deg(tab[i]['Column_'+String(Den1*1000)],tab[i].Temp);\n        msg.payload = res1;\n        json['1Obs15']=parseFloat((res1*tank.Tangki1).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";        msg.topic += String((data.time/1000000)+1)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank1',\";\n        msg.topic += \"'\"+String(json['1Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['1Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den1)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        break;\n    }\n}\n////\n////\nvar Den2 = 0.787;\nvar res2 = 0;\njson['2Obs'] = tank.Tangki2;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki2'])==tab[i].Temp){\n        res2 = tank15deg(tab[i]['Column_'+String(Den2*1000)],tab[i].Temp);\n        json['2Obs15']=parseFloat((res2*tank.Tangki2).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+2)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank2',\";\n        msg.topic += \"'\"+String(json['2Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['2Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den2)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den3 = 0.787;\nvar res3 = 0;\njson['3Obs'] = tank.Tangki3;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki3'])==tab[i].Temp){\n        res3 = tank15deg(tab[i]['Column_'+String(Den3*1000)],tab[i].Temp);\n        json['3Obs15']=parseFloat((res3*tank.Tangki3).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+3)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank3',\";\n        msg.topic += \"'\"+String(json['3Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['3Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den3)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n////\nvar Den4 = 0.787;\nvar res4 = 0;\njson['4Obs'] = tank.Tangki4;\nfor(i=0;i<tab.length;i++){\n    if(ConvertToTemp(data['TempTangki4'])==tab[i].Temp){\n        res4 = tank15deg(tab[i]['Column_'+String(Den4*1000)],tab[i].Temp);\n        json['4Obs15']=parseFloat((res4*tank.Tangki4).toFixed(2));\n        \n        msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        msg.topic += String((data.time/1000000)+4)+\",\";\n        msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        msg.topic += \"'tank4',\";\n        msg.topic += \"'\"+String(json['4Obs'])+\"',\";\n        msg.topic += \"'\"+String(json['4Obs15'])+\"',\";\n        msg.topic += \"'\"+String(Den4)+\"',\";\n        msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n\n\nreturn msg;\n\nfunction ConvertToTemp(value){\n    var r1 = [400,2000];\n    var r2 = [0,100];\n    var res =  parseFloat((( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]).toFixed(0));\n    if(res<=0){\n        res = 0;\n    }else if(res>=100){\n        res = 100;\n    }\n    return res;\n}\n\nfunction tank15deg(x,y){\n    var k0less770 = 346.42278;\n    var k0around778839 = 594.5418;\n    var k0more839 = 186.9696;\n    var k1less770 = 0.43884;\n    var k1around778839 = 0;\n    var k1more839 = 0.48618;\n    var alpha = 0.0;\n    if(x<=770){\n        alpha = createalpha(k0less770,k1less770,x);\n    }else if(x>=778 && x<839){\n        alpha = createalpha(k0around778839,k1around778839,x);\n    }else if(x>=839){\n        alpha = createalpha(k0more839,k1more839,x);\n    }\n    var DegC = y-15;\n    return Math.pow(2.71828,((alpha*-1)*DegC*(1+0.8*alpha*DegC)));\n}\n\nfunction createalpha(x,y,z){\n    return (x+(y*z))/Math.pow(z,2)\n}\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":800,"wires":[[]]},{"id":"8bc70aa0.d3b168","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","name":"","x":2320,"y":720,"wires":[["7cbbfc8b.896304","30934fe9.99394"],[]]},{"id":"81387134.05549","type":"inject","z":"fd486f91.7596e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3040,"y":2020,"wires":[["9b4f9f5b.2646a"]]},{"id":"9b4f9f5b.2646a","type":"function","z":"fd486f91.7596e","name":"","func":"var day = \"\";\nswitch (new Date().getDay()) {\n  case 0:\n    day = \"Sunday\";\n    \n  case 1:\n    day = \"Monday\";\n    \n  case 2:\n     day = \"Tuesday\";\n    \n  case 3:\n    day = \"Wednesday\";\n    \n  case 4:\n    day = \"Thursday\";\n    \n  case 5:\n    day = \"Friday\";\n    \n  case 6:\n    day = \"Saturday\";\n    \n}\nmsg.payload = day;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3190,"y":2020,"wires":[["dafbb3ed.6b0de"]]},{"id":"dafbb3ed.6b0de","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3350,"y":2020,"wires":[]},{"id":"9957927.cc7257","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":700,"wires":[["32a1e188.5640e6"]]},{"id":"32a1e188.5640e6","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from Grafana3206 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\n\nmsg.query += \" time > 1680181201000000000\";\n//2\n//msg.query += \" time >= 1675083601000 and time < 1677762001000\";\n//3\n//msg.query += \" time >= 1677762001000 and time < 1680181201000\";\n//4\n//msg.query += \" time > 1680181201000 and time < 1682859601000\";\n//5\n//msg.query += \" time > 1682859601000 and time < 1685451601000\";\n//6\n//msg.query += \" time > 1685451601000 and time < 1688130001000\";\n//7\n//msg.query += \" time > 1688130001000 and time < 1690722001000\";\n//8\n//msg.query += \" time > 1690722001000 and time < 1693400401000\";\n//9\n//msg.query += \" time > 1693400401000 \";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":700,"wires":[["c6bc1ccb.7d33c8"]]},{"id":"c6bc1ccb.7d33c8","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":550,"y":700,"wires":[["60f27f14.e5f0e8"]]},{"id":"60f27f14.e5f0e8","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14]\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":700,"wires":[["83070d22.ad8238"]]},{"id":"83070d22.ad8238","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":895,"y":700,"wires":[["2a51e163.e62b7e","798a01fe.d93a98"]]},{"id":"798a01fe.d93a98","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"mbp3206-avgreport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1105,"y":700,"wires":[]},{"id":"8c40c28c.5994b","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":235,"y":800,"wires":[["74ff23d7.5b0664"]]},{"id":"74ff23d7.5b0664","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from Grafana3 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672531200000\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":385,"y":800,"wires":[["22d6e655.d06cc2"]]},{"id":"22d6e655.d06cc2","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":535,"y":800,"wires":[["bfef571e.7c9f08"]]},{"id":"bfef571e.7c9f08","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":715,"y":800,"wires":[["f8073264.819718"]]},{"id":"f8073264.819718","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":880,"y":800,"wires":[["beea5af3.e70c58","2a51e163.e62b7e"]]},{"id":"beea5af3.e70c58","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"mbp3222-avgreport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1090,"y":800,"wires":[]},{"id":"83a06ab6.8aa1b","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":235,"y":900,"wires":[["51027937.6a2c2"]]},{"id":"51027937.6a2c2","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from GrafanaTAMBAT where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1696114555000000000\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":385,"y":900,"wires":[["b1325975.d6bb1"]]},{"id":"b1325975.d6bb1","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":535,"y":900,"wires":[["c46b67d8.1aee5"]]},{"id":"c46b67d8.1aee5","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":900,"wires":[["d06f099c.8b275"]]},{"id":"d06f099c.8b275","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":880,"y":900,"wires":[["ff614597.ba18","2a51e163.e62b7e"]]},{"id":"ff614597.ba18","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"tambat-avgreport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1080,"y":900,"wires":[]},{"id":"2a51e163.e62b7e","type":"debug","z":"ea265a0.2300aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1015,"y":980,"wires":[]},{"id":"b0c95826.2a62d8","type":"mqtt in","z":"720653e6.744a9c","name":"","topic":"SWMDATA","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":80,"y":40,"wires":[["60ff0474.2def7c"]]},{"id":"60ff0474.2def7c","type":"json","z":"720653e6.744a9c","name":"","property":"payload","action":"obj","pretty":false,"x":220,"y":40,"wires":[["57e58e67.e5091","280d0c77.430844","55b224e.7eee3dc"]]},{"id":"b3c0274b.2f4848","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"SWMDATA","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":550,"y":40,"wires":[]},{"id":"57e58e67.e5091","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":410,"y":80,"wires":[]},{"id":"280d0c77.430844","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload['sta'] = '0';\n\nmsg.payload['DevID'] = msg.payload.DevID.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":40,"wires":[["b3c0274b.2f4848"]]},{"id":"997c1a93.bd8318","type":"inject","z":"720653e6.744a9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from SWMDATA limit 10;","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":920,"y":1020,"wires":[["87533e92.2f1ea"]]},{"id":"87533e92.2f1ea","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":1120,"y":1020,"wires":[["c4b76c31.291c"]]},{"id":"c4b76c31.291c","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1280,"y":1040,"wires":[]},{"id":"4a360149.0dc9f","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":380,"wires":[["2c4b727.7f9488e"]]},{"id":"9819f259.d0b39","type":"trigger","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"1 min","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"70","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":490,"y":440,"wires":[["3fe7b779.4825d8","a345480f.bfedf8","2407daf8.e5af06"]]},{"id":"66c0356a.789e5c","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"set","func":"flow.set(\"ToApex\",true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":200,"wires":[[]]},{"id":"f745e613.4176b8","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Set","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":200,"wires":[["66c0356a.789e5c"]]},{"id":"2c4b727.7f9488e","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Check","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\n//SETTING\nvar limit = 50///////////\nvar freq = 2;\nmsg.limitt = Math.round(limit/freq);\nmsg.delay = 100;\n\nreturn msg;\n\nfunction count(){\n    var a = flow.get(\"Count\");\n    a+=1;\n    flow.set(\"Count\",a);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":380,"wires":[["b42d7283.a4857","1d74c785.50fff8","a6ee8767.871bd8"]]},{"id":"b42d7283.a4857","type":"switch","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":380,"wires":[["9819f259.d0b39","eb2df056.e42a5"]]},{"id":"89d5ba7e.ee7348","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":240,"wires":[["16009458.da844c"]]},{"id":"16009458.da844c","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Show","func":"if(flow.get(\"ToApex\")){\n   msg.payload = \"O_O_O_O_O_O_O_O_O\"; \n}else{\n    msg.payload = \"X-X-X-X-X-X-X-X-X\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":240,"wires":[["95a36415.566838"]]},{"id":"95a36415.566838","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":240,"wires":[]},{"id":"3fe7b779.4825d8","type":"delay","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"1 min","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":670,"y":440,"wires":[["484263c4.c5889c"]]},{"id":"484263c4.c5889c","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Reset","func":"msg.reset = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":440,"wires":[["6020efe9.c2913"]]},{"id":"dcf39f56.cfecb","type":"link in","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","links":["6020efe9.c2913"],"x":375,"y":440,"wires":[["9819f259.d0b39"]]},{"id":"6020efe9.c2913","type":"link out","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","links":["dcf39f56.cfecb"],"x":1055,"y":440,"wires":[]},{"id":"783d698a.645118","type":"inject","z":"720653e6.744a9c","d":true,"g":"fe9bcf91.65e0c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":190,"y":660,"wires":[["97c56520.1a1968","79cc4206.6a43fc"]]},{"id":"97c56520.1a1968","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Check Buffer","func":"// msg.topic = \"SELECT count(`EPO`) FROM `VMSDATA`;\"\n// msg.topic += \"SELECT count(`time`) FROM `POPUP`;\"\n// msg.topic += \"SELECT count(`EPO`) FROM `FuelData`;\"\nmsg.query = \"SELECT count(sta) FROM SWMDATA2 WHERE sta = '0';\";\nmsg.query += \"SELECT count(sta) FROM SWMDATA_RECORD WHERE sta = '0';\";\nmsg.query += \"SELECT count(sta) FROM SWMDATAOK WHERE sta = '0';\";\nmsg.query += \"SELECT count(sta) FROM SWMDATAOK WHERE sta = '1';\";\nmsg.query += \"SELECT count(sta) FROM SWMDATAOK;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":660,"wires":[["3d732d84.ae4c52"]]},{"id":"68b0c80e.073b38","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","func":"var d = msg.payload;\ntry{\n    msg.payload = [d[0][0]['count'],d[1][0]['count'],d[2][0]['count'],d[3][0]['count'],d[4][0]['count']];    \n}catch(x){\n    msg.payload = [0,d[1][0]['count'],0,d[3][0]['count'],d[4][0]['count']];\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":660,"wires":[["a8faf473.6736e8"]]},{"id":"a8faf473.6736e8","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Stored,Backup,Pending,Sended,Total","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":910,"y":660,"wires":[]},{"id":"eb2df056.e42a5","type":"trigger","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":380,"wires":[["475d9209.ce125c"]]},{"id":"475d9209.ce125c","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":380,"wires":[["981e0069.444a3","5c0e27cd.ab66c8"]]},{"id":"981e0069.444a3","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":850,"y":380,"wires":[]},{"id":"1d74c785.50fff8","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":340,"wires":[["b980447a.1c01f8"]]},{"id":"b980447a.1c01f8","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":550,"y":320,"wires":[]},{"id":"a345480f.bfedf8","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"Triggered\",msg.payload);\nflow.set(\"Count\",0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":520,"wires":[["d87b3f85.a4023"]]},{"id":"d87b3f85.a4023","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":790,"y":520,"wires":[]},{"id":"79cc4206.6a43fc","type":"trigger","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":330,"y":700,"wires":[[]]},{"id":"c34182c6.2a1d8","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Run","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":460,"wires":[["2c4b727.7f9488e"]]},{"id":"5c0e27cd.ab66c8","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Time","func":"msg.payload= 60-((Date.parse(new Date()+(3600*8))-Date.parse(flow.get(\"Triggered\")))/1000);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":380,"wires":[["26ba6752.b41d48"]]},{"id":"41ce15bd.c22fec","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" Countdown","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":580,"wires":[]},{"id":"b40a9b53.e14508","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"reset","v":"RESET","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":970,"y":480,"wires":[["6020efe9.c2913"]]},{"id":"6bbf7e7.f74b88","type":"inject","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"Show Save","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":530,"y":200,"wires":[["bb6f1414.00d4d8"]]},{"id":"bb6f1414.00d4d8","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","func":"msg.payload = flow.get(\"Save\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":200,"wires":[["409671fb.45032"]]},{"id":"409671fb.45032","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":840,"y":200,"wires":[]},{"id":"cec13a6a.a18398","type":"link out","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","links":["927d6359.76f3d"],"x":795,"y":480,"wires":[]},{"id":"26ba6752.b41d48","type":"link out","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","links":["33c3efb8.3dc98"],"x":1095,"y":380,"wires":[]},{"id":"33c3efb8.3dc98","type":"link in","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","links":["26ba6752.b41d48"],"x":345,"y":580,"wires":[["41ce15bd.c22fec"]]},{"id":"a6ee8767.871bd8","type":"function","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"count","func":"msg.payload = flow.get(\"Count\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":300,"wires":[["feedaad7.8223c8"]]},{"id":"feedaad7.8223c8","type":"debug","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":280,"wires":[]},{"id":"2407daf8.e5af06","type":"delay","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":480,"wires":[["cec13a6a.a18398"]]},{"id":"3d732d84.ae4c52","type":"influxdb in","z":"720653e6.744a9c","g":"fe9bcf91.65e0c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":510,"y":660,"wires":[["68b0c80e.073b38"]]},{"id":"fb739e95.9d1d7","type":"inject","z":"720653e6.744a9c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1210,"y":640,"wires":[["bd190121.7214e"]]},{"id":"bd190121.7214e","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = [flow.get(\"EightHour\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":640,"wires":[["e948295e.5be3b8","625610bc.1a292","a11bc6e5.b34b28"]]},{"id":"e948295e.5be3b8","type":"function","z":"720653e6.744a9c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":640,"wires":[["3ec9ea3e.696ee6"]]},{"id":"625610bc.1a292","type":"function","z":"720653e6.744a9c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[1]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":640,"wires":[[]]},{"id":"3ec9ea3e.696ee6","type":"debug","z":"720653e6.744a9c","name":"8 jam","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1670,"y":640,"wires":[]},{"id":"da1e0635.8330c8","type":"inject","z":"720653e6.744a9c","name":" resetflow","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1220,"y":540,"wires":[["1e375c75.828f24"]]},{"id":"1e375c75.828f24","type":"function","z":"720653e6.744a9c","name":" ","func":"\nfor(i=0;i<=100;i++){\n    flow.set(\"EightHour-M\"+tridigit(i));\n}\nmsg.payload = \"Reseted SWM\";\nreturn msg;\n\nfunction tridigit(x){\n    var str = String(x);\n    while(str.length<3){\n        str = \"0\" + str;\n    }\n    return str;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1370,"y":540,"wires":[["ecbe0838.7f3b28"]]},{"id":"da22e0d3.88b5e","type":"inject","z":"720653e6.744a9c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from SWMDATA2 where time >= 1684560316884 AND sta = '0' order by time asc limit 100;","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":670,"y":40,"wires":[["bdc825c3.70f438"]]},{"id":"bdc825c3.70f438","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":790,"y":40,"wires":[["a14b09b7.cf5f28"]]},{"id":"38b6ef.c3c1a912","type":"debug","z":"720653e6.744a9c","name":" Device","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.DevID","targetType":"msg","statusVal":"payload.DevID","statusType":"auto","x":1550,"y":20,"wires":[]},{"id":"85dbdfc.ac3072","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    arr.push(json);\n}\nmsg.payload= arr;\nmsg.delay = 10;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":40,"wires":[["f4be3c12.9ad02","9a6bced2.1eeab","17a63bb7.e5df44"]]},{"id":"dad7f1e8.28354","type":"function","z":"720653e6.744a9c","name":"SWMDATA","func":"var resmsg = [];\nvar d = msg.payload;\nif(flow.get(\"EightHour-\"+d.DevID)==undefined){\n    InsertData(\"SWMDATAOK\");\n    InsertData(\"SWMDATA_RECORD\");\n    flow.set(\"EightHour-\"+d.DevID,d.time);\n}else{                                          \n    if((d.time-flow.get(\"EightHour-\"+d.DevID))>7200000){//28800 detik(8 jam), 7200 detik(2 jam)\n        InsertData(\"SWMDATAOK\");\n        InsertData(\"SWMDATA_RECORD\");\n        flow.set(\"EightHour-\"+d.DevID,d.time);\n    }else{\n        InsertData(\"SWMDATA_RECORD\");\n    }\n}\nmsg.payload = resmsg;\nmsg.delay = 1;\nreturn msg;\n\nfunction InsertData(table){\n    resmsg.push([d,table]);   \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":80,"wires":[["cfb692c0.85027"]]},{"id":"a11bc6e5.b34b28","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1540,"y":560,"wires":[]},{"id":"ecbe0838.7f3b28","type":"debug","z":"720653e6.744a9c","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1550,"y":480,"wires":[]},{"id":"f097a04d.ca4a","type":"inject","z":"720653e6.744a9c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1210,"y":420,"wires":[["718244ad.36732c"]]},{"id":"718244ad.36732c","type":"function","z":"720653e6.744a9c","name":" ","func":"var arr = [];\nfor(i=0;i<=100;i++){\n    if(flow.get(\"EightHour-M\"+tridigit(i)) == undefined){\n        continue;\n    }else{\n        arr.push([\"EightHour-M\"+tridigit(i),Math.round(flow.get(\"EightHour-M\"+tridigit(i)))])\n    }\n}\nmsg.payload = arr;\nreturn msg;\n\nfunction tridigit(x){\n    var str = String(x);\n    while(str.length<3){\n        str = \"0\" + str;\n    }\n    return str;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":420,"wires":[["ecbe0838.7f3b28"]]},{"id":"cfb692c0.85027","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","name":"","x":1830,"y":80,"wires":[["1cd7007a.b44d9","aad2bece.25067"],[]]},{"id":"de6caf60.558f2","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":1410,"y":40,"wires":[]},{"id":"47a0455a.d9ea0c","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload;\nflow.set(\"Count\",msg.topic);\nd['DevID'] = d.DevID.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\nif(d.DevID[0]!=\"M\"){\n    msg.payload = null;\n}\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1410,"y":40,"wires":[["38b6ef.c3c1a912","2c185f2d.68afb","f3385bb4.10c868","5b99ac4.03be254"]]},{"id":"1cd7007a.b44d9","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":1970,"y":80,"wires":[]},{"id":"f3385bb4.10c868","type":"function","z":"720653e6.744a9c","name":"Time","func":"msg.payload= new Date(Math.round(msg.payload.time))+(3600*8);\nflow.set(\"LastOnline\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":160,"wires":[["34337a3b.521f06"]]},{"id":"34337a3b.521f06","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1690,"y":160,"wires":[]},{"id":"2c185f2d.68afb","type":"switch","z":"720653e6.744a9c","name":"FM","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1550,"y":80,"wires":[["dad7f1e8.28354"]]},{"id":"9f105405.0e6608","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.measurement = msg.payload[1];\nmsg.payload = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2110,"y":60,"wires":[["d2c3f081.bfc6f"]]},{"id":"aad2bece.25067","type":"switch","z":"720653e6.744a9c","name":" ","property":"payload[1]","propertyType":"msg","rules":[{"t":"eq","v":"SWMDATAOK","vt":"str"},{"t":"eq","v":"SWMDATA_RECORD","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1970,"y":80,"wires":[["9f105405.0e6608"],["9f105405.0e6608","61796a6a.c13114"]]},{"id":"61796a6a.c13114","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = msg.payload[0];\nmsg.payload['sta'] = \"1\";\nmsg.measurement = \"SWMDATA2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2110,"y":100,"wires":[["d2c3f081.bfc6f","a61a12fb.af934"]]},{"id":"17a63bb7.e5df44","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","name":"","env":[],"x":1290,"y":40,"wires":[["47a0455a.d9ea0c","de6caf60.558f2"],[]]},{"id":"d2c3f081.bfc6f","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":2430,"y":60,"wires":[]},{"id":"f4be3c12.9ad02","type":"trigger","z":"720653e6.744a9c","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"55","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1290,"y":80,"wires":[[]]},{"id":"4927e06b8b0d7590","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = \"SELECT * FROM SWMDATAOK where sta = '0' ORDER BY time ASC LIMIT 100;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":70,"y":820,"wires":[["b6dd94b7.c0e218"]]},{"id":"55d902cf56285100","type":"function","z":"720653e6.744a9c","name":" ","func":"if(msg.payload.length<1){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":820,"wires":[["dc22660ac6553a73"]]},{"id":"dc22660ac6553a73","type":"switch","z":"720653e6.744a9c","name":"Empty?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":870,"y":820,"wires":[["4c832322.884ffc"]]},{"id":"0ec28ada9000f2e7","type":"function","z":"720653e6.744a9c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.IDD)));\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":760,"wires":[["a4635f8b5ce41826"]]},{"id":"1f465190bf7f6127","type":"function","z":"720653e6.744a9c","name":"PostToApex","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/swm_sensor\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nvar d = msg.payload;\nmsg.data = d;\nmsg.topic = String(parseInt(String(msg.topic))+1);\nmsg.payload = {\n    \"IDD\":Math.round(msg.payload.time),\n    \"DEVICEID\":String(d.DevID),\n    \"VALUEE\":String(d.val)\n}\n// delete msg.payload['sta'];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":820,"wires":[["1bf590283bb7a322","8169a3c8dc63d2bd","0ec28ada9000f2e7"]]},{"id":"a4635f8b5ce41826","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1490,"y":760,"wires":[]},{"id":"7ebddcc46bd79b43","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1150,"y":760,"wires":[]},{"id":"1bf590283bb7a322","type":"function","z":"720653e6.744a9c","name":"Check","func":"if(flow.get(\"ToApex\")!=true){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":820,"wires":[["e9dc59ae86f9db3a"]]},{"id":"8169a3c8dc63d2bd","type":"debug","z":"720653e6.744a9c","name":"debug 32","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1360,"y":880,"wires":[]},{"id":"e9dc59ae86f9db3a","type":"switch","z":"720653e6.744a9c","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1470,"y":820,"wires":[["69c19302.d3321c","6c8c6b94eae2852d"]]},{"id":"6c8c6b94eae2852d","type":"http request","z":"720653e6.744a9c","name":"Request","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1600,"y":820,"wires":[["86cc41c5e47902c1","93c31ec3985a8492"]]},{"id":"86cc41c5e47902c1","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1730,"y":860,"wires":[]},{"id":"93c31ec3985a8492","type":"function","z":"720653e6.744a9c","name":" ","func":"if(msg.payload!=\"\"){\n    msg.errorr = msg.payload;\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":820,"wires":[["19595e096f592c84","7442c8430c234cfc"]]},{"id":"19595e096f592c84","type":"switch","z":"720653e6.744a9c","name":"OK","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1870,"y":820,"wires":[["98c768e2659eb3e1"]]},{"id":"7442c8430c234cfc","type":"switch","z":"720653e6.744a9c","name":"Null","property":"payload","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1870,"y":860,"wires":[["05904a858271f70f"]]},{"id":"98c768e2659eb3e1","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.data;\nd['sta'] = \"1\";\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1990,"y":820,"wires":[["8d7f1bf3.1d05a8","7a9753db65328407","68c1b961.9ad948"]]},{"id":"05904a858271f70f","type":"link out","z":"720653e6.744a9c","name":"","links":[],"x":2015,"y":860,"wires":[]},{"id":"7a9753db65328407","type":"debug","z":"720653e6.744a9c","name":"debug 23","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2260,"y":820,"wires":[]},{"id":"b6dd94b7.c0e218","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":190,"y":820,"wires":[["e580cb8b.bf0b38","e0d08b34.4434e8"]]},{"id":"c0177246.7c344","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    arr.push(json);\n}\nmsg.payload= arr;\nmsg.delay = 10;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":820,"wires":[["55d902cf56285100"]]},{"id":"4c832322.884ffc","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","name":"","x":1010,"y":820,"wires":[["1f465190bf7f6127","7ebddcc46bd79b43"],[]]},{"id":"e580cb8b.bf0b38","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"topic","statusType":"auto","x":310,"y":760,"wires":[]},{"id":"927d6359.76f3d","type":"link in","z":"720653e6.744a9c","name":"","links":["cec13a6a.a18398"],"x":35,"y":780,"wires":[["4927e06b8b0d7590"]]},{"id":"69c19302.d3321c","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":1610,"y":920,"wires":[]},{"id":"8d7f1bf3.1d05a8","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"SWMDATAOK","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":2120,"y":820,"wires":[]},{"id":"68c1b961.9ad948","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2120,"y":780,"wires":[]},{"id":"9a6bced2.1eeab","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1290,"y":120,"wires":[]},{"id":"a14b09b7.cf5f28","type":"function","z":"720653e6.744a9c","name":" ","func":"try{\n    if(msg.payload.results[0].series.length<=0){\n        msg.payload = null;\n    }\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":40,"wires":[["70352e1a.5348"]]},{"id":"70352e1a.5348","type":"switch","z":"720653e6.744a9c","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":40,"wires":[["85dbdfc.ac3072"]]},{"id":"e0d08b34.4434e8","type":"function","z":"720653e6.744a9c","name":" ","func":"try{\n    if(msg.payload.results[0].series.length<=0){\n        msg.payload = null;\n    }\n}catch(x){\n    msg.payload = null;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":820,"wires":[["258edadc.adf216"]]},{"id":"258edadc.adf216","type":"switch","z":"720653e6.744a9c","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":820,"wires":[["c0177246.7c344"]]},{"id":"a61a12fb.af934","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2340,"y":160,"wires":[]},{"id":"55b224e.7eee3dc","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload['sta'] = '0';\nmsg.payload['time'] = Date.now();\nmsg.payload['DevID'] = msg.payload.DevID.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":80,"wires":[["ef5f34b9.fe4808","90f349bb.7960f8"]]},{"id":"ef5f34b9.fe4808","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":80,"wires":[]},{"id":"90f349bb.7960f8","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"SWMDATA2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":630,"y":80,"wires":[]},{"id":"364b2b2a.1d4ea4","type":"inject","z":"720653e6.744a9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from SWMDATA order by time asc","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":100,"wires":[["f1ab51cc.7ef67"]]},{"id":"f1ab51cc.7ef67","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":130,"y":140,"wires":[["209686df.9b344a"]]},{"id":"209686df.9b344a","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    arr.push(json);\n}\n\nmsg.payload= arr;\n\nmsg.delay = 10;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":140,"wires":[["d7429cf2.f80b8","5a14dfe4.a98d2"]]},{"id":"b09593ac.7d038","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":760,"y":120,"wires":[]},{"id":"5a14dfe4.a98d2","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.length","targetType":"msg","statusVal":"payload.length","statusType":"auto","x":290,"y":80,"wires":[]},{"id":"d7429cf2.f80b8","type":"function","z":"720653e6.744a9c","name":" ","func":"var arr = msg.payload;\nfor(i=0;i<arr.length;i++){\n    try{\n        if(String(arr[i].time).length==16){\n            arr[i]['time'] = Math.round(arr[i].time/1000);\n        }else if(String(arr[i].time).length==19){\n            arr[i]['time'] = Math.round(arr[i].time/1000000);\n        }\n    }catch(x){\n        msg.payload = i;\n        return msg;\n    }\n}\nmsg.delay = 100;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":140,"wires":[["bf8a0de8.300eb"]]},{"id":"bf8a0de8.300eb","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","name":"","env":[],"x":540,"y":140,"wires":[["b09593ac.7d038","90f349bb.7960f8","63c8de.15a77724","beb985b0.27fb18"],[]]},{"id":"63c8de.15a77724","type":"function","z":"720653e6.744a9c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":140,"wires":[["a7782147.9646a"]]},{"id":"a7782147.9646a","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1050,"y":80,"wires":[]},{"id":"beb985b0.27fb18","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.sta","targetType":"msg","statusVal":"payload","statusType":"auto","x":1030,"y":140,"wires":[]},{"id":"5a41244d.a7717c","type":"inject","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM SWMDATA2 WHERE time < 1684560316884 AND sta = '0';","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1820,"y":320,"wires":[["7be74a60.f19c24"]]},{"id":"7be74a60.f19c24","type":"influxdb in","z":"720653e6.744a9c","g":"c6c5f291.8b695","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":1890,"y":360,"wires":[["611ebe25.a6781"]]},{"id":"611ebe25.a6781","type":"function","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    arr.push(json);\n}\n\nmsg.payload= arr;\n\nmsg.delay = 50;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2010,"y":360,"wires":[["87f7837f.322e6","33f58d13.a4ecc2"]]},{"id":"3968ac47.e94214","type":"debug","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":2420,"y":320,"wires":[]},{"id":"407de22.c53121c","type":"function","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"","func":"msg.payload['sta'] = '1';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":360,"wires":[["3968ac47.e94214","f1d9f512.719fa8","538ce6d1.08b2e8"]]},{"id":"538ce6d1.08b2e8","type":"influxdb out","z":"720653e6.744a9c","g":"c6c5f291.8b695","influxdb":"76f4cea2.88ada","name":" ","measurement":"SWMDATA2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":2450,"y":420,"wires":[]},{"id":"f1d9f512.719fa8","type":"function","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":280,"wires":[["aeb0c5dd.cb2b58"]]},{"id":"aeb0c5dd.cb2b58","type":"debug","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2610,"y":280,"wires":[]},{"id":"ebd86a79.f8a8d8","type":"debug","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":2300,"y":460,"wires":[]},{"id":"87f7837f.322e6","type":"debug","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.length","targetType":"msg","statusVal":"payload","statusType":"auto","x":2060,"y":280,"wires":[]},{"id":"33f58d13.a4ecc2","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","g":"c6c5f291.8b695","name":"","x":2150,"y":360,"wires":[["407de22.c53121c"],["ebd86a79.f8a8d8"]]},{"id":"5b99ac4.03be254","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1550,"y":120,"wires":[]},{"id":"65c07937.5d306","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":215,"y":1260,"wires":[["6d8d7b73.ad641c"]]},{"id":"6d8d7b73.ad641c","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from GrafanaIBUF where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672502399000 LIMIT 10\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":365,"y":1260,"wires":[["a6192537.746c48"]]},{"id":"a6192537.746c48","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":515,"y":1260,"wires":[["3f3cf464.db9334"]]},{"id":"3f3cf464.db9334","type":"debug","z":"ea265a0.2300aa8","name":"Cek Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":1340,"wires":[]},{"id":"61fc90e1.b5e938","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":215,"y":1060,"wires":[["496ec778.df0508"]]},{"id":"496ec778.df0508","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from Grafana2 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672531200000\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":1060,"wires":[["95f71f29.7ce45"]]},{"id":"95f71f29.7ce45","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":515,"y":1060,"wires":[["875849be.829e68"]]},{"id":"875849be.829e68","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":695,"y":1060,"wires":[["4d00c074.33c028"]]},{"id":"4d00c074.33c028","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":860,"y":1060,"wires":[["2504361d.ece502","2a51e163.e62b7e"]]},{"id":"2504361d.ece502","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"mbp3222-avgreport2","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1070,"y":1060,"wires":[]},{"id":"b07d06ca.b68208","type":"mqtt in","z":"720653e6.744a9c","name":"","topic":"smrthm","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":160,"y":1680,"wires":[["ccfe3857.94b538","ae624560.8dfbf8","f6566606.298b58"]]},{"id":"ccfe3857.94b538","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":370,"y":1680,"wires":[]},{"id":"ae624560.8dfbf8","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = {\n    \"time\":Date.now(),\n    \"payload\":msg.payload\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1760,"wires":[["1eae5d11.893a13","2b6787c4.047878"]]},{"id":"1eae5d11.893a13","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":650,"y":1660,"wires":[]},{"id":"2b6787c4.047878","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"smrthm","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":630,"y":1760,"wires":[]},{"id":"f6566606.298b58","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.payload = {\n    \"time\":Date.now(),\n    \"payload\":msg.payload,\n    \"sta\":'0'\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":1800,"wires":[["a7894b59.f4e7e8"]]},{"id":"a7894b59.f4e7e8","type":"influxdb out","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","measurement":"smrthmflag","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":630,"y":1800,"wires":[]},{"id":"128fc4a9.d10d4b","type":"comment","z":"720653e6.744a9c","name":"1688174196461","info":"","x":540,"y":1600,"wires":[]},{"id":"95a4a600.dd8e08","type":"function","z":"720653e6.744a9c","name":" ","func":"\nif(msg.payload!=\"\"){\n    msg.errorr = msg.payload;\n    msg.payload = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":2000,"wires":[["7a56b0da.6bf87"]]},{"id":"7a56b0da.6bf87","type":"switch","z":"720653e6.744a9c","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":940,"y":2000,"wires":[[]]},{"id":"9660c42c.a1ca58","type":"inject","z":"720653e6.744a9c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from smrthm where time >= 1686498782926","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":2000,"wires":[["6a84a6c.455a058"]]},{"id":"2137af9d.e4a2b","type":"debug","z":"720653e6.744a9c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"payload","statusType":"auto","x":600,"y":2040,"wires":[]},{"id":"6a84a6c.455a058","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":210,"y":2040,"wires":[["85e672db.0fdec"]]},{"id":"85e672db.0fdec","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    arr.push(json);\n}\nmsg.payload= arr;\nvar arr2 = [];\nfor(i=0;i<arr.length;i++){\n    var json2 = {};\n    if(arr[i].payload.split(\",\")[0]==\"GW100\" || arr[i].payload.split(\",\")[0]==\"online\" || arr[i].payload.split(\",\")[1]==\"144\"){\n        continue;\n    }else{\n        json2 = arr[i];\n    }\n    arr2.push(json2);\n}\nmsg.payload = arr2;\n// var res = {};\nvar arr3 = [];\nvar arr4 = [];\nvar arr5 = [];\nvar arr6 = [];\nfor(i=0;i<arr2.length;i++){\n    if(arr2[i].payload.split(\",\")[1]==\"2\" && arr2[i].payload.split(\",\")[0]==\"6\"){\n        arr3.push(parseFloat(arr2[i].payload.split(\",\")[3]));\n        arr6.push(arr2[i]);\n    }else if(arr2[i].payload.split(\",\")[1]==\"4\" && arr2[i].payload.split(\",\")[0]==\"6\"){\n        arr4.push(arr2[i]);\n        arr6.push(arr2[i]);\n    }else{\n        arr5.push(arr2[i]);\n    }\n}\nvar avr = 0.0;\nfor(i=0;i<arr3.length;i++){\n    avr+=arr3[i];\n}\navr = avr / arr3.length;\n\nmsg.payload = [arr2,arr3,arr4,arr5,avr,arr6];\n\nmsg.payload = arr6;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2040,"wires":[["f34e7216.b943c","3a5bc1b4.8bb83e"]]},{"id":"eb5be67d.2c2fa8","type":"inject","z":"720653e6.744a9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":1860,"wires":[["5619243f.61850c"]]},{"id":"5619243f.61850c","type":"function","z":"720653e6.744a9c","name":" ","func":"msg.query = \"SELECT * FROM smrthm where time > 1688317200000 AND time < 1688403600000;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":1860,"wires":[["e1b9a57d.bcabb8"]]},{"id":"e1b9a57d.bcabb8","type":"influxdb in","z":"720653e6.744a9c","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":370,"y":1860,"wires":[["37111b86.99b0e4"]]},{"id":"ac3dbc97.b891c","type":"debug","z":"720653e6.744a9c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":1860,"wires":[]},{"id":"37111b86.99b0e4","type":"function","z":"720653e6.744a9c","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    arr.push(json);\n}\nmsg.payload= arr;\nvar arr2 = [];\nfor(i=0;i<d.length;i++){\n    if(arr[i].payload.split(\",\")[2]==\"14\" && arr[i].payload.split(\",\")[1]==\"2\" && parseFloat(arr[i].payload.split(\",\")[3])>0){\n        // arr2.push(parseFloat(arr[i].payload.split(\",\")[3]));\n        arr2.push(arr[i]);\n    }\n}\n// var res = 0;\n// for(i=0;i<arr2.length;i++){\n//     res+=arr2[i];\n// }\n// res = res/arr2.length;\nmsg.payload = arr2;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1860,"wires":[["ac3dbc97.b891c"]]},{"id":"5645138a.e2c9ac","type":"comment","z":"720653e6.744a9c","name":"From 1686498782926","info":"","x":140,"y":1960,"wires":[]},{"id":"474c1b64.5c19b4","type":"comment","z":"720653e6.744a9c","name":"1 week To 1687021200000","info":"","x":630,"y":1960,"wires":[]},{"id":"8d462dea.d0b66","type":"comment","z":"720653e6.744a9c","name":"1 day To 1686502800000","info":"","x":370,"y":1960,"wires":[]},{"id":"175428c2.f8bd17","type":"debug","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":500,"y":2780,"wires":[]},{"id":"5db66292.f15ebc","type":"mqtt out","z":"720653e6.744a9c","name":"","topic":"kirimsmrthm","qos":"","retain":"","broker":"3df154b8.35094c","x":610,"y":2120,"wires":[]},{"id":"f34e7216.b943c","type":"debug","z":"720653e6.744a9c","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.length","targetType":"msg","statusVal":"payload","statusType":"auto","x":530,"y":2000,"wires":[]},{"id":"3a5bc1b4.8bb83e","type":"subflow:e9b71a55.b25c68","z":"720653e6.744a9c","name":"","x":420,"y":2080,"wires":[["2137af9d.e4a2b","5db66292.f15ebc"],[]]},{"id":"78e79218.170cfc","type":"inject","z":"31a1ac1c.c57c44","g":"efacc863.a3f888","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 07 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":4660,"wires":[["2fd56e81.38a5d2"]]},{"id":"2fd56e81.38a5d2","type":"influxdb in","z":"31a1ac1c.c57c44","g":"efacc863.a3f888","influxdb":"76f4cea2.88ada","name":" ","query":"select * from fuelkelanis order by time desc limit 20","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":330,"y":4660,"wires":[["ff361356.16168"]]},{"id":"de89a4c3.7b81a8","type":"function","z":"31a1ac1c.c57c44","g":"efacc863.a3f888","name":" ","func":"var d = secondsToDhms(Math.round((Date.now() - new Date(Math.round((msg.payload[0].time)/1000000)))/1000));\nvar len = msg.payload.length;\nvar f1 = 0;var f2 = 0;var f3 = 0;var f4 = 0;var t1 = 0;var t2 = 0;var t3 = 0;var t4 = 0;var d1 = 0;var d2 = 0;var d3 = 0;var d4 = 0;\nvar f1a = 0;var f2a = 0;var f3a = 0;var f4a = 0;var t1a = 0;var t2a = 0;var t3a = 0;var t4a = 0;var d1a = 0;var d2a = 0;var d3a = 0;var d4a = 0;\nvar f1b = false;var f2b = false;var f3b = false;var f4b = false;var t1b = false;var t2b = false;var t3b = false;var t4b = false;var d1b = false;var d2b = false;var d3b = false;var d4b = false;\nf1a=msg.payload[0].FuelTangki1;\nf2a=msg.payload[0].FuelTangki2;\nf3a=msg.payload[0].FuelTangki3;\nf4a=msg.payload[0].FuelTangki4;\nt1a=msg.payload[0].TempTangki1;\nt2a=msg.payload[0].TempTangki2;\nt3a=msg.payload[0].TempTangki3;\nt4a=msg.payload[0].TempTangki4;\nd1a=msg.payload[0].DSG1;\nd2a=msg.payload[0].DSG2;\nd3a=msg.payload[0].DSG3;\nd4a=msg.payload[0].DSG4;\nfor(i=0;i<msg.payload.length;i++){\n    if(f1a!=msg.payload[i].FuelTangki1){\n        f1b = true;\n    }\n    if(f2a!=msg.payload[i].FuelTangki2){\n        f2b = true;\n    }\n    if(f3a!=msg.payload[i].FuelTangki3){\n        f3b = true;\n    }\n    if(f4a!=msg.payload[i].FuelTangki4){\n        f4b = true;\n    }\n    \n    if(t1a!=msg.payload[i].TempTangki1){\n        t1b = true;\n    }\n    if(t2a!=msg.payload[i].TempTangki2){\n        t2b = true;\n    }\n    if(t3a!=msg.payload[i].TempTangki3){\n        t3b = true;\n    }\n    if(t4a!=msg.payload[i].TempTangki4){\n        t4b = true;\n    }\n    \n    if(d1a!=msg.payload[i].DSG1){\n        d1b = true;\n    }\n    if(d2a!=msg.payload[i].DSG2){\n        d2b = true;\n    }\n    if(d3a!=msg.payload[i].DSG3){\n        d3b = true;\n    }\n    if(d4a!=msg.payload[i].DSG4){\n        d4b = true;\n    }\n}\n\n\n    \nmsg.payload = \"Info Device Kelanis\\n\\n\";\nmsg.payload += \"Last Online : \"+String(d)+\"\\n\";\nmsg.payload += \"Fuel Level 1 : \"+String(updated(f1b))+\"\\n\";\nmsg.payload += \"Fuel Level 2 : \"+String(updated(f2b))+\"\\n\";\nmsg.payload += \"Fuel Level 3 : \"+String(updated(f3b))+\"\\n\";\nmsg.payload += \"Fuel Level 4 : \"+String(updated(f4b))+\"\\n\";\n\nmsg.payload += \"Temperature 1 : \"+String(updated(t1b))+\"\\n\";\nmsg.payload += \"Temperature 2 : \"+String(updated(t2b))+\"\\n\";\nmsg.payload += \"Temperature 3 : \"+String(updated(t3b))+\"\\n\";\nmsg.payload += \"Temperature 4 : \"+String(updated(t4b))+\"\\n\";\n\nmsg.payload += \"Density 1 : \"+String(updated(d1b))+\"\\n\";\nmsg.payload += \"Density 2 : \"+String(updated(d2b))+\"\\n\";\nmsg.payload += \"Density 3 : \"+String(updated(d3b))+\"\\n\";\nmsg.payload += \"Density 4 : \"+String(updated(d4b))+\"\\n\";\nmsg.topic = \"FMS Status Report\";\nreturn msg;\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    var res = dDisplay + hDisplay + mDisplay ;\n    if(res.length<1){\n        return \"less than a minute\";\n    }\n    return res;\n}\n\nfunction updated(x){\n    if(x){\n        return \"Update\";\n    }else{\n        return \"not Update\";\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":4660,"wires":[["7bb0b3dd.66b21c","11835065.ad6ea"]]},{"id":"ff361356.16168","type":"function","z":"31a1ac1c.c57c44","g":"efacc863.a3f888","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":4660,"wires":[["de89a4c3.7b81a8"]]},{"id":"7bb0b3dd.66b21c","type":"link out","z":"31a1ac1c.c57c44","g":"efacc863.a3f888","name":"FMS Report","links":["c2fbaa40.e58d78"],"x":713,"y":4615,"wires":[]},{"id":"c2fbaa40.e58d78","type":"link in","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","links":["7bb0b3dd.66b21c"],"x":185,"y":2720,"wires":[["4a1b1df5116616ac","ae92eecf31a0b75b","360f3b01.bae684","6decb252.0228bc"]]},{"id":"c24f2789.75c4f8","type":"e-mail","z":"47ec9b6e.206e24","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"fadlurrahmanfahmibudiman@gmail.com","dname":"","x":1480,"y":2660,"wires":[]},{"id":"c97f37ef.d2e498","type":"e-mail","z":"47ec9b6e.206e24","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"ravellerhaven@gmail.com","dname":"","x":1430,"y":2700,"wires":[]},{"id":"bcc1819d.6cca7","type":"e-mail","z":"47ec9b6e.206e24","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"mamanbudiman@yahoo.com","dname":"","x":1450,"y":2740,"wires":[]},{"id":"6e102191.b6dd6","type":"function","z":"47ec9b6e.206e24","d":true,"g":"f41a6b42.27a6f8","name":" ","func":"var d = msg.payload[1];\nflow.set(\"Current_\"+String(d.SHIP_NAME),d.CURRENTT);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1160,"wires":[[]]},{"id":"5f3ec0e8.e0ade","type":"function","z":"47ec9b6e.206e24","name":" ","func":"var msg1={};var msg2={};var msg3={};var msg4={};\nmsg1['payload'] = flow.get(\"Current_MBP3222\");\nmsg2['payload'] = flow.get(\"Current_IBUF\");\nmsg3['payload'] = flow.get(\"Current_TAMBAT\");\nmsg4['payload'] = flow.get(\"Current_MBP3206\");\nreturn [msg1,msg2,msg3,msg4];","outputs":4,"noerr":0,"initialize":"","finalize":"","x":290,"y":1460,"wires":[["fb9426d5.591b68"],["19ffa732.3e65e9"],["fc3a743c.b1fe48"],["1dfff5f1.56a84a"]]},{"id":"3dec1f12.c78eb","type":"link out","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":"","links":["d773201.aa37be"],"x":255,"y":500,"wires":[]},{"id":"d773201.aa37be","type":"link in","z":"47ec9b6e.206e24","name":"","links":["3dec1f12.c78eb"],"x":175,"y":1460,"wires":[["5f3ec0e8.e0ade"]]},{"id":"fb9426d5.591b68","type":"debug","z":"47ec9b6e.206e24","name":" MBP3222","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":600,"y":1380,"wires":[]},{"id":"19ffa732.3e65e9","type":"debug","z":"47ec9b6e.206e24","name":" IBUF","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":590,"y":1440,"wires":[]},{"id":"fc3a743c.b1fe48","type":"debug","z":"47ec9b6e.206e24","name":" TAMBAT","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":600,"y":1500,"wires":[]},{"id":"1dfff5f1.56a84a","type":"debug","z":"47ec9b6e.206e24","name":" MBP3206","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":600,"y":1560,"wires":[]},{"id":"87745895.2463c8","type":"debug","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":170,"y":1160,"wires":[]},{"id":"f4d2f5af.20b448","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":215,"y":1160,"wires":[["ee456f82.501be"]]},{"id":"ee456f82.501be","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from GrafanaIBUF where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time >= 1696114555000000000\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":365,"y":1160,"wires":[["eacd473.548df38"]]},{"id":"eacd473.548df38","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":515,"y":1160,"wires":[["60ab6885.444b5"]]},{"id":"60ab6885.444b5","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":695,"y":1160,"wires":[["8a293b99.a670e8"]]},{"id":"8a293b99.a670e8","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":860,"y":1160,"wires":[["2a51e163.e62b7e","e6099c32.31b8a8"]]},{"id":"e6099c32.31b8a8","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"ibuf-avgreport","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1050,"y":1160,"wires":[]},{"id":"cbd356bc.61c2f8","type":"function","z":"31a1ac1c.c57c44","name":" Formula","func":"var tab = msg.payload;\nvar data = msg.datatank;\nvar tank = msg.data;\nvar json = {};\nvar arr = [];\nvar convs = 0.0;\nmsg.topic = \"\";\n\n////\n////\nvar Den3 = map_range(data['DSG3'],400,2000,0,2);\nvar res3 = 0;\nvar den153 = 0;\nvar temp3 = 0;\njson['3dst'] = Den3;\njson['3Obs'] = tank.Tangki3;\nfor(i=0;i<tab.length;i++){\n    // convs = ConvertToTemp(data['TempTangki3'])+5+2.5;\n    convs = 115.55;\n    if(convs===0){\n        convs = 16;\n    }\n    if(convs==tab[i].Temp){\n        // res3 = tank15deg(tab[i]['Column_'+String(Den3*1000)],tab[i].Temp);\n        res3 = tank15deg(889,tab[i].Temp);\n        json['VCF'] = res3;\n        json['dst15deg'] = tab[i]['Column_'+String(Den3*1000)]; // 864.3\n        // res3 = 0;\n        json['3Obs15']=parseFloat((res3*tank.Tangki3).toFixed(2));\n        den153 = tab[i]['Column_'+String(Den3*1000)];\n        temp3 = tab[i].Temp;\n        json['3Temp'] = temp3;\n        // msg.topic += \"INSERT INTO `FMS_DASHBOARD`(`EPOCH`, `DATEE`, `TANKID`, `TOTALOBS`, `TOTAL15DEG`, `DENSITY`, `TEMPERATURE`, `STA`) VALUES (\";\n        // msg.topic += String((data.time/1000000)+3)+\",\";\n        // msg.topic += \"'\"+String(simpledate(String(new Date(parseFloat(data.time/1000000)))))+\"',\";\n        // msg.topic += \"'tank3',\";\n        // msg.topic += \"'\"+String(json['3Obs'])+\"',\";\n        // msg.topic += \"'\"+String(json['3Obs15'])+\"',\";\n        // msg.topic += \"'\"+String(Den3)+\"',\";\n        // msg.topic += \"'\"+String(tab[i].Temp)+\"',\";\n        // msg.topic += \"0);\";\n        \n        break;\n    }\n}\n////\n\nvar resarr = [];\nresarr.push([res3,den153,temp3,json['3Obs'],json['3Obs15']]);\nmsg.payload = json;\nreturn msg;\n\nfunction ConvertToTemp(value){\n    var r1 = [400,2000];\n    var r2 = [0,100];\n    var res =  parseFloat((( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ]).toFixed(0));\n    if(res<=0){\n        res = 0;\n    }else if(res>=100){\n        res = 100;\n    }\n    return res;\n}\n\nfunction tank15deg(x,y){\n    var k0less770 = 346.42278;\n    var k0around778839 = 594.5418;\n    var k0more839 = 186.9696;\n    var k1less770 = 0.43884;\n    var k1around778839 = 0;\n    var k1more839 = 0.48618;\n    var alpha = 0.0;\n    if(x<=770){\n        alpha = createalpha(k0less770,k1less770,x);\n    }else if(x>=778 && x<839){\n        alpha = createalpha(k0around778839,k1around778839,x);\n    }else if(x>=839){\n        alpha = createalpha(k0more839,k1more839,x);\n    }\n    json['alpha'] = alpha;\n    var DegC = y-15;\n    return parseFloat(Math.pow(2.71828,((alpha*-1)*DegC*(1+0.8*alpha*DegC))).toFixed(4));\n}\n\nfunction createalpha(x,y,z){\n    return (x+(y*z))/Math.pow(z,2)\n}\n\nfunction simpledate(x){\n    var spt = x.split(' ');\n    var str = \"\";\n    str+=spt[2]+\"/\";\n    str+=String(gmfs(spt[1]))+\"/\";\n    str+=spt[3]+\" \";\n    str+=spt[4].substring(0,5);\n    return str;\n}\n\nfunction gmfs(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n      return new Date(d).getMonth() + 1;\n   }\n   return -1;\n}\n\nfunction map_range(value, low1, high1, low2, high2) {\n    var res = low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n    if(res<0){\n        return 0;\n    }else{\n        return parseFloat((res).toFixed(3));\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":200,"wires":[["362a063.3add5fa"]]},{"id":"fbab249d.978848","type":"inject","z":"31a1ac1c.c57c44","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from fuelkelanis order by time desc limit 1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":1620,"y":200,"wires":[["69c1044.e7bfbfc"]]},{"id":"69c1044.e7bfbfc","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":1630,"y":260,"wires":[["efb19be8.20af18"]]},{"id":"362a063.3add5fa","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1880,"y":340,"wires":[]},{"id":"efb19be8.20af18","type":"function","z":"31a1ac1c.c57c44","name":"","func":"msg.datatank = msg.payload[0];\nmsg.query = \"select * from fuelkelanisliter order by time desc limit 1;\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":320,"wires":[["97206f9a.efbf5"]]},{"id":"97206f9a.efbf5","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":1630,"y":380,"wires":[["781c7493.3bc9ec"]]},{"id":"781c7493.3bc9ec","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"msg.data = msg.payload[0];\nmsg.topic = \"SELECT * FROM `tabel15deg`;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":140,"wires":[["3d6d11bf.80d90e"]]},{"id":"3d6d11bf.80d90e","type":"mysql","z":"31a1ac1c.c57c44","mydb":"b21187dd.19c978","name":"Get","x":1830,"y":140,"wires":[["cbd356bc.61c2f8"]]},{"id":"b8d03b72.00ed18","type":"mqtt in","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","topic":"SendDataKelanis","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":130,"y":560,"wires":[["ab056952.93a6a8"]]},{"id":"1628851b.04bf3b","type":"debug","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":960,"y":600,"wires":[]},{"id":"f9095625.39ce08","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","env":[],"x":620,"y":560,"wires":[["c708fa1c.595738","de2fcc67.1127c","16bc65.b224a39b"],[]]},{"id":"ab056952.93a6a8","type":"json","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","property":"payload","action":"obj","pretty":false,"x":300,"y":560,"wires":[["6c57d2b6.f0df5c","4195668.aee4298"]]},{"id":"c708fa1c.595738","type":"mqtt out","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","topic":"SendDataKelanisDone","qos":"","retain":"","broker":"4803b37b.b88cfc","x":820,"y":560,"wires":[]},{"id":"de2fcc67.1127c","type":"link out","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","links":["8e7cab51.64f268"],"x":715,"y":520,"wires":[]},{"id":"8e7cab51.64f268","type":"link in","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","links":["de2fcc67.1127c"],"x":95,"y":100,"wires":[["fb7a9dbd.53871","edeb8d83.210da"]]},{"id":"edeb8d83.210da","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":390,"y":20,"wires":[]},{"id":"7bd54c86.fe99a4","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":670,"y":60,"wires":[]},{"id":"10095b0c.c3ab65","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":770,"y":180,"wires":[]},{"id":"11835065.ad6ea","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":900,"y":4680,"wires":[]},{"id":"cec0c607.212c98","type":"trigger","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":470,"y":240,"wires":[[]]},{"id":"fb1478c1.97cf68","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1490,"y":100,"wires":[]},{"id":"6c57d2b6.f0df5c","type":"debug","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":480,"y":600,"wires":[]},{"id":"4195668.aee4298","type":"delay","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":560,"wires":[["f9095625.39ce08"]]},{"id":"16bc65.b224a39b","type":"function","z":"31a1ac1c.c57c44","g":"25e7d0fc.3faee","name":"","func":"msg.payload['time'] = Math.round(msg.payload.time/1000000);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":600,"wires":[["1628851b.04bf3b"]]},{"id":"83b11e14.df53","type":"debug","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":380,"wires":[]},{"id":"da716c93.8b8fd","type":"trigger","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"250","extend":true,"overrideDelay":true,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":330,"y":240,"wires":[[]]},{"id":"40a565e8.9dd9dc","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":720,"wires":[]},{"id":"598e93e9.e362bc","type":"function","z":"80eab637.b91808","g":"5248f06a.76272","name":"","func":"msg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":740,"wires":[["40a565e8.9dd9dc"]]},{"id":"4e44fabf.a5fa44","type":"inject","z":"80eab637.b91808","g":"5248f06a.76272","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":890,"y":740,"wires":[["598e93e9.e362bc"]]},{"id":"ee6fea8e.2a62e8","type":"debug","z":"ea265a0.2300aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1530,"y":540,"wires":[]},{"id":"8d823f6b.75c7e8","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1220,"wires":[["9dd13640.c3ecf8"]]},{"id":"def76353.b5668","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":490,"y":1220,"wires":[["19fd2dbc.00da8a"]]},{"id":"9dd13640.c3ecf8","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from IBUF2 where time > uint(v: 2023-01-18T12:00:00.000000000Z)\";\n\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\n\n\nmsg.payload = msg.query;\nreturn msg; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1220,"wires":[["def76353.b5668"]]},{"id":"63811488.5523dc","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1220,"wires":[["663d6427.a29244"]]},{"id":"663d6427.a29244","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":770,"y":1220,"wires":[["6f47d8d4.be69a8"]]},{"id":"6f47d8d4.be69a8","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1220,"wires":[["b1969e7e.18737"]]},{"id":"b4cea104.465ad","type":"mqtt out","z":"ea265a0.2300aa8","d":true,"name":"","topic":"ibuf-report","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1210,"y":1220,"wires":[]},{"id":"b1969e7e.18737","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1050,"y":1220,"wires":[["76693494.ed45c4"]]},{"id":"76693494.ed45c4","type":"debug","z":"ea265a0.2300aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":1320,"wires":[]},{"id":"19fd2dbc.00da8a","type":"debug","z":"ea265a0.2300aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":1340,"wires":[]},{"id":"d3dc9db9.0ae42","type":"debug","z":"ea265a0.2300aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":930,"y":100,"wires":[]},{"id":"60f6d360.869a2c","type":"debug","z":"b6837abd.323fd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":600,"y":1520,"wires":[]},{"id":"1fc57748.e1f849","type":"link in","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","links":["3ec5f4c3.7a618c"],"x":715,"y":2620,"wires":[["76c2a638.494e78","6decb252.0228bc","c893e887.526d78","846a8c01.2342a","360f3b01.bae684","76cca9ca.d048d8","4a1b1df5116616ac"]]},{"id":"3ec5f4c3.7a618c","type":"link out","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","links":["1fc57748.e1f849"],"x":655,"y":2620,"wires":[]},{"id":"7297400c.6384","type":"debug","z":"80eab637.b91808","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1020,"y":2160,"wires":[]},{"id":"d298ad44.53b86","type":"inject","z":"80eab637.b91808","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING_BUNKER] WHERE SHIP = 'MBP 3222' ORDER BY TIME_START ASC;","payloadType":"str","x":270,"y":2220,"wires":[[]]},{"id":"16197d11.881323","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"DEBUGGG","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":450,"y":1660,"wires":[]},{"id":"ddc44bdc.7cae48","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":700,"y":1540,"wires":[]},{"id":"5febb4b5.106e6c","type":"function","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"Date","func":"var x = Math.round(parseInt(String(msg.data.EPOCH))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":1540,"wires":[["73c8b37d.48021c"]]},{"id":"73c8b37d.48021c","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1190,"y":1540,"wires":[]},{"id":"fb06a5bb.0a9e28","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","env":[],"x":870,"y":1620,"wires":[["2460cfe0.80692","476c917.b35497","92eac366.afb23"],[]]},{"id":"6fc07de9.769894","type":"mysql","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","mydb":"b21187dd.19c978","name":"","x":310,"y":1620,"wires":[["bafada45.3619c8","16197d11.881323"]]},{"id":"476c917.b35497","type":"trigger","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":990,"y":1660,"wires":[[]]},{"id":"50241f9f.34fba","type":"trigger","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":870,"y":1660,"wires":[[]]},{"id":"8237ec92.84c9","type":"trigger","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1870,"y":1640,"wires":[[]]},{"id":"f3706505.4cf838","type":"debug","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1180,"y":1680,"wires":[]},{"id":"92eac366.afb23","type":"json","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","property":"payload","action":"str","pretty":false,"x":990,"y":1620,"wires":[["3d68afce.bc3da"]]},{"id":"3d68afce.bc3da","type":"json","z":"31a1ac1c.c57c44","g":"cc6a03f2.0bc1e","name":"","property":"payload","action":"obj","pretty":false,"x":1110,"y":1620,"wires":[["e543ed1e.83322","f3706505.4cf838"]]},{"id":"1738828b.5d70fd","type":"debug","z":"80eab637.b91808","g":"641d28f8.063e48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":1220,"wires":[]},{"id":"7d03c947.2b6808","type":"inject","z":"31a1ac1c.c57c44","g":"f91a5010.a62fe","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1360,"wires":[["2aed5054.cbed2"]]},{"id":"adda36b3.dd6078","type":"inject","z":"47ec9b6e.206e24","g":"e90ee691.a45788","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":780,"wires":[["e1d85b19.a86398"]]},{"id":"33a3a30.97dbe5e","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":180,"y":1040,"wires":[]},{"id":"e1fc1b82.447788","type":"link in","z":"b6837abd.323fd8","g":"2f8b3dd0.0d2cb2","name":"","links":["b3ea6152.e7e6d"],"x":355,"y":640,"wires":[["6a9a35b7.ea5f3c"]]},{"id":"1de2a798.4309a8","type":"inject","z":"31a1ac1c.c57c44","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1890,"y":2140,"wires":[["f914658d.c916b8"]]},{"id":"fc29b644.332508","type":"influxdb in","z":"31a1ac1c.c57c44","influxdb":"76f4cea2.88ada","name":"fuelkelanis","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":2260,"y":2140,"wires":[["1556911a.3d810f"]]},{"id":"f914658d.c916b8","type":"function","z":"31a1ac1c.c57c44","name":"","func":"var before = 1698768000000*1000000;\nmsg.query = \"SELECT * FROM fuelkelanis WHERE time >= \"+String(before)+\";\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2070,"y":2140,"wires":[["fc29b644.332508"]]},{"id":"a0f68a15.1e4848","type":"debug","z":"31a1ac1c.c57c44","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2840,"y":2140,"wires":[]},{"id":"1556911a.3d810f","type":"function","z":"31a1ac1c.c57c44","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[\"Date\"] = new Date(Math.round(d[i][0]/1000000));\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2480,"y":2140,"wires":[["6ffa39ca.55e948"]]},{"id":"6ffa39ca.55e948","type":"excel","z":"31a1ac1c.c57c44","name":"","file":"/var/www/html/KelanisRecord.xlsx","x":2680,"y":2140,"wires":[["a0f68a15.1e4848"]]},{"id":"4dd7b8be.b813e8","type":"mqtt in","z":"47ec9b6e.206e24","name":"","topic":"DataTracking","qos":"2","datatype":"auto","broker":"3df154b8.35094c","x":1350,"y":3020,"wires":[["c4de5c49.6b901","4194b991.f89ee8"]]},{"id":"c4de5c49.6b901","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1550,"y":3020,"wires":[]},{"id":"4194b991.f89ee8","type":"json","z":"47ec9b6e.206e24","name":"","property":"payload","action":"obj","pretty":false,"x":1440,"y":3060,"wires":[["79e0c5f9.dae45c"]]},{"id":"79e0c5f9.dae45c","type":"excel","z":"47ec9b6e.206e24","name":"","file":"/var/www/html/Tracking.xlsx","x":1520,"y":3100,"wires":[[]]},{"id":"3638dafb.bd5206","type":"mqtt in","z":"47ec9b6e.206e24","g":"e29f94d3.283128","name":"","topic":"OfflineDTI","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":240,"y":2840,"wires":[["175428c2.f8bd17","360f3b01.bae684","4a1b1df5116616ac"]]},{"id":"5be3e6cb.f51278","type":"mqtt in","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","topic":"CountFlowmeterDataKelanis","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":180,"y":1840,"wires":[["552bca54.381214"]]},{"id":"92a551da.cd603","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload[0].count","targetType":"msg","statusVal":"payload","statusType":"auto","x":490,"y":1780,"wires":[]},{"id":"f151297d.27cdc8","type":"function","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","func":"var d = msg.payload[0].count;\nmsg.count = d;\nmsg.query = \"select count(DATEE) as count from RecordFlowmeterRaw limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1840,"wires":[["f470c14e.b0d86"]]},{"id":"552bca54.381214","type":"json","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","property":"payload","action":"obj","pretty":false,"x":370,"y":1840,"wires":[["92a551da.cd603","485f479e.6f6e28"]]},{"id":"f470c14e.b0d86","type":"influxdb in","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":770,"y":1840,"wires":[["70006388.0f487c"]]},{"id":"70006388.0f487c","type":"function","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","func":"var countlocal = msg.count;\nvar countcloud = 0;\nif(msg.payload.length>0){\n    countcloud = msg.payload[0].count;\n}\nif(countlocal!=countcloud){\n    msg.sendsta = true;\n    msg.selisih = countlocal-countcloud;\n    // msg.selisih = 10;\n    msg.payload = \"SELECT * FROM RecordFlowmeter order by time DESC limit \"+String(msg.selisih)+\";\"\n    \n}else{\n    msg.selisih = countlocal-countcloud;\n    msg.sendsta = false;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1840,"wires":[["eefba998.643828","a4a3bc2b.0b91a","52a37321.dda2cc"]]},{"id":"eefba998.643828","type":"switch","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","property":"sendsta","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":1840,"wires":[["27cb6362.f0adac"]]},{"id":"27cb6362.f0adac","type":"mqtt out","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","topic":"RequestFlowmeterDataKelanis","qos":"","retain":"","broker":"4803b37b.b88cfc","x":1290,"y":1840,"wires":[]},{"id":"63a6d877.38c708","type":"mqtt in","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","topic":"ReceiveFlowmeterDataKelanis","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":190,"y":1920,"wires":[["36894d1a.2287e2","9b8fa7b1.36e8e8"]]},{"id":"36894d1a.2287e2","type":"json","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","property":"payload","action":"obj","pretty":false,"x":430,"y":1920,"wires":[["f11e279.c8cd7d8"]]},{"id":"f11e279.c8cd7d8","type":"function","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":1920,"wires":[["a7f76186.0dcab"]]},{"id":"4f5788c3.69a108","type":"influxdb out","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","influxdb":"76f4cea2.88ada","name":"RecordFlowmeterRaw","measurement":"RecordFlowmeterRaw","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1020,"y":1920,"wires":[]},{"id":"a4a3bc2b.0b91a","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"selisih","targetType":"msg","statusVal":"sendsta","statusType":"auto","x":1030,"y":1780,"wires":[]},{"id":"eaf735c9.70b438","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":830,"y":1880,"wires":[]},{"id":"73dfe935.543408","type":"function","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","func":"msg.raw = msg.payload;\nvar json = {\n    \"time\":msg.payload.time,\n    \"EPOCH\":msg.payload.time,\n    \"DATEE\":String(new Date(msg.payload.time)).substring(0,24),\n    \"GANTRY\":msg.payload.ID,\n    \"STARTT\":String(new Date(msg.payload.EPO_BEFORE)).substring(16,24),\n    \"FINISHH\":String(new Date(msg.payload.EPO_AFTER)).substring(16,24),\n    \"DURATIONN\":secondsToDhms(Math.round((msg.payload.EPO_AFTER-msg.payload.EPO_BEFORE)/1000)),\n    \"STARTVALUERAW\":String(msg.payload.VAL_BEFORE),\n    \"ENDVALUERAW\":String(msg.payload.VAL_AFTER),\n    \"REFUELINGVALUE\":String(msg.payload.VAL_AFTER-msg.payload.VAL_BEFORE),\n    \"STAT\":'0'\n}\nmsg.payload = json;\nreturn msg;\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    var res = dDisplay + hDisplay + mDisplay ;\n    if(res.length<1){\n        return \"less than a minute\";\n    }\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":1920,"wires":[["4f5788c3.69a108","d351af57.42f43"]]},{"id":"d351af57.42f43","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.DATEE","targetType":"msg","statusVal":"payload.DATEE","statusType":"auto","x":1210,"y":1880,"wires":[]},{"id":"60db1bcd.8a2e14","type":"switch","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":1960,"wires":[["cbb51b40.72fa38","ba744d22.51da8","327c4f78.bf109","633d76a8.021148"]]},{"id":"d303228a.4aaa6","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1190,"y":1780,"wires":[]},{"id":"485f479e.6f6e28","type":"switch","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":1840,"wires":[["f151297d.27cdc8"]]},{"id":"a7f76186.0dcab","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","x":700,"y":1920,"wires":[["73dfe935.543408","eaf735c9.70b438","e614b4e4.343fd8"],[]]},{"id":"e614b4e4.343fd8","type":"function","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","func":"msg.raw = msg.payload;\nif(msg.payload.EPO_AFTER == 0 || (msg.payload.VAL_AFTER-msg.payload.VAL_BEFORE)<=100){\n    msg.payload=null;\n    return msg;\n}\nvar json = {\n    \"time\":msg.payload.time,\n    \"EPOCH\":msg.payload.time,\n    \"DATEE\":String(new Date(msg.payload.time)).substring(0,24),\n    \"GANTRY\":msg.payload.ID,\n    \"STARTT\":String(new Date(msg.payload.EPO_BEFORE)).substring(16,24),\n    \"FINISHH\":String(new Date(msg.payload.EPO_AFTER)).substring(16,24),\n    \"DURATIONN\":secondsToDhms(Math.round((msg.payload.EPO_AFTER-msg.payload.EPO_BEFORE)/1000)),\n    \"STARTVALUERAW\":String(msg.payload.VAL_BEFORE),\n    \"ENDVALUERAW\":String(msg.payload.VAL_AFTER),\n    \"REFUELINGVALUE\":String(msg.payload.VAL_AFTER-msg.payload.VAL_BEFORE),\n    \"STAT\":'0'\n}\nmsg.payload = json;\nflow.set(\"SAVEFLOWMETER\",msg.payload);\nreturn msg;\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    var res = dDisplay + hDisplay + mDisplay ;\n    if(res.length<1){\n        return \"less than a minute\";\n    }\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":1960,"wires":[["60db1bcd.8a2e14","e0748802.9b95b8"]]},{"id":"cbb51b40.72fa38","type":"influxdb out","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","influxdb":"76f4cea2.88ada","name":"RecordFlowmeter","measurement":"RecordFlowmeter","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1130,"y":1960,"wires":[]},{"id":"ba744d22.51da8","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.DATEE","targetType":"msg","statusVal":"payload.DATEE","statusType":"auto","x":1210,"y":1960,"wires":[]},{"id":"ff81a9f5.623d88","type":"link in","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":"","links":["916de746.519338"],"x":75,"y":2080,"wires":[["330aff73.a4d26"]]},{"id":"330aff73.a4d26","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","func":"msg.query = \"select * from RecordFlowmeter WHERE STAT = '0' order by time desc limit 50;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":2080,"wires":[["45f4e092.38546"]]},{"id":"45f4e092.38546","type":"influxdb in","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":310,"y":2080,"wires":[["bef1050.72452f8"]]},{"id":"bef1050.72452f8","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","func":"if(!Object.keys(msg.payload.results[0]).includes(\"series\")){\n    msg.payload = null;\n    return msg;\n}\nvar d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":2080,"wires":[["e4e740b4.7f422"]]},{"id":"162364ee.add1ab","type":"subflow:e9b71a55.b25c68","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":"","x":670,"y":2080,"wires":[["a2bd3365.2a727","cccb15ed.c15418"],[]]},{"id":"a2bd3365.2a727","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","func":"msg.data = msg.payload;\nvar d = msg.payload;\ndelete d['time'];\ndelete d['STAT'];\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":2080,"wires":[["cfeb0f30.84705"]]},{"id":"cfeb0f30.84705","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" Send to Apex Kelanis","func":"msg.method = \"POST\";\nmsg.url = \"https://gffc6be1c389bcf-db8gk8v.adb.ap-singapore-1.oraclecloudapps.com/ords/deviota_lab/InsertData/FMSGANTRY\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":2080,"wires":[["a26428dd.29e328"]]},{"id":"a26428dd.29e328","type":"http request","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":"Update","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1180,"y":2080,"wires":[["8665b312.3fef7","9023f1c1.783ec"]]},{"id":"8665b312.3fef7","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","func":"var d =  msg.payload;\nif(d==\"\"){\n    msg.payload = msg.result;\n    msg.pass = true;\n}else{\n    msg.payload = \"Error\";\n    msg.pass = false;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":2080,"wires":[["14662b5e.b10325"]]},{"id":"67330b22.978554","type":"link out","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":"","links":["89dc0128.7afc5"],"x":1515,"y":2120,"wires":[]},{"id":"14662b5e.b10325","type":"switch","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","property":"pass","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1430,"y":2080,"wires":[["9070b6b6.9c94f8"],["67330b22.978554"]]},{"id":"9070b6b6.9c94f8","type":"function","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","func":"var d = msg.data;\nd[\"time\"] = d.EPOCH;\nd[\"STAT\"] = \"1\";\nmsg.payload = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1560,"y":2080,"wires":[["df0eb504.630f48"]]},{"id":"df0eb504.630f48","type":"influxdb out","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","influxdb":"76f4cea2.88ada","name":"RecordFlowmeter","measurement":"RecordFlowmeter","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1730,"y":2080,"wires":[]},{"id":"9023f1c1.783ec","type":"debug","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1310,"y":2120,"wires":[]},{"id":"cccb15ed.c15418","type":"debug","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":790,"y":2120,"wires":[]},{"id":"e4e740b4.7f422","type":"switch","z":"31a1ac1c.c57c44","g":"f9733f01.9767d","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":2080,"wires":[["162364ee.add1ab"]]},{"id":"52a37321.dda2cc","type":"trigger","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1030,"y":1840,"wires":[[]]},{"id":"9b8fa7b1.36e8e8","type":"trigger","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"125","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":430,"y":1960,"wires":[[]]},{"id":"633d76a8.021148","type":"debug","z":"31a1ac1c.c57c44","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload.DATEE","statusType":"auto","x":1370,"y":1880,"wires":[]},{"id":"327c4f78.bf109","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.DATEE","targetType":"msg","statusVal":"payload.DATEE","statusType":"auto","x":1370,"y":1960,"wires":[]},{"id":"e0748802.9b95b8","type":"debug","z":"31a1ac1c.c57c44","g":"df4bcd58.fbdb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":920,"y":1800,"wires":[]},{"id":"9ab5e5a7.bd1a98","type":"inject","z":"47ec9b6e.206e24","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2040,"y":320,"wires":[["b32d2de5.542d4"]]},{"id":"b32d2de5.542d4","type":"http request","z":"47ec9b6e.206e24","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"localhost:3000","tls":"","persist":false,"proxy":"","authType":"","x":2220,"y":340,"wires":[["39447918.d7ea76"]]},{"id":"6874bb21.74f804","type":"inject","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING_BUNKER] WHERE SHIP = 'MBP 3222' ORDER BY TIME_START ASC;","payloadType":"str","x":250,"y":2320,"wires":[[]]},{"id":"7a67df2b.18d1d","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":"Check Length","func":"var qty = flow.get(\"QTYBunker\");\nvar d = msg.payload\nvar arr = []\nif(d.length!=qty){\n    for(i=qty;i<d.length;i++){\n        arr.push(d[i]);\n    }\n    msg.payload = arr;\n}else{\n    msg.payload = null;\n}\nmsg.lenlen = d.length;\nmsg.delay = 20000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":2320,"wires":[["4a145c7a.b81ea4"]]},{"id":"9c481dc1.4eec4","type":"inject","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":2460,"wires":[["af663a3c.235d48"]]},{"id":"af663a3c.235d48","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":"Set","func":"flow.set(\"QTYBunker\",2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":2460,"wires":[[]]},{"id":"4a145c7a.b81ea4","type":"switch","z":"80eab637.b91808","g":"4305afdb.9f512","name":"NewData?","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":2320,"wires":[["7297400c.6384","7ddc72c6.62a1cc"]]},{"id":"c0940631.e18df8","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","func":"var d = msg.payload;\nvar json = {\n    \"TIMEBFRVMS\":\"\",\n    \"TIMEAFTVMS\":\"\",\n    \"ROB_BEFORE_VMS\":\"\",\n    \"ROB_AFTER_VMS\":\"\",\n    \"SHIP\":String(d.SHIP),\n    \"datee\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_START\":String(d.ROB_START),\n    \"TIME_START\":toDate(epoch(d.TIME_START)-(8*3600000)).substring(0,toDate(epoch(d.TIME_START)-(8*3600000)).length-25),\n    \"ROB_FINISH\":String(d.ROB_FINISH),\n    \"TIME_COMPLETE\":toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).substring(0,toDate(epoch(d.TIME_COMPLETE)-(8*3600000)).length-25),\n    \"BUNKER_QTY\":String(d.BUNKER_QTY),\n    \"FO_RECEIVED\":String(d.FO_RECEIVED),\n    \"recorddate\":epoch(String(d.TIME_START)),\n    \"FO_CONS\":String(d.FO_CONS),\n    \"vmsrob\":\"\",\n    \"dif\":\"\"\n}\nvar timebfr = (epoch(d.TIME_START)-(8*3600000)-300000)*1000000;\nvar timeaft = (epoch(d.TIME_COMPLETE)-(8*3600000)-300000)*1000000;\nmsg.Bunker = json;\nvar tabelROB = \"GrafanaRawLiter\";\nmsg.query = \"SELECT ROB FROM \"+tabelROB+\" WHERE time <= \"+timebfr+\" ORDER BY time DESC limit 3;\";\nmsg.query += \"SELECT ROB FROM \"+tabelROB+\" WHERE time >= \"+timeaft+\" ORDER BY time ASC limit 3;\";\n// msg.payload = json;\nmsg.payload = [timebfr,timeaft];\nreturn msg;\n\nfunction epoch (date) {\n  return Date.parse(date)\n}\nfunction toDate(date){\n    return String(new Date(date));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":2320,"wires":[["99b227d8.6705c8"]]},{"id":"7c6900d9.1aa0d","type":"influxdb in","z":"80eab637.b91808","g":"4305afdb.9f512","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":290,"y":2380,"wires":[["c16b7d4d.598d7"]]},{"id":"e7f36995.016728","type":"switch","z":"80eab637.b91808","g":"4305afdb.9f512","name":"Success","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":720,"y":2380,"wires":[["73a9ff1f.bb8ad"]]},{"id":"122544ec.4242cb","type":"debug","z":"80eab637.b91808","g":"4305afdb.9f512","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":2440,"wires":[]},{"id":"99b227d8.6705c8","type":"link out","z":"80eab637.b91808","g":"4305afdb.9f512","name":"","links":["99a89200.df3e5"],"x":1095,"y":2320,"wires":[]},{"id":"99a89200.df3e5","type":"link in","z":"80eab637.b91808","g":"4305afdb.9f512","name":"","links":["99b227d8.6705c8"],"x":195,"y":2380,"wires":[["7c6900d9.1aa0d"]]},{"id":"73a9ff1f.bb8ad","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","func":"flow.set(\"QTYBunker\",msg.lenlen);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":2380,"wires":[["2eda7861.aecf08"]]},{"id":"2b6f265a.c97fea","type":"http request","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertbunker","tls":"","persist":false,"proxy":"","authType":"basic","x":590,"y":2380,"wires":[["e7f36995.016728","122544ec.4242cb"]]},{"id":"c16b7d4d.598d7","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":" ","func":"var avrb= avr(msg.payload.results[0].series[0].values);\nvar avra= avr(msg.payload.results[1].series[0].values);\nvar timeb = String(new Date(Math.round(msg.payload.results[0].series[0].values[0][0]/1000000)));\ntimeb = timeb.substring(0,timeb.length-25);\nvar timea = String(new Date(Math.round(msg.payload.results[1].series[0].values[0][0]/1000000)));\ntimea = timea.substring(0,timea.length-25);\nvar robvms = Math.round(Math.abs(avrb-avra));\nmsg.Bunker['TIMEBFRVMS'] = timeb.split(' ')[2]+\"-\"+gm(timeb.split(' ')[1])+\"-\"+timeb.split(' ')[3]+\" \"+timeb.split(' ')[4];\nmsg.Bunker['TIMEAFTVMS'] = timea.split(' ')[2]+\"-\"+gm(timea.split(' ')[1])+\"-\"+timea.split(' ')[3]+\" \"+timea.split(' ')[4];\nmsg.Bunker['vmsrob'] = String(robvms);\nmsg.Bunker['dif'] = String(Math.round(Math.abs(msg.Bunker.FO_RECEIVED - robvms)));\nmsg.Bunker['ROB_BEFORE_VMS'] = String(avrb);\nmsg.Bunker['ROB_AFTER_VMS'] = String(avra);\n// msg.Bunker['RECORD_ID'] = Date.parse(msg.Bunker.TIME_START);\nmsg.Bunker['datee'] = msg.Bunker.datee.split(' ')[2]+\"-\"+gm(msg.Bunker.datee.split(' ')[1])+\"-\"+msg.Bunker.datee.split(' ')[3];//+\" \"+msg.Bunker.datee.split(' ')[4];\nmsg.Bunker['TIME_START'] = msg.Bunker.TIME_START.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_START.split(' ')[1])+\"-\"+msg.Bunker.TIME_START.split(' ')[3]+\" \"+msg.Bunker.TIME_START.split(' ')[4];\nmsg.Bunker['TIME_COMPLETE'] = msg.Bunker.TIME_COMPLETE.split(' ')[2]+\"-\"+gm(msg.Bunker.TIME_COMPLETE.split(' ')[1])+\"-\"+msg.Bunker.TIME_COMPLETE.split(' ')[3]+\" \"+msg.Bunker.TIME_COMPLETE.split(' ')[4];\nmsg.payload= msg.Bunker;\nreturn msg;\n\nfunction avr(x){\n    var res = 0;\n    for(i=0;i<x.length;i++){\n        res+=x[i][1];\n    }\n    res = Math.round(res / x.length);\n    return res;\n}\n\nfunction gm(mon){\n   var d = Date.parse(mon + \"1, 2012\");\n   if(!isNaN(d)){\n       var res = \"\";\n       if(String(new Date(d).getMonth() + 1).length<2){\n           res = \"0\" + String(new Date(d).getMonth() + 1);\n       }else{\n           res = String(new Date(d).getMonth() + 1);\n       }\n      return res;\n   }\n   return -1;\n }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2380,"wires":[["122544ec.4242cb","2b6f265a.c97fea"]]},{"id":"355e6a3d.a00e46","type":"function","z":"80eab637.b91808","g":"4305afdb.9f512","name":"Get","func":"msg.payload = flow.get(\"QTYBunker\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":2420,"wires":[["122544ec.4242cb"]]},{"id":"7ddc72c6.62a1cc","type":"subflow:e9b71a55.b25c68","z":"80eab637.b91808","g":"4305afdb.9f512","name":"","env":[],"x":890,"y":2320,"wires":[["244b78d.aba7388","c0940631.e18df8"],[]]},{"id":"813678d4b5e17a9a","type":"MSSQL","z":"80eab637.b91808","g":"5248f06a.76272","mssqlCN":"7db681aad1f6f90a","name":"","query":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'MBP 3222' ORDER BY DATE_TIME DESC","outField":"payload","x":970,"y":860,"wires":[["509e6195.182e5","3581f557.a7092a"]]},{"id":"b9b8f74935bbf75a","type":"MSSQL","z":"b6837abd.323fd8","g":"5f95045c.cd76fc","mssqlCN":"7db681aad1f6f90a","name":"","query":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","outField":"payload","x":980,"y":1140,"wires":[["38e14f66.f4575","8813107e.d371f"]]},{"id":"9bf857e3d218ae89","type":"MSSQL","z":"fd486f91.7596e","g":"7dbe7912.2bbcf8","mssqlCN":"7db681aad1f6f90a","name":"","query":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","outField":"payload","x":940,"y":1000,"wires":[["85c384d1.de55c8","4e3f4e2a.0fd16"]]},{"id":"d6869cfd122385d0","type":"MSSQL","z":"ce7006a0.688478","g":"eb56ff57.5b80d","mssqlCN":"7db681aad1f6f90a","name":"","query":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'MBP 3206' ORDER BY DATE_TIME DESC","outField":"payload","x":1000,"y":1100,"wires":[["76f9243b.3c1d2c","1362f2bd.4b1b0d"]]},{"id":"4506b969e7039ba0","type":"mqtt in","z":"ce7006a0.688478","name":"","topic":"ASDASDASD","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","nl":false,"rap":true,"rh":0,"x":900,"y":1740,"wires":[["db8e638d7dd1c634"]]},{"id":"db8e638d7dd1c634","type":"debug","z":"ce7006a0.688478","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1120,"y":1740,"wires":[]},{"id":"31051401d1af3d6f","type":"debug","z":"47ec9b6e.206e24","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":880,"y":2260,"wires":[]},{"id":"ac1e26a6fb544816","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":1040,"wires":[]},{"id":"5b15b21639bc6261","type":"inject","z":"323faf53d384df59","g":"77ad3b83d2a689b5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"_terminalEpochTime\":\"1234567891011\",\"_terminalTime\":\"2024-01-26 15:50:25.698\",\"_groupName\":\"adaro\",\"IncTemparature\":\"34.74\",\"IncX\":\"-0.28\",\"IncY\":\"-0.28\",\"IncZ\":\"89.90\",\"Wind_Direction\":\"353\",\"Wind_Speed\":\"3.27\",\"DT_Port\":\"0.792\",\"ST2_Center_Front\":\"-0.013\",\"ST2_Port\":\"1.163\",\"DT_Stbd\":\"0.74\",\"ST2_Center_Back\":\"-0.01\",\"ST2_Stbd\":\"1.12\",\"Latitude\":\"-3.33804\",\"Longitude\":\"114.54550\",\"SpeedKmph\":\"0.0000\",\"Heading\":\"-179.871\",\"RPM_ENG_PORT\":\"0\",\"RPM_ENG_STBD\":\"0\",\"RPM_ENG_Port_Raw\":\"7\",\"RPM_ENG_Stbd_Raw\":\"6\",\"Speed_Knot\":\"0\"}","payloadType":"json","x":310,"y":180,"wires":[["81081cf231112f82"]]},{"id":"81081cf231112f82","type":"mqtt out","z":"323faf53d384df59","g":"77ad3b83d2a689b5","name":"","topic":"isb/tulus/sensor_test","qos":"1","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":530,"y":140,"wires":[]},{"id":"32e1383180943dd9","type":"mqtt in","z":"323faf53d384df59","name":"","topic":"data/isb/tulus/sensorbatch","qos":"1","datatype":"json","broker":"4803b37b.b88cfc","nl":false,"rap":true,"rh":0,"x":210,"y":300,"wires":[["ba06f15e9cc19587"]]},{"id":"14ec19f9eef3d57a","type":"debug","z":"323faf53d384df59","g":"a5952fbf264b6317","name":"debug 34","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1000,"y":420,"wires":[]},{"id":"ba06f15e9cc19587","type":"change","z":"323faf53d384df59","g":"a5952fbf264b6317","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"\t    {\t    \"time\" : payload.terminalEpochTime,\t    \"incTemperature\": payload.IncTemparature,\t    \"IncX\": payload.IncX,\t    \"IncY\": payload.IncY,\t    \"IncZ\": payload.IncZ,\t    \"terminalTime\": payload._terminalTime,\t    \"serverEpochTime\": $toMillis($now()),\t    \"serverTime\": $now(),\t    \"Wind_Direction\": payload.Wind_Direction,\t    \"Wind_Speed\": payload.Wind_Speed,\t    \"DT_Port\": payload.DT_Port,\t    \"ST2_Center_Front\": payload.ST2_Center_Front,\t    \"ST2_Port\": payload.ST2_Port,\t    \"DT_Stbd\": payload.DT_Stbd,\t    \"ST2_Center_Back\": payload.ST2_Center_Back,\t    \"ST2_Stbd\": payload.ST2_Stbd,\t    \"Latitude\": payload.Latitude,\t    \"Longitude\": payload.Longitude,\t    \"Speed_Kmph\": payload.SpeedKmph,\t    \"Heading\": payload.Heading,\t    \"RPM_ENG_Port\": payload.RPM_ENG_PORT,\t    \"RPM_ENG_Stbd\": payload.RPM_ENG_STBD,\t    \"RPM_ENG_Port_Raw\": payload.RPM_ENG_Port_Raw,\t    \"RPM_ENG_Stbd_Raw\": payload.RPM_ENG_Stbd_Raw,\t    \"Speed_Knot\": payload.Speed_Knot,\t    \"ST2_Stbd_Raw\": payload.ST2_Stbd_Raw,\t    \"DT_Port_Raw\": payload.DT_Port_Raw,\t    \"ST2_Center_Front_Raw\": payload.ST2_Center_Front_Raw,\t    \"ST2_Port_Raw\": payload.ST2_Port_Raw,\t    \"DT_Stbd_Raw\": payload.DT_Stbd_Raw,\t    \"ST2_Center_Back_Raw\":payload.ST2_Center_Back_Raw\t    }\t\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":420,"wires":[["14ec19f9eef3d57a","2e59aebea5f323ca","fe6576f020202bf9"]]},{"id":"2e59aebea5f323ca","type":"influxdb out","z":"323faf53d384df59","g":"a5952fbf264b6317","influxdb":"76f4cea2.88ada","name":"","measurement":"tulusraw","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"IT","bucket":"vms","x":860,"y":320,"wires":[]},{"id":"205409add2c080ed","type":"debug","z":"323faf53d384df59","name":"debug 35","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":380,"y":500,"wires":[]},{"id":"e79343b0f0b957c8","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":480,"wires":[["27c8ebab6fb13253"]]},{"id":"80832f9d7385a4a2","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":480,"wires":[["f17750f01bde603c"]]},{"id":"27c8ebab6fb13253","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from tulusraw  \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" \";\nmsg.payload = msg.query;\nreturn msg; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":480,"wires":[["80832f9d7385a4a2"]]},{"id":"f17750f01bde603c","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    json[da[21]] = d[i][21];\n    json[da[22]] = d[i][22];\n    json[da[23]] = d[i][23];\n    json[da[24]] = d[i][24];\n    json[da[25]] = d[i][25];\n    json[da[26]] = d[i][26];\n    json[da[27]] = d[i][27];\n    json[da[28]] = d[i][28];\n    json[da[29]] = d[i][29];\n    json[da[30]] = d[i][30];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":480,"wires":[["2347fa0086babfac"]]},{"id":"2347fa0086babfac","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":480,"wires":[["264511f5e1ffa084"]]},{"id":"264511f5e1ffa084","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":480,"wires":[["1b70cd2c39b9064b"]]},{"id":"a0fb6e496229d769","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"tulus-report","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":1290,"y":480,"wires":[]},{"id":"1b70cd2c39b9064b","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":480,"wires":[["a0fb6e496229d769","ee6fea8e.2a62e8"]]},{"id":"050a71994f52a6e4","type":"function","z":"0b6b53eb180f1e72","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar angle = d.ws.split(',')[1];\nvar speed = d.ws.split(',')[2];\nif(isNaN(speed)){\n    speed=\"0\";\n}\nvar wind = d.ws.split(',')[0];\nvar calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(angle),\n    \"WS\":detectInt(wind), // \"WS\":0,\n    \"F1\":MA(d.FS125,1),//Daily\n    \"F2\":MA(d.FS124,2),//KiriBlkng\n    \"F3\":MA(d.FS127,3),//KiriDepan\n    \"F4\":MA(d.FS120,4),//KananDepan\n    \"F5\":MA(d.FS121,5),//KananBlkng\n    \"F6\":MA(d.FS105,6),//TengahDepan\n    \"F7\":MA(d.FS112,7),//TengahBlkng\n    \"RPM106\":MA(d.RPM106,8),\n    \"RPM104\":MA(d.RPM104,9),\n    \"RPM209\":MA(d.RPM209,10),\n    \"RPM205\":MA(d.RPM205,11),\n    \"Speed\":parseFloat(speed)//MA(speed,8)\n}\njson['StorageCenter'] = StorageCenter(json.F6,json.F7);\njson['StorageKanan'] = StorageKanan(json.F4,json.F5);\njson['StorageKiri'] = StorageKiri(json.F3,json.F2);\njson['Daily'] = DailyTank(json.F1);\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\n// for(i=0;i<6;i++){\n//     var val = Math.round(json['F'+String(i+1)]);\n//     msg.topic += \"SELECT `Liter` FROM \"+calitable[i]+\" WHERE `Value` = \"+String(val)+\";\";\n// }\nmsg.topic += \"SELECT * FROM `LOOKUPDAILYMBP3206` WHERE `Sonde`>=\"+String(json.Daily)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGEKANANMBP3206` WHERE `Sonde`>=\"+String(json.StorageKanan)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGEKIRIMBP3206` WHERE `Sonde`>=\"+String(json.StorageKiri)+\" limit 1;\";\nmsg.topic += \"SELECT * FROM `LOOKUPSTORAGETENGAHMBP3206` WHERE `Sonde`>=\"+String(json.StorageCenter)+\" limit 1;\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(a != \"-1\"){\n        if(b<8){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=8){\n            a = parseFloat(String(a));\n        }\n        if(a % 1 === 0){\n            n.push(a);\n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=400){\n            return 400;\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\nfunction StorageCenter(x,y){\n    var res = (x * 0.42841243648887317)+(y * -0.2056183258097715)+(-103.94678576592575);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction StorageKanan(x,y){\n    var res = (x * 0.057270078054845235)+(y * 0.1335491517895142)+(-78.97277610267666);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction StorageKiri(x,y){\n    var res = (x * 0.6021531180443854)+(y * -0.4176463630886229)+(-78.74300956569955);\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}\nfunction DailyTank(x){\n    var res = (0.177*x) - 92.637;\n    if(res<=1){\n        res = 0;\n    }\n    return Math.round(res);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1040,"y":300,"wires":[["665587e3ab741b9e","72f54f7370daf225"]]},{"id":"72f54f7370daf225","type":"mysql","z":"0b6b53eb180f1e72","mydb":"be353e7e.73b9d","name":"","x":1230,"y":300,"wires":[["c1718cd88051d87d","a949074c49708d66"]]},{"id":"c1718cd88051d87d","type":"function","z":"0b6b53eb180f1e72","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"CenterLiter\":d[3][0].Liter,\n    \"CenterCm\":d[3][0].Sonde,\n    \"KananLiter\":d[1][0].Liter,\n    \"KananCm\":d[1][0].Sonde,\n    \"KiriLiter\":d[2][0].Liter,\n    \"KiriCm\":d[2][0].Sonde,\n    \"DailyLiter\":d[0][0].Liter,\n    \"DailyCm\":d[0][0].Sonde,\n    \"ws\":convertws(msg.data.WS),\n    \"RPMKanan\":RPMkanan(msg.data.RPM106),\n    \"RPMKiri\":RPMkiri(msg.data.RPM104),\n    \"PropKanan\":String(msg.data.RPM209),\n    \"PropKiri\":String(msg.data.RPM205)\n}\njson['ROB'] = json.CenterLiter+json.KananLiter+json.KiriLiter+json.DailyLiter;\nmsg.Grafana3206 = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    if(x[1][0].Liter>=2394){//FS002\n        // res+=(Math.round((x[1][0].Liter+x[0][0].Liter)/2));//FS002+FS001/2\n        res+=x[1][0].Liter;\n    }else{\n        res+=x[1][0].Liter;\n    }\n    if(x[2][0].Liter>=2347){//FS003\n        // res+=(Math.round((x[2][0].Liter+x[5][0].Liter)/2));//FS003+FS006/2\n        res+=x[2][0].Liter;\n    }else{\n        res+=x[2][0].Liter;\n    }\n    res+=x[3][0].Liter;//FS004\n    res+=x[4][0].Liter;//FS005\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\nfunction convertrpm( value ) { \n    var r1 = [0,3000];\n    var r2 = [0,1500];\n    return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n}\n\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}\n\nfunction RPMkiri(x){\n    var res = 0;\n    res = (2.76871285876849*x) - 42.57238588949300\n    if(res<600){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction RPMkanan(x){\n    var res = 0;\n    res = (0.750754160044114*x) - 13.576238513829700;\n    if(res<500){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1390,"y":300,"wires":[["1ad66b7ba5b1ca32"]]},{"id":"59da3f21fd5463f6","type":"function","z":"0b6b53eb180f1e72","name":"Convert","func":"var data = msg.payload\nvar data1 = {\n    \"time\":data.time,\n    \"lat\":data.lat, \n    \"lon\":data.lon, \n    \"ws\":data.ws, \n    \"FS125\":data.FS125, \n    \"FS121\":data.FS121, \n    \"FS124\":data.FS124, \n    \"FS127\":data.FS127, \n    \"FS112\":data.FS112, \n    \"FS105\":data.FS105, \n    \"FS120\":data.FS120, \n    \"RPM106\":data.RPM113, \n    \"RPM104\":data.RPM104, \n    \"RPM209\":data.RPM209,\n    \"RPM205\":data.RPM205\n};\nmsg.payload = data1;\nmsg.countt = msg.topic;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":300,"wires":[["050a71994f52a6e4","5dcf0c78018e06b0"]]},{"id":"c43135f15134a6fd","type":"inject","z":"0b6b53eb180f1e72","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1710733548259,\"lat\":\"-7.705261\",\"lon\":\"113.614372\",\"ws\":\"3,250.73,0.31\",\"FS125\":\"950\",\"FS121\":\"990\",\"FS124\":\"1127\",\"FS127\":\"1132\",\"FS112\":\"659\",\"FS105\":\"733\",\"FS120\":\"1024\",\"RPM113\":\"2545\",\"RPM104\":\"2665\",\"RPM209\":\"0\",\"RPM205\":\"0\"}","payloadType":"json","x":630,"y":300,"wires":[["e9250ce78902c430","59da3f21fd5463f6"]]},{"id":"e9250ce78902c430","type":"debug","z":"0b6b53eb180f1e72","name":"get_influx_data","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":900,"y":120,"wires":[]},{"id":"5dcf0c78018e06b0","type":"debug","z":"0b6b53eb180f1e72","name":"convert_InsertToMBP3206","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":980,"y":200,"wires":[]},{"id":"665587e3ab741b9e","type":"debug","z":"0b6b53eb180f1e72","name":"MovingAverage","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1240,"y":160,"wires":[]},{"id":"a949074c49708d66","type":"debug","z":"0b6b53eb180f1e72","name":"getMysqlData","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1400,"y":200,"wires":[]},{"id":"1ad66b7ba5b1ca32","type":"debug","z":"0b6b53eb180f1e72","name":"CreateJson_InsertToGrafana3206","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1740,"y":300,"wires":[]},{"id":"782b13cbc07ff02d","type":"inject","z":"fd486f91.7596e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"SELECT * FROM TAMBAT2","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3040,"y":1280,"wires":[["a9c62aacbdac1fc3"]]},{"id":"a9c62aacbdac1fc3","type":"influxdb in","z":"fd486f91.7596e","influxdb":"76f4cea2.88ada","name":"","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":3280,"y":1280,"wires":[["4ab9da4ca7b0f335","f3135431a1a82393"]]},{"id":"f3135431a1a82393","type":"function","z":"fd486f91.7596e","name":"","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3500,"y":1260,"wires":[["4ab9da4ca7b0f335","2e325854540b1279"]]},{"id":"2e325854540b1279","type":"excel","z":"fd486f91.7596e","name":"","file":"/var/www/html/TAMBAT.xlsx","x":3630,"y":1280,"wires":[["0c9150a7b66bc789"]]},{"id":"4ab9da4ca7b0f335","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3500,"y":1320,"wires":[]},{"id":"fafb52893a455ec2","type":"debug","z":"fd486f91.7596e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3360,"y":1340,"wires":[]},{"id":"8442d504c175954f","type":"json","z":"fd486f91.7596e","name":"","property":"payload","action":"","pretty":false,"x":3140,"y":1360,"wires":[["fafb52893a455ec2"]]},{"id":"0c9150a7b66bc789","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3790,"y":1260,"wires":[]},{"id":"17cedf7afd7b870b","type":"inject","z":"fd486f91.7596e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3020,"y":1540,"wires":[["f9f65cf707ecb184"]]},{"id":"f9f65cf707ecb184","type":"function","z":"fd486f91.7596e","name":"Last Online","func":"msg.payload = flow.get(\"LastOnline\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3190,"y":1520,"wires":[["a4e3bf848091258e"]]},{"id":"a4e3bf848091258e","type":"debug","z":"fd486f91.7596e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":3350,"y":1520,"wires":[]},{"id":"eca11e9671619e74","type":"inject","z":"fd486f91.7596e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"CMDTAMBAT","payload":"influx","payloadType":"str","x":3090,"y":1640,"wires":[["21237c488f5e0671"]]},{"id":"21237c488f5e0671","type":"mqtt out","z":"fd486f91.7596e","name":"","topic":"","qos":"","retain":"","broker":"4803b37b.b88cfc","x":3320,"y":1640,"wires":[]},{"id":"2078cfaab63051a2","type":"link out","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"","links":["a217eec014a2a788"],"x":1015,"y":1700,"wires":[]},{"id":"19d5cb57531dd627","type":"inject","z":"fd486f91.7596e","g":"fcbdbec6.319c5","name":"Cek Kosong","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":130,"y":1660,"wires":[["3fc071d5.867c6e"]]},{"id":"a64ad2620c1e6d9d","type":"inject","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":1820,"wires":[["b7bd465c6008ce05"]]},{"id":"b7bd465c6008ce05","type":"function","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":1820,"wires":[["54c1b98fad5353b8","12950f8fee82695d"]]},{"id":"12950f8fee82695d","type":"function","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1820,"wires":[["90e710faf616f687"]]},{"id":"90e710faf616f687","type":"debug","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":570,"y":1800,"wires":[]},{"id":"9ff1dabfee1b0d16","type":"debug","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":580,"y":1860,"wires":[]},{"id":"54c1b98fad5353b8","type":"function","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1860,"wires":[["9ff1dabfee1b0d16"]]},{"id":"aea4898cf999525b","type":"function","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":1860,"wires":[[]]},{"id":"407ef8ff8c204532","type":"inject","z":"fd486f91.7596e","g":"f8c1175ae8ef7af1","name":" reset time","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":120,"y":1860,"wires":[["aea4898cf999525b"]]},{"id":"d5f5e2d66dea1bd7","type":"debug","z":"47ec9b6e.206e24","g":"f41a6b42.27a6f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1200,"y":1160,"wires":[]},{"id":"704a8141.f82cf","type":"mqtt in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1","topic":"PINGTAMBAT","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":200,"wires":[["4556d74e.bb68b8","ea0be969.25f6b8"]]},{"id":"bb96ab8d.971528","type":"delay","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"60","randomUnits":"seconds","drop":false,"x":650,"y":200,"wires":[["41ddf714.c19238"]]},{"id":"41ddf714.c19238","type":"mqtt out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1->2","topic":"PINGTAMBATnd","qos":"","retain":"","broker":"4803b37b.b88cfc","x":790,"y":200,"wires":[]},{"id":"31f81998.347856","type":"mqtt in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"3","topic":"PINGTAMBATrd","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":240,"wires":[["7a0f38d.aeafac8"]]},{"id":"83772f1.1d115d","type":"mqtt out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"3->4","topic":"PINGTAMBATth","qos":"","retain":"","broker":"4803b37b.b88cfc","x":530,"y":240,"wires":[]},{"id":"a211a538.1b93b8","type":"switch","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":200,"wires":[["bb96ab8d.971528"]]},{"id":"60823f95.e8f89","type":"mqtt in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"5","topic":"PINGTAMBATData","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":280,"wires":[["4948af18.6d611"]]},{"id":"4948af18.6d611","type":"delay","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":230,"y":280,"wires":[["908344ee.ea3e18"]]},{"id":"997ba561.c8c678","type":"mqtt out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"5->6","topic":"PINGTAMBATFINAL","qos":"","retain":"","broker":"4803b37b.b88cfc","x":530,"y":280,"wires":[]},{"id":"7dd5715c.4e50b","type":"mqtt in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"7","topic":"PINGTAMBATDone","qos":"2","datatype":"auto","broker":"4803b37b.b88cfc","x":90,"y":320,"wires":[["86f3bf18.b0bcf"]]},{"id":"9a6b26fd.f095e8","type":"mqtt out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","topic":"UPDATETAMBAT","qos":"","retain":"","broker":"4803b37b.b88cfc","x":570,"y":360,"wires":[]},{"id":"908344ee.ea3e18","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Save","func":"flow.set(\"RSRT\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":280,"wires":[["997ba561.c8c678"]]},{"id":"86f3bf18.b0bcf","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"same?","func":"var rsrt = flow.get(\"RSRT\");\nvar d = msg.payload;\nif(rsrt!=d || d == \"[]\"){\n    msg.payload=null;\n}\n//msg.delay = 1000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":320,"wires":[["143a4405.812f8c"]]},{"id":"143a4405.812f8c","type":"switch","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"same","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":320,"wires":[["9a6b26fd.f095e8","1af04911.590687"]]},{"id":"1af04911.590687","type":"json","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","property":"payload","action":"","pretty":false,"x":530,"y":320,"wires":[["8c991105.199dd"]]},{"id":"8c991105.199dd","type":"subflow:e9b71a55.b25c68","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","env":[],"x":670,"y":320,"wires":[["f687e42a.847d08","9e97a5ff.702a68","bdeddbfb.ccda18"],["e113b393.8c61","c58d6065.48ce9"]]},{"id":"9548c64f.7dd838","type":"influxdb out","z":"fd486f91.7596e","d":true,"g":"d7541a4.d356fe8","influxdb":"76f4cea2.88ada","name":"TAMBAT","measurement":"TAMBAT","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1200,"y":260,"wires":[]},{"id":"bdeddbfb.ccda18","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Convert","func":"var data = msg.payload;\nvar data1 = {\n    \"time\":data.time,\n    \"lat\":data.Lat, \n    \"lon\":data.Lon, \n    \"ws\":data.WS, \n    \"angle\":data.Angle, \n    \"speed\":data.Speed, \n    \"F1\":data.FS102, \n    \"F2\":data.FS113, \n    \"F3\":data.FS114, \n    \"F4\":data.FS106, \n    \"F5\":data.FS116, \n    \"F6\":data.FS117,\n    \"RPM1\":data.RPM113,\n    \"RPM2\":data.RPM114\n};\nmsg.payload = data1;\nmsg.countt = msg.topic;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":280,"wires":[["9e97a5ff.702a68","1d7ccbb9.e31694","663d0c7a.eb4ca4"]]},{"id":"e113b393.8c61","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Reset","func":"msg.payload = \"RESET\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":360,"wires":[["5397a21f.8030bc"]]},{"id":"5397a21f.8030bc","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["a49d942c.8f1c48","242e9e2d.9b74c2"],"x":925,"y":360,"wires":[]},{"id":"a49d942c.8f1c48","type":"link in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["5397a21f.8030bc"],"x":295,"y":160,"wires":[["7cc15c50.3aa794"]]},{"id":"c58d6065.48ce9","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" up","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"\"Tambat Update \"&$string(payload, true)&\" Data\"\t","targetType":"jsonata","statusVal":"payload","statusType":"auto","x":810,"y":400,"wires":[]},{"id":"9e97a5ff.702a68","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1070,"y":300,"wires":[]},{"id":"7cc15c50.3aa794","type":"trigger","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"50","extend":true,"overrideDelay":true,"units":"s","reset":"RESET","bytopic":"all","topic":"topic","outputs":1,"x":390,"y":200,"wires":[["a211a538.1b93b8"]]},{"id":"4556d74e.bb68b8","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["1f07104e.02081"],"x":195,"y":160,"wires":[]},{"id":"1f07104e.02081","type":"link in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["4556d74e.bb68b8"],"x":55,"y":80,"wires":[["e447db7c.481ac8","641839e6.da57e8","933f2b09.3bd168","87964e94.b2df2"]]},{"id":"e447db7c.481ac8","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":170,"y":60,"wires":[]},{"id":"73409110.8d0ee","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":310,"y":60,"wires":[]},{"id":"641839e6.da57e8","type":"trigger","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"10","extend":true,"overrideDelay":true,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":170,"y":120,"wires":[[]]},{"id":"933f2b09.3bd168","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Time","func":"msg.payload= new Date()+(3600*8);\nflow.set(\"LastOnline\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":120,"wires":[["73409110.8d0ee"]]},{"id":"f55c6a05.00aa48","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Query","func":"msg.payload = \"SELECT * FROM ReportData WHERE sta = '0' limit 50;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":240,"wires":[["83772f1.1d115d"]]},{"id":"1d7ccbb9.e31694","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["e333ef2a.fc30e"],"x":1035,"y":220,"wires":[]},{"id":"ea0be969.25f6b8","type":"delay","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1 msg-only","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":250,"y":200,"wires":[["7cc15c50.3aa794"]]},{"id":"ace0340a.7c2aa8","type":"inject","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"TriggerSend","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":140,"wires":[["77f288da.bf1248"]]},{"id":"b60933e2.0f928","type":"link in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["77f288da.bf1248"],"x":255,"y":240,"wires":[["f55c6a05.00aa48"]]},{"id":"77f288da.bf1248","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["b60933e2.0f928"],"x":535,"y":140,"wires":[]},{"id":"7a0f38d.aeafac8","type":"delay","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"1sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"60","randomLast":"180","randomUnits":"seconds","drop":false,"x":230,"y":240,"wires":[["f55c6a05.00aa48"]]},{"id":"398fb8b8.303028","type":"inject","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"RESETALL","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":120,"y":380,"wires":[["ecd733b7.272f2"]]},{"id":"ecd733b7.272f2","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"RESET TAMBAT","links":["3ce3157d.8d829a","5bf0dd0c.098834","6d59ccdc.330bc4","d976bbdf.e5ebd8","81537343.6dcbb","7e568acdc7614f94","3df37d353c58e5aa","101f99c61f6abb8e","054ca2d130345187","3d62f4ede8c3f936"],"x":235,"y":380,"wires":[]},{"id":"c057387a.08a2e8","type":"influxdb out","z":"fd486f91.7596e","d":true,"g":"d7541a4.d356fe8","influxdb":"76f4cea2.88ada","name":"TAMBAT2","measurement":"TAMBAT2","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1200,"y":220,"wires":[]},{"id":"663d0c7a.eb4ca4","type":"influxdb out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","influxdb":"76f4cea2.88ada","name":"TAMBAT3","measurement":"TAMBAT3","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1080,"y":260,"wires":[]},{"id":"87a0452.da9b7b8","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":950,"y":100,"wires":[]},{"id":"f687e42a.847d08","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":120,"wires":[["87a0452.da9b7b8"]]},{"id":"87964e94.b2df2","type":"link out","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"ONLINETAMBAT","links":["228e8277.f9ee6e"],"x":115,"y":80,"wires":[]},{"id":"591a9f46.021d7","type":"inject","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Check Last Data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":520,"y":60,"wires":[["a206b44b.935098"]]},{"id":"a217eec014a2a788","type":"link in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"","links":["a913596e7bec3d67","2078cfaab63051a2","12b6ad31e3914e83"],"x":955,"y":220,"wires":[["1d7ccbb9.e31694"]]},{"id":"14f59fe.3ceaf6","type":"debug","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1110,"y":60,"wires":[]},{"id":"dc1766bb.d187e8","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.results[0].series[0].values[0][0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":60,"wires":[["14f59fe.3ceaf6"]]},{"id":"23c75db2.924ed2","type":"influxdb in","z":"fd486f91.7596e","g":"d7541a4.d356fe8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":810,"y":60,"wires":[["dc1766bb.d187e8"]]},{"id":"a206b44b.935098","type":"function","z":"fd486f91.7596e","g":"d7541a4.d356fe8","name":" ","func":"msg.query = \"SELECT * from TAMBAT3 order by time desc limit 1;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":60,"wires":[["23c75db2.924ed2"]]},{"id":"35b9b41cf6f41040","type":"inject","z":"0b6b53eb180f1e72","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":970,"y":480,"wires":[["95949f36f15f88b1"]]},{"id":"95949f36f15f88b1","type":"function","z":"0b6b53eb180f1e72","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=11;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":480,"wires":[["e900606f4e26bd3b"]]},{"id":"e900606f4e26bd3b","type":"debug","z":"0b6b53eb180f1e72","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1230,"y":480,"wires":[]},{"id":"59e9811f42cc1fe4","type":"inject","z":"0b6b53eb180f1e72","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":970,"y":520,"wires":[["86f2dd04cebcde98"]]},{"id":"86f2dd04cebcde98","type":"function","z":"0b6b53eb180f1e72","name":"SetAvr","func":"for(i=1;i<=15;i++){\n    flow.set(\"avr\"+String(i),[]);\n    \n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":520,"wires":[[]]},{"id":"667eb3e926e602aa","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["74a62164c8b1c8c5","89561f3d80785403"],"x":115,"y":1380,"wires":[["518e3ef2ff0662b7"]]},{"id":"518e3ef2ff0662b7","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" Take GeoFence","func":"// msg.Valid = msg.payload;\nmsg.Create = {};\nmsg.Create['time'] = msg.Valid.time+1;\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` ASC;\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":1380,"wires":[["df237815f146eafd"]]},{"id":"df237815f146eafd","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":390,"y":1380,"wires":[["e9d17504cdc266fc","3c779c3ec41c46a6"]]},{"id":"e9d17504cdc266fc","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Proses","func":"msg.topic = msg.countt;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nif(msg.Valid.lat == \"-1\" || msg.Valid.lon == \"-1\" || msg.Valid.lat == -1 || msg.Valid.lon == -1){\n    var prev = flow.get(\"DataPrev\");\n    msg.Valid['lat'] = prev.lat;\n    msg.Valid['lon'] = prev.lon;\n}\nlat = parseFloat(msg.Valid.lat); \nlon = parseFloat(msg.Valid.lon);    \n\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    try{\n        if(d[i].lat3 == null || d[i].lat4 == null){\n            continue;\n        }\n        var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n        if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n            msg.Create['CurrentGeo'] = d[i].geofenceName;\n            msg.Create['geofenceID'] = d[i].geofenceID;\n            msg.payload = msg.Create;\n            return msg;\n        }\n    }catch(x){\n        msg.payload = null;\n        return msg;\n    }\n}\nmsg.payload = [lat,lon];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":1380,"wires":[["4019ea38ee6fd93f","8e9dbce068ead96e"]]},{"id":"b7c1b9d03a4f08b0","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SELECTQUERY","func":"msg.imov = flow.get(\"IMOV\")[0];\nvar polpod = String(msg.imov.POL)+\"-\"+\"\"+String(msg.imov.POD);\nmsg.polpod = polpod;\nmsg.topic = \"SELECT * FROM `PathName` WHERE `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') ORDER BY `PathNum` ASC;\";\nmsg.topic += \"SELECT `Name`,`PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"';\";\nmsg.topic += \"SELECT * FROM `TaskID` WHERE `VID` = 'A2';\";\nmsg.topic += \"UPDATE `TaskID` SET `PathID` = (SELECT `PathID` FROM `PathID` WHERE `PathName` = '\"+String(polpod)+\"') WHERE `VID`='A2';\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1420,"wires":[["32ba978b7220f80f"]]},{"id":"4019ea38ee6fd93f","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["21794c522ea251b7"],"x":775,"y":1380,"wires":[]},{"id":"21794c522ea251b7","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["4019ea38ee6fd93f"],"x":135,"y":1420,"wires":[["b7c1b9d03a4f08b0"]]},{"id":"19c13536957caddf","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Insert","func":"var d = msg.payload;\nmsg.topic = \"\";\nmsg.topic += \"INSERT INTO `VMS_RouteTULUS`(`Time`, `Date`, `Ship_Name`, `GPS`, `PathID`, `POLPOD`, `Path_Num`, `geofenceID`, `Current_Location`, `Next_Location`, `IMOVEID`, `Barge`, `Cycle`, `Statuss`) \";\nmsg.topic += \"VALUES (\";\n\nmsg.topic += String(d.epoch)+\",\";\nmsg.topic += \"'\"+String(d.date)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.shipname)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.GPS)+\"'\"+\",\";\nmsg.topic += String(d.pathid)+\",\";\nmsg.topic += \"'\"+String(d.pathName)+\"'\"+\",\";\nmsg.topic += String(d.pathNum)+\",\";\nmsg.topic += String(d.geofenceID)+\",\";\nmsg.topic += \"'\"+String(d.curloc)+\"'\"+\",\";\nmsg.topic += \"'\"+String(d.nexloc)+\"'\"+\",\";\nmsg.topic += String(d.imoveid)+\",\";\nmsg.topic += \"'\"+String(d.barge)+\"'\"+\",\";\nmsg.topic += String(d.cycle)+\",\";\nmsg.topic += \"'\"+String(d.statuss)+\"'\";\n\nmsg.topic += \");\";\n\nmsg.topic += \"UPDATE `TaskID` SET `PathNum` = \"+d.pathNum+\" WHERE `VID` = 'A2';\";\nmsg.newvmsroute = d;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":1420,"wires":[["130d15266a26b7b6"]]},{"id":"32ba978b7220f80f","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":410,"y":1420,"wires":[["87cc70206d015671"]]},{"id":"87cc70206d015671","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Create Data TULUS","func":"var pN = msg.payload[0];var PathID = msg.payload[1][0].PathID;msg.deparv = msg.payload[1][0].Name;var cycle = msg.payload[2][0].Cycle\nvar Main = \"_\";var PathNum = 0;var Next = \"_\";\nvar Alur = flow.get(\"Alur\")\nmsg.topic = msg.countt;\nfor(i=0;i<pN.length;i++){\n    if(pN[i].geofenceID == msg.Create.geofenceID){\n        Main = pN[i].Main_Activity;\n        PathNum = pN[i].PathNum;\n        \n        if(i<1){\n            var ONSTART = flow.get(\"ONSTART\");\n            ONSTART['ROB'] = msg.ROB;\n            ONSTART['time'] = msg.Valid.time;\n            if(ONSTART!=undefined){\n            flow.set(\"ONSTART\",ONSTART);\n            }\n            flow.set(\"Alur\",\"Start\")\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"Start\"){\n            flow.set(\"Alur\",\"ToPoD\");\n        }else if(i>=Math.round(pN.length/2)){\n            // var ONEND = flow.get(\"POD\");\n            var ONEND = {};\n            ONEND['ROB'] = msg.ROB;\n            ONEND['time'] = msg.Valid.time;\n            flow.set(\"POD\",ONEND);\n            flow.set(\"Alur\",\"End\");\n        }else if(i>0 && i<=Math.round(pN.length/2)-1 && Alur == \"End\"){\n            flow.set(\"Alur\",\"ToPoL\");\n        }\n        Alur = flow.get(\"Alur\");\n        if(Alur == \"ToPoL\"){\n            Next = pN[i-1].Main_Activity;\n        }else{\n            Next = pN[i+1].Main_Activity;\n        }\n        break;\n    }\n}\nvar json = {\n    \"epoch\": msg.Valid.time,\n    \"date\": tcc(msg.Valid.time),\n    \"shipname\": \"TULUS\",\n    \"GPS\": String(msg.Valid.lat)+\",\"+String(msg.Valid.lon),\n    \"pathid\": PathID,\n    \"pathName\": msg.polpod,\n    \"pathNum\": PathNum,\n    \"geofenceID\":msg.Create.geofenceID,\n    \"curloc\": Main,\n    \"nexloc\": Next,\n    \"imoveid\": msg.imov.ID,\n    \"barge\":msg.imov.BARGE,\n    \"cycle\":cycle,\n    \"statuss\":\"\"\n}\nAlur = flow.get(\"Alur\");\nif(Alur == \"ToPoL\" || Alur == \"End\"){\n    msg.polpod = msg.polpod.split('-')[1]+\"-\"+msg.polpod.split('-')[0];\n    msg.deparv = msg.deparv.split('-')[1]+\"-\"+msg.deparv.split('-')[0];\n}\nmsg.Create = json;\nmsg.payload = json;\nreturn msg;\n\n\nfunction MainActive(x,pN){\n    var res = [];\n    \n    return [];\n}\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":1420,"wires":[["19c13536957caddf"]]},{"id":"130d15266a26b7b6","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["9ad12c8bb43ba1fa"],"x":955,"y":1420,"wires":[]},{"id":"9ad12c8bb43ba1fa","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["130d15266a26b7b6"],"x":135,"y":1460,"wires":[["ba06892a53e0557f","270eaa62b1b16110"]]},{"id":"ba06892a53e0557f","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Proses Alldata","func":"var speed =  \"\";\nmsg.topic = \"\";\nvar prev = flow.get(\"DataPrev\");\nif(isEmpty(prev)){\n    var j = {\n        \"time\":msg.Valid.time,\n        \"lat\":msg.Valid.lat,\n        \"lon\":msg.Valid.lon\n    }\n    flow.set(\"DataPrev\",j);\n    speed =\"0.00Kn/0.00°\";\n}else{\n    // prev.lat = parseFloat(prev.lat);prev.lon = parseFloat(prev.lon);\n    // msg.Valid.lat = parseFloat(msg.Valid.lat);msg.Valid.lon = parseFloat(msg.Valid.lon);\n    // var selisiht = Math.abs(msg.Valid.time - prev.time);\n    // var spd = distance(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon,\"K\")/(selisiht/(1000*3600));\n    // var knot = (1.852*spd).toFixed(2);\n    // if(String(knot)==\"NaN\"){\n    //     knot = 0;\n    // }\n    // speed = String(knot)+\"Kn/\"+String(angle(prev.lat,prev.lon,msg.Valid.lat,msg.Valid.lon))+\"°\";\n    //speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2))+\"Kn/\"+String(msg.Valid.angle)+\"°\";\n    speed = String((parseFloat(String(msg.Valid.Speed_Knot))).toFixed(2))+\"Kn/\"+String(msg.Valid.Heading)+\"°\";\n    //msg.speed = String((parseFloat(String(msg.Valid.speed))*1.852).toFixed(2));\n    msg.speed = String((parseFloat(String(msg.Valid.Speed_Knot))).toFixed(2));\n    flow.set(\"DataPrev\",msg.Valid);\n}\nvar json = {\n    \"EPO\":msg.Valid.time,\n    \"RECORDDATA\":formatdate(msg.Valid.time),\n    \"SHIP_NAME\":\"TULUS\",\n    \"LAT\":parseFloat(String(msg.Valid.lat)),\n    \"LON\":parseFloat(String(msg.Valid.lon)),\n    \"DEPARTURE\":msg.polpod.split('-')[0],\n    \"ARRIVAL\":msg.polpod.split('-')[1],\n    \"CURRENTT\":msg.Create.curloc, \n    \"NEXTT\":msg.Create.nexloc, //\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":Math.round((parseInt(String(msg.GrafanaTulus.R1)))),\n    \"RPMENGINE_S\":Math.round(parseInt(String(msg.GrafanaTulus.R2))),\n    \"RPMPROP_P\":0,//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"RPMPROP_S\":0,//Math.round((parseInt(msg.Valid.RP5)+parseInt(msg.Valid.RP8))/2),\n    \"WINDSPEED\":(parseFloat(String(msg.GrafanaTulus.ws))),\n    \"SPEEDCOURSE\":speed\n};\nmsg.alldata = json;\nmsg.payload = json;\nmsg.measurement = \"alldata\";\nreturn msg;\n\nfunction toStringEpo(x){\n    var date = String(new Date(x));\n    var sub = String(date).substring(0,date.length-25);\n    return sub;\n}\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}\nfunction angle(cx, cy, ex, ey) {\n  var dy = ey - cy;\n  var dx = ex - cx;\n  var theta = Math.atan2(dy, dx);\n  theta *= 180 / Math.PI; \n  if(theta<0){\n      theta = 360+theta;\n  }\n  return theta.toFixed(2);\n}\n\nfunction isEmpty(obj) {\n  for(var prop in obj) {\n    if(Object.prototype.hasOwnProperty.call(obj, prop)) {\n      return false;\n    }\n  }\n  return JSON.stringify(obj) === JSON.stringify({});\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1460,"wires":[["bf1cfa526047af37","884ab70982d8c52f","886906b945f82154"]]},{"id":"cd4d4fc062dba6be","type":"comment","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"ProcessToApex","info":"","x":240,"y":1340,"wires":[]},{"id":"bf1cfa526047af37","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Cek Payload 3","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":360,"y":1640,"wires":[]},{"id":"7b613f2769e031dd","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1340,"wires":[["6cd0830333fdc74a"]]},{"id":"6cd0830333fdc74a","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SetDataPrev","func":"flow.set(\"DataPrev\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1340,"wires":[[]]},{"id":"59d6c96b521474f6","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"ShowDataPrev","func":"msg.payload = flow.get(\"DataPrev\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1300,"wires":[["8f5d98d97c897391"]]},{"id":"131ce50ffc32c2f6","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1300,"wires":[["59d6c96b521474f6"]]},{"id":"884ab70982d8c52f","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Alldata","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/insert/insertalldata\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1460,"wires":[["b224de5a911b1a13","5ccaca3281be99f6"]]},{"id":"36002db1fb7e54de","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","func":"var d = msg.payload[0][0];\nvar name = msg.payload[1][0].Name;\nvar diss = msg.payload[2][0].DISTANCE_POL_POD;\nvar spd = flow.get(\"SPEEDMBP3222KM\");\nvar timeleft = Math.round((diss/spd)*3600*1000);\nif(timeleft > 172800){\n    timeleft = 172800000;\n}\nvar ifx = msg.influxx;\nmsg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":d.POLPOD.split('-')[0],\n    \"ARRIVAL\":d.POLPOD.split('-')[1],\n    \"CURRENTT\":d.Current_Location,\n    \"NEXTT\":d.Next_Location,\n    \"LASTRECORDDATE\":d.Date,\n    \"LASTRECEIVEDATE\":d.Date,\n    \"LATITUDE\":d.GPS.split(',')[0],\n    \"LONGITUDE\":d.GPS.split(',')[1],\n    \"NAMEE\":d.Ship_Name,\n    \"ROB\":ifx.ROB,\n    \"RPMENGINE\":ifunderten(parseInt(String(ifx.RPMENGINE))),\n    \"RPMPROPELLER\":ifunderten(parseInt(String(ifx.RPMPROPELLER))),\n    \"WINDSPEED\":Math.round(parseFloat(String(ifx.WINDSPEED))/100),\n    \"SPEEDCOURSE\":flow.get(\"SPEEDMBP3222\"),\n    \"BARGE\":d.Barge,\n    \"DESTINATION\":name.split('-')[1],\n    \"FROMM\":name.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"datprevA1\").ROBprev),\n    \"TD\":String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"ETA\":String(epotostr((flow.get(\"datprevA1\").epochprev/1000000)+timeleft)).substring(0,String(epotostr(flow.get(\"datprevA1\").epochprev/1000000)).length-34),\n    \"RPMAVR\":ifx.rpmavr,\n    \"TARGET_FO\":msg.TARGET_FO\n}\nfunction ifunderten(x){\n    if(x<10){\n        return '0';\n    }else{\n        return String(x);\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1260,"wires":[[]]},{"id":"b224de5a911b1a13","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" PopUpp","func":"msg.method = \"POST\";\nmsg.url = \"https://apex.oracle.com/pls/apex/iot-elkafi/update/updatepopup\";\nmsg.headers = {};\nmsg.headers[\"Content-Type\"] = \"application/json\";\nmsg.payload = {\n    \"DEPARTURE\":msg.alldata.DEPARTURE,\n    \"ARRIVAL\":msg.alldata.ARRIVAL,\n    \"CURRENTT\":msg.alldata.CURRENTT,\n    \"NEXTT\":msg.alldata.NEXTT,\n    \"LASTRECORDDATE\":msg.alldata.RECORDDATA,\n    \"LASTRECEIVEDATE\":formatdate(Date.now()),\n    \"LATITUDE\":parseFloat(String(msg.alldata.LAT)),\n    \"LONGITUDE\":parseFloat(String(msg.alldata.LON)),\n    \"NAMEE\":\"TULUS\",\n    \"ROB\":msg.ROB,\n    \"RPMENGINE_P\":msg.alldata.RPMENGINE_P,\n    \"RPMENGINE_S\":msg.alldata.RPMENGINE_S,\n    \"RPMPROPELLER_P\":msg.alldata.RPMPROP_P,\n    \"RPMPROPELLER_S\":msg.alldata.RPMPROP_S,\n    \"WINDSPEED\":msg.alldata.WINDSPEED,\n    \"SPEEDCOURSE\":msg.alldata.SPEEDCOURSE,\n    \"BARGE\":msg.imov.BARGE,\n    \"DESTINATION\":msg.deparv.split('-')[1],\n    \"FROMM\":msg.deparv.split('-')[0],\n    \"ROBONSTART\":String(flow.get(\"ONSTART\").ROB),\n    \"TD\":TDDD(),\n    \"ETA\":ETAAA(),\n    \"RPMAVR\":Math.round((parseInt(String(msg.alldata.RPMENGINE_P))+parseInt(String(msg.alldata.RPMENGINE_S)))/2),\n    \"TARGET_FO\":parseFloat(String(msg.imov.fo_target))\n}\nmsg.popupp = msg.payload;\nmsg.measurement = \"popup\";\nflow.set(\"POPUPTULUS\",msg.payload);\nreturn msg;\nfunction ETAAA(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time + ((msg.imov.TARGET_POL_POD)*(3600*1000))));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time + ((msg.imov.TARGET_POD_POL)*(3600*1000))));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction TDDD(){\n    try{\n        var alur = flow.get(\"Alur\");\n        if(alur == \"Start\" || alur == \"ToPoD\"){\n            var start = flow.get(\"ONSTART\");\n            var datee = String(epotostr(start.time));\n            if(datee.substring(0,String(datee).length-34) == \"\"){\n                return \".\";\n            }\n            return datee.substring(0,String(datee).length-34);\n        }else if(alur == \"End\" || alur == \"ToPoL\"){\n            var end = flow.get(\"POD\");\n            var dateee = String(epotostr(end.time));\n            if(dateee.substring(0,String(dateee).length-34) == \"\"){\n                return \".\";\n            }\n            return dateee.substring(0,String(dateee).length-34);\n        }else{\n            return \".\";\n        }\n    }catch(x){\n        return \".\";\n    }\n}\nfunction epotostr(x){\n    var dt = new Date(x);\n    return dt\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":1460,"wires":[["39936c7f103dbe8f","b3babaaf34e2276a","263385f6a8b265ae","d23cd2f7547da22a","ecdcbaf43473e447"]]},{"id":"9f088a99d6ea494b","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1260,"wires":[["8bd81a37ce146d75"]]},{"id":"8bd81a37ce146d75","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SetONSTART","func":"flow.set(\"ONSTART\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1260,"wires":[[]]},{"id":"623f4065a5179ef3","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"ShowONSTART","func":"msg.payload = flow.get(\"ONSTART\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1220,"wires":[["65cd7badba3b8e14"]]},{"id":"c04a92c8465565ea","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1220,"wires":[["623f4065a5179ef3"]]},{"id":"6f43c47144392d2c","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":410,"y":1180,"wires":[["2c547a63ea734cb3"]]},{"id":"2c547a63ea734cb3","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SetAlur","func":"flow.set(\"Alur\",\"\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":1180,"wires":[[]]},{"id":"418423e13de673e7","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"ShowAlur","func":"msg.payload = flow.get(\"Alur\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":1140,"wires":[["e13d75f063fd7967"]]},{"id":"73dc6f068cf0709f","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":1140,"wires":[["418423e13de673e7"]]},{"id":"39936c7f103dbe8f","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" Cek Payload 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":760,"y":1460,"wires":[]},{"id":"79c67d017cf2a3fd","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":1140,"wires":[["fc519290ab646f17"]]},{"id":"dab8fb8563771c2d","type":"inject","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":930,"y":1180,"wires":[["b6dae04d96413171"]]},{"id":"fc519290ab646f17","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"ShowPOD","func":"msg.payload = flow.get(\"POD\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":1140,"wires":[["8cf2927c2c04b028"]]},{"id":"b6dae04d96413171","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SetPOD","func":"flow.set(\"POD\",{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1180,"wires":[[]]},{"id":"b3babaaf34e2276a","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"SaveGPS","func":"var json = {\n    \"time\":msg.Valid.time,\n    \"Alur\":flow.get(\"Alur\"),\n    \"GPS\":String(msg.Valid.lat)+\",\"+String(msg.Valid.lon)\n}\nmsg.payload = json;\nmsg.measurement = \"PO\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1540,"wires":[["f8f4fa3c47ac7615"]]},{"id":"f8f4fa3c47ac7615","type":"influxdb out","z":"323faf53d384df59","g":"9cdee6d271f686a5","influxdb":"76f4cea2.88ada","name":"PO","measurement":"POTULUS","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":930,"y":1540,"wires":[]},{"id":"7e568acdc7614f94","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"RESETALL","links":["ecd733b7.272f2"],"x":435,"y":1180,"wires":[["2c547a63ea734cb3"]]},{"id":"3df37d353c58e5aa","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"RESETALL","links":["ecd733b7.272f2"],"x":435,"y":1260,"wires":[["8bd81a37ce146d75"]]},{"id":"101f99c61f6abb8e","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"RESETALL","links":["ecd733b7.272f2"],"x":435,"y":1340,"wires":[["6cd0830333fdc74a"]]},{"id":"054ca2d130345187","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"RESETALL","links":["ecd733b7.272f2"],"x":955,"y":1180,"wires":[["b6dae04d96413171"]]},{"id":"9ded4b1df3bd8142","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Msg.Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1200,"y":1260,"wires":[]},{"id":"c14f50878b420f95","type":"link in","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["8cf2927c2c04b028","e13d75f063fd7967","65cd7badba3b8e14","8f5d98d97c897391"],"x":1075,"y":1260,"wires":[["9ded4b1df3bd8142"]]},{"id":"8cf2927c2c04b028","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["c14f50878b420f95"],"x":1215,"y":1140,"wires":[]},{"id":"e13d75f063fd7967","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["c14f50878b420f95"],"x":635,"y":1140,"wires":[]},{"id":"65cd7badba3b8e14","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["c14f50878b420f95"],"x":675,"y":1220,"wires":[]},{"id":"8f5d98d97c897391","type":"link out","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","links":["c14f50878b420f95"],"x":675,"y":1300,"wires":[]},{"id":"263385f6a8b265ae","type":"trigger","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":950,"y":1460,"wires":[["332d5932c1cdc9df"],["c4ceba969a728ef2"]]},{"id":"332d5932c1cdc9df","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"From","func":"flow.set(\"REPORTPOPUP1\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1420,"wires":[[]]},{"id":"c4ceba969a728ef2","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"To","func":"flow.set(\"REPORTPOPUP2\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1500,"wires":[[]]},{"id":"d23cd2f7547da22a","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.alldata.EPO;\nmsg.measurement = \"PopupTulus\"\n\nmsg.topic = \"\";\n\nmsg.topic = \"INSERT INTO `POPUP`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"BARGE\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"DESTINATION\"+\"`,\";\nmsg.topic += \"`\"+\"ETA\"+\"`,\";\nmsg.topic += \"`\"+\"FROMM\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECEIVEDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LASTRECORDDATE\"+\"`,\";\nmsg.topic += \"`\"+\"LATITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"LONGITUDE\"+\"`,\";\nmsg.topic += \"`\"+\"NAMEE\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"ROBONSTART\"+\"`,\";\nmsg.topic += \"`\"+\"RPMAVR\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROPELLER_S\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"TARGET_FO\"+\"`,\";\nmsg.topic += \"`\"+\"TD\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\n\n\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.BARGE)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += \"'\"+String(d.DESTINATION)+\"',\";\nmsg.topic += \"'\"+String(d.ETA)+\"',\";\nmsg.topic += \"'\"+String(d.FROMM)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECEIVEDATE)+\"',\";\nmsg.topic += \"'\"+String(d.LASTRECORDDATE)+\"',\";\nmsg.topic += String(d.LATITUDE)+\",\";\nmsg.topic += String(d.LONGITUDE)+\",\";\nmsg.topic += \"'\"+String(d.NAMEE)+\"',\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += \"'\"+String(d.ROBONSTART)+\"',\";\nmsg.topic += String(d.RPMAVR)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROPELLER_P)+\",\";\nmsg.topic += String(d.RPMPROPELLER_S)+\",\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.TARGET_FO)+\",\";\nmsg.topic += \"'\"+String(d.TD)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":1580,"wires":[["930196acb8f0b037","e00953cc91b59ce9","511ed55cf299090e"]]},{"id":"930196acb8f0b037","type":"influxdb out","z":"323faf53d384df59","g":"9cdee6d271f686a5","influxdb":"76f4cea2.88ada","name":"Popupp","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":960,"y":1620,"wires":[]},{"id":"d261488056749650","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":1580,"wires":[]},{"id":"c8f33989e6fcc5b1","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":590,"y":1620,"wires":[["1786bcf2046fb859"]]},{"id":"1786bcf2046fb859","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":730,"y":1620,"wires":[]},{"id":"e00953cc91b59ce9","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":930,"y":1660,"wires":[["95cdb6500f6d586f"]]},{"id":"95cdb6500f6d586f","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1090,"y":1660,"wires":[]},{"id":"8e9dbce068ead96e","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.CurrentGeo","targetType":"msg","statusVal":"payloadCurrentGeo","statusType":"auto","x":790,"y":1340,"wires":[]},{"id":"511ed55cf299090e","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Fuel","func":"var d= msg.GrafanaTulus;\nvar json = {\n    \"EPO\":parseInt(String(msg.data.Time)),\n    \"DATEE\":String(msg.alldata.RECORDDATA),\n    \"STORAGE1\":parseInt(String(d.Kanan)),\n    \"STORAGE2\":parseInt(String(d.Kiri)),\n    \"STORAGE3\":parseInt(String(d.Center)),\n    \"STORAGE4\":parseInt(String(\"0\")),\n    \"STORAGE5\":parseInt(String(\"0\")),\n    \"DAILY1\":parseInt(String(d.DailyKanan)),\n    \"DAILY2\":parseInt(String(d.DailyKiri)),\n    \"DAILY3\":parseInt(String(\"0\")),\n    \"DAILY4\":parseInt(String(\"0\")),\n    \"DAILY5\":parseInt(String(\"0\"))\n}\nmsg.topic = \"INSERT INTO `FuelData`(`EPO`,`DATEE`,`SHIPNAME`,`STORAGE1`,`STORAGE2`,`STORAGE3`,`STORAGE4`,`STORAGE5`,`DAILY1`,`DAILY2`,`DAILY3`,`DAILY4`,`DAILY5`)\";\nmsg.topic += \"VALUES(\"+\"'\"+String(json.EPO)+\"',\"+\"'\"+String(json.DATEE)+\"','TULUS',\"+\"'\"+String(json.STORAGE1)+\"',\"+\"'\"+String(json.STORAGE2)+\"',\"+\"'\"+String(json.STORAGE3)+\"',\"+\"'\"+String(json.STORAGE4)+\"',\"+\"'\"+String(json.STORAGE5)+\"',\"+\"'\"+String(json.DAILY1)+\"',\"+\"'\"+String(json.DAILY2)+\"',\"+\"'\"+String(json.DAILY3)+\"',\"+\"'\"+String(json.DAILY4)+\"',\"+\"'\"+String(json.DAILY5)+\"');\";\n\n// INSERT INTO FUEL_VMS(EPO,DATEE,STORAGE1,STORAGE2,STORAGE3,STORAGE4,STORAGE5,DAILY1,DAILY2,DAILY3,DAILY4,DAILY5) \n// VALUES(:EPO,:DATEE,:STORAGE1,:STORAGE2,:STORAGE3,:STORAGE4,:STORAGE5,:DAILY1,:DAILY2,:DAILY3,:DAILY4,:DAILY5)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1090,"y":1580,"wires":[["ebe9360d0cd1a93d"]]},{"id":"ebe9360d0cd1a93d","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":1230,"y":1580,"wires":[["873afc755c864a1d"]]},{"id":"873afc755c864a1d","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1390,"y":1580,"wires":[]},{"id":"178e542f2bf15939","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"asdvms","x":900,"y":1380,"wires":[[]]},{"id":"270eaa62b1b16110","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Cek Payload 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":220,"y":1540,"wires":[]},{"id":"ecdcbaf43473e447","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"VMSDATA","func":"if(flow.get(\"prevday\") != msg.alldata.RECORDDATA.split(\"/\")[0]){\n    flow.set(\"HalfHour\",undefined);\n}\nif(flow.get(\"HalfHour\")==undefined){\n    InsertData(\"VMSDATA\");\n    flow.set(\"HalfHour\",msg.data.Time);\n}else{\n    if((msg.data.Time-flow.get(\"HalfHour\"))>1800000){\n        InsertData(\"VMSDATA\");\n        flow.set(\"HalfHour\",msg.data.Time);\n    }else{\n        InsertData(\"VMSDATA_RECORD\");\n    }\n}\nflow.set(\"prevday\",msg.alldata.RECORDDATA.split(\"/\")[0]);\nreturn msg;\n\nfunction InsertData(table){\n    var alldata = msg.alldata;\n    var popupp = msg.popupp;\n    msg.topic = \"\"\n    var column = ['EPO', 'SHIP_NAME', 'BARGE', 'DEPARTURE', 'ARRIVAL', 'CURRENTT', 'NEXTT', 'TD', 'ETA', 'LASTRECORDDATE', 'LASTRECEIVEDATE', 'LATITUDE', 'LONGITUDE', 'FROMM', 'DESTINATION', 'STATUS', 'ANGLE', 'ROB', 'ROBONSTART', 'ESTROB', 'FUELCONS', 'ST', 'RPMENGINE_S', 'RPMENGINE_P', 'RPMAVR', 'RPMPROPELLER_S', 'RPMPROPELLER_P', 'WINDSPEED', 'SPEED', 'TARGET_FO'];\n    msg.topic += \"INSERT INTO `\"+String(table)+\"`(\"; // VMSDATA\n    for(i=0;i<column.length;i++){\n        msg.topic+=\"`\";\n        msg.topic+=column[i];\n        msg.topic+=\"`\";\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \") VALUES (\";\n    for(i=0;i<column.length;i++){\n        var res = \"\"\n        var fromdata = {}\n        if(alldata.hasOwnProperty(column[i])){\n            fromdata = alldata;\n        }else if(popupp.hasOwnProperty(column[i])){\n            fromdata = popupp;\n        }\n        if(column[i]==\"ANGLE\"){\n            res = parseFloat(String(msg.data.Angle));\n        }else if(column[i]==\"STATUS\"){\n            var stat = Date.now()-msg.data.Time;\n            if(stat > 432000000){ // five days\n                res = \"2\";\n            }else if(stat > 172800000){ // 2 days\n                res = \"1\";\n            }else{  // online\n                res = \"0\";\n            }\n        }else if(column[i]==\"ST\"){\n            res = secondsToDhms((Date.now()-flow.get(\"ONSTART\").time)/1000);\n            if(res==\"\"){\n                res = \"_\";\n            }\n        }else if(column[i]==\"SPEED\"){\n            res = String(msg.speed);\n        }else if(column[i]==\"ESTROB\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(popupp.TARGET_FO)));\n        }else if(column[i]==\"FUELCONS\"){\n            res = String(parseInt(String(flow.get(\"ONSTART\").ROB))-parseInt(String(msg.ROB)));\n        }else if(column[i]==\"EPO\" || column[i]==\"LATITUDE\" || column[i]==\"LONGITUDE\"){\n            res = fromdata[column[i]];    \n        }else{\n            res = String(fromdata[column[i]]);    \n        }\n        \n        if (typeof res === 'string' || res instanceof String){\n            msg.topic+=\"'\"+res+\"'\";\n        }else{\n            msg.topic+=String(res);\n        }\n        if(i<(column.length-1)){\n            msg.topic += \",\";\n        }\n    }\n    msg.topic += \");\"\n}\n\nfunction secondsToDhms(seconds) {\n    seconds = Number(seconds);\n    var d = Math.floor(seconds / (3600 * 24));\n    var h = Math.floor(seconds % (3600 * 24) / 3600);\n    var m = Math.floor(seconds % 3600 / 60);\n    var s = Math.floor(seconds % 60);\n\n    var dDisplay = d > 0 ? d + (d == 1 ? \" day. \" : \" days. \") : \"\";\n    var hDisplay = h > 0 ? h + (h == 1 ? \" hour. \" : \" hours. \") : \"\";\n    var mDisplay = m > 0 ? m + (m == 1 ? \" minute\" : \" minutes\") : \"\";\n    return dDisplay + hDisplay + mDisplay ;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":1460,"wires":[["4ac24b2c88477a10","0a191d2043f369fd"]]},{"id":"0a191d2043f369fd","type":"mysql","z":"323faf53d384df59","g":"9cdee6d271f686a5","mydb":"be353e7e.73b9d","name":"","x":1450,"y":1460,"wires":[["d59fdc9b01f65bbb","f809acdf500add27"]]},{"id":"4ac24b2c88477a10","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":1580,"y":1520,"wires":[]},{"id":"f809acdf500add27","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1590,"y":1460,"wires":[]},{"id":"d59fdc9b01f65bbb","type":"trigger","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":" ","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1590,"y":1400,"wires":[[]]},{"id":"d6d3622355de9dd1","type":"link in","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"","links":["33be50e2ed9829ff"],"x":135,"y":720,"wires":[["733accd290919ef4","c8a86fbfcd859d42"]]},{"id":"c8a86fbfcd859d42","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" Moving Average","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\nvar shipId = '';\n//var calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar json = {\n    \"Time\":d.time,\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(d.Heading),\n    \"WS\":detectInt(d.ws),\n    \"F1\":MA(d.ST2_Center_Front,1),\n    \"F2\":MA(d.ST2_Center_Back,2),\n    \"F3\":MA(d.ST2_Stbd,3),\n    \"F4\":MA(d.ST2_Port,4),\n    \"F5\":MA(d.DT_Stbd,5),\n    \"F6\":MA(d.DT_Port,6),\n    \"R1\":parseFloat(d.RPM_ENG_Stbd),\n    \"R2\":parseFloat(d.RPM_ENG_Port),\n    \"Speed\":MA(d.Speed_Knot,11)\n}\n/*\njson['StorageCenter'] = Center(json.F5,json.F6);\njson['StorageKanan'] = Kanan(json.F4);\njson['StorageKiri'] = Kiri(json.F3);\njson['DailyKanan'] = DailyKanan(json.F2);\njson['DailyKiri'] = DailyKiri(json.F1);\n*/\n\njson['StorageCenter'] = RoundCm(json.F1);\njson['StorageKanan'] = RoundCm(json.F3);\njson['StorageKiri'] = RoundCm(json.F4);\njson['DailyKanan'] = RoundCm(json.F5);\njson['DailyKiri'] = RoundCm(json.F6);\n\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nmsg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = '2M' and ship = '100000016' and Trim = 0.0 and `Sounding` = \"+String(json.StorageCenter)+\";\";\nmsg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = '2P' and ship = '100000016' and Trim = 0.0 and `Sounding` = \"+String(json.StorageKanan)+\";\";\nmsg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = '2S' and ship = '100000016' and Trim = 0.0 and `Sounding` = \"+String(json.StorageKiri)+\";\";\nmsg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = 'DP' and ship = '100000016' and Trim = 0.0 and `Sounding` = \"+String(json.DailyKanan)+\";\";\nmsg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = 'DS' and ship = '100000016' and Trim = 0.0 and `Sounding` = \"+String(json.DailyKiri)+\";\";\nreturn msg;\n\nfunction detectInt(x){\n    try{\n        return parseInt(x);\n    }catch(s){\n        return 0;\n    }\n}\n\nfunction avr(n){\n    var rs = 0;\n    for(i=0;i<n.length;i++){\n        rs+=n[i];\n    }\n    rs = Math.round(rs/n.length);\n    return rs;\n}\n\nfunction MA(a,b){\n    var n = flow.get(\"avr\"+String(b));\n    if(a != \"-1\"){\n        if(b<7){\n            a = parseInt(String(a)); // 800-4000 -> 400-2000\n        }else if(b>=7){\n            a = parseInt(String(a));\n        }\n        if(a % 1 === 0){\n            n.push(a);\n        }\n        if(n.length>10){\n            n.shift();\n        }\n        flow.set(\"avr\"+String(b),n);\n    }\n    if(b<7){\n        if(avr(n)<=0){\n            return 0;\n        }else{\n            return avr(n);\n        }\n    }else{\n        return avr(n);\n    }\n}\n\nfunction RoundCm(x){\n    var res = Math.round(x);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\n\n/*\nfunction Center(x,y){\n    return Math.round((x * 0.07552776477236758)+(y * 0.11475764688716274)+(-63.50832099981113));\n}\n\nfunction Kanan(x){\n    var res = Math.round((0.1871*x) - 76.976);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction Kiri(x){\n    var res = Math.round((0.1913*x) - 70.627);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction DailyKiri(x){\n    var res = Math.round((0.0654*x) - 17.169);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\nfunction DailyKanan(x){\n    var res = Math.round((0.0625*x) - 14.85);\n    if(res<1){\n        res = 0;\n    }\n    return res;\n}\n*/\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":720,"wires":[["dec94fd168715d6b","5802c609cdcf27de","724923f2e6e7053e"]]},{"id":"572c66bbe49e89f0","type":"comment","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"StoretoDatabase","info":"","x":200,"y":680,"wires":[]},{"id":"36e8ffd561d03a57","type":"inject","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":370,"y":680,"wires":[["2f15cb6faca3414d"]]},{"id":"2f15cb6faca3414d","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"SetAvr","func":"for(i=1;i<=11;i++){\n    flow.set(\"avr\"+String(i),[]);\n}\nfor(i=1;i<=10;i++){\n    flow.set(\"val\"+String(i),0);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":680,"wires":[[]]},{"id":"edd02c8aa9a8c267","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"Show Avr","func":"var arr = [];\nfor(i=1;i<=11;i++){\n    arr.push(flow.get(\"avr\"+String(i)));\n}\nvar arr2 = [];\nfor(i=1;i<=10;i++){\n    arr2.push(flow.get(\"val\"+String(i)));\n}\nmsg.payload = [arr,arr2];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":640,"wires":[["0fdc05585074589a"]]},{"id":"ed5a089213647a59","type":"inject","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":370,"y":640,"wires":[["edd02c8aa9a8c267"]]},{"id":"0fdc05585074589a","type":"debug","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":630,"y":640,"wires":[]},{"id":"d11afd4c3c08a414","type":"debug","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" CreateJson","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":800,"wires":[]},{"id":"dec94fd168715d6b","type":"mysql","z":"323faf53d384df59","g":"c6157749cd57c3a9","mydb":"be353e7e.73b9d","name":"","x":430,"y":720,"wires":[["581d848c94dc5516"]]},{"id":"581d848c94dc5516","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"CreateJson","func":"var d = msg.payload;\nvar json = {\n    \"time\":tonanosec(msg.data.Time),//1000\n    \"Center\":d[0][0].Volume,\n    \"Kanan\":d[1][0].Volume,\n    \"Kiri\":d[2][0].Volume,\n    \"DailyKanan\":d[3][0].Volume,\n    \"DailyKiri\":d[4][0].Volume,\n    \"R1\":parseInt(String(msg.data.R1)),\n    \"R2\":parseInt(String(msg.data.R2)),\n    \"ROB\":ROB(d),\n    \"CmCenter\":msg.data.StorageCenter,\n    \"CmKanan\":msg.data.StorageKanan,\n    \"CmKiri\":msg.data.StorageKiri,\n    \"CmDailyKanan\":msg.data.DailyKanan,\n    \"CmDailyKiri\":msg.data.DailyKiri,\n    \"ws\":msg.data.WS\n}\n\nmsg.GrafanaTulus = json;\nmsg.ROB = json.ROB;\nmsg.payload = json;\nreturn msg;\nfunction ROB(x){\n    var res = 0;\n    res += d[0][0].Volume; //Center\n    res += d[1][0].Volume; //Kanan\n    res += d[2][0].Volume; //Kiri\n    res += d[3][0].Volume; //Daily Kanan\n    res += d[4][0].Volume; //Daily Kiri\n    // for(i=0;i<x.length;i++){\n    //     if(i==0||i==5){\n    //         continue;\n    //     }\n    //     res+=x[i][0].Liter;\n    // }\n    return res;\n}\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}\n// function convertrpm( value ) { \n//     var r1 = [0,3000];\n//     var r2 = [0,1500];\n//     return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n// }\n\n\nfunction RPMKANAN(x){\n    var res = (0.6*x) - 340.66;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction RPMKIRI(x){\n    var res = (0.6335*x) - 436.26;\n    if(res<1){\n        res = 0;\n    }else if(res<70){\n        res = 0;\n    }\n    return parseFloat(res.toFixed(2));\n}\n\nfunction convertws(x) {\n    var val = parseInt(String(x));\n    var r1 = [0, 5000];\n    var r2 = [0, 30];\n    var sp = (val - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n    var res = parseFloat((sp * 1.94384).toFixed(2));\n    return res;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":720,"wires":[["d11afd4c3c08a414","36490f137680ac35","b2a61155964adfca","b31ab7ee0cf4bb5b","74a62164c8b1c8c5"]]},{"id":"74a62164c8b1c8c5","type":"link out","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"Data Out to Apex","links":["667eb3e926e602aa"],"x":695,"y":860,"wires":[]},{"id":"36490f137680ac35","type":"influxdb out","z":"323faf53d384df59","g":"c6157749cd57c3a9","influxdb":"76f4cea2.88ada","name":"Grafana","measurement":"GrafanaTULUS","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":760,"y":760,"wires":[]},{"id":"5d4228b6b433bcee","type":"influxdb out","z":"323faf53d384df59","g":"c6157749cd57c3a9","influxdb":"76f4cea2.88ada","name":"GrafanaMA","measurement":"GrafanaMATULUS","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":590,"y":760,"wires":[]},{"id":"d735bbd1202a34a0","type":"influxdb out","z":"323faf53d384df59","g":"c6157749cd57c3a9","influxdb":"76f4cea2.88ada","name":"GrafanaRaw","measurement":"GrafanaRawTULUS","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":430,"y":800,"wires":[]},{"id":"733accd290919ef4","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" StoreRaw","func":"msg.Valid = msg.payload;\nvar d = msg.Valid;\n//var calitable = [\"`FS001Ags`\",\"`FS002Ags`\",\"`FS003Ags`\",\"`FS004Ags`\",\"`FS005Ags`\",\"`FS006Ags`\"];\nvar tanktype = [\"`2M`\",\"`2M`\",\"`2S`\",\"`2P`\",\"`DS`\",\"`DP`\"];\nvar json = {\n    \"time\":tonanosec(d.time),\n    \"Lat\":parseFloat(d.lat),\n    \"Lon\":parseFloat(d.lon),\n    \"Angle\":parseFloat(d.Heading),\n    \"F1\":parseInt(String(d.ST2_Center_Front)),\n    \"F2\":parseInt(String(d.ST2_Center_Back)),\n    \"F3\":parseInt(String(d.ST2_Stbd)),\n    \"F4\":parseInt(String(d.ST2_Port)),\n    \"F5\":parseInt(String(d.DT_Stbd)),\n    \"F6\":parseInt(String(d.DT_Port)),\n    \"R1\":parseInt(String(d.RPM_ENG_Stbd)),\n    \"R2\":parseInt(String(d.RPM_ENG_Port)),\n    //--------------------\n    // \"F1\":pars(d.FS111,1),\n    // \"F2\":pars(d.FS113,2),\n    // \"F3\":pars(d.FS114,3),\n    // \"F4\":pars(d.FS115,4),\n    // \"F5\":pars(d.FS116,5),\n    // \"F6\":pars(d.FS117,6),\n    // \"R1\":pars(d.RPM113,7),\n    // \"R2\":pars(d.RPM114,8),\n    \"Speed\":parseFloat(d.Speed_Knot)\n}\nmsg.data = json;\nmsg.payload = json;\nmsg.topic = \"\";\nfor(i=0;i<6;i++){\n    msg.topic += \"SELECT `Volume` FROM `bmstanktable` where Type = '\"+tanktype[i]+\"' and ship = '100000016' and Trim = 0.0 and `Value` = \"+String(Math.round(json['F'+String(i+1)]))+\";\";\n}\nreturn msg;\nfunction pars(x,y){\n    if(x == \"-1\"){\n        return flow.get(\"val\"+String(y));\n    }else{\n        var a = parseInt(x);\n        if(y<=6 && a<400){\n            a = 400;\n        }\n        flow.set(\"val\"+String(y),a);\n        return a;\n    }\n}\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":800,"wires":[["d735bbd1202a34a0"]]},{"id":"5802c609cdcf27de","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" Store MA","func":"var a = msg.payload;\nvar t = a.Time;\na['time'] = tonanosec(t);\nmsg.payload = a\nreturn msg;\n\nfunction tonanosec(x){\n    x = String(x);\n    while(x.length<19){\n        x += \"0\";\n    }\n    return parseInt(x);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":760,"wires":[["5d4228b6b433bcee"]]},{"id":"3d62f4ede8c3f936","type":"link in","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"RESETALL","links":["ecd733b7.272f2"],"x":395,"y":680,"wires":[["2f15cb6faca3414d"]]},{"id":"b2a61155964adfca","type":"debug","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" ROB","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.ROB","targetType":"msg","statusVal":"payload.ROB","statusType":"auto","x":800,"y":660,"wires":[]},{"id":"b31ab7ee0cf4bb5b","type":"function","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"Time","func":"msg.payload= new Date()+(3600*8);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":720,"wires":[["c55a967f19013096"]]},{"id":"c55a967f19013096","type":"debug","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":" ","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":950,"y":700,"wires":[]},{"id":"33be50e2ed9829ff","type":"link out","z":"323faf53d384df59","name":"","links":["d6d3622355de9dd1"],"x":735,"y":560,"wires":[]},{"id":"54fcbff1ec39d626","type":"inject","z":"323faf53d384df59","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"time\":1710733548259,\"Lat\":\"-7.705261\",\"Lon\":\"113.614372\",\"WS\":\"3,250.73,0.31\",\"Angle\":\"0\",\"Speed\":\"0\",\"FS102\":\"950\",\"FS113\":\"990\",\"FS114\":\"1127\",\"FS106\":\"1132\",\"FS116\":\"733\",\"FS117\":\"1024\",\"RPM113\":\"2545\",\"RPM114\":\"2665\"}","payloadType":"json","x":150,"y":500,"wires":[[]]},{"id":"fe6576f020202bf9","type":"function","z":"323faf53d384df59","name":"Convert","func":"var data = msg.payload;\nvar data1 = {\n    \"time\" : data.time*1000,\n    \"lat\": data.Latitude,\n    \"lon\": data.Longitude,\n    \"incTemperature\": data.incTemperature,\n    \"IncX\": data.IncX,\n    \"IncY\": data.IncY,\n    \"IncZ\": data.IncZ,\n    \"terminalTime\": data.terminalTime,\n    \"serverEpochTime\": data.serverEpochTime,\n    \"serverTime\": data.serverTime,\n    \"Wind_Direction\": data.Wind_Direction,\n    \"ws\": data.Wind_Speed,\n    \"DT_Port\": data.DT_Port,\n    \"DT_Stbd\": data.DT_Stbd,\n    \"ST2_Center_Front\": data.ST2_Center_Front,\n    \"ST2_Center_Back\": data.ST2_Center_Back,\n    \"ST2_Port\": data.ST2_Port,\n    \"ST2_Stbd\": data.ST2_Stbd,\n    \"Speed_Kmph\": data.Speed_Kmph,\n    \"Heading\": data.Heading,\n    \"RPM_ENG_Port\": data.RPM_ENG_Port,\n    \"RPM_ENG_Stbd\": data.RPM_ENG_Stbd,\n    \"RPM_ENG_Port_Raw\": data.RPM_ENG_Port_Raw,\n    \"RPM_ENG_Stbd_Raw\": data.RPM_ENG_Stbd_Raw,\n    \"Speed_Knot\": data.Speed_Knot\n};\n\nmsg.payload = data1;\nmsg.countt = msg.topic;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":560,"wires":[["33be50e2ed9829ff"]]},{"id":"299b822059bc5661","type":"change","z":"323faf53d384df59","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"\t    {\t    \"time\" : payload._terminalEpochTime,\t    \"incTemperature\": payload.IncTemparature,\t    \"IncX\": payload.IncX,\t    \"IncY\": payload.IncY,\t    \"IncZ\": payload.IncZ,\t    \"terminalTime\": payload._terminalTime,\t    \"serverEpochTime\": $toMillis($now()),\t    \"serverTime\": $now(),\t    \"Wind_Direction\": payload.Wind_Direction,\t    \"Wind_Speed\": payload.Wind_Speed,\t    \"DT_Port\": payload.DT_Port,\t    \"ST2_Center_Front\": payload.ST2_Center_Front,\t    \"ST2_Port\": payload.ST2_Port,\t    \"DT_Stbd\": payload.DT_Stbd,\t    \"ST2_Center_Back\": payload.ST2_Center_Back,\t    \"ST2_Stbd\": payload.ST2_Stbd,\t    \"Latitude\": payload.Latitude,\t    \"Longitude\": payload.Longitude,\t    \"Speed_Kmph\": payload.SpeedKmph,\t    \"Heading\": payload.Heading,\t    \"RPM_ENG_Port\": payload.RPM_ENG_PORT,\t    \"RPM_ENG_Stbd\": payload.RPM_ENG_STBD,\t    \"RPM_ENG_Port_Raw\": payload.RPM_ENG_Port_Raw,\t    \"RPM_ENG_Stbd_Raw\": payload.RPM_ENG_Stbd_Raw,\t    \"Speed_Knot\": payload.Speed_Knot\t\t\t    }\t\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":560,"wires":[["fe6576f020202bf9"]]},{"id":"400a7a38e97b7d11","type":"inject","z":"323faf53d384df59","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"_terminalEpochTime\":\"1696115134585\",\"_terminalTime\":\"2024-01-26 15:50:25.698\",\"_groupName\":\"adaro\",\"IncTemparature\":\"34.74\",\"IncX\":\"-0.28\",\"IncY\":\"-0.28\",\"IncZ\":\"89.90\",\"Wind_Direction\":\"353\",\"Wind_Speed\":\"3.27\",\"DT_Port\":\"0.792\",\"ST2_Center_Front\":\"3.013\",\"ST2_Port\":\"2.163\",\"DT_Stbd\":\"0.74\",\"ST2_Center_Back\":\"-0.01\",\"ST2_Stbd\":\"2.12\",\"Latitude\":\"-3.337574\",\"Longitude\":\"114.544913\",\"SpeedKmph\":\"0.0000\",\"Heading\":\"-179.871\",\"RPM_ENG_PORT\":\"2\",\"RPM_ENG_STBD\":\"5\",\"RPM_ENG_Port_Raw\":\"7\",\"RPM_ENG_Stbd_Raw\":\"6\",\"Speed_Knot\":\"99\"}","payloadType":"json","x":150,"y":560,"wires":[["299b822059bc5661"]]},{"id":"481987f45fb83427","type":"inject","z":"80eab637.b91808","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"query","v":"select * from fuelLevel4 order by time desc limit 1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":450,"y":2640,"wires":[["e01c3e2d985d6cfd"]]},{"id":"e01c3e2d985d6cfd","type":"influxdb in","z":"80eab637.b91808","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"","retentionPolicy":"","org":"organisation","x":660,"y":2640,"wires":[["f816a895381a34b0"]]},{"id":"f816a895381a34b0","type":"debug","z":"80eab637.b91808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":980,"y":2640,"wires":[]},{"id":"3c779c3ec41c46a6","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"cek Payload","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"Valid","targetType":"msg","statusVal":"","statusType":"auto","x":210,"y":1200,"wires":[]},{"id":"724923f2e6e7053e","type":"debug","z":"323faf53d384df59","g":"c6157749cd57c3a9","name":"MovingAverage","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":860,"wires":[]},{"id":"c23c79bfe2e5cbcf","type":"inject","z":"323faf53d384df59","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3780","crontab":"","once":true,"onceDelay":0.1,"topic":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","payload":"","payloadType":"date","x":910,"y":1300,"wires":[["4617c1d82d3d83ab"]]},{"id":"4617c1d82d3d83ab","type":"MSSQL","z":"323faf53d384df59","mssqlCN":"7db681aad1f6f90a","name":"","query":"select * from [Dashboard_ops].[dbo].[VMS_STAGGING] WHERE SHIP = 'TAMBAT' ORDER BY DATE_TIME DESC","outField":"payload","x":1040,"y":1340,"wires":[["d68668db3f32f777","cf7956d31fbe88de"]]},{"id":"d68668db3f32f777","type":"function","z":"323faf53d384df59","name":"Save","func":"flow.set(\"IMOV\",msg.payload);\nmsg.payload = flow.get(\"IMOV\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":1140,"wires":[[]]},{"id":"cf7956d31fbe88de","type":"debug","z":"323faf53d384df59","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1310,"y":1200,"wires":[]},{"id":"886906b945f82154","type":"function","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Store","func":"var d = msg.payload;\nmsg.payload['time'] = msg.payload.EPO;\nmsg.measurement = \"AlldataTulus\";\n\nmsg.topic = \"INSERT INTO `ALLDATASQL`(\";\nmsg.topic += \"`\"+\"time\"+\"`,\";\nmsg.topic += \"`\"+\"ARRIVAL\"+\"`,\";\nmsg.topic += \"`\"+\"CURRENTT\"+\"`,\";\nmsg.topic += \"`\"+\"DEPARTURE\"+\"`,\";\nmsg.topic += \"`\"+\"EPO\"+\"`,\";\nmsg.topic += \"`\"+\"LAT\"+\"`,\";\nmsg.topic += \"`\"+\"LON\"+\"`,\";\nmsg.topic += \"`\"+\"NEXTT\"+\"`,\";\nmsg.topic += \"`\"+\"RECORDDATA\"+\"`,\";\nmsg.topic += \"`\"+\"ROB\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMENGINE_S\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_P\"+\"`,\";\nmsg.topic += \"`\"+\"RPMPROP_S\"+\"`,\";\nmsg.topic += \"`\"+\"SHIP_NAME\"+\"`,\";\nmsg.topic += \"`\"+\"SPEEDCOURSE\"+\"`,\";\nmsg.topic += \"`\"+\"WINDSPEED\"+\"`\";\nmsg.topic += \")VALUES(\";\nmsg.topic += String(d.time)+\",\";\nmsg.topic += \"'\"+String(d.ARRIVAL)+\"',\";\nmsg.topic += \"'\"+String(d.CURRENTT)+\"',\";\nmsg.topic += \"'\"+String(d.DEPARTURE)+\"',\";\nmsg.topic += String(d.EPO)+\",\";\nmsg.topic += String(d.LAT)+\",\";\nmsg.topic += String(d.LON)+\",\";\nmsg.topic += \"'\"+String(d.NEXTT)+\"',\";\nmsg.topic += \"'\"+String(d.RECORDDATA)+\"',\";\nmsg.topic += String(d.ROB)+\",\";\nmsg.topic += String(d.RPMENGINE_P)+\",\";\nmsg.topic += String(d.RPMENGINE_S)+\",\";\nmsg.topic += String(d.RPMPROP_P)+\",\";\nmsg.topic += String(d.RPMPROP_S)+\",\";\nmsg.topic += \"'\"+String(d.SHIP_NAME)+\"',\";\nmsg.topic += \"'\"+String(d.SPEEDCOURSE)+\"',\";\nmsg.topic += String(d.WINDSPEED)+\");\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1580,"wires":[["3f9f9a46d2325276","c8f33989e6fcc5b1"]]},{"id":"3f9f9a46d2325276","type":"influxdb out","z":"323faf53d384df59","g":"9cdee6d271f686a5","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":590,"y":1520,"wires":[]},{"id":"b62a3f2911f9016f","type":"debug","z":"80eab637.b91808","g":"50524935.d705d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":270,"y":500,"wires":[]},{"id":"c630955530ddf6da","type":"json","z":"80eab637.b91808","g":"50524935.d705d8","name":"","property":"payload","action":"obj","pretty":false,"x":400,"y":440,"wires":[["b62a3f2911f9016f","638cbce7.d872e4","a97fa98d.e57c68"]]},{"id":"532b9665.20cea8","type":"subflow:e9b71a55.b25c68","z":"80eab637.b91808","g":"50524935.d705d8","name":"","env":[],"x":690,"y":400,"wires":[["c5f6187c.1da7f8","54657a7f.c1cbd4"],["7aa78bc7.d4c694","d5156c20.db42f","3254795a.fdfa06","999ba0fe.ae798","1539036d.d1b99d"]]},{"id":"71c44d41e40f17dc","type":"debug","z":"80eab637.b91808","g":"5248f06a.76272","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":160,"y":800,"wires":[]},{"id":"70d8eba8e5ccbce1","type":"debug","z":"47ec9b6e.206e24","name":"Cek Send to Apex","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":490,"y":960,"wires":[]},{"id":"fa233e015f85b6b5","type":"function","z":"ebaf9ff27fa33555","name":"","func":"var data = msg.payload;\nvar data1 = {\n    \"time\" : data._terminalEpochTime,\n    \"lat\": data.Latitude,\n    \"lon\": data.Longitude,\n    \"date\": tcc(parseInt(data._terminalEpochTime)*1000000),\n    \"date2\": formatdate(parseInt(data._terminalEpochTime)*1000000)\n};\n\nmsg.payload = data1;\nreturn msg;\n\nfunction tcc(timee){\n    var d = new Date(timee);\n    return d;\n}\n\nfunction formatdate(x){\n    var val = parseInt(String(x));\n    var full = String(new Date(x));\n    var day = String(full.split(\" \")[2]);\n    var month = \"\"\n    if (getMonthFromString(full.split(\" \")[1]) < 10){\n        month += \"0\";\n    }\n    month += String(getMonthFromString(full.split(\" \")[1]));\n    var year = String(full.split(\" \")[3]);\n    var time = String(full.split(\" \")[4].substring(0,5));\n    return day+\"/\"+month+\"/\"+year+\" \"+time;\n    \n    function getMonthFromString(mon){\n       return new Date(Date.parse(mon +\" 1, 2012\")).getMonth()+1\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":220,"wires":[["529a0978fef127a0"]]},{"id":"7f878d94a946f994","type":"inject","z":"ebaf9ff27fa33555","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"_terminalEpochTime\":1711514986,\"_terminalTime\":\"2024-03-27 12:49:45\",\"_groupName\":\"adaro\",\"IncTemparature\":\"36.01055908203125000000000000000000\",\"IncX\":\"0.35156482458114624023437500000000\",\"IncY\":\"0.72510236501693725585937500000000\",\"IncZ\":\"90.01647949218750000000000000000000\",\"Wind_Direction\":\"19\",\"Wind_Speed\":\"2.72376942634582519531250000000000\",\"RPM_ENG_Port_Raw\":\"7\",\"RPM_ENG_Stbd_Raw\":\"6\",\"Heading\":\"-1.55648\",\"DT_Port\":\"70.9285\",\"ST2_Center_Front\":\"58.1341\",\"ST2_Port\":\"25.4964\",\"DT_Stbd\":\"61.5846\",\"ST2_Center_Back\":\"43.2\",\"ST2_Stbd\":\"0\",\"RPM_ENG_PORT\":\"0\",\"RPM_ENG_STBD\":\"0\",\"Speed_Knot\":\"0\",\"Latitude\":\"-2.30518507957458496093750000000000\",\"Longitude\":\"114.87126922607421875000000000000000\",\"SpeedKmph\":\"0.00000000000000000000000000000000\"}","payloadType":"json","x":400,"y":200,"wires":[["fa233e015f85b6b5"]]},{"id":"529a0978fef127a0","type":"debug","z":"ebaf9ff27fa33555","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":820,"y":220,"wires":[]},{"id":"c6bf2d4dd52d4364","type":"influxdb out","z":"ebaf9ff27fa33555","influxdb":"76f4cea2.88ada","name":"Alldata","measurement":"","precision":"","retentionPolicy":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":790,"y":340,"wires":[]},{"id":"e29b1538fc6949d3","type":"inject","z":"ebaf9ff27fa33555","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":360,"wires":[["3a58daecb355a31c"]]},{"id":"3a58daecb355a31c","type":"function","z":"ebaf9ff27fa33555","name":"","func":"msg.query = \"select * from AlldataTulus where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1696114555000\";\nmsg.payload = msg.query;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":340,"wires":[["c6bf2d4dd52d4364"]]},{"id":"0f3822a9f45bce3e","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1440,"wires":[["f25a92b35d80838e"]]},{"id":"f25a92b35d80838e","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from GrafanaTULUS where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\n\nmsg.query += \" time > 1680181201000000000\";\n//2\n//msg.query += \" time >= 1675083601000 and time < 1677762001000\";\n//3\n//msg.query += \" time >= 1677762001000 and time < 1680181201000\";\n//4\n//msg.query += \" time > 1680181201000 and time < 1682859601000\";\n//5\n//msg.query += \" time > 1682859601000 and time < 1685451601000\";\n//6\n//msg.query += \" time > 1685451601000 and time < 1688130001000\";\n//7\n//msg.query += \" time > 1688130001000 and time < 1690722001000\";\n//8\n//msg.query += \" time > 1690722001000 and time < 1693400401000\";\n//9\n//msg.query += \" time > 1693400401000 \";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":1440,"wires":[["6d2677c9a2532c93"]]},{"id":"6d2677c9a2532c93","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":490,"y":1440,"wires":[["08859cedb428149b"]]},{"id":"08859cedb428149b","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14]\n    ar.push(json);\n}\n\nmsg.payload= ar;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1440,"wires":[["6d4469ea80761251"]]},{"id":"6d4469ea80761251","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":835,"y":1440,"wires":[["5ccdc81683c250b3"]]},{"id":"5ccdc81683c250b3","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"tulus-avgreport","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":1025,"y":1440,"wires":[]},{"id":"52654064dc8cf120","type":"mqtt in","z":"323faf53d384df59","name":"","topic":"isb/tulus/sensor_batch","qos":"1","datatype":"json","broker":"4803b37b.b88cfc","nl":false,"rap":true,"rh":0,"x":180,"y":380,"wires":[["ba06f15e9cc19587"]]},{"id":"8cd63949ddb245ea","type":"mqtt in","z":"323faf53d384df59","name":"","topic":"data/isb/tulus/sensorbatch/+","qos":"1","datatype":"json","broker":"4803b37b.b88cfc","nl":false,"rap":true,"rh":0,"x":180,"y":440,"wires":[["ba06f15e9cc19587","205409add2c080ed"]]},{"id":"5ccaca3281be99f6","type":"debug","z":"323faf53d384df59","g":"9cdee6d271f686a5","name":"Cek ROB","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"GrafanaTulus.ROB","targetType":"msg","statusVal":"ROB","statusType":"auto","x":690,"y":1700,"wires":[]},{"id":"7afd8aeb41d1e37c","type":"inject","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":" ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1270,"y":660,"wires":[["1057749a68808eec"]]},{"id":"1057749a68808eec","type":"function","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":" ","func":"msg.payload = [flow.get(\"HalfHour\"),flow.get(\"prevday\")];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1410,"y":660,"wires":[["5fa0bf934287639a","29fdb639fbf9f66e"]]},{"id":"29fdb639fbf9f66e","type":"function","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload[0]))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":660,"wires":[["c32fcf5a924e76f9"]]},{"id":"c32fcf5a924e76f9","type":"debug","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":"30mnt","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1730,"y":640,"wires":[]},{"id":"889d2db58bebcded","type":"debug","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":"new Day","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1740,"y":700,"wires":[]},{"id":"5fa0bf934287639a","type":"function","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":" ","func":"msg.payload = msg.payload[1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":700,"wires":[["889d2db58bebcded"]]},{"id":"4bb71a6d1ddde0f7","type":"function","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":" ","func":"flow.set(\"HalfHour\",undefined);\nflow.set(\"prevday\",undefined);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1410,"y":700,"wires":[[]]},{"id":"835889b25625563e","type":"inject","z":"323faf53d384df59","g":"42acac8bf0d92f0c","name":" reset time","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":1280,"y":700,"wires":[["4bb71a6d1ddde0f7"]]},{"id":"ffb72ba719abe892","type":"inject","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":960,"wires":[["7038dfd64bfb48af"]]},{"id":"c49a8cc6045b560d","type":"influxdb in","z":"323faf53d384df59","g":"93166cf09fa2d088","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":430,"y":960,"wires":[["6a53e7e8748fab07"]]},{"id":"314ee4f73eba8a7d","type":"debug","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":690,"y":1000,"wires":[]},{"id":"79135ffd89104d8a","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"Date","func":"var x = Math.round(parseInt(String(msg.payload.time))/1000);\nvar d = new Date(0);\nd.setUTCSeconds(x);\nmsg.payload = String(d);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":1000,"wires":[["a36234e129c831fb"]]},{"id":"0c1220727504a8a9","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","func":"var d = msg.payload;\nvar keyy = ['FS125','FS121','FS124','FS127','FS112','FS105','FS120','lat','lon','ws'];\nfor(i=0;i<10;i++){\n    if(d[keyy[i]] == \"-1\"){\n        var z = flow.get(\"cekkosong\");\n        z.push(d.time);\n        flow.set(\"cekkosong\",z);\n        msg.payload = null;\n        return msg;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":1040,"wires":[["44c977294b3e6de8"]]},{"id":"8b7e769c330553fb","type":"debug","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"count","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","targetType":"msg","statusVal":"topic","statusType":"auto","x":850,"y":960,"wires":[]},{"id":"a36234e129c831fb","type":"debug","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":990,"y":1000,"wires":[]},{"id":"44c977294b3e6de8","type":"switch","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":1040,"wires":[["ef0f9d471b94acba","89561f3d80785403"]]},{"id":"ef0f9d471b94acba","type":"debug","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1130,"y":1000,"wires":[]},{"id":"de6b3c096af97543","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","func":"msg.payload = flow.get(\"cekkosong\").length;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1000,"wires":[["283a765f5e8b2ad4"]]},{"id":"50b46af16a65c3de","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","func":"flow.set(\"cekkosong\",[]);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1040,"wires":[[]]},{"id":"283a765f5e8b2ad4","type":"debug","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":490,"y":1000,"wires":[]},{"id":"49d758607b9b88dd","type":"inject","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"Reset Kosong","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":220,"y":1040,"wires":[["50b46af16a65c3de"]]},{"id":"7038dfd64bfb48af","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","func":"msg.query = \"select * from TAMBAT3 where \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" time > 1672415999000;\";\nmsg.payload = msg.query;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":960,"wires":[["c49a8cc6045b560d"]]},{"id":"e9d875ea71181e5c","type":"subflow:e9b71a55.b25c68","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"","x":690,"y":960,"wires":[["79135ffd89104d8a","0c1220727504a8a9","8b7e769c330553fb"],[]]},{"id":"6a53e7e8748fab07","type":"function","z":"323faf53d384df59","g":"93166cf09fa2d088","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar arr = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    arr.push(json);\n}\nmsg.payload= arr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":960,"wires":[["314ee4f73eba8a7d","e9d875ea71181e5c"]]},{"id":"89561f3d80785403","type":"link out","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"","links":["667eb3e926e602aa"],"x":1115,"y":1040,"wires":[]},{"id":"f13fe18a8ac2d5bc","type":"inject","z":"323faf53d384df59","g":"93166cf09fa2d088","name":"Cek Kosong","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":210,"y":1000,"wires":[["de6b3c096af97543"]]},{"id":"6d30f5c8b94f8e92","type":"inject","z":"ea265a0.2300aa8","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":560,"wires":[["49ba1a9e9992cb5a"]]},{"id":"dab04cd33340f5c0","type":"influxdb in","z":"ea265a0.2300aa8","influxdb":"76f4cea2.88ada","name":" ","query":"","rawOutput":true,"precision":"n","retentionPolicy":"","org":"organisation","x":570,"y":560,"wires":[["b9224541debee8ef"]]},{"id":"49ba1a9e9992cb5a","type":"function","z":"ea265a0.2300aa8","name":"","func":"msg.query = \"select * from tulusraw  \";\n// var keyy = ['F1','F2','F3','F4','F5','F6','lat','lon','ws'];\n// for(i=0;i<keyy.length;i++){\n//     msg.query += \" \"+String(keyy[i])+\" != '-1' AND\"\n// }\nmsg.query += \" \";\nmsg.payload = msg.query;\nreturn msg; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":560,"wires":[["dab04cd33340f5c0"]]},{"id":"b9224541debee8ef","type":"function","z":"ea265a0.2300aa8","name":" ","func":"var d = msg.payload.results[0].series[0].values;\nvar da = msg.payload.results[0].series[0].columns;\nvar ar = [];\nfor(i=0;i<d.length;i++){\n    var json = {};\n    json[da[0]] = d[i][0];\n    json[da[1]] = d[i][1];\n    json[da[2]] = d[i][2];\n    json[da[3]] = d[i][3];\n    json[da[4]] = d[i][4];\n    json[da[5]] = d[i][5];\n    json[da[6]] = d[i][6];\n    json[da[7]] = d[i][7];\n    json[da[8]] = d[i][8];\n    json[da[9]] = d[i][9];\n    json[da[10]] = d[i][10];\n    json[da[11]] = d[i][11];\n    json[da[12]] = d[i][12];\n    json[da[13]] = d[i][13];\n    json[da[14]] = d[i][14];\n    json[da[15]] = d[i][15];\n    json[da[16]] = d[i][16];\n    json[da[17]] = d[i][17];\n    json[da[18]] = d[i][18];\n    json[da[19]] = d[i][19];\n    json[da[20]] = d[i][20];\n    json[da[21]] = d[i][21];\n    json[da[22]] = d[i][22];\n    json[da[23]] = d[i][23];\n    json[da[24]] = d[i][24];\n    json[da[25]] = d[i][25];\n    json[da[26]] = d[i][26];\n    json[da[27]] = d[i][27];\n    json[da[28]] = d[i][28];\n    json[da[29]] = d[i][29];\n    json[da[30]] = d[i][30];\n    json[da[31]] = d[i][31];\n    json[da[32]] = d[i][32];\n    json[da[33]] = d[i][33];\n    json[da[34]] = d[i][34];\n    json[da[35]] = d[i][35];\n    json[da[36]] = d[i][36];\n    ar.push(json);\n}\nmsg.topic = \"SELECT * FROM `Geofence` ORDER BY `lat1` DESC;\";\nmsg.payload= ar;\nmsg.ar = ar;\nmsg.arrr = ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":560,"wires":[["908191348f489b21"]]},{"id":"908191348f489b21","type":"mysql","z":"ea265a0.2300aa8","mydb":"be353e7e.73b9d","name":"","x":850,"y":560,"wires":[["2e1f1c2008445913"]]},{"id":"2e1f1c2008445913","type":"function","z":"ea265a0.2300aa8","name":" ","func":"msg.Create = {};\nmsg.payload = [msg.payload,msg.ar];\nreturn msg;\nvar d = msg.payload;\nvar lat = 0.0;var lon = 0.0;\nvar res = [];\nfor(j=0;j<msg.ar.length;j++){\n    msg.Valid  = msg.ar[j];\n    lat = parseFloat(msg.Valid.lat); \n    lon = parseFloat(msg.Valid.lon);\n    var arr = [];\n    for(i=0;i<d.length;i++){\n        try{\n            if(d[i].lat3 == null || d[i].lat4 == null){\n                continue;\n            }\n            var maxcor = [Math.max(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.max(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            var mincor = [Math.min(d[i].lat1,d[i].lat2,d[i].lat3,d[i].lat4),Math.min(d[i].long1,d[i].long2,d[i].long3,d[i].long4)];\n            if(lat>mincor[0] && lat<maxcor[0] && lon>mincor[1] && lon<maxcor[1]){\n                msg.ar[j]['Current'] = d[i].geofenceName;\n                res.push(d[i].geofenceName);\n            }\n        }catch(x){\n            msg.payload = null;\n            return msg;\n        }\n    }\n}\nmsg.payload = msg.ar;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":560,"wires":[["131d00a5f321fa95"]]},{"id":"286892a0d3904863","type":"mqtt out","z":"ea265a0.2300aa8","name":"","topic":"tulus-report2","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4803b37b.b88cfc","x":1290,"y":560,"wires":[]},{"id":"131d00a5f321fa95","type":"json","z":"ea265a0.2300aa8","name":"","property":"payload","action":"str","pretty":false,"x":1130,"y":560,"wires":[["286892a0d3904863"]]},{"id":"5cdbfddb9a4ef822","type":"json","z":"31a1ac1c.c57c44","g":"54e9d374.2101fc","name":"","property":"payload","action":"obj","pretty":false,"x":210,"y":60,"wires":[["fb7a9dbd.53871","edeb8d83.210da"]]}]